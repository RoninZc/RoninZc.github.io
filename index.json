[{"categories":["æ‚è®°"],"content":"ä¹‹å‰ä¸‹è½½çš„ CFW å’Œ PicGo çš„ ARM ç‰ˆæœ¬ä¸€ç›´æç¤ºæŸåğŸ˜« sudo xattr -d com.apple.quarantine \"/Applications/Clash for Windows.app\" æ‰§è¡Œå®Œæˆé‡æ–°æ‰“å¼€å³å¯ ","date":"2023-04-04","objectID":"/posts/mac-arm-%E5%8C%85%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D/:0:0","tags":["Mac","ARM"],"title":"Mac ARM åŒ…æŸåä¿®å¤","uri":"/posts/mac-arm-%E5%8C%85%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D/"},{"categories":["æ‚è®°"],"content":" å‰è¨€æœ€è¿‘ä¸€ç›´åœ¨æŠ˜è…¾å…³äº Clash ç›¸å…³çš„å†…å®¹ï¼Œä¸€ç›´æ²¡ä»”ç»†äº†è§£å…·ä½“çš„åŠŸèƒ½ æ­£å¥½æœ‰ç‚¹æ—¶é—´ä¸Šç½‘å†²æµªğŸ„ï¼ˆä¸æ˜¯æ‘¸é±¼ï¼‰ ä¹Ÿå› ä¸º mac ä½¿ç”¨ doh ç”¨ cloudflared ä¸€ç›´ä¸ç¨³å®šï¼Œæ— æ³•æ­£å¸¸è§£æå¯¼è‡´æœ‰ç‚¹çƒ¦èº ä¸€ä¸åšäºŒä¸ä¼‘å°è¯•ä¸€ä¸‹ CFW çš„ TUN æ¨¡å¼ ","date":"2023-04-04","objectID":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/:1:0","tags":["CFW"],"title":"CFW ä¸ªäººä½¿ç”¨è®°å½•","uri":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"},{"categories":["æ‚è®°"],"content":" æ“ä½œ Fndroid/clash_for_windows_pkg (github.com) CFW ç‰ˆæœ¬ v0.20.19 ","date":"2023-04-04","objectID":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/:2:0","tags":["CFW"],"title":"CFW ä¸ªäººä½¿ç”¨è®°å½•","uri":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"},{"categories":["æ‚è®°"],"content":" 1ã€å®‰è£… Serviceä¹Ÿå°±æ˜¯å·¦è¾¹èœå•ä¸Šçš„ General -\u003e Service Modelï¼Œç‚¹å‡»å³ä¾§çš„ Manage å†ç‚¹å‡» install å³å¯ï¼Œå¦‚ä¹‹å‰å·²ç»å®‰è£…è¿‡å¯ç‚¹å‡» update æ­¤æ—¶ Service Mode å³ä¾§çš„å°åœ°çƒå˜ç»¿äº†ï¼Œå°±ä»£è¡¨ä½ ç»¿å®‰è£…æˆåŠŸäº† ","date":"2023-04-04","objectID":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/:2:1","tags":["CFW"],"title":"CFW ä¸ªäººä½¿ç”¨è®°å½•","uri":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"},{"categories":["æ‚è®°"],"content":" 2ã€Mixin é…ç½®ä¸‹é¢ç»™å‡ºæˆ‘è‡ªå·±å¸¸ç”¨çš„ Mixin é…ç½® ç‚¹å‡» Mixin å³ä¾§çš„å°é½¿è½® âš™ï¸ï¼Œåœ¨å¼¹å‡ºçš„ç¼–è¾‘å™¨é‡Œå°†ä¸‹åˆ—å†…å®¹ç›´æ¥å…¨éƒ¨ç²˜è´´å¤åˆ¶ æ³¨æ„é…ç½®ç”Ÿæ•ˆéœ€è¦å¼€å…³ä¸€æ¬¡ Mixin æ¨¡å¼ï¼Œä¹Ÿå¯ç‚¹å‡» Clash Core å³ä¾§çš„èŠ¯ç‰‡æŒ‰é’®ï¼ˆå¯èƒ½ï¼‰å¯ä»¥æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½® mixin: # Mixin é…ç½®æ–‡ä»¶ # DNSæœåŠ¡å™¨ dns: # å¼€å¯Clashå†…ç½®DNSæœåŠ¡å™¨ # é»˜è®¤ä¸ºfalse enable: true # ä½¿ç”¨ ipv6 è§£æ # é»˜è®¤ä¸º false ipv6: false # DNS ç›‘å¬ç«¯å£ listen: 0.0.0.0:53 # è§£ænameserverå’Œfallbackçš„DNSæœåŠ¡å™¨ # å¡«å…¥çº¯IPçš„DNSæœåŠ¡å™¨ default-nameserver: - 114.114.114.114 - 119.29.29.29 - 223.5.5.5 - 223.6.6.6 - 8.8.8.8 - 8.8.4.4 - 4.2.2.1 - 4.2.2.2 - 1.1.1.1 # æ¨¡å¼fake-ip or redir-host enhanced-mode: fake-ip # ä½¿ç”¨æœ¬åœ° hosts æ–‡ä»¶ use-hosts: true nameserver: # è…¾è®¯DoH DNS Serveråœ°å€ - https://doh.pub/dns-query - https://sm2.doh.pub/dns-query # è…¾è®¯DoT DNS Serveråœ°å€ - tls://dot.pub # é˜¿é‡ŒDoH DNS Serveråœ°å€ - https://dns.alidns.com/dns-query # é˜¿é‡ŒDoT DNS Serveråœ°å€ - tls://dns.alidns.com # 360 DoH DNS Serveråœ°å€ - https://doh.360.cn # 360 DoT DNS Serveråœ°å€ - tls://dot.360.cn fallback: # cloudflare DoH DNS åœ°å€ - https://1.0.0.1/dns-query # Google DoH DNS Serveråœ°å€ - https://dns.google/dns-query # Google DoT DNS Serveråœ°å€ - tls://dns.google # fake-ipä»…æœ‰ fake-ip-filter: - \"*.lan\" - \"*.local\" - \"*.localhost\" - \"*.msftconnecttest.com\" - \"*.msftncsi.com\" - msftconnecttest.com - msftncsi.com # fake-ipä»…æœ‰ fallback-filter: geoip: true geoip-code: CN ipcidr: - 0.0.0.0/8 - 10.0.0.0/8 - 100.64.0.0/10 - 127.0.0.0/8 - 169.254.0.0/16 - 172.16.0.0/12 - 192.0.0.0/24 - 192.0.2.0/24 - 192.168.0.0/16 - 192.88.99.0/24 - 198.18.0.0/15 - 198.51.100.0/24 - 203.0.113.0/24 - 224.0.0.0/4 - 240.0.0.0/4 - 255.255.255.255/32 domain: - \"+.facebook.com\" - \"+.google.com\" - \"+.youtube.com\" tun: # Tun é…ç½® enable: true # å¯ç”¨ Tun æ¨¡å¼ stack: system # gvisor/system ä½¿ç”¨ system stack è¯·æŒ‰ç…§æœ¬æ–‡åé¢é˜²ç«å¢™æ”¾è¡Œç¨‹åº dns-hijack: - 198.18.0.2:53 # æœ¬åœ°åŠ«æŒ DNS åœ°å€ï¼Œæ— éœ€ä¿®æ”¹ auto-route: true auto-detect-interface: true # è‡ªåŠ¨æ£€æµ‹å‡ºå£ç½‘å¡ ","date":"2023-04-04","objectID":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/:2:2","tags":["CFW"],"title":"CFW ä¸ªäººä½¿ç”¨è®°å½•","uri":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"},{"categories":["æ‚è®°"],"content":" 3ã€ä½¿ç”¨åœ¨æ§åˆ¶å°ä¸­ ping google.com å¯ä»¥çœ‹åˆ°å·²ç»è¢«ä»£ç†åˆ° fake-ip ï¼Œå†æ‰§è¡Œ curl google -v æ­å–œä½ å·²ç»æˆåŠŸäº†ï½ ","date":"2023-04-04","objectID":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/:2:3","tags":["CFW"],"title":"CFW ä¸ªäººä½¿ç”¨è®°å½•","uri":"/posts/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"},{"categories":["æŠ˜è…¾"],"content":" å®‰è£… HomeBrewï¼ˆå·²æœ‰åˆ™å¿½ç•¥ï¼‰ /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)\" ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:1","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" å®‰è£… cloudflared brew install cloudflare/cloudflare/cloudflared ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:2","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" åˆ›å»ºé…ç½®æ–‡ä»¶ mkdir -p /usr/local/etc/cloudflared vim /usr/local/etc/cloudflared/config.yaml proxy-dns: true proxy-dns-upstream: - https://doh.pub/dns-query - https://1.1.1.1/dns-query - https://1.0.0.1/dns-query è¿™é‡Œä½¿ç”¨çš„æ˜¯é»˜è®¤ DNSPod çš„ DoH æœåŠ¡ ä¸‹åˆ—ä¸¤ä¸ªæ˜¯ Cloudflare æä¾›çš„ DoH æœåŠ¡ç”¨äºå†—ä½™ ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:3","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" å¯åŠ¨æœåŠ¡ sudo cloudflared service install // ä¹‹åä¸æƒ³ä½¿ç”¨çš„è¯å¯ä»¥æ‰§è¡Œ sudo cloudflared service uninstall ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:4","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" ä¿®æ”¹æœ¬æœºè®¾å®šã€Œç³»ç»Ÿè®¾ç½®ã€-\u003eã€ŒWi-Fiã€-\u003eã€Œè¯¦ç»†ä¿¡æ¯ã€-\u003eã€ŒDNSã€ ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:5","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" æµ‹è¯• dig ronin-zc.com æŸ¥çœ‹ç›¸åº”è¯·æ±‚çš„ DNS æœåŠ¡å™¨ ip ","date":"2023-02-08","objectID":"/posts/macos%E4%BD%BF%E7%94%A8doh/:0:6","tags":["MacOS","DNS"],"title":"MacOSä½¿ç”¨DoH","uri":"/posts/macos%E4%BD%BF%E7%94%A8doh/"},{"categories":["æŠ˜è…¾"],"content":" é—®é¢˜è¿™ä¸ªé—®é¢˜æ˜¯æœ¬äººåœ¨æŠ˜è…¾è‡ªå·±çš„è‰¯å¿ƒäº‘ï¼ˆå‡‰å¿ƒäº‘ï¼‰çš„æ—¶å€™å‘ç°çš„ï¼Œå½“æ—¶æ˜¯æƒ³ä½¿ç”¨ä¸€ä¸ªå‰ç½® Nginx è½¬å‘æ‰€æœ‰çš„è¯·æ±‚ï¼ŒåŒæ—¶è¿›è¡Œæ—¥å¿—çš„è®°å½•ç­‰ç­‰ã€‚ å½“æˆ‘å†™å®Œé…ç½®æ–‡ä»¶ï¼Œæµ‹è¯•æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯å½“æˆ‘å…³é—­äº†è‡ªå·±æ­å»ºçš„ es æœåŠ¡ï¼Œæˆ‘å‘ç°æˆ‘è®¿é—®æ‰€æœ‰çš„æœåŠ¡éƒ½ 500 äº†ï¼Œè¿™æ—¶æˆ‘æŸ¥çœ‹ nginx error æ—¥å¿—ï¼Œè®°å½•å¦‚ä¸‹ [emerg] 1#1: host not found in upstream \"es\" in /etc/nginx/conf.d/es.conf:13 ","date":"2022-07-20","objectID":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/:1:0","tags":["Docker","Nginx"],"title":"Docker éƒ¨ç½² Nginx å‡ºç°ã€Œhost not found in upstreamã€é—®é¢˜è§£å†³","uri":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"},{"categories":["æŠ˜è…¾"],"content":" è§£å†³åœ¨ nginx çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ server { listen 80; server_name test.com; # æ·»åŠ é¢å¤–çš„ dns è§£æåœ°å€ï¼Œæ­¤åœ°å€ä¸º docker å†…éƒ¨ dns åœ°å€ # å½“ proxy_pass ä¸ºå˜é‡æ—¶ å¿…é¡»æ·»åŠ  resolver 127.0.0.11; location / { set $tmp es; proxy_pass http://$tmp; } } ","date":"2022-07-20","objectID":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/:2:0","tags":["Docker","Nginx"],"title":"Docker éƒ¨ç½² Nginx å‡ºç°ã€Œhost not found in upstreamã€é—®é¢˜è§£å†³","uri":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"},{"categories":["æŠ˜è…¾"],"content":" åŸç†nginx å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å…¶é…ç½®çš„ upstream è¿›è¡Œ DNS è§£ææµ‹è¯•ï¼Œå¦‚æœæ— æ³•è§£ææˆåŠŸåˆ™ä¼šæŠ¥é”™æ— æ³•å¯åŠ¨ã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°† upstream ä¿®æ”¹ä¸ºå˜é‡æ—¶ï¼Œnginx ä¸ä¼šè¿›è¡Œæµ‹è¯•ï¼Œä»¥æ­¤ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚ resolver åˆ™ä¸º Nginx è®¾ç½® DNS æœåŠ¡å™¨ï¼ŒNginxä¼šåŠ¨æ€åˆ©ç”¨ resolver è®¾ç½®çš„DNSæœåŠ¡å™¨ï¼ˆæœ¬æœºè®¾ç½®çš„ DNS æœåŠ¡å™¨æˆ– /etc/hosts æ— æ•ˆï¼‰ï¼Œå°†åŸŸåè§£ææˆ IPï¼Œproxy æ¨¡å—ä¼šå°†è¯·æ±‚è½¬å‘åˆ°è§£æåçš„IPä¸Šã€‚ å¦‚æœä¸æ·»åŠ çš„è¯ï¼Œè®¿é—®å°†ä¼š502 Bad Gatewayï¼ŒåŒæ—¶æ—¥å¿—ä¼šæ˜¾ç¤º no resolver defined to resolve es ","date":"2022-07-20","objectID":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/:2:1","tags":["Docker","Nginx"],"title":"Docker éƒ¨ç½² Nginx å‡ºç°ã€Œhost not found in upstreamã€é—®é¢˜è§£å†³","uri":"/posts/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"},{"categories":["å­¦ä¹ "],"content":" è¿™ç¯‡æ–‡ç« ç”¨ä½œè‡ªå·±å­¦ä¹  k8s çš„ç¬”è®°ï¼Œå­¦ä¹ çš„èµ„æ–™ä¸ºbç«™çš„è§†é¢‘ 2021 å¹´æœ«å€¾åŠ›æ‰“é€  Kubernetes å…¥é—¨è‡³ç²¾é€š - 2022 å¹´å¹¸ç¦çš„å¼€èƒƒèœ_å“”å“©å“”å“©_bilibili æœ¬æ–‡ç« ä¸ºæœ¬äººå­¦ä¹ æ‰€ç”¨ï¼Œå¦‚éœ€è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:0:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 1ã€åŸºç¡€æ¦‚å¿µ åŸºç¡€ç»„ä»¶ kubectl api server scheduler replication controller etcd kubelet kube proxy firewall æ’ä»¶ CoreDNS è´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾› DNS æœåŠ¡ Ingress Controller ä¸º k8s ä¸­çš„æœåŠ¡æä¾›å¤–ç½‘å…¥å£ Prometheus ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›èµ„æºç›‘æ§èƒ½åŠ›ï¼Œæ—¶åºæ•°æ®åº“ Dashboard æä¾› B/S çš„è®¿é—®ä½“ç³»ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ web è¿›è¡Œé›†ç¾¤ç®¡ç†å’Œè®¾ç½®ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å¦‚ï¼šrancher Federation æä¾›è·¨å¯ç”¨åŒºçš„é›†ç¾¤ï¼Œæä¾›ä¸åŒæ•°æ®ä¸­å¿ƒçš„ K8S é›†ç¾¤çš„ç®¡ç†èƒ½åŠ› ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:1:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 2ã€Podåœ¨ä¸‹è¾¾åˆ›å»º pod çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªè¢«åˆå§‹åŒ–çš„å®¹å™¨ä¸ºpauseï¼Œä½œç”¨ä¸ºåˆå§‹åŒ–ç½‘ç»œæ ˆï¼ŒæŒ‚è½½å­˜å‚¨å·ç­‰ã€‚åç»­ç»§ç»­åˆ›å»ºå¯¹åº”çš„ containerï¼Œè¿™äº›åˆ›å»ºçš„ container éƒ½ä¼šä¸åˆå§‹å®¹å™¨pause å…±äº«ç½‘ç»œæ ˆå’Œå­˜å‚¨ç­‰ï¼Œç±»ä¼¼ docker ä¸­çš„--netå’Œ--volumes-fromã€‚è¿™æ ·åœ¨ä¸€ä¸ª Pod ä¸­çš„ container å¯ä»¥ç›´æ¥é€šè¿‡å›ç¯æ¥å£ç›¸äº’è®¿é—®ã€‚ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:2:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" Podç§ç±» è‡ªä¸»å¼ Pod æ§åˆ¶å™¨ç®¡ç†çš„ Podï¼ˆæ¨èï¼‰ ReplicationController \u0026 ReplicaSet \u0026 Deployment HPAï¼ˆHorizontalPodAutoScaleï¼‰ StatefullSet DarmonSet Job \u0026 Cronjob è‡ªå®šä¹‰æ§åˆ¶å™¨â€¦ ä¸åšè®¨è®º ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:2:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" æ§åˆ¶å™¨ç§ç±» Replication Controller ï¼ˆRCï¼‰\u0026 ReplicaSetï¼ˆRSï¼‰ \u0026 Deploymentç”¨æ¥ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod æ¥æ›¿ä»£ï¼Œè€Œå¦‚æœå¼‚å¸¸å¤šå‡ºçš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ã€‚ åœ¨æ–°ç‰ˆæœ¬çš„ K8S ä¸­å»ºè®®ä½¿ç”¨ RS æ¥å–ä»£ RCã€‚ RS çš„æœ¬è´¨å’Œ RC æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œå¹¶ä¸” RS æ”¯æŒé›†åˆå¼çš„æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆtag selectorï¼‰ã€‚ è™½ç„¶ RS å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬å»ºè®®ä½¿ç”¨ Deployment æ¥è‡ªåŠ¨ç®¡ç† RSï¼Œè¿™æ ·å¯ä»¥æ— éœ€æ‹…å¿ƒå’Œå…¶ä»–æœºåˆ¶ä¸å…¼å®¹çš„é—®é¢˜ã€‚æ¯”å¦‚ RS ä¸æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼ˆrolling-updateï¼‰ä½† Deployment æ”¯æŒã€‚ æ»šåŠ¨æ›´æ–° # æ›´æ–°å‰ Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€ â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š3ã€ â”œâ”€ Pod:v1 â”œâ”€ Pod:v1 â””â”€ Pod:v1 # æ›´æ–°Podæ¨¡æ¿:v2 # æ›´æ–°ä¸­ï¼š Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€ â”œâ”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š2ã€ â”‚ â”œâ”€â”€ Pod:v1 â”‚ â””â”€â”€ Pod:v1 â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š1ã€ â””â”€ Pod:v2 # æ›´æ–°å®Œæ¯•ï¼š Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€ â”œâ”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š0ã€ â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š3ã€ â”œâ”€ Pod:v2 â”œâ”€ Pod:v2 â””â”€ Pod:v2 æ»šåŠ¨æ›´æ–°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ RS æ§åˆ¶å™¨ï¼Œä»¥æ­¤æ¥åˆ›å»ºæ–°ç‰ˆæœ¬çš„ Podï¼Œæ­¤æ—¶æŠŠè€ç‰ˆæœ¬çš„ RS æ§åˆ¶å™¨çš„æœŸæœ›æ•°é‡ä¸€ä¸ªä¸ªè°ƒæ•´è‡³0ï¼Œè¿™æ ·å°±å®Œæˆäº†æ»šåŠ¨æ›´æ–°ã€‚ HPAï¼ˆHorizontalPodAutoScaleï¼‰è‡ªåŠ¨æ‰©ç¼©å®¹å¯ä»¥æ ¹æ® Pod çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œè°ƒæ•´å‰¯æœ¬æ•°é‡ï¼Œä¾èµ–äº RCã€RSã€Deployment ä¹‹ä¸Š StatefulSet æœåŠ¡åˆ†ç±» æœ‰çŠ¶æ€çš„æœåŠ¡ æ— çŠ¶æ€æœåŠ¡ ä¸­å¿ƒåŒ–æœåŠ¡ å»ä¸­å¿ƒåŒ–æœåŠ¡ ä¸ºäº†è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜è€Œè®¾è®¡å‡ºæ¥ï¼Œå¯ç”¨æ¥æœ‰åºæ‰©å®¹ç¼©ï¼Œå…¶åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ï¼Œå³ Pod é‡æ–°è°ƒåº¦åè¿˜æ˜¯èƒ½è®¿é—®åˆ°ç›¸åŒçš„æŒä¹…åŒ–æ•°æ®ï¼ŒåŸºäº PVC å®ç° ç¨³å®šçš„ç½‘ç»œæ ‡å¿—ï¼Œå³ Pod é‡æ–°è°ƒåº¦åï¼Œå…¶ PodName å’Œ HostName ä¸å˜ï¼ŒåŸºäº Headless Serviceï¼ˆå³æ²¡æœ‰ Cluster IP çš„ Serviceï¼‰å®ç° æœ‰åºéƒ¨ç½²ï¼Œæœ‰åºæ‰©å±•ï¼Œå³ Pod æ˜¯æœ‰é¡ºåºçš„ï¼Œåœ¨éƒ¨ç½²æˆ–è€…æ‰©å±•çš„æ—¶å€™è¦ä¾æ®å®šä¹‰çš„é¡ºåºä¾æ¬¡è¿›è¡Œï¼ˆå³ä» 0 åˆ° N-1ï¼Œåœ¨ä¸‹ä¸€ä¸ª Pod è¿è¡Œä¹‹å‰ï¼Œæ‰€æœ‰ä¹‹å‰çš„ Pod å¿…é¡»éƒ½æ˜¯ Running å’Œ Ready çŠ¶æ€ï¼‰ï¼ŒåŸºäº init containers æ¥å®ç° æœ‰åºæ”¶ç¼©ï¼Œæœ‰åºåˆ é™¤ï¼ˆå³ N-1åˆ° 0ï¼‰ DaemonSetç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰ Node åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Podã€‚å½“æœ‰ Node ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤æ‰€æœ‰ç”±å®ƒåˆ›å»ºçš„ Pod ç»å…¸ç”¨æ³•ï¼š è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œ glusterdï¼Œceph åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œæ—¥å¿—æ‰‹æœº deamonï¼Œä¾‹å¦‚ fluentdï¼Œlogstash åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œç›‘æ§ deamonï¼Œä¾‹å¦‚ Prometheus Node Exporter Job \u0026 cronJobJob è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ª Pod æˆåŠŸç»“æŸ Cron Job ç®¡ç†åŸºäºæ—¶é—´çš„ Jobï¼Œå³ï¼š åœ¨ç»™å®šæ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡ å‘¨æœŸæ€§çš„åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:2:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ç½‘ç»œæ¨¡å‹K8S çš„ç½‘ç»œæ¨¡å‹å‡å®šäº†æ‰€æœ‰ Pod éƒ½åœ¨ä¸€ä¸ªå¯ä»¥ç›´æ¥è¿é€šçš„æ‰å¹³çš„ç½‘ç»œç©ºé—´ä¸­ï¼Œè¿™åœ¨ GCEï¼ˆGoogle Compute Engineï¼‰é‡Œé¢æ˜¯ç°æˆçš„ç½‘ç»œæ¨¡å‹ï¼ŒK8S å‡å®šè¿™ä¸ªç½‘ç»œå·²ç»å­˜åœ¨ã€‚è€Œåœ¨ç§æœ‰äº‘é‡Œæ­å»º K8S é›†ç¾¤ï¼Œå°±ä¸èƒ½å‡å®šè¿™ä¸ªç½‘ç»œå·²ç»å­˜åœ¨äº†ã€‚æˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°è¿™ä¸ªç½‘ç»œå‡è®¾ï¼Œå°†ä¸åŒèŠ‚ç‚¹ä¸Šçš„ Docker å®¹å™¨ä¹‹é—´çš„äº’ç›¸è®¿é—®å…ˆæ‰“é€šï¼Œç„¶åè¿è¡Œ K8Sã€‚ FlannelFlannel æ˜¯ CoreOS å›¢é˜Ÿé’ˆå¯¹ Kubernetes è®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„ Docker å®¹å™¨éƒ½å…·æœ‰å…¨é›†ç¾¤å”¯ä¸€çš„è™šæ‹Ÿ IP åœ°å€ã€‚è€Œä¸”å®ƒè¿˜èƒ½åœ¨è¿™äº› IP åœ°å€ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¦†ç›–ç½‘ç»œï¼ˆOverlay Networkï¼‰ï¼Œé€šè¿‡è¿™ä¸ªè¦†ç›–ç½‘ç»œï¼Œå°†æ•°æ®åŒ…åŸå°ä¸åŠ¨åœ°ä¼ è¾“åˆ°ç›®æ ‡å®¹å™¨å†…ã€‚åŸºäº etcd å®ç°ã€‚ å®ç°æ­¥éª¤ï¼š Flanneld å‘ etcd ç”³è¯·å½“å‰ Pod çš„ç½‘æ®µï¼Œä¿®æ”¹å½“å‰ Docker0 çš„IP ä¼šå¸¦ä¸Šå½“å‰æœºå™¨çš„ç‰©ç†ç½‘å¡åœ°å€ï¼Œè¿™æ ·å°±åœ¨ etcd é‡Œæ ‡è¯†äº†è™šæ‹Ÿç½‘æ®µä¸çœŸå®IPä¹‹é—´çš„å…³ç³» å½“ä¸€ä¸ª Pod å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡å¯¹æ–¹çš„è™šæ‹ŸIPå°±å¯ä»¥æ‰¾åˆ°çœŸå®IPäº† è¯·æ±‚æµè½¬ï¼ˆæ ¹æ®å›¾è§‚å¯Ÿï¼‰ app2 å‘é€ä¸€ä¸ªæ•°æ®åŒ…ç»™10.1.20.3ï¼Œå‘ç°æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ•°æ®åŒ…ä¼ é€’ç»™ç½‘å…³ æ­¤æ—¶æ•°æ®åŒ…è¢« Flanneld æ‰€æ•è·ï¼ˆFlannel0 ç›‘å¬çš„ä¸º 10.1.15.0ï¼Œæ³¨æ„è¿™ä¸ª0ï¼‰ä¼ é€’ç»™å¯¹åº”çš„å¦å¤–ä¸€ä¸ª Flanneldï¼ˆä»etcdè·å–ï¼‰ æ­¤æ—¶ Flanneld ä¼šå¯¹æ•°æ®åŒ…è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œç±»ä¼¼ä¸€ä¸ªå¿«é€’é‡Œæ˜¯å¦å¤–ä¸€ä¸ªå¿«é€’ æ¥æ”¶åˆ°æ•°æ®åŒ…åè¿›è¡Œæ‹†åŒ…ï¼Œåœ¨å¯¹åº”çš„ Docker0 ä¸­å¹¿æ’­ï¼Œè¿™æ ·ä¹Ÿå°±èƒ½æ”¶åˆ°äº† å›åº”åŒç† ç½‘ç»œé€šè®¯æ¨¡å¼ åŒ Pod é—´ä¸åŒå®¹å™¨é—´çš„ç½‘ç»œé€šè®¯ï¼šæœ¬åœ°å›ç¯ ä¸åŒ Pod é—´çš„é€šè®¯ åŒç‰©ç†æœºï¼šDocker0 ç½‘æ¡¥å®ç°æŠ¥æ–‡è½¬å‘ ä¸åŒç‰©ç†æœºï¼šflannel UDP æ•°æ®åŒ…äºŒæ¬¡å°è£… svc ç½‘ç»œä¸ Pod é—´çš„é€šè®¯ éš”ç¦»ï¼šnamespace network ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:2:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 3ã€K8Så®‰è£…","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:3:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" å‰ç½®å‡†å¤‡ å®‰è£…é…ç½® æ¨èå®‰è£…åœ¨å•ç½‘å¡æœºå™¨ CPU \u003e= 2ï¼Œå†…å­˜ 3G ä»¥ä¸Šï¼Œç£ç›˜ 100G å…³é—­ SWAP åˆ†åŒº /boot 800m / å…¨éƒ¨ seliunxï¼Œfirewall stopï¼Œiptable none K8Så®‰è£…3ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªè½¯è·¯ç”±ï¼ŒåŒç½‘å¡ ç½‘å¡1: ä»…ä¸»æœº ç½‘å¡2: NAT ä¸Šç½‘ å®‰è£…å·¥å…·åŒ…ï¼ˆå¯é€‰ï¼‰ sudo apt-get install -y conntrack ntpdate ntp ipvsadm ipset iptables curl sysstat wget net-tools git åŒæ­¥æ—¶åŒº sudo apt install ntpdate sudo ntpdate ntp.aliyun.com å…³é—­swap sudo swapoff -a # ä¸´æ—¶å…³é—­ sed -ri 's/.swap./#\u0026/' /etc/fstab # æ°¸ä¹…å…³é—­ å…è®¸ iptables æ¡¥æ¥æµé‡ cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF # è®¾ç½®ç½‘å¡å…è®¸è½¬å‘ ipv4 æµé‡ sudo sysctl -w net.ipv4.ip_forward=1 sudo sysctl --system ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:3:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" å®‰è£… Kubernetes æºç åŒ…ç¼–è¯‘å®‰è£…ï¼ˆéš¾åº¦è¿‡é«˜ï¼‰ å¯å‚è€ƒKubernetes - äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£… - v1.18 (cloudmessage.top) å®¹å™¨åŒ–å®‰è£… kubeadm å®˜æ–¹ è¯ä¹¦æœ‰æ•ˆæœŸ 1 å¹´ï¼ˆéœ€è¦ä¿®æ”¹æºç ï¼Œè®¾ç½®ç”Ÿæˆè¯ä¹¦æœ‰æ•ˆæ—¶é—´ï¼‰ rancher sealos 1ã€å®‰è£…å®¹å™¨ç»„ä»¶ docker ARM ç³»ç»Ÿå®‰è£… X86_64 å¯å‚è€ƒä¸Šæ–‡ï¼Œæ³¨æ„ä¿®æ”¹å¯¹åº”ç³»ç»Ÿæ¶æ„å³å¯ containerd k8s v1.24.0å K8Sv1.24.0-containerdå®‰è£…æ•™ç¨‹ 2ã€å®‰è£… Kubeadm ï¼ˆä¸»ä»é…ç½®ï¼‰ Kubeadm å¯åŠ¨æµç¨‹ Master Systemd \u003e kubelet \u003e å®¹å™¨ç»„ä»¶ \u003e Kubernetes å®¹å™¨ç»„ä»¶åœ¨ k8s v1.24.0 ç‰ˆæœ¬å·²å¼ƒç”¨ Docker shim ä½¿ç”¨äº†æ–°ç»„ä»¶ CRI DOCKERD # æ·»åŠ é˜¿é‡Œäº‘é•œåƒæº sudo apt update \u0026\u0026 sudo apt install -y apt-transport-https sudo curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add - # æ·»åŠ é˜¿é‡Œäº‘æˆ–è€…å®˜æ–¹ api æº # é˜¿é‡Œäº‘ echo \"deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list # å®˜æ–¹ sudo curl -o /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg echo \"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list # å®‰è£…è½¯ä»¶ sudo apt update \u0026\u0026 sudo apt install -y kubelet kubeadm kubectl # å¼€æœºè‡ªå¯ systemctl enable kubelet.service # æ³¨æ„ï¼Œæ­¤æ—¶å¯èƒ½ kublet æ²¡æ­£å¸¸è¿è¡Œï¼Œä¸ç”¨ç®¡ç»§ç»­å¾€ä¸‹èµ° 3ã€åˆå§‹åŒ–ä¸»èŠ‚ç‚¹ # æ‰“å° kubeadm é»˜è®¤é…ç½® sudo kubeadm config print init-defaults \u003e kubeadm-config.yaml # ä¿®æ”¹ï¼š`localAPIEndpoint.advertiseAddress`çš„å€¼ä¸ºå½“å‰ä¸»èŠ‚ç‚¹çš„ ip åœ°å€ ... localAPIEndpoint: advertiseAddress: 1.2.3.4 # è¿™é‡Œ bindPort: 6443 ... # ä¿®æ”¹ï¼š`nodeRegistration.name` çš„å€¼ä¸ºå½“å‰ä¸»èŠ‚ç‚¹åç§° Â·Â·Â· nodeRegistration: criSocket: unix:///var/run/containerd/containerd.sock imagePullPolicy: IfNotPresent name: k8s-master01 # è¿™é‡Œ taints: null Â·Â·Â· # æ·»åŠ  Pod ç½‘æ®µï¼ŒFlannel éœ€è¦å·¥ä½œåœ¨æŒ‡å®šçš„ç½‘æ®µ ... networking: dnsDomain: cluster.local serviceSubnet: 10.96.0.0/12 podSubnet: 10.244.0.0/16 # æ–°å¢è¯¥è¡Œ Â·Â·Â· # è®¾ç½®è´Ÿè½½å‡è¡¡æ–¹å¼ä¸º ipvsï¼ˆå¯é€‰ï¼‰ï¼Œä¸‹åˆ—é…ç½®æ·»åŠ åˆ°æœ«å°¾ï¼Œæ³¨æ„ --- ä¹Ÿéœ€è¦æ·»åŠ  Â·Â·Â· --- apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration featureGates: SupportIPVSProxyMode: true mode: ipvs Â·Â·Â· # k8s.gcr.io å›½å†…æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒåœ°å€ sed -i 's/k8s.gcr.io/registry.cn-hangzhou.aliyuncs.com\\/google_containers/g' kubeadm-config.yaml # é…ç½®æ–‡ä»¶å‡†å¤‡å®Œæ¯•ï¼Œå¼€å§‹åˆå§‹åŒ– sudo kubeadm init --config=kubeadm-config.yaml --ignore-preflight-errors=all --v=5 | tee kubeadm-init.log # åˆå§‹åŒ–æˆåŠŸæ ¹æ®é¡µé¢æç¤º # é root ç”¨æˆ· mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config # root ç”¨æˆ· export KUBECONFIG=/etc/kubernetes/admin.conf # æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ kubectl cluster-info 4ã€å·¥ä½œèŠ‚ç‚¹åŠ å…¥ # åœ¨åˆå§‹åŒ–ä¸»èŠ‚ç‚¹æˆåŠŸåï¼Œæ‰“å°å‡ºçš„æ—¥å¿—å†…çš„æœ€åä¸€æ®µï¼Œå‘Šè¯‰äº†æˆ‘ä»¬åº”è¯¥å¦‚ä½•åŠ å…¥ä¸€ä¸ªä¸»èŠ‚ç‚¹ # ä¹Ÿå¯ä»¥ cat kubeadm-init.log æŸ¥çœ‹ # åŠ å…¥å‰æŸ¥çœ‹å½“å‰ä¸»æœºåç§° hostnamectlï¼Œå¯ä»¥ä¿®æ”¹ä¸ºè‡ªå·±ä¾¿äºè¯†åˆ«çš„åç§° sudo hostnamectl set-hostname k8s-node01 --static # åŠ å…¥èŠ‚ç‚¹ sudo kubeadm join 192.168.31.100:6443 --token xxx.xxx \\ --discovery-token-ca-cert-hash sha256:xxx # å¦‚æœæç¤º unable to fetch the kubeadm-config ConfigMap: faild to get config map: Unauthorized # è¿™ä¸ªä»£è¡¨ token è¿‡æœŸï¼Œé‡æ–°ç”Ÿæˆå³å¯ sudo kubeadm token create --ttl 0 --print-join-command # å¦‚æœæç¤º # [kubelet-check] Initial timeout of 40s passed. # error execution phase kubelet-start: error uploading crisocket: timed out waiting for the condition # To see the stack trace of this error execute with --v=5 or higher sudo kubeadm reset -f 5ã€å·¥ä½œèŠ‚ç‚¹é€€å‡º # 1ã€å°†èŠ‚ç‚¹è®¾ç½®ä¸ºç»´æŠ¤æ¨¡å¼ kubectl drain k8s-node01 --delete-local-data --force --ignore-daemonsets node/k8s-node01 # 2ã€åˆ é™¤èŠ‚ç‚¹ kubectl delete node k8s-node01 # ç™»é™†ä¸ŠèŠ‚ç‚¹æœºå™¨ # 3ã€åœæ­¢ kubelet systemctl stop kubelet # 4ã€k8s é‡ç½® sudo kubeadm reset -f 6ã€åˆ›å»ºç½‘ç»œã€Œflannelã€ # æ‹·è´é…ç½®æ–‡ä»¶ sudo mkdir -p /usr/local/kubernetes/cni/flannel/ cd /usr/local/kubernetes/cni/flannel/ wget https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml # åº”ç”¨é…ç½® kubectl apply -f kube-flannel.yml # ç­‰å¾…2ï½3åˆ†é’Ÿï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸ kubectl get nodes # å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¾ç¤º ready 7ã€é›†ç¾¤æµ‹è¯• 7.1ã€åˆ›å»ºpod # åˆ›å»ºä¸€ä¸ª deployment ä»»åŠ¡ æŒ‡å®šé•œåƒ kubectl create deployment nginx --image=nginx # è·å– pod åˆ—è¡¨ kubectl get po -o wide 7.2ã€åˆ›å»º svc ç½‘ç»œ # åˆ›å»ºä¸€ä¸ª svc ç½‘ç»œ kubectl create svc clusterip nginx --tcp=80:80 # æŸ¥çœ‹å½“å‰ svc ç½‘ç»œ kubectl get svc ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:3:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 4ã€èµ„æºæ¸…å• åœ¨ k8s ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯èµ„æºï¼Œèµ„æºå®ä¾‹åŒ–ä¹‹åï¼Œå«åšå¯¹è±¡ èµ„æºï¼š å‘½åç©ºé—´çº§åˆ« å·¥ä½œè´Ÿè½½å‹èµ„æºï¼šPodã€ReplicaSetã€Deployment ç­‰ æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡å‹èµ„æºï¼šServiceã€Ingress ç­‰ é…ç½®ä¸å­˜å‚¨å‹èµ„æºï¼šVolumeã€CSI ç­‰ ç‰¹æ®Šç±»å‹çš„å­˜å‚¨å·ï¼šConfigMapã€Secre ç­‰ é›†ç¾¤çº§èµ„æº Namespaceã€Nodeã€ClusterRoleã€ClusterRoleBinding å…ƒæ•°æ®ç±»å‹èµ„æº HPAã€PodTemplateã€LimitRange åœ¨ k8s ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ yaml æ ¼å¼çš„æ–‡ä»¶æ¥åˆ›å»ºç¬¦åˆæˆ‘ä»¬é¢„æœŸæœŸæœ›çš„å¯¹è±¡ï¼Œè¿™æ ·çš„ yaml æ–‡ä»¶æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºèµ„æºæ¸…å• ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:4:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" æ ¼å¼ apiVersion: group/apiversion # å¦‚æœæ²¡æœ‰ç»™å®š group åç§°ï¼Œé‚£ä¹ˆé»˜è®¤ä¸º coreï¼Œå¯ä»¥ä½¿ç”¨ kubectl apt-versions è·å–å½“å‰ k8s ç‰ˆæœ¬ä¸Šæ‰€æœ‰çš„ apiVersion ç‰ˆæœ¬ä¿¡æ¯ï¼ˆæ¯ä¸ªç‰ˆæœ¬å¯èƒ½ä¸åŒï¼‰ kind: # èµ„æºç±»åˆ« metadate: # èµ„æºå…ƒæ•°æ® name namespace lables annotations # ä¸»è¦ç›®çš„æ˜¯æ–¹ä¾¿ç”¨æˆ·é˜…è¯»æŸ¥æ‰¾ spec: # æœŸæœ›çš„çŠ¶æ€ ï¼ˆdisired stateï¼‰ status: # å½“å‰çŠ¶æ€ï¼Œæœ¬å­—æ®µç”± kubernetes è‡ªèº«ç»´æŠ¤ï¼Œç”¨æˆ·ä¸èƒ½å®šä¹‰ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:4:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" å¸¸ç”¨å‘½ä»¤å¿…é¡»è®°ä½çš„å‘½ä»¤ kubectl explain xxx.xxx å¿…é¡»è®°ä½çš„å‘½ä»¤ kubectl explain xxx.xxx å¿…é¡»è®°ä½çš„å‘½ä»¤ kubectl explain xxx.xxx # æŸ¥è¯¢ # -n æŒ‡å®šå‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default kuebctl get pod -o wide -l [key/key=values] # è·å– pod åˆ—è¡¨ kubectl get pod podName -o json/yaml # è·å– pod è¯¦ç»†ä¿¡æ¯ kubectl log podName # è·å– pod æ—¥å¿— kubectl describe pod podName # è·å– pod äº‹ä»¶ä¿¡æ¯ # æ“ä½œ kubectl create -f filename # åˆ›å»ºèµ„æº kubectl exec -it podName -c containerName -- [script] # åœ¨æŸä¸ªå®¹å™¨å†…æ‰§è¡Œè„šæœ¬ kubectl delete [res] [--all | name] # åˆ é™¤èµ„æº kubectl scale --replicas=[num] [controllerKind]/[resName] # ä¿®æ”¹æŸä¸ªæ§åˆ¶å™¨çš„å‰¯æœ¬æ•°é‡ è·å– apiversion ç‰ˆæœ¬ä¿¡æ¯ kubectl api-versions # output: admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 ... å­—æ®µé…ç½®æ ¼å¼ apiVersion \u003cstring\u003e # è¡¨ç¤ºå­—ç¬¦ä¸²ç±»å‹ metadata \u003cobject\u003e # è¡¨ç¤ºéœ€è¦åµŒå¥—å¤šå±‚å­—æ®µ labels \u003cmap[string]string\u003e # è¡¨ç¤ºç”± k:v ç»„æˆçš„æ˜ å°„ finalizers \u003c[]string\u003e # è¡¨ç¤ºå­—ç¬¦ä¸²åˆ—è¡¨ ownerReferences \u003c[]object\u003e # è¡¨ç¤ºå¯¹è±¡åˆ—è¡¨ hostPID \u003cboolean\u003e # true | flase priority \u003cinteger\u003e # æ•´å‹ name \u003cstring\u003e -required- # å¦‚æœç±»å‹åé¢æ¥ requiredï¼Œè¡¨ç¤ºä¸ºå¿…å¡«å­—æ®µ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:4:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" é€šè¿‡å®šä¹‰æ¸…å•æ–‡ä»¶åˆ›å»º Pod apiVersion: v1 kind: Pod metadate: name: pod-demo namespace: default lables: app: myPod spec: containers: - name: myPod-1 image: nginx - name: myPod-2 image: busybos:1.34.1 command: - \"/bin/sh\" - \"-c\" - \"sleep 3600\" # ä½¿ç”¨ -o é€‰é¡¹åŠ  yamlï¼Œå¯ä»¥å°†èµ„æºçš„é…ç½®ä»¥ yaml çš„æ ¼å¼è¾“å‡ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ json kubectl get pod xxx.xxx.xxx -o yaml ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:4:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 5ã€Pod ç”Ÿå‘½å‘¨æœŸ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" æ‰§è¡Œæµç¨‹ Pauseï¼šåœ¨ä¸€ä¸ª Pod å¯åŠ¨å‰ï¼Œä¼šå…ˆå¯åŠ¨ä¸€ä¸ª Pause å®¹å™¨ã€‚å®ƒä¼šåˆå§‹åŒ–ç›¸åº”çš„ç½‘ç»œæ ˆï¼ŒåŒæ—¶æŠŠè‡ªèº«çš„ç½‘ç»œå·å…±äº«ç»™ Pod å†…çš„å®¹å™¨ åˆå§‹åŒ–å®¹å™¨ã€ŒinitCã€ï¼Œå¯ä»¥æœ‰0åˆ°æ— é™ä¸ª å®ƒæ˜¯æ‰¹å¤„ç†ç±»å‹çš„ä»»åŠ¡ å®ƒçš„è¿è¡Œæ˜¯æœ‰åºçš„ï¼Œç¬¬ä¸€ä¸ªä¸è¿è¡ŒæˆåŠŸï¼Œç¬¬äºŒä¸ªä¸ä¼šè¿è¡Œ å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œä¼šç›´æ¥é‡è½½æ•´ä¸ª Podï¼Œç›´åˆ° Init å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod å¯¹åº”çš„ restartPolicy ä¸º Never åˆ™ä¸ä¼šé‡å¯ ä¸»å®¹å™¨ã€ŒmainCã€ï¼Œè‡³å°‘å­˜åœ¨ä¸€ä¸ª å¤šä¸ª mainC å¹¶è¡Œå¯åŠ¨ å¤šä¸ª mainC å…±äº«åŒä¸€ä¸ªç½‘ç»œå·ï¼Œç»‘å®šçš„ç«¯å£ä¸èƒ½é‡å¤ hook å¯åŠ¨å‰ã€Œå’Œä¸»è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œä¸ä¸€å®šåœ¨ä¸»è¿›ç¨‹è¿è¡Œå‰æ‰§è¡Œå®Œæˆã€ å…³é—­å‰ã€Œå¯ä»¥ä¿è¯åœ¨å…³é—­å‰æ‰§è¡Œå®Œæˆã€ æ¢é’ˆã€Œtcpï½œhttpï½œscriptã€ å¯ä»¥è¿›è¡Œå°±ç»ªã€å­˜æ´»æ¢æµ‹æ¢é’ˆï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œåç»­æ¢é’ˆï¼Œæ–°ç‰ˆæœ¬æ‰å­˜åœ¨ å°±ç»ªæ¢é’ˆï¼šåˆ¤æ–­ä¸€ä¸ª mainC æ˜¯å¦å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡ï¼Œå¯ä»¥å®šä¹‰æ¢æµ‹é—´éš” å­˜æ´»æ¢é’ˆï¼šåˆ¤æ–­ä¸€ä¸ª mainC æ˜¯å¦å­˜æ´»ï¼Œå¦‚æ— å“åº”åˆ™é‡å¯å®¹å™¨ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" init å®¹å™¨å› ä¸º Init å®¹å™¨å…·æœ‰ä¸åº”ç”¨å®¹å™¨åˆ†ç¦»çš„å•ç‹¬é•œåƒï¼Œæ‰€ä»¥å®ƒä»¬çš„å¯åŠ¨ç›¸å…³ä»£ç å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š å®ƒä»¬å¯ä»¥åŒ…å«å¹¶è¿è¡Œå®ç”¨å·¥å…·ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸å»ºè®®åœ¨åº”ç”¨å®¹å™¨é•œåƒä¸­åŒ…å«è¿™äº›å·¥å…· åº”ç”¨ç¨‹åºé•œåƒå¯ä»¥åˆ†ç¦»å‡ºåˆ›å»ºå’Œéƒ¨ç½²çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¿…è¦è”åˆå®ƒä»¬æ„å»ºä¸€ä¸ªå•ç‹¬çš„é•œåƒ Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹äºåº”ç”¨å®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œä»–ä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºåˆ™ä¸èƒ½ ä»–ä»¬å¿…é¡»åœ¨åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œå®Œæˆï¼Œè€Œåº”ç”¨å®¹å™¨æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œæ‰€ä»¥ Init å®¹å™¨èƒ½å¤Ÿæä¾›ä¸€ç§ç®€å•çš„é˜»å¡æˆ–å»¶è¿Ÿåº”ç”¨å®¹å™¨å¯åŠ¨çš„æ–¹æ³•ï¼Œç›´åˆ°æ»¡è¶³å•¦ä¸€ç»„å…ˆå†³æ¡ä»¶ Init å®¹å™¨å…·æœ‰åº”ç”¨å®¹å™¨çš„æ‰€æœ‰å­—æ®µã€‚é™¤äº† readinessProbeï¼Œå› ä¸º Init å®¹å™¨æ— æ³•å®šä¹‰ä¸åŒäºå®Œæˆå’Œå°±ç»ªä¹‹å¤–çš„å…¶ä»–çŠ¶æ€ï¼Œè¿™ä¼šåœ¨éªŒè¯è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œ åœ¨ Pod ä¸­çš„æ¯ä¸ª app å’Œ init å®¹å™¨çš„åç§°å¿…é¡»å”¯ä¸€ï¼›ä¸å…¶ä»–ä»»ä½•å®¹å™¨å…±äº«åŒä¸€ä¸ªåç§°ï¼Œä¼šåœ¨éªŒè¯æ—¶æŠ›å‡ºé”™è¯¯ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ç®€å•å®æ“ # testpod.yaml apiVersion: v1 kind: Pod metadata: name: my-nginx-pod labels: app: my-nginx spec: containers: - name: my-nginx image: nginx initContainers: - name: init-my-service image: busybox command: ['sh', '-c', 'until nslookup my-service; do echo waiting for my-service; sleep 2; done;'] - name: init-my-db image: busybox command: ['sh', '-c', 'until nslookup my-db; do echo waiting for my-db; sleep 2; done;'] # init-testpod.yaml apiVersion: v1 kind: Service metadata: name: my-service spec: ports: - protocol: TCP port: 80 targetPort: 9376 --- apiVersion: v1 kind: Service metadata: name: my-db spec: ports: - protocol: TCP port: 80 targetPort: 9377 å…ˆåˆ›å»º init æ¨¡æ¿ kubectl create -f init-pod.yaml æŸ¥çœ‹ Pod çŠ¶æ€ kubectl get po æŸ¥çœ‹åˆå§‹åŒ–å®¹å™¨æ—¥å¿— kubectl logs my-nginx-pod -c init-my-service å‘ç°ä¸€ç›´åœ¨è§£æåŸŸåï¼Œè¿™æ—¶æˆ‘ä»¬åˆ›å»ºå“åº”çš„ service kubectl create -f init-test-pod.yaml ç„¶åæˆ‘ä»¬å†å»æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ä¸€å®šçš„æ—¶é—´ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" æ¢é’ˆæ¢é’ˆæ˜¯ç”± kubelet å¯¹å®¹å™¨æ‰§è¡Œçš„å®šæœŸè¯Šæ–­ï¼Œè¦æ‰§è¡Œè¯Šæ–­ï¼Œkubelet è°ƒç”¨å®¹å™¨å®ç°çš„ Handlerã€‚æœ‰ä¸‰ç§ç±»å‹çš„å¤„ç†ç¨‹åºï¼š ExecActionï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸ TCPSocketActionï¼šå¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨ IP åœ°å€è¿›è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«ä»»åŠ¡æ—¶æˆåŠŸçš„ HTTPGetActionï¼šå¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨ IP åœ°å€æ‰§è¡Œ HTTP Get è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº 200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ æ¯æ¬¡æ¢æµ‹éƒ½å°†è·å¾—ä»¥ä¸‹ä¸‰ç§ç»“æœï¼š æˆåŠŸï¼šå®¹å™¨é€šè¿‡è¯Šæ–­ å¤±è´¥ï¼šå®¹å™¨æœªé€šè¿‡è¯Šæ–­ æœªçŸ¥ï¼šè¯Šæ–­å¤±è´¥ï¼Œä½†ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨ readinessProbeã€Œå°±ç»ªæ¢é’ˆã€æŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢æµ‹å¤±è´¥ï¼Œç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸ Pod åŒ¹é…çš„æ‰€æœ‰ Service çš„ç«¯ç‚¹ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚åˆå§‹å»¶è¿Ÿå‰çš„å°±ç»ªçŠ¶æ€é»˜è®¤ä¸º Failureã€‚å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º SUCCESS # readinessProbe-httpget apiVersion: v1 kind: Pod metadata: name: reaadiness-httpget-pod namespace: default labels: app: myapp spec: containers: - name: readiness-httpget-container image: nginx imagePullPolice: IfNotPresent readinessProbe: # é…ç½®å°±ç»ªæ¢é’ˆ httpGet: # æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£å’Œ path port: 80 path: readiness.html initialDelaySeconds: 1 # å¼€å§‹æ¢æµ‹å»¶è¿Ÿ periodSeconds: 3 # æ¢æµ‹é—´éš” åˆ›å»ºè¯¥ Pod åï¼Œä¼šå‘ç° Pod å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯ READY å´æ˜¯ 0/1ã€‚è¿™æ—¶æˆ‘ä»¬æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œå‘ç°æ¢é’ˆè¿”å›ä¸º 404ï¼Œæ­¤æ—¶è¡¨ç¤ºæ¢é’ˆæ­£å¸¸ç”Ÿæ•ˆã€‚ æˆ‘ä»¬è¿›å…¥å®¹å™¨ï¼Œåœ¨ nginx çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºreadiness.htmlæ–‡ä»¶ï¼Œé€€å‡ºåå‘ç°å®¹å™¨å·²å¤„äºå°±ç»ªçŠ¶æ€ã€‚ livenessProbeã€Œå­˜æ´»æ¢é’ˆã€æŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥ï¼Œåˆ™ kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œå¹¶ä¸”å®¹å™¨å°†æ ¹æ®é‡å¯ç­–ç•¥æ¥åˆ¤æ–­æ˜¯å¦é‡æ–°æ‹‰èµ·ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º SUCCESS # livenessProbe-exec apiVersion: v1 kind: Pod metadata: name: liveness-exec-pod namespace: default spec: containers: - name: liveness-exec-container image: busybox imagePullPolicy: IfNotPresent command: [\"/bin/sh\", \"-c\", \"touch /tmp/live; sleep 60; rm -rf /tmp/live; sleep 3600\"] # è¿è¡Œè„šæœ¬ livenessProbe: exec: # exec ç±»å‹æ¢é’ˆ command: [\"test\", \"-e\", \"/tmp/live\"] # æ‰§è¡Œè„šæœ¬ initialDelaySeconds: 1 # å¼€å§‹æ¢æµ‹å»¶è¿Ÿ periodSeconds: 3 # æ¢æµ‹é—´éš” åˆ›å»ºè¯¥ Pod åï¼Œåœ¨å‰ 60 ç§’å†…æ­£å¸¸è¿è¡Œï¼Œä¹‹åå‘ç° Pod è¢«æ€æ­»å¹¶é‡æ–°åˆ›å»ºã€‚ # livenessProbe-httpget apiVersion: v1 kind: Pod metadata: name: liveness-httpget-pod namespace: default spec: containers: - name: liveness-httpget-container image: nginx imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 livenessProbe: httpGet: # æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£å’Œ path port: 80 path: index.html initialDelaySeconds: 3 # å¼€å§‹æ¢æµ‹å»¶è¿Ÿ periodSeconds: 3 # æ¢æµ‹é—´éš” timeoutSeconds: 3 # è¶…æ—¶æ—¶é—´ # livenessProbe-tcp apiVersion: v1 kind: Pod metadata: name: liveness-tcp-pod namespace: default spec: containers: - name: liveness-tcp-container image: nginx imagePullPolicy: IfNotPresent ports: - name: tcp containerPort: 80 livenessProbe: tcpSocket: # æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£ port: 80 initialDelaySeconds: 5 # å¼€å§‹æ¢æµ‹å»¶è¿Ÿ timeoutSeconds: 1 # è¶…æ—¶æ—¶é—´ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:4","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" å¯åŠ¨ã€é€€å‡ºåŠ¨ä½œã€Œhookã€ apiVersion: v1 kind: Pod metadata: name: lifecycle-demo spec: containers: - name: lifecycle-demo-container image: nginx lifecycle: # ç”Ÿå‘½å‘¨æœŸ postStart: # å¯åŠ¨å‰ exec: command: [\"/bin/sh\", \"-c\", \"echo postStart \u003e /usr/share/message\"] preStart: # å…³é—­å‰ exec: command: [\"/bin/sh\", \"-c\", \"echo preStart \u003e /usr/share/message\"] åœ¨è¿›å…¥å®¹å™¨åï¼Œå°±å¯ä»¥çœ‹åˆ°/usr/share/messageå­˜åœ¨ï¼Œå¹¶ä¸”å†…å®¹æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„postStartã€‚æˆ‘ä»¬è¿›å»å®¹å™¨æ­»å¾ªç¯æ‰“å°æ–‡ä»¶ while true; do cat /usr/share/message; done åœ¨å¤–éƒ¨å…³é—­å®¹å™¨åï¼Œå‘ç°æ‰“å°å˜æˆäº†preStart ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:5","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 6ã€æ§åˆ¶å™¨è¯¦è§£","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" RC æ§åˆ¶å™¨ # file: rc.yaml apiVersion: v1 kind: ReplicationController metadata: name: frontend spec: replicas: 3 # å‰¯æœ¬æ•°é‡ selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¯»æ‰¾ app=nginx çš„ Pod app: nginx template: # åˆ›å»º Pod æ¨¡æ¿ metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 åœ¨åˆ›å»ºä¸Šè¿°æ–‡ä»¶åï¼Œæˆ‘ä»¬æ‰§è¡Œ kubectl create -f rc.yaml ç„¶åæˆ‘ä»¬æŸ¥çœ‹å¯¹åº” Podï¼š è¿™ä¹Ÿå°±æ˜¯ RC æ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ é™¤å…¶ä¸­ä¸€ä¸ª Pod ä¼šå‘ç°åˆè¢«é‡æ–°åˆ›å»º ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" RS æ§åˆ¶å™¨ apiVersion: v1 kind: ReplicaSet metadata: name: frontend spec: replicas: 3 # å‰¯æœ¬æ•°é‡ selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¯»æ‰¾ app=nginx çš„ Pod matchLabels: app: nginx1 # matchExpressions: å¯é€‰ template: # åˆ›å»º Pod æ¨¡æ¿ metadata: labels: app: nginx1 spec: containers: - name: nginx image: nginx ports: - containerPort: 80 RS æ§åˆ¶å™¨ç›¸æ¯” RC æ§åˆ¶å™¨ï¼Œåªæ˜¯å¤šäº†ä¸€ç§æ ‡ç­¾é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ï¼š kubectl explain rs.spec.selector å¯ä»¥çœ‹åˆ°é™¤äº†å’Œ RC æ§åˆ¶å™¨åŠŸèƒ½ä¸€è‡´çš„matchLabelsï¼Œè¿˜å¤šäº†ä¸€ç§matchExpressionså¯é€‰æ‹©ã€‚ matchExpressionsç›®å‰èƒ½æ”¯æŒçš„æ“ä½œåŒ…æ‹¬ï¼š Inï¼šlabel çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­ NotInï¼šlabel çš„å€¼ä¸åœ¨æŸä¸€ä¸ªåˆ—è¡¨ä¸­ Existsï¼šæŸä¸ª label å­˜åœ¨ DoesNotExistï¼šæŸä¸ª label ä¸å­˜åœ¨ ç¤ºä¾‹ # selector exists demo apiVersion: v1 kind: ReplicaSet metadata: name: rs-demo spec: selector: matchExpressions: # è¿™é‡Œ - key: app operator: Exists # label ä¸­ key ä¸º app å­˜åœ¨å³å¯ template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 # selector In demo apiVersion: v1 kind: ReplicaSet metadata: name: rs-demo spec: selector: matchExpressions: # è¿™é‡Œ - key: app operator: In # label ä¸­ key å¯¹åº”çš„ value åœ¨æšä¸¾çš„ values ä¸­å³å¯ values: - nginx - nginx1 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" Deployment æ§åˆ¶å™¨ å‘½ä»¤çš„å®šä¹‰æ–¹å¼ å‘½ä»¤å¼å®šä¹‰ kubectl create -f xxxxx å£°æ˜å¼å®šä¹‰ kubectl apply -f xxxxx åŒºåˆ«ï¼šå£°æ˜å¼å‘½ä»¤å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­å½“å‰æ“ä½œæ˜¯ä¿®æ”¹è¿˜æ˜¯åˆ›å»º æ¨èç›´æ¥ä½¿ç”¨ applyï¼Œåœ¨é‡åˆ°å‘½ä»¤å¼èµ„æºæ—¶ä¼šè‡ªåŠ¨é™çº§æˆå‘½ä»¤å¼ Deployment ä¸º Pod å’Œ ReplicaSet æä¾›æ¥ä¸€ä¸ªå£°æ˜å¼å®šä¹‰æ–¹æ³•ï¼Œç”¨æ¥ä»£æ›¿ä¹‹å‰çš„ ReplicationController æ¥æ–¹ä¾¿ç®¡ç†åº”ç”¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š å®šä¹‰ Deployment æ¥åˆ›å»º Pod å’Œ ReplicaSet æ»šåŠ¨å‡çº§å’Œå›æ»šåº”ç”¨ æ‰©å®¹å’Œç¼©å®¹ æš‚åœå’Œç»§ç»­ Deployment 1ã€éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ Nginx åº”ç”¨ apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deployment spec: replicas: 3 template: metadate: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 kubectl apply -f https://kubernetes.io/docs/user-guide/nginx-deployment.yaml --record # --record å¯ä»¥è®°å½•å½“å‰å‘½ä»¤åˆ° deployment åˆ°å†å²è®°å½•ä¸­ 2ã€æ‰©å®¹ # ä¿®æ”¹å‰¯æœ¬æ•°é‡ä¸º 10ï¼Œä¸ä¼šå½±å“ deployment å·²ç»åˆ›å»ºçš„ rs kubectl scale deployment nginx-deployment --replicas 10 å¦‚æœé›†ç¾¤æ”¯æŒ horizontal pod autoscaling çš„è¯ï¼Œè¿˜å¯ä»¥ä¸º Deployment è®¾ç½®è‡ªåŠ¨æ‰©å±• kubectl autoscale deployment nginx-deployment --min=10 --max=15 --cpu-percent=80 3ã€æ›´æ–°é•œåƒ kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1 4ã€å›æ»š kubectl rollout undo deployment/nginx-deployment å‡å¦‚å½“å‰æœ‰4ä¸ªç‰ˆæœ¬ v1ã€v2ã€v3ã€v4ï¼Œç›®å‰çš„ç‰ˆæœ¬ä¸º v4ï¼Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤å›æ»šä¹‹åå›æ»šåˆ° v3 ç‰ˆæœ¬ï¼Œå†æ¬¡ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œæ­¤æ—¶å›é‡æ–°å›æ»šåˆ° v4 ç‰ˆæœ¬ï¼Œå› ä¸ºå½“å‰çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸º v4ï¼Œå¦‚æœæƒ³æŒ‡å®šç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ï¼š # æŸ¥çœ‹å†å²ç‰ˆæœ¬è®°å½•ï¼Œå¦‚æœä½¿ç”¨äº† --replicas ä¼šæ˜¾ç¤ºå½“æ—¶çš„å‘½ä»¤ kubectl rollout history deployment/nginx-deployment # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ kubectl rollout undo deployment/nginx-deployment --to-revision=2 # æš‚åœ deployment çš„æ›´æ–° kubectl rollout pause deployment/nginx-deployment # å¯ä»¥ä½¿ç”¨ kubectl rollout status æŸ¥çœ‹å›æ»šæ˜¯å¦å®Œæˆï¼ŒåŒæ—¶å‘½ä»¤è¿”å› code ä¸º 0ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬æ¥åˆ¤æ–­ kubectl rollout status depoyment/nginx-deployment é™åˆ¶ç‰ˆæœ¬æ•°é‡ å¯ä»¥è®¾ç½®.spec.revisionHistoryLimitæ¥è®¾ç½®ä¿ç•™çš„ç‰ˆæœ¬æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡ä¹Ÿå°±æ˜¯ deployment ç®¡ç†çš„å†å² rs æ•°é‡ å¤šä¸ª rollout å¹¶è¡Œ å‡è®¾å½“å‰æœ‰ 10 ä¸ª Pod æ­£åœ¨ä» v1 ç‰ˆæœ¬å‡çº§è‡³ v2 ç‰ˆæœ¬ï¼Œæ­¤æ—¶ v1 : 5ã€v2 : 5ã€‚ è¿™æ—¶æˆ‘ä»¬å†å‡çº§è‡³ v3 ç‰ˆæœ¬ï¼Œæ­¤æ—¶å‡çº§çš„ 5 ä¸ª v2 ç‰ˆæœ¬çš„ Pod ä¼šç›´æ¥è¢«æ€æ­»ï¼Œç„¶åç›´æ¥åˆ›å»º v3 ç‰ˆæœ¬çš„ Podã€‚ å¸¸ç”¨å›æ»šç­–ç•¥ ä¸€èˆ¬åœ¨ä¼ä¸šä¸­ä¸ä¼šä½¿ç”¨ revision è¿™ç§å›æ»šæ–¹å¼ï¼Œè€Œæ˜¯ä¼šå¤åˆ¶æœ€è¿‘ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åç§°åç›´æ¥è¿›è¡Œ apply æ“ä½œï¼Œæ¯”å¦‚nginx-deployment-2022-06-06 12:00:00.yamlã€‚è¿™æ ·çš„è¯å‡ºç°é—®é¢˜å¯ä»¥ç›´æ¥ apply è‡³ä¸Šä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯ã€‚ 5ã€æ›´æ–°ç­–ç•¥Deployment å¯ä»¥ä¿è¯åœ¨å‡çº§æ—¶åªæœ‰ä¸€å®šæ•°é‡çš„ Pod æ˜¯ down çš„ã€‚é»˜è®¤å®ƒä¼šç¡®ä¿è‡³å°‘æœ‰æ¯”æœŸæœ›çš„å‰¯æœ¬æ•°é‡å°‘ä¸€ä¸ªä¸º up çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šä¸€ä¸ªä¸å¯ç”¨ åŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›ä¸€å®šæ•°é‡çš„ Podï¼Œé»˜è®¤ä¼šæ¯”æœŸæœ›çš„å‰¯æœ¬æ•°é‡å¤šä¸€ä¸ªæ˜¯ up çŠ¶æ€ æœªæ¥çš„ kuberentes ç‰ˆæœ¬ä¸­ï¼Œå°†ä» 1-1 å˜æˆ 25%-25% å½“ç„¶ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ›´æ–°ç­–ç•¥ kubectl explain deploy.spec.strategy.type Recreateï¼šé‡æ–°åˆ›å»º rollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰ maxSurgeï¼šæŒ‡å®šè¶…å‡ºå‰¯æœ¬æ•°æœ‰å‡ ä¸ªï¼Œä¸¤ç§æ–¹å¼ï¼š1ã€æŒ‡å®šæ•°é‡ 2ã€ç™¾åˆ†æ¯” maxUnavailableï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡æœ€å¤šæœ‰å‡ ä¸ªä¸å¯ç”¨ # æŸ¥è¯¢å½“å‰æ›´æ–°ç­–ç•¥ kubectl describe deployments {æ§åˆ¶å™¨åç§°} # æ‰¾åˆ° RollingUpdateStrategy # ä¿®æ”¹å½“å‰æ›´æ–°ç­–ç•¥ kubectl edit deployment {æ§åˆ¶å™¨åç§°} # æ‰¾åˆ° rollingUpdate # æˆ–è€…ä½¿ç”¨ patch æ‰“è¡¥ä¸ kubectl patch deployment nginx-deployment -p '{\"spec\": {\"strategy\": {\"rollingUpdate\": {\"maxSurge\":1, \"maxUnavailable\": 0}}}}' 6ã€é‡‘ä¸é›€éƒ¨ç½² # éœ€è¦è®¾ç½®å½“å‰æ›´æ–°ç­–ç•¥ä¸º maxSurge:1 maxUnavailable:0 kubectl patch deployment nginx-deployment -p '{\"spec\": {\"strategy\": {\"rollingUpdate\": {\"maxSurge\":1, \"maxUnavailable\": 0}}}}' # å¼€å§‹æ›´æ–°åç›´æ¥æš‚åœï¼Œæ­¤æ—¶åªä¼šæ–°å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ Podï¼Œæ—§ç‰ˆæœ¬çš„ Pod ä¸ä¼šè¿›è¡Œåˆ é™¤ # æ­¤æ—¶ svc ç½‘ç»œä¼šå°†æµé‡è´Ÿè½½å‡è¡¡è‡³å½“å‰å…¨éƒ¨ Podï¼Œå°±å¯ä»¥æµ‹è¯•æ–°ç‰ˆæœ¬äº† kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 \\ \u0026\u0026 kubectl rollout pause deployment nginx-deployment # ç­‰å¾…æµ‹è¯•ç»“æŸåï¼Œç»§ç»­æ›´æ–° kubectl rollout resume deployment nginx-deployment ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" DaemonSetDaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰ Node å‡å¦‚é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Podã€‚å½“æœ‰ Node ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Pod ä½¿ç”¨ DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œglusterdã€ceph åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›† daemonï¼Œä¾‹å¦‚fluentdã€logstash åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œç›‘æ§ darmonï¼Œä¾‹å¦‚Promentheus Node Exproterã€collectdã€Datadogä»£ç†ã€New Relic ä»£ç†æˆ–è€…Ganglia gmond apiVersion: apps/v1 kind: DaemonSet metadata: name: daemonset-example labels: app: daemonset spec: selector: matchLabels: name: daemonset-example template: metadata: labels: name: daemonset-example spec: containers: - name: daemonset-example image: nginx ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:4","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" JobJob è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ª Pod æˆåŠŸç»“æŸ ç‰¹æ®Šè¯´æ˜ .spec.templateæ ¼å¼åŒ Pod RestartPolicy ä»…æ”¯æŒ Never æˆ–è€… OnFailure å½“ä¸ª Pod æ—¶ï¼Œé»˜è®¤ Pod è¿è¡ŒæˆåŠŸå Job å³ç»“æŸ .spec.completionsæ ‡å¿— Job ç»“æŸéœ€è¦æˆåŠŸè¿è¡Œçš„ Pod ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 1 .spec.parallelismæ ‡å¿—å¹¶è¡Œè¿è¡Œçš„ Pod ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 1 spec.activeDeadlineSecodsæ ‡å¿—å¤±è´¥ Pod çš„é‡è¯•æœ€å¤§æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¸ä¼šç»§ç»­é‡è¯• apiVersion: batch/v1 kind: Job metadata: name: job spec: template: metadata: name: job spec: containers: - name: job image: busybox command: ['echo', 'this is a job container'] restartPolicy: Never ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:5","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" CronJobCronJob åŸºäºæ—¶é—´ç®¡ç†çš„ Jobï¼Œå³ï¼š åœ¨ç»™å®šçš„æ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡ å‘¨æœŸæ€§çš„åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ ä½¿ç”¨æ¡ä»¶ï¼šå½“å‰ä½¿ç”¨ k8s é›†ç¾¤ï¼Œç‰ˆæœ¬ \u003e= 1.8 å…¸å‹ç”¨æ³•ï¼š åœ¨ç»™å®šçš„æ—¶é—´ç‚¹è°ƒåº¦ Job è¿è¡Œ åˆ›å»ºå‘¨æœŸæ€§è¿è¡Œçš„ Jobï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å¤‡ä»½ã€å‘é€é‚®ä»¶ Spec .spec.scheduleï¼šè°ƒåº¦ï¼Œå¿…é¡»å­—æ®µï¼ŒæŒ‡å®šä»»åŠ¡è¿è¡Œå‘¨æœŸï¼Œæ ¼å¼åŒ Cron .spec.jobTemplateï¼šJob æ¨¡æ¿ï¼Œå¿…é¡»å­—æ®µï¼ŒæŒ‡å®šéœ€è¦è¿è¡Œçš„ä»»åŠ¡ï¼Œæ ¼å¼åŒ Job .spec.startingDeadlineSecondsï¼šå¯åŠ¨ Job çš„æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé€‰å¡«ï¼Œè¶…å‡ºè¯¥æ—¶é—´æœªå¯åŠ¨è®¤å®šä¸ºå¤±è´¥ï¼Œé»˜è®¤æ²¡æœ‰æœŸé™ .spce.concurrencyPolicyï¼šå¹¶å‘ç­–ç•¥ï¼Œé€‰å¡«ï¼ŒæŒ‡å®š Job çš„å¹¶å‘æ‰§è¡Œï¼Œåªå…è®¸ä»¥ä¸‹ç­–ç•¥ï¼š Allow ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å¹¶å‘è¿è¡Œ Forbidï¼š ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è·³è¿‡ Replaceï¼šå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ Jobï¼Œç”¨ä¸€ä¸ªæ–°çš„æ›¿æ¢ ä»¥ä¸Šç­–ç•¥åªèƒ½åº”ç”¨äºåŒä¸€ä¸ª CronJob åˆ›å»ºçš„ Jobï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª CronJobï¼Œå®ƒä»¬ä¹‹é—´æ€»æ˜¯äº’ä¸å¹²æ¶‰çš„ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:6","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 7ã€Service Kubernetes Service å®šä¹‰äº†è¿™æ ·ä¸€ç§æŠ½è±¡ï¼š ä¸€ä¸ª Pod çš„é€»è¾‘åˆ†ç»„ï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„ç­–ç•¥ï¼Œé€šå¸¸ç§°ä¸º å¾®æœåŠ¡ è¿™ä¸€ç»„ Pod èƒ½å¤Ÿè¢« Service è®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡ Label Selector ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:7:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" æ ¸å¿ƒè¿­ä»£åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ª Node è¿è¡Œä¸€ä¸ª kube-proxyè¿›ç¨‹ã€‚kube-proxy è´Ÿè´£ä¸º Serviceå®ç°ä¸€ç§ VIPï¼ˆè™šæ‹ŸIPï¼‰çš„å½¢å¼ï¼Œè€Œä¸æ˜¯ExternalNameçš„å½¢å¼ã€‚åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨ userspaceã€‚åœ¨ Kubernetes v1.1 ç‰ˆæœ¬ï¼Œå¢åŠ äº† iptables ä»£ç†ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ä» Kubernetes v1.2 èµ·ï¼Œé»˜è®¤å°±æ˜¯ iptables ä»£ç†ã€‚åœ¨ Kubernetes v1.8.0-beta.0 ä¸­ï¼Œæ·»åŠ äº† ipvs ä»£ç†ã€‚åœ¨ Kubernetes v1.14 ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨ ipvs ä»£ç†ã€‚ åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼ŒService æ˜¯ 4å±‚ï¼ˆTCP/UDP over IPï¼‰æ¦‚å¿µã€‚åœ¨ Kubernetes v1.1 ç‰ˆæœ¬ï¼Œæ–°å¢äº† Ingress APIï¼ˆbeta ç‰ˆï¼‰ï¼Œç”¨æ¥è¡¨ç¤º 7å±‚ï¼ˆHTTPï¼‰æœåŠ¡ã€‚ 1ã€userspace ä»£ç†æ¨¡å¼ 2ã€iptables ä»£ç†æ¨¡å¼ 3ã€ipvs ä»£ç†æ¨¡å¼æ³¨æ„ï¼šipvs æ¨¡å¼å‡å®šè¿è¡Œ kube-proxy ä¹‹å‰åœ¨èŠ‚ç‚¹ä¸Šéƒ½å·²ç»å®‰è£…äº† IPVS å†…æ ¸æ¨¡å—ã€‚å½“ kube-proxyä»¥ ipvs ä»£ç†æ¨¡å¼å¯åŠ¨æ—¶ï¼Œkube-proxy å°†éªŒè¯èŠ‚ç‚¹æ˜¯å¦å®‰è£… IPVS æ¨¡å—ï¼Œå¦‚æœæœªå®‰è£…ï¼Œåˆ™å›é€€åˆ° iptables ä»£ç†æ¨¡å¼ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:7:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" é™åˆ¶Service èƒ½å¤Ÿæä¾›è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæœ‰ä»¥ä¸‹é™åˆ¶ï¼š åªæä¾› 4 å±‚è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œæ²¡æœ‰ 7 å±‚çš„åŠŸèƒ½ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ›´å¤šçš„åŒ¹é…è§„åˆ™æ¥è½¬å‘è¯·æ±‚ï¼Œè¿™ç‚¹ 4 å±‚è´Ÿè½½å‡è¡¡æ˜¯ä¸æ”¯æŒçš„ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:7:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ç±»å‹ ClusterIPï¼šé»˜è®¤ç±»å‹ï¼Œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä»… Cluster å†…éƒ¨å¯ä»¥è®¿é—®çš„è™šæ‹Ÿ IP NodePortï¼šåœ¨ Cluster Ip åŸºç¡€ä¸Šä¸º Service åœ¨æ¯å°æœºå™¨ä¸Šç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ : æ¥è®¿é—®æœåŠ¡ LoadBalancerï¼šåœ¨ NodePort çš„åŸºç¡€ä¸Šï¼Œç»“æŸ cloud provider åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ° : ExternalNameï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨æ¥ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç›´æ¥ä½¿ç”¨ã€‚æ²¡æœ‰ä»»ä½•ç±»å‹ä»£ç†è¢«åˆ›å»ºï¼Œè¿™è‡ªç”± Kubernetes 1.7 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ kube-dns æ‰æ”¯æŒ 1ã€ClusterIP apiVersion: v1 kind: Service metadata: name: myapp namespace: default spec: type: ClusterIP selector: app: myapp relese: stable ports: - name: http port: 80 targetPort: 80 Headless Service æœ‰æ—¶ä¸éœ€è¦æˆ–ä¸æƒ³è¦è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠå•ç‹¬çš„ Service IPã€‚ é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š Cluster IPï¼ˆspec.clusterIPï¼‰çš„å€¼ä¸º \"None\" æ¥åˆ›å»º Headless Serviceã€‚ ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ— å¤´ Service ä¸å…¶ä»–æœåŠ¡å‘ç°æœºåˆ¶è¿›è¡Œæ¥å£ï¼Œè€Œä¸å¿…ä¸ Kubernetes çš„å®ç°æ†ç»‘åœ¨ä¸€èµ·ã€‚ å¯¹äºæ— å¤´ Services å¹¶ä¸ä¼šåˆ†é… Cluster IPï¼Œkube-proxy ä¸ä¼šå¤„ç†å®ƒä»¬ï¼Œ è€Œä¸”å¹³å°ä¹Ÿä¸ä¼šä¸ºå®ƒä»¬è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±ã€‚ DNS å¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®ï¼Œä¾èµ–äº Service æ˜¯å¦å®šä¹‰äº†é€‰æ‹©ç®—ç¬¦ã€‚ apiVersion: v1 kind: Service metadata: name: myapp-headless namespace: default spec: selector: app: myapp clusterIP: \"None\" ports: - port: 80 targetPort: 80 2ã€NodePort apiVersion: v1 kind: Service metadata: name: myapp-nodeport namespace: default spec: type: NodePort selector: app: myapp relese: stable ports: - name: http port: 80 targetPort: 80 nodePort: 30000 # å¯æŒ‡å®š 3ã€LoadBalancerloadBalacer å’Œ nodePort å…¶å®æ˜¯åŒä¸€ç§æ–¹å¼ï¼ŒåŒºåˆ«åœ¨äº loadBalancer æ¯” nodePort å¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯å¯ä»¥è°ƒç”¨ cloud provider å»åˆ›å»º LB æ¥å‘èŠ‚ç‚¹å¯¼æµ 4ã€ExternalNameå¯ä»¥å°†æœåŠ¡æ˜ å°„åˆ° ExternalName å­—æ®µçš„å†…å®¹ï¼ˆä¾‹å¦‚ï¼šmyapp.otherNSï¼‰ã€‚ExternalName Service æ˜¯ Service çš„ç‰¹ä¾‹ï¼Œå®ƒæ²¡æœ‰ selectorï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰ä»»ä½•çš„ç«¯å£å’Œ Endpointã€‚ç›¸åçš„ã€å¯¹äºè¿è¡Œåœ¨é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡è¿”å›å¤–éƒ¨æœåŠ¡çš„åˆ«åè¿™ç§æ–¹å¼æ¥æä¾›æœåŠ¡ kind: Service apiVersion: v1 metadata: name: my-service namespace: default spec: type: ExternalName externalName: myapp.otherNS ä½†æŸ¥è¯¢ä¸»æœºmy-service.default.svc.cluster.localï¼ˆSVC NAME.NAMESPACE.svc.cluster.localï¼‰æ—¶ï¼Œé›†ç¾¤çš„ coreDNS æœåŠ¡å°†è¿”å›ä¸€ä¸ªå€¼ my.database.example.com çš„ CANEM è®°å½•ã€‚è®¿é—®è¿™ä¸ªæœåŠ¡çš„å·¥ä½œæ–¹å¼å’Œå…¶ä»–çš„ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„äº‹é‡å®šå‘å‘ç”Ÿåœ¨ DNS å±‚ï¼Œè€Œä¸”ä¸ä¼šè¿›è¡Œä»£ç†å’Œè½¬å‘ ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:7:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 8ã€IngressIngress çš„åŠŸèƒ½ä¸ service å¤§è‡´ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ ingerss æä¾›äº†7å±‚çš„ä»£ç†ï¼Œè€Œ service åªæä¾›äº† 4 å±‚ä»£ç†ï¼Œå¦‚æœå¸Œæœ›å®ç° https çš„è®¿é—®åˆ™å¯ä»¥ä½¿ç”¨ Ingress ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:8:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" å®ç°åŸç† åœ¨ k8s ç¯å¢ƒä¸‹åˆ›å»ºä¸€ä¸ª nginx podï¼Œåœ¨å†…ç¼–å†™é…ç½®æ–‡ä»¶å»åå‘ä»£ç† svcï¼ŒåŒæ—¶æä¾› https æœåŠ¡ã€‚å…¶ä¸­çš„ nginx åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶çš„çŠ¶æ€ä¸‹å¯èƒ½ä¼šé€ æˆæœåŠ¡çš„ä¸ç¨³å®šï¼Œæ‰€ä»¥ ingress çš„ nginx ç‰ˆæœ¬æ˜¯ä¸åŒçš„ï¼Œå…·ä½“é€»è¾‘è§ä¸‹å›¾ï¼š ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:8:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ç¤ºä¾‹ httpä»£ç† apiVersion: extensions/v1beta1 kind: Deployment metadata: name: myapp spec: replicas: 2 template: metadata: labels: name: app spec: containers: - name: nginx image: myapp:v1 imagePullPolicy: IfNotPresent ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: app-svc spec: ports: - port: 80 targetPort: 80 protocol: TCP selector: name: app --- apiVersion: extensions/v1beta1 kind: Ingress metadata: name: app-ingress spec: rules: - host: test.localhost http: paths: - path: / backend: serviceName: app-svc servicePort: 80 å¯ä»¥å‘ç° Ingress ä¾èµ–ä¸ svcï¼Œé¿å…ä¾èµ–åŠ¨æ€çš„æœåŠ¡å‰¯æœ¬æ•°é‡é¢‘ç¹é‡å¯ Ingress httpsä»£ç†åˆ›å»º https è¯ä¹¦ï¼Œä»¥åŠåˆ›å»º secret å¯¹è±¡è¿›è¡Œå­˜å‚¨ # åˆ›å»ºè¯ä¹¦ openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj \"/CN=nginxsvc /O=nginxsvc\" kubectl create secret tls tls-secret --key tls.key --cert tls.crt é…ç½®æ–‡ä»¶ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: app-ingress spec: tls: - hosts: - test.localhost secretName: tls-secret rules: - host: test.localhost http: paths: - path: / backend: serviceName: app-svc servicePort: 80 BasicAuthåˆ›å»ºå¯†é’¥å¯¹ yum -y install httpd-tools htpasswd -c auth foo kubectl create secret generic basic-auth --form-file=auth é…ç½®æ–‡ä»¶ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: ingress-with-auth anntations: nginx.ingress.kubernetes.io/auth-type: basic nginx.ingress.kubernetes.io/auth-secret: basic-auth nginx.ingress.kubernetes.io/auth-realm: 'Authentication Required - foo' spec: rules: - host: test.localhost http: paths: - path: / backend: serviceName: app-svc servicePort: 80 Nginx è¿›è¡Œé‡å†™ åç§° æè¿° å€¼ nginx.ingress.kubernetes.io/rewrite-target å¿…é¡»é‡å®šå‘æµé‡çš„ç›®æ ‡ URL å­—ç¬¦ä¸² nginx.ingress.kubernetes.io/ssl-redirect æŒ‡ç¤ºä½ç½®éƒ¨åˆ†æ˜¯å¦ä»…å¯è®¿é—®SSLï¼ˆå½“ Ingress åŒ…å«è¯ä¹¦æ—¶é»˜è®¤ä¸º trueï¼‰ å¸ƒå°” nginx.ingress.kubernetes.io/force-ssl-redirect å³ä½¿ Ingress æœªå¯ç”¨ TLSï¼Œä¹Ÿå¼ºåˆ¶é‡å®šå‘åˆ° HTTPS å¸ƒå°” nginx.ingress.kubernetes.io/app-root å®šä¹‰ Controller å¿…é¡»é‡å®šå‘åˆ°åº”ç”¨ç¨‹åºæ ¹ï¼Œå¦‚æœå®ƒåœ¨ â€˜/â€™ ä¸Šä¸‹æ–‡ä¸­ å­—ç¬¦ä¸² nginx.ingress.kubernetes.io/use-regex æŒ‡ç¤º Ingress ä¸Šå®šä¹‰å½“è·¯å¾„æ˜¯å¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ å¸ƒå°” ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:8:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" 9ã€å­˜å‚¨ K8S é›†ç¾¤ä¸­å­˜å‚¨å¸¸ç”¨çš„æœ‰ä»¥ä¸‹ 4 ç§ ConfigMap: ä¸€èˆ¬ç”¨äºå­˜å‚¨é…ç½®ä¿¡æ¯ Secret: å­˜å‚¨ä¸€äº›å®‰å…¨ç±»å‹çš„å†…å®¹ï¼Œä¾‹å¦‚å­˜å‚¨å¯†é’¥ Volume: å·ï¼Œå¯ä»¥ä¿éšœ Pod çº§åˆ«çš„æ–‡ä»¶å­˜å‚¨ Persistent Volume: æŒä¹…å· ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:0","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ConfigMap æè¿°ConfigMap åŠŸèƒ½åœ¨ Kubernetes 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºä¼šä»é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ConfigMap å¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ–è€… JSON äºŒè¿›åˆ¶ç­‰å¯¹è±¡ åˆ›å»ºä½¿ç”¨ç›®å½•åˆ›å»º ls /root/game # game.file # ui.file cat /root/game/game.file # version=1.17 # name=dave # age=18 cat /root/game/ui.file # level=2 # color=yellow kubectl create configmap game-config --from-file=/root/game -from-fileæŒ‡å®šåœ¨ç›®å½•ä¸‹å½“æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ ConfigMap é‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åç§°å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹ ä½¿ç”¨æ–‡ä»¶åˆ›å»º åªè¦æŒ‡å®šä¸ºä¸€ä¸ªæ–‡ä»¶å°±å¯ä»¥ä»å•æ–‡ä»¶ä¸­åˆ›å»º ConfigMap kubectl create configmap game-config-2 --from-file=/root/game/game.file --form-fileè¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€å¯ä»¥ä½¿ç”¨ä¸¤æ¬¡åˆ†åˆ«æŒ‡å®šä¸‰ä¸ªå®ä¾‹ä¸­çš„é‚£ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ•ˆæœå’ŒæŒ‡å®šæ•´ä¸ªç›®å½•æ˜¯ä¸€æ ·çš„ ä½¿ç”¨å­—é¢å€¼åˆ›å»º ä½¿ç”¨æ–‡å­—åˆ›å»ºï¼Œåˆ©ç”¨-from-literalå‚æ•°ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¯¥å‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œæ ¼å¼å¦‚ä¸‹ kubectl create configmap literal-config --from-literal=name=dave --from-literal=password=pass kubectl get configmap literal-config -o yaml ä½¿ç”¨ ä½¿ç”¨ ConfigMap æ¥ä»£æ›¿ç¯å¢ƒå˜é‡åˆ›å»ºä¸¤ä¸ª ConfigMap apiVersion: v1 kind: ConfigMap metadata: name: literal-config namespace: default data: name: dave password: pass apiVersion: v1 kind: ConfigMap metadata: name: env-config namespace: default data: log_level: INFO åœ¨ Pod ä¸­ä½¿ç”¨ ConfigMap apiVersion: v1 kind: Pod metadata: name: cm-env-test-pod spec: containers: - name: test-container image: myapp:v1 command: [\"/bin/sh\", \"-c\", \"env\"] env: # å•ä¸ªæŒ‡å®š - name: USERNAME valueFrom: configMapKeyRef: name: literal-config key: name - name: PASSWORD valueForm: configMapKeyRef: name: literal-config key: password envFrom: # æ‰¹é‡æ³¨å…¥ - configMapRef: name: env-config restartPolicy: Never ä½¿ç”¨ ConfigMap è®¾ç½®å‘½ä»¤è¡Œå‚æ•° apiVersion: v1 kind: Pod metadata: name: cm-env-test-pod spec: containers: - name: test-container image: myapp:v1 command: [\"/bin/sh\", \"-c\", \"echo $(USERNAME) $(PASSWORD)\"] env: # å•ä¸ªæŒ‡å®š - name: USERNAME valueFrom: configMapKeyRef: name: literal-config key: name - name: PASSWORD valueForm: configMapKeyRef: name: literal-config key: password restartPolicy: Never é€šè¿‡æ•°æ®å·æ’ä»¶ä½¿ç”¨ ConfigMapåœ¨æ•°æ®å·é‡Œé¢ä½¿ç”¨è¿™ä¸ª ConfigMapï¼Œæœ‰ä¸åŒçš„é€‰é¡¹ã€æœ€åŸºæœ¬çš„å°±æ˜¯å°†æ–‡ä»¶å¡«å…¥æ•°æ®å·ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé”®å°±æ˜¯æ–‡ä»¶åç§°ï¼Œå€¼å°±æ˜¯æ–‡ä»¶å†…å®¹ apiVersion: v1 kind: Pod metadata: name: cm-volume-test-pod spec: containers: - name: test-container image: myapp:v1 volumeMounts: - name: config-volume mountPath: /etc/config volumes: - name: config-volume configMap: name: literal-config restartPolicy: Never çƒ­æ›´æ–°åœ¨é€šè¿‡æ•°æ®å·æ’ä»¶çš„å½¢å¼ä½¿ç”¨ ConfigMap æ—¶ï¼Œå¯ä»¥è¾¾åˆ°çƒ­æ›´æ–°çš„ç›®çš„ï¼Œä¿®æ”¹ ConfigMap ä¹‹åï¼Œåœ¨ Pod ä¸­çš„å¯¹åº”æ–‡ä»¶å†…å®¹ä¹Ÿå°†ä¿®æ”¹æˆå¯¹åº”ä¿®æ”¹åçš„å†…å®¹ åˆ›å»ºåˆå§‹ ConfigMap \u0026 Pod # åˆå§‹å†…å®¹ apiVersion: v1 kind: ConfigMap metadata: name: log-cofnig namespace: default data: log_level: INFO --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: hot-update spec: replicas: 1 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: myapp:v1 ports: - containerPort: 80 volumeMounts: - name: config-volume mountPath: /etc/config volumes: - name: config-volume configMap: name: log-config æŸ¥çœ‹å†…å®¹ kubectl exec pod-xxx cat /etc/config/log_level # INFO ä¿®æ”¹ ConfigMap kubectl edit cm log-config # log_level=ERROR å†æ¬¡æŸ¥çœ‹å†…å®¹ï¼Œéœ€è¦ä¸€å®šæ—¶é—´ kubectl exec pod-xxx cat /etc/config/log_level # ERROR **æ³¨æ„ï¼š**å¦‚æœ configMap ä»¥ ENV çš„æ–¹å¼æŒ‚è½½ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå®ç°çƒ­æ›´æ–° æ»šåŠ¨æ›´æ–°Podåœ¨æ›´æ–° ConfigMap ä¹‹åå¹¶ä¸ä¼šè§¦å‘ Pod çš„æ»šåŠ¨æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ Pod annotations çš„æ–¹å¼æ¥å¼ºåˆ¶å‡ºå‘æ»šåŠ¨æ›´æ–° kubectl patch deploy my-nginx --patch '{\"spec\": {\"template\": {\"metadata\": {\"anntations\": {\"version/config\": \"20190411\"}}}}}' è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬åœ¨.spec.template.metadata.annotationsä¸­æ·»åŠ version/configï¼Œæ¯æ¬¡é€šè¿‡ä¿®æ”¹version/configæ¥è§¦å‘æ»šåŠ¨æ›´æ–° ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:1","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" Secretè§£å†³äº†å¯†ç ã€tokenã€å¯†é’¥ç­‰æ•æ„Ÿæ•°æ®ç­‰é…ç½®é—®é¢˜ï¼Œè€Œä¸éœ€è¦æŠŠè¿™äº›æ•æ„Ÿæ•°æ®æš´éœ²åˆ°é•œåƒæˆ–è€… Pod Spec ä¸­ã€‚Secret å¯ä»¥ä»¥ Volume æˆ–è€…ç¯å¢ƒå˜é‡æ–¹å¼ä½¿ç”¨ Secretæœ‰ä¸‰ç§ç±»å‹ï¼š Service Accountï¼šç”¨æ¥è®¿é—® Kubernetes APIï¼Œç”± Kubernetes è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ° Pod çš„ /run/secrets/kubernetes.io/serviceaccountç›®å½•ä¸­ Opaqueï¼šbase64 ç¼–ç æ ¼å¼çš„ Secretï¼Œç”¨æ¥å­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰ kubernetes.io/dockerconfigjsonï¼šç”¨æ¥å­˜æ”¾ç§æœ‰ docker ä»“åº“ç­‰è®¤è¯ä¿¡æ¯ Service Accountç”¨æ¥è®¿é—® Kubernetes APIï¼Œç”± Kubernetes è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ° Pod çš„ /run/secrets/kubernetes.io/serviceaccountç›®å½•ä¸­ kubectl exec pod-xxx -- ls /run/secrets/kubernetes.io/serviceaccount # ca.crt # namespace # token Opaque SecretOpaque ç±»å‹çš„æ•°æ®æ˜¯ä¸€ä¸ª map ç±»å‹ï¼Œè¦æ±‚ value æ˜¯ base64 ç¼–ç æ ¼å¼ åˆ›å»º $ echo -n \"admin\" | base64 YWRtaW4= $ echo -n \"123456\" | base64 MTIzNDU2 secrets.yaml apiVersion: v1 kind: Secret metadata: name: mysecret type: Opaque data: username: YWRtaW4= password: MTIzNDU2 secret åœ¨æŒ‚è½½åä¼šè‡ªåŠ¨è§£å¯† ä½¿ç”¨1ã€å°† Secret æŒ‚è½½åˆ° Volume ä¸­ apiVersion: v1 kind: Pod metadata: labels: name: secret-test name: secret-test spec: volumes: - name: volumes12 secret: secretName: mysecret containers: - image: myapp:v1 name: db volumeMounts: - name: volumes12 mountPath: \"/data\" 2ã€å°† Secret å¯¼å‡ºåˆ°ç¯å¢ƒå˜é‡ä¸­ apiVersion: extensions/v1beta1 kind: Deployment metadata: labels: name: pod-deployment spec: replicas: 2 template: metadata: labels: app: pod-deployment spec: containers: - name: pod-1 image: myapp:v1 ports: - containerPort: 80 env: - name: TEST_USER valueFrom: secretKeyRef: name: mysecret key: username - name: TEST_PASSWORD valueFrom: secretKeyRef: name: mysecret key: password kubernetes.io/dockerconfigjsonä½¿ç”¨ kubectl åˆ›å»º docker ä»“åº“è®¤è¯çš„ secret $ kubectl create secret docker-registry myregistrykey \\ --docker-server=DOCKER_REGISTRY_SERVER \\ --docker-username=DOCKER_USER \\ --docker-password=DOCKER_PASSWOED \\ --docker-email=DOCKER_EMAIL secret \"myregistrykey\" createdã€‚ åœ¨åˆ›å»º Pod çš„æ—¶å€™ï¼Œé€šè¿‡ imagePullSecretsæ¥å¼•ç”¨åˆšåˆ›å»ºçš„myregistrykey apiVersion: v1 kind: Pod metadata: name: foo spec: containers: - name: foo image: hub.xxx.com/xxx/xxxx imagePullSecrets: - name: myregistrykey ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:2","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" Volumeã€Œå·ã€å®¹å™¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ç­‰ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œè¿™å°±ä½¿å¾—åœ¨å®¹å™¨ä¸­è¿è¡Œé‡è¦åº”ç”¨æ—¶ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œå½“å®¹å™¨å´©æºƒæ—¶ï¼Œkubelet ä¼šé‡å¯å®ƒï¼Œä½†æ˜¯å®¹å™¨ä¸­çš„æ–‡ä»¶å°†ä¸¢å¤±ï¼Œå®¹å™¨å°†ä»¥å¹²å‡€çš„çŠ¶æ€ï¼ˆé•œåƒæœ€åˆçš„çŠ¶æ€ï¼‰é‡æ–°å¯åŠ¨ã€‚å…¶æ¬¡ï¼Œåœ¨Podä¸­åŒæ—¶è¿è¡Œå¤šä¸ªå®¹å™¨æ—¶ï¼Œè¿™äº›å®¹å™¨ä¹‹é—´é€šå¸¸éœ€è¦å…±äº«æ–‡ä»¶ã€‚Kubernetes ä¸­çš„ Volume æŠ½è±¡å°±å¾ˆå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ Kubernetes ä¸­çš„å·æœ‰æ˜ç¡®çš„å¯¿å‘½ï¼ˆä¸å°è£…å®ƒçš„ Pod ç›¸åŒï¼‰ã€‚æ‰€ä»¥ï¼Œå·çš„ç”Ÿå‘½æ¯” Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é•¿ï¼Œå½“è¿™ä¸ªå®¹å™¨é‡å¯æ—¶æ•°æ®ä»ç„¶å¾—ä»¥ä¿å­˜ã€‚å½“ç„¶ï¼Œå½“ Pod ä¸å†å­˜åœ¨æ—¶ï¼Œå·ä¹Ÿå°†ä¸å¤å­˜åœ¨ã€‚ä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯ï¼ŒKubernetes æ”¯æŒå¤šç§ç±»å‹çš„å·ï¼ŒPod å¯ä»¥åŒæ—¶ä½¿ç”¨ä»»æ„æ•°é‡çš„å· ç±»å‹ kubernetes æ”¯æŒä»¥ä¸‹ç±»å‹çš„å·ï¼š csi é€šç”¨å­˜å‚¨æ¥å£ hostPath ä¸»æœºè·¯å¾„ï¼ˆä¸èƒ½é™åˆ¶ä½¿ç”¨é‡ï¼‰ emptyDir ç©ºç›®å½• awsElasticBlockStore azureDisk azureFile cephfs downwardAPI fc flocker gcePersistentDisk gitRepo glusterfs hostPath iscsi local nfs persistentVolumeClaim projected portworxVolume quobyte rbd scaleIO secret storageos vsphereVolume emptyDirå½“ Pod è¢«åˆ†é…ç»™èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆåˆ›å»º emptyDir å·ï¼Œå¹¶ä¸”åªè¦è¯¥ Pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè¯¥å·å°±ä¼šå­˜åœ¨ã€‚æ­£å¦‚å·åå­—æ‰€è¿°ï¼Œå®ƒæœ€åˆæ—¶ç©ºçš„ã€‚Pod ä¸­çš„å®¹å™¨å¯ä»¥è¯»å–å–å†™å…¥ emptyDir å·ä¸­çš„ç›¸åŒæ–‡ä»¶ï¼Œå°½ç®¡è¯¥å·å¯ä»¥æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­çš„ç›¸åŒæˆ–ä¸åŒè·¯å¾„ä¸Šã€‚å½“å‡ºäºä»»ä½•åŸå› ä»èŠ‚ç‚¹ä¸­åˆ é™¤ Pod æ—¶ï¼ŒempryDir ä¸­çš„æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ âš ï¸æ³¨æ„ï¼š å®¹å™¨å´©æºƒä¸ä¼šä»èŠ‚ç‚¹ä¸­ç§»é™¤ Podï¼Œå› æ­¤ emptyDir å·ä¸­çš„æ•°æ®åœ¨å®¹å™¨å´©æºƒæ—¶æ˜¯å®‰å…¨çš„ ç”¨æ³•ï¼š æš‚å­˜ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºåŸºäºç£ç›˜çš„åˆå¹¶æ’åºã€ç”¨ä½œé•¿æ—¶é—´è®¡ç®—å´©æºƒæ¢å¤æ—¶çš„æ£€æŸ¥ç‚¹ Web æœåŠ¡å™¨å®¹å™¨æä¾›æ•°æ®æ—¶ï¼Œä¿å­˜å†…å®¹ç®¡ç†å™¨æå–çš„æ–‡ä»¶ apiVersion: batch/v1 kind: Job metadata: name: jobs-empty spec: template: spce: restartPolicy: Never initContainers: - name: job-1 image: busybox:1.34.1 command: - \"sh\" - \"-c\" - \u003e for i in 1 2 3; do echo \"job-1 `date`\"; sleep 1s; done; echo job-1 GG \u003e /src/input/code volumeMounts: # æŒ‚è½½ä¸€ä¸ªå· - name: input mountPath: /src/input/ - name: job-2 image: busybox:1.34.1 command: - \"sh\" - \"-c\" - \u003e for i in 1 2 3; do echo \"job-2 `date`\"; sleep 1s; done; cat /src/input/code \u0026\u0026 echo job-2 GG \u003e /sec/input/output/file volumeMounts: # æŒ‚è½½ä¸¤ä¸ªå· - name: input mountPath: /src/input/ - name: output mountPath: /src/input/output/ containers: - name: job-3 image: busybox:1.34.1 command: - \"sh\" - \"-c\" - \u003e echo \"job-1 and job-2 completed\"; sleep 3s; cat /src/output/file volumeMounts: - name: output mountPath: /src/output/ volumes: - name: input emptyDir: {} - name: output emptyDir: {} hostPathhostPath å·å°†ä¸»æœºèŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°é›†ç¾¤ä¸­ ç”¨é€”å¦‚ä¸‹ï¼š è¿è¡Œéœ€è¦è®¿é—® Docker å†…éƒ¨çš„å®¹å™¨ï¼›ä½¿ç”¨ /var/lib/docker çš„ hostPath åœ¨å®¹å™¨ä¸­è¿è¡Œ cAdvisor; ä½¿ç”¨ /dev/cgroups çš„ hostPath å…è®¸ Pod æŒ‡å®šç»™å®šçš„ hostPath æ˜¯å¦åº”è¯¥åœ¨ Pod è¿è¡Œä¹‹å‰å­˜åœ¨ï¼Œæ˜¯å¦åº”è¯¥åˆ›å»ºï¼Œä»¥åŠå®ƒåº”è¯¥ä»¥ä»€ä¹ˆå½¢å¼å­˜åœ¨ é™¤äº†æ‰€éœ€çš„ path å±æ€§ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥ä¸º hostPath å·æŒ‡å®š type å€¼ è¡Œä¸º ç©ºå­—ç¬¦ä¸²ï¼ˆé»˜è®¤ï¼‰ç”¨äºå‘åå…¼å®¹ï¼Œè¿™æ„å‘³ç€åœ¨æŒ‚è½½ hostPath å·ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ£€æŸ¥ DirectoryOrCreate å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„æ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ ¹æ®éœ€è¦åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œæƒé™è®¾ç½®ä¸º 0755ï¼Œä¸ kubelet å…·æœ‰ç›¸åŒçš„ç»„å–æ‰€æœ‰æƒ Directory ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨ç›®å½• FileOrCreate å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„æ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ ¹æ®éœ€è¦åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0655ï¼Œä¸ kubelet å…·æœ‰ç›¸åŒçš„ç»„å–æ‰€æœ‰æƒ File ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨æ–‡ä»¶ Socket ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨ UNIX å¥—æ¥å­— CharDevice ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å­—ç¬¦è®¾å¤‡ BlockDevice ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å—è®¾å¤‡ ä½¿ç”¨è¿™ç§å·ç±»å‹æ—¶è¯·æ³¨æ„ï¼Œå› ä¸ºï¼š ç”±äºæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶éƒ½ä¸åŒï¼Œå…·æœ‰ç›¸åŒé…ç½®ï¼ˆä¾‹å¦‚ä» PodTemplate åˆ›å»ºçš„ï¼‰çš„ Pod åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„è¡Œä¸ºä¼šæœ‰æ‰€ä¸åŒ å½“ Kubernetes æŒ‰ç…§è®¡åˆ’æ·»åŠ èµ„æºæ„ŸçŸ¥è°ƒåº¦æ—¶ï¼Œå°†æ— æ³•è€ƒè™‘ hostPath ä½¿ç”¨çš„èµ„æº åœ¨åº•å±‚ä¸»æœºä¸Šåˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•åªèƒ½ç”± root å†™å…¥ï¼Œæ‚¨éœ€è¦åœ¨ç‰¹æƒå®¹å™¨ä¸­ä»¥ root èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œæˆ–ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶æƒé™ä»¥ä¾¿å†™å…¥ hostPath å· apiVersion: v1 kind: Pod metadata: name: test-pd spec: containers: - image: myapp:v1 name: test-container volumeMounts: - name: test-volume mountPath: /test-pd volumes: - name: test-volume hostPath: path: /data type: Dirctory ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:3","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" Persistent Volumeã€ŒæŒä¹…å·ã€ æ¦‚å¿µPersistentVolumeï¼ˆPVï¼‰ æ˜¯ç”±ç®¡ç†å‘˜è®¾ç½®çš„å­˜å‚¨ï¼Œå®ƒæ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„èµ„æºä¸€æ ·ï¼ŒPV ä¹Ÿæ˜¯é›†ç¾¤ä¸­çš„èµ„æºã€‚PV æ˜¯ Volume ä¹‹ç±»çš„å·æ’ä»¶ï¼Œä½†å…·æœ‰ç‹¬ç«‹äºä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚æ­¤ API å¯¹è±¡åŒ…å«å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œå³ NFSã€ISCSI æˆ–ç‰¹å®šäºäº‘ä¾›åº”å•†çš„å­˜å‚¨ç³»ç»Ÿ PersistentVolumeClaimï¼ˆPVCï¼‰ æ˜¯ç”¨æˆ·å­˜å‚¨çš„è¯·æ±‚ï¼Œå®ƒä¸ Pod ç›¸ä¼¼ã€‚Pod æ¶ˆè€—èŠ‚ç‚¹èµ„æºï¼ŒPVC æ¶ˆè€— PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šçº§åˆ«çš„èµ„æºï¼ˆCPU å’Œ å†…å­˜ï¼‰ã€‚å£°æ˜å¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼šå¯ä»¥ä»¥è¯»/å†™ä¸€æ¬¡æˆ–åªè¯»å¤šæ¬¡æ¨¡å¼æŒ‚è½½ï¼‰ é™æ€PV é›†ç¾¤ç®¡ç†å‘˜åˆ›å»ºä¸€äº› PVã€‚å®ƒä»¬å¸¦æœ‰å¯ä¾›é›†ç¾¤ç”¨æˆ·ä½¿ç”¨çš„å®é™…å­˜å‚¨çš„ç»†èŠ‚ã€‚å®ƒä»¬å­˜åœ¨äº Kuberneters API ä¸­ï¼Œå¯ç”¨äºæ¶ˆè´¹ã€‚ åŠ¨æ€PV å½“ç®¡ç†å‘˜åˆ›å»ºçš„é™æ€ PV éƒ½ä¸åŒ¹é…ç”¨æˆ·çš„ PVC æ—¶ï¼Œé›†ç¾¤å¯èƒ½ä¼šå°è¯•åŠ¨æ€çš„ä¸º PVC åˆ›å»ºå·ã€‚æ­¤é…ç½®åŸºäº StorageClassesï¼š PVC å¿…é¡»è¯·æ±‚ ã€Œå­˜å‚¨ç±»ã€ï¼Œå¹¶ä¸”ç®¡ç†å‘˜å¿…é¡»åˆ›å»ºå¹¶é…ç½®è¯¥ç±»æ‰èƒ½è¿›è¡ŒåŠ¨æ€åˆ›å»ºã€‚å£°æ˜è¯¥ç±»ä¸º \"\" å¯ä»¥æœ‰æ•ˆçš„ç¦ç”¨å…¶åŠ¨æ€é…ç½® è¦å¯ç”¨åŸºäºå­˜å‚¨çº§åˆ«çš„åŠ¨æ€å­˜å‚¨é…ç½®ï¼Œé›†ç¾¤ç®¡ç†å‘˜éœ€è¦å¯ç”¨ API server ä¸Šçš„ DefaultStorageClassã€Œå‡†å…¥æ§åˆ¶å™¨ã€ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ç¡®ä¿ DefaultStorageClass ä½äº API server ç»„ä»¶çš„ --admission-control æ ‡å¿—ï¼Œä½¿ç”¨é€—å·åˆ†éš”çš„æœ‰åºå€¼åˆ—è¡¨ä¸­ï¼Œå¯ä»¥å®Œæˆæ­¤æ“ä½œ ç»‘å®šmaster ä¸­çš„æ§åˆ¶ç¯è·¯ç›‘å¬æ–°çš„ PVCï¼Œå¯»æ‰¾åŒ¹é…çš„ PVï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚å¦‚æœä¸ºæ–°çš„ PVC åŠ¨æ€æ‰é… PVï¼Œåˆ™è¯¥ç¯è·¯å°†å§‹ç»ˆå°† PV ç»‘å®šåˆ° PVCï¼Œå¦åˆ™ç”¨æˆ·æ€»ä¼šå¾—åˆ°ä»–ä»¬æ‰€è¯·æ±‚çš„å­˜å‚¨ï¼Œä½†æ˜¯å®¹é‡å¯èƒ½è¶…å‡ºè¦æ±‚çš„æ•°é‡ã€‚ä¸€æ—¦ PV å’Œ PVC ç»‘å®šåï¼ŒPersistentVolumeClaim ç»‘å®šæ˜¯æ’ä»–æ€§çš„ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦‚ä½•ç»‘å®šçš„ã€‚PVC è·Ÿ PV ç»‘å®šæ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ ä¿æŠ¤PVC ä¿æŠ¤çš„ç›®çš„æ˜¯ç¡®ä¿ç”± Pod æ­£åœ¨ä½¿ç”¨çš„ PVC ä¸ä¼šä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œå› ä¸ºå¦‚æœè¢«ç§»é™¤çš„è¯å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤± âš ï¸**æ³¨æ„ï¼š**å½“ Pod çŠ¶æ€ä¸º Pending å¹¶ä¸” Pod å·²ç»åˆ†é…ç»™èŠ‚ç‚¹æˆ– Pod ä¸º Running çŠ¶æ€æ—¶ï¼ŒPVCå¤„äºæ´»è·ƒçŠ¶æ€ å½“å¯ç”¨ PVC ä¿æŠ¤ alpha åŠŸèƒ½æ—¶ï¼Œå¦‚æœç”¨æˆ·åˆ é™¤äº†ä¸€ä¸ª Pod æ­£åœ¨ä½¿ç”¨çš„ PVCï¼Œåˆ™è¯¥ PVC ä¸ä¼šè¢«ç«‹å³åˆ é™¤ã€‚PVC çš„åˆ é™¤å°†è¢«æ¨è¿Ÿï¼Œç›´åˆ° PVC ä¸å†è¢«ä»»ä½• Pod ä½¿ç”¨ åˆ†ç±»PersistentVolume ç±»å‹ä»¥æ’ä»¶å½¢å¼å‡ºç°ã€‚Kubernetes ç›®å‰æ”¯æŒä»¥ä¸‹æ’ä»¶ç±»å‹ï¼š HostPath GCEPersistentDisk AWSElasticBlockStore AzureFile AzureDisk FC(Fibre Channel) FlexVolume Flocker NFS iSCSI RBD CephFS Cinder(OpenStack block storage) Glusterfs VsphereVolume Quobyte Volumes Vmware Photon Portworx Voumes ScaleIO Volumes StorageOS æŒä¹…å·ç¤ºä¾‹ä»£ç  apiVersion: v1 kind: PersistentVolume metadata: name: pv0001 spec: capacity: # å®¹é‡ storage: 5Gi volumeMode: Filesystem # å·æ¨¡å¼ accessModes: # è®¿é—®ç­–ç•¥ - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle # å›æ”¶ç­–ç•¥ storageClassName: slow # å­˜å‚¨ç±»åç§° é»˜è®¤ä¸º StorageClass mountOptions: - hard - nfsvers=4.1 nfs: path: /tmp server: 172.17.0.2 è®¿é—®æ¨¡å¼PV å¯ä»¥ä»¥èµ„æºæä¾›è€…æ”¯æŒçš„ä»»ä½•å½¢å¼æŒ‚è½½åˆ°ä¸»æœºä¸Šã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œä¾›åº”å•†å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œæ¯ä¸ª PV çš„è®¿é—®æ¨¡å¼éƒ½å°†è¢«è®¾ç½®ä¸ºè¯¥å·æ”¯æŒçš„ç‰¹å®šæ¨¡å¼ã€‚ä¾‹å¦‚ï¼ŒNFS å¯ä»¥æ”¯æŒå¤šä¸ªè¯»/å†™å®¢æˆ·ç«¯ï¼Œä½†ç‰¹å®šçš„ NFS PV å¯èƒ½ä»¥åªè¯»æ–¹å¼å¯¼å‡ºåˆ°æœåŠ¡å™¨ä¸Šã€‚æ¯ä¸ª PV éƒ½æœ‰ä¸€å¥—è‡ªå·±çš„ç”¨æ¥æè¿°ç‰¹å®šåŠŸèƒ½çš„è®¿é—®æ¨¡å¼ ReadWriteOnce è¯¥å·å¯ä»¥è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½ ReadOnlyMany è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ¨¡å¼æŒ‚è½½ ReadWriteMany è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½ åœ¨å‘½ä»¤è¡Œä¸­ï¼Œè®¿é—®æ¨¡å¼ç¼©å†™ä¸ºï¼š RWO - ReadWriteOnce ROX - ReadOnlyMany ReadWriteMany - RWX âš ï¸**æ³¨æ„ï¼š**ä¸€ä¸ªå·ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ç§è®¿é—®æ¨¡å¼æŒ‚è½½ï¼Œå³ä½¿å®ƒæ”¯æŒå¾ˆå¤šè®¿é—®æ¨¡å¼ã€‚ä¾‹å¦‚ï¼ŒGCRPersistentDisk å¯ä»¥ç”±å•ä¸ªèŠ‚ç‚¹ä½œä¸º ReadWriteOnce æ¨¡å¼æŒ‚è½½ï¼Œæˆ–ç”±å¤šä¸ªèŠ‚ç‚¹ä»¥ ReadOnlyMany æ¨¡å¼æŒ‚è½½ï¼Œä½†ä¸èƒ½åŒæ—¶æŒ‚è½½ å›æ”¶ç­–ç•¥ Retainï¼ˆä¿ç•™ï¼‰ï¼šæ‰‹åŠ¨å›æ”¶ Recycleï¼ˆå›æ”¶ï¼‰ï¼šåŸºæœ¬æ“¦é™¤ï¼ˆrm -rf /thevolume/*ï¼‰ Deleteï¼ˆåˆ é™¤ï¼‰ï¼šå…³è”çš„å­˜å‚¨èµ„äº§ï¼ˆä¾‹å¦‚ AWS EBSâ€¦ï¼‰å°†è¢«åˆ é™¤ å½“å‰ï¼Œåªæœ‰ HostPath æ”¯æŒå›æ”¶ç­–ç•¥ï¼ŒAWS EBSã€GCE PDã€Azure Disk å’Œ Cinder å·æ”¯æŒåˆ é™¤ç­–ç•¥ çŠ¶æ€å·å¯ä»¥å¤„äºä¸€ä¸‹çš„æŸç§çŠ¶æ€ï¼š Availableï¼ˆå¯ç”¨ï¼‰ï¼šä¸€å—ç©ºé—²èµ„æºè¿˜æ²¡æœ‰è¢«ä»»ä½•å£°æ˜ç»‘å®š Boundï¼ˆå·²ç»‘å®šï¼‰ï¼šå·å·²ç»è¢«å£°æ˜ç»‘å®š Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼šå£°æ˜è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜ Failedï¼ˆå¤±è´¥ï¼‰ï¼šè¯¥å·çš„è‡ªåŠ¨å›æ”¶å¤±è´¥ å‘½ä»¤è¡Œä¼šæ˜¾ç¤ºç»‘å®šåˆ° PV çš„ PVC çš„åç§° ","date":"2022-06-07","objectID":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:4","tags":["k8s"],"title":"K8Så­¦ä¹ ç¬”è®°","uri":"/posts/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ "],"content":" ä¸€ã€å‰è¨€æœ€è¿‘åœ¨è€ƒè™‘PAASç§»åŠ¨å¹³å°çš„â€åŠ¨æ€å­—æ®µå­˜å‚¨â€é—®é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯å‰æ®µæŸé¡µé¢ä¸­çš„è¡¨å•åŠ¨æ€å¢åŠ ä¸€ä¸ªç¼–è¾‘æ¡†ï¼Œä»¥æŸä¸€ä¸ªæ–°å­—æ®µçš„å½¢å¼æäº¤åˆ°åç«¯ï¼Œåç«¯æ¥å£èƒ½å¤Ÿåœ¨ä¸å¢åŠ æ–°çš„è¡¨å­—æ®µä¸”åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ä»£ç çš„æ–¹å¼å­˜å‚¨èµ·æ¥ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå…³ç³»å‹æ•°æ®åº“MySQLçš„æ•°æ®è¡¨åœ¨ä¿®æ”¹è¡¨å­—æ®µæ—¶ï¼Œä»£ä»·æ¯”è¾ƒå¤§ï¼Œç”šè‡³å‡ºç°é”è¡¨å¯¼è‡´æœåŠ¡å¥”æºƒã€‚æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»ç„¶åŸºäºMySQLï¼Œå¯¹æ¯”äº†ä¸¤ç§å¯è¡Œçš„æ–¹æ³•ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:1:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" äºŒã€åŠ¨æ€ç»“æ„å…³ç³»æ•°æ®åº“éå¸¸é€‚åˆå…·æœ‰å¤§é‡å…³ç³»çš„ç»“æ„åŒ–æ•°æ®ï¼Œå®ƒæ‰€å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯é¢„å…ˆèƒ½å¤Ÿå®šä¹‰å‡ºæ¸…æ™°çš„ç»“æ„ï¼Œå¹¶ä¸”çŸ­æœŸæˆ–æ›´é•¿çš„æ—¶é—´å†…ç»“æ„ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä½†æ˜¯ä¸šåŠ¡æ€»æ˜¯ä¸æ–­åœ¨å˜åŒ–çš„ï¼Œä¸šåŠ¡åœ¨æ‰©å±•ï¼Œå­˜å‚¨çš„ä¿¡æ¯å¿…ç„¶æ›´å¤šæ›´å¹¿ï¼Œè¡¨ç»“æ„å‘ç”Ÿå˜åŒ–å‡ ä¹æ˜¯ä¸å¯é¿å…ã€‚ ä¸ºäº†è§£å†³â€åŠ¨æ€ç»“æ„â€çš„é—®é¢˜ä¹Ÿæœ‰ä¸å°‘è½»æ˜“èƒ½å¤Ÿæƒ³åˆ°çš„æ–¹æ³•ï¼š åˆ—æ¨¡å‹ï¼šå°±æ˜¯å¸¸è¯´çš„â€å®½è¡¨â€ï¼Œä¸ºäº†åº”å¯¹è¡¨ç»“æ„çš„æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¾è®¡è¡¨ç»“æ„çš„æ—¶å€™ï¼Œé¢„ç•™å¤šä¸€äº›ç©ºç™½å­—æ®µï¼Œç®€å•å¥½ç†è§£ï¼Œä½†æ˜¯å®¹æ˜“é€ æˆæ•°æ®çš„â€ç¨€ç–æ€§â€ï¼ŒåŒæ—¶é•¿è¿œçœ‹æ¥å®½è¡¨å¤ªå®½å­˜å‚¨æ€§èƒ½å¾ˆå·®ï¼Œå¤ªçª„ä¼šæ»¡è¶³ä¸äº†ä¸šåŠ¡å˜åŒ–ã€‚ è¡Œæ¨¡å‹ï¼šå°±æ˜¯ä»¥key-valueç»“æ„ä½œä¸ºä¸€è¡Œå­˜å‚¨åˆ°è¡¨ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªå­—æ®µå°±æ–°å¢ä¸€è¡Œæ•°æ®ï¼Œå…¼é¡¾çµæ´»æ€§ï¼Œé—®é¢˜åœ¨äºvalueå®šä¹‰ç±»å‹åªèƒ½æ˜¯varcharï¼Œå¤§å°ä¹Ÿéœ€è¦åšé™åˆ¶ã€‚ NoSQLï¼šåˆ©ç”¨NoSQLåŸºäºdocumentç±»å‹çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å­˜å‚¨åŠ¨æ€ç»“æ„å¹¶ä¸”æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†é—®é¢˜åœ¨äºä¸šåŠ¡æ”¹é€ æˆæœ¬å¤§ï¼ŒåŒæ—¶éœ€è¦ACIDäº‹åŠ¡çš„åœºæ™¯æ”¯æŒåº¦ä¸å¤Ÿã€‚ è¿˜æœ‰ä¸€ç§æ¨¡å‹ï¼Œç›®å‰åœ¨è¯¸å¦‚åŒ»ç–—æ•°æ®åº“ã€çŠ¯ç½ªæ•°æ®åº“å’Œå¤§å‹ç”µå•†ç±»æ•°æ®ç­‰æœ‰ç€å¹¿æ³›åº”ç”¨çš„æˆç†Ÿæ¨¡å‹ï¼šEAVæ¨¡å‹ï¼Œä¹Ÿå³æ˜¯ä»¥â€å®ä½“-å±æ€§-å€¼â€æ¥ç»„ç»‡æ•°æ®ã€‚ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:2:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" EAVæ¨¡å‹åœ¨å¼€æºå’Œphpç¤¾åŒºï¼Œæœ€è‘—åçš„EAVå®ç°æ˜¯Magentoï¼Œä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°ã€‚EAVæ¨¡å‹ï¼Œå°±æ˜¯æŠŠå®ä½“-å±æ€§-å€¼ï¼ˆEntity-Attribute-Valueï¼‰åˆ†å¼€è¡¨è¿›è¡Œå­˜å‚¨ã€‚å®ä½“è¡¨å­˜å‚¨å¯¹è±¡çš„IDå’Œä¸»è¦å±æ€§ï¼Œå±æ€§è¡¨å­˜å‚¨éœ€è¦æ‰©å±•çš„å±æ€§ï¼Œå€¼è¡¨ç”±ä¸åŒç±»å‹çš„è¡¨ç»„æˆä¸€ä¸ªé›†åˆï¼Œä¸€ä¸ªå€¼éœ€è¦ç”±å®ä½“ID+å±æ€§IDæ¥ç¡®å®šã€‚ ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾æŸä¸€ä¸ªå®ä½“å…·å¤‡å“ªäº›å±æ€§ï¼Œå¯ä»¥å¢åŠ å®ä½“ç±»å‹ï¼ˆtype_idï¼‰ï¼ŒåŸºäºå®ä½“çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾eav_attributeæ¥æ‰¾åˆ°è¦è®¾ç½®äº§å“çš„é‚£ä¸€å±æ€§ã€‚å½“éœ€è¦æ“ä½œæŸä¸€ä¸ªå®ä½“çš„å±æ€§æ—¶ï¼Œå°±å¯ä»¥å…ˆæŠŠå®ä½“æ‹¥æœ‰çš„å±æ€§å…ˆæŸ¥å‡ºæ¥ï¼Œå†å¯¹å±æ€§è¿›è¡Œæ“ä½œï¼Œè®¾ç½®å±æ€§å€¼æ—¶ï¼Œå…ˆåˆ¤æ–­å±æ€§çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå†æ‰¾åˆ°å¯¹åº”ç±»å‹çš„å€¼è¡¨ï¼Œç„¶åæ›´æ–°æ”¹å±æ€§çš„å€¼ã€‚ è™½ç„¶EAVæ¨¡å‹èƒ½å¤Ÿè§£å†³ä»¥ä¸Šä¸‰ç§æ¨¡å‹çš„ç¼ºç‚¹ï¼Œæœ‰ç€çµæ´»æ€§å¼ºï¼Œå®Œç¾è§£å†³æ•°æ®ç¨€ç–æ€§ï¼Œä½†æ˜¯å®ƒä¹Ÿå› ä¸ºå¤ªè¿‡äºå¤æ‚ï¼Œæœ‰ç€æ˜æ˜¾çš„å­¦ä¹ æ›²çº¿ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¹Ÿç›¸å¯¹ä½ä¸‹ï¼Œå¿…é¡»ä¸ºå…¶æå‡æ€§èƒ½åšå¤§é‡çš„è¾…åŠ©å·¥ä½œã€‚ æˆ‘çš„ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ç§åŠ¨æ€ç»“æ„çš„æ•°æ®çš„æ¨¡å‹æ€§èƒ½å¯ä¸æ–‡æ¡£æ•°æ®åº“ç›¸åª²ç¾ï¼Œç»“æ„æ›´ç®€å•æ¯”EAVæ›´å…·å¯è¯»æ€§ã€‚é‚£å°±æ˜¯MySQL5.7ä»¥åæ”¯æŒçš„JSONç±»å‹ï¼Œä¹Ÿå°±è¡¨å­—æ®µç±»å‹ä¸ºJSONï¼Œç”¨äºå­˜å‚¨åŠ¨æ€æ‰©å±•å­—æ®µã€‚ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:2:1","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" JSONæ¨¡å‹JSONæ¨¡å‹ï¼Œæ¯”è¾ƒMySQL5.7ä»¥å‰ä½¿ç”¨textç±»å‹æ¥å­˜æ–‡æœ¬JSONçš„æ–¹å¼ï¼ŒJSONæ¨¡å‹å…¼é¡¾äº†æ€§èƒ½åŠæ˜“ç”¨æ€§ï¼Œåœ¨æ“ä½œå’Œæ€§èƒ½ä¸Šéƒ½å¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚JSONç±»å‹æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œè¦æ¯”å­—ç¬¦ä¸²æ›´åŠ é«˜æ•ˆï¼Œå†ä¹Ÿä¸ç”¨jsonåºåˆ—åŒ–è¿‘æ–‡æœ¬å­—æ®µï¼ŒæŸ¥è¯¢ä¹‹åè¿˜è¦è§£æï¼ŒåŒæ—¶è¿˜è¦å…¼é¡¾jsonçš„åˆæ³•æ€§ã€‚ åœ¨MySQL 5.7.8ä¸­ï¼ŒMySQLæ”¯æŒç”±RFC 7159å®šä¹‰çš„æœ¬åœ°JSONæ•°æ®ç±»å‹ï¼Œå®ƒæ”¯æŒå¯¹JSON(JavaScriptå¯¹è±¡æ ‡è®°)æ–‡æ¡£ä¸­çš„æ•°æ®è¿›è¡Œæœ‰æ•ˆè®¿é—®. æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š MySQLä¼šå¯¹DML JSONæ•°æ®è‡ªåŠ¨éªŒè¯ã€‚æ— æ•ˆçš„DML JSONæ•°æ®æ“ä½œä¼šäº§ç”Ÿé”™è¯¯. ä¼˜åŒ–çš„å­˜å‚¨æ ¼å¼ã€‚å­˜å‚¨åœ¨JSONåˆ—ä¸­çš„JSONæ–‡æ¡£è½¬æ¢ä¸ºä¸€ç§å†…éƒ¨æ ¼å¼ï¼Œå…è®¸å¯¹Jsonå…ƒç´ è¿›è¡Œå¿«é€Ÿè¯»å–è®¿é—®. MySQL Jsonç±»å‹æ”¯æŒå»ºç«‹ç´¢å¼•å¢åŠ æŸ¥è¯¢æ€§èƒ½æå‡. å¦å¤–æœ‰è¿˜æœ‰ä¸€ç§æˆ‘è®¤ä¸ºæ”¶ç›Šæ¯”è¾ƒå¤§çš„æ˜¯ï¼šè™šæ‹Ÿåˆ— Virtual Column åœ¨MySQL 5.7ä¸­ï¼Œæ”¯æŒä¸¤ç§Generated Columnï¼Œå³Virtual Generated Columnå’ŒStored Generated Columnï¼Œå‰è€…åªå°†Generated Columnä¿å­˜åœ¨æ•°æ®å­—å…¸ä¸­ï¼ˆè¡¨çš„å…ƒæ•°æ®ï¼‰ï¼Œå¹¶ä¸ä¼šå°†è¿™ä¸€åˆ—æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼›åè€…ä¼šå°†Generated ColumnæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯»å–çš„æ—¶å€™è®¡ç®—æ‰€å¾—ã€‚å¾ˆæ˜æ˜¾ï¼Œåè€…å­˜æ”¾äº†å¯ä»¥é€šè¿‡å·²æœ‰æ•°æ®è®¡ç®—è€Œå¾—çš„æ•°æ®ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´ï¼Œä¸Virtual Columnç›¸æ¯”å¹¶æ²¡æœ‰ä¼˜åŠ¿ï¼Œå› æ­¤ï¼ŒMySQL 5.7ä¸­ï¼Œä¸æŒ‡å®šGenerated Columnçš„ç±»å‹ï¼Œé»˜è®¤æ˜¯Virtual Columnã€‚ æœ‰äº†è™šæ‹Ÿåˆ—ï¼Œåœ¨selectå­å¥å’Œwhereå­å¥ä¸­ï¼ŒæŸ¥è¯¢è™šæ‹Ÿåˆ—ä¸æ™®é€šçš„åˆ—æ²¡æœ‰ä¸åŒï¼ŒæŸ¥è¯¢ç”¨æ³•ä¸Šå¯ä»¥åŸºæœ¬ä¸éœ€è¦å˜åŒ–ã€‚åŒæ—¶ç”±äºè™šæ‹Ÿåˆ—çš„ç‰¹æ€§ï¼Œåªæ˜¯ä¸jsonä¸­çš„å±æ€§keyçš„ä¸€ç§æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥è™šæ‹Ÿåˆ—çš„å¢åˆ æ€§èƒ½æ˜¯éå¸¸å¥½çš„ã€‚ å¦å¤–ï¼Œåœ¨å»ºç«‹äº†è™šæ‹Ÿåˆ—ä¹‹åï¼Œå¯ä»¥ç»§ç»­å¯¹è™šæ‹Ÿåˆ—å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæœ‰äº†ç´¢å¼•ï¼Œæ€§èƒ½å‡ ä¹è·Ÿæ™®é€šæ²¡æœ‰åŒºåˆ«ã€‚ ä¸‹é¢çš„ç¬¬äº”èŠ‚çš„æ¨¡å‹æ“ä½œå¯¹æ¯”ä¸­ä¼šç»™å‡ºä¸€äº›JSONæ“ä½œçš„å®ä¾‹ï¼Œæ›´å¤šå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://dev.mysql.com/doc/refman/5.7/en/json.html ä¸‹é¢ç»™å‡ºåˆ—æ¨¡å‹ã€è¡Œæ¨¡å‹ã€EAVæ¨¡å‹å’ŒJSONæ¨¡å‹çš„ä¼˜ç¼ºç‚¹åŠè¡¨ç»“æ„å¯¹æ¯”ï¼š ç”±äºåˆ—æ¨¡å‹ã€è¡Œæ¨¡å‹å’ŒNoSQLéƒ½æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£å’Œå¸¸è§ï¼Œæ‰€ä»¥ä¸‹æ–‡é‡ç‚¹åªå¯¹EAVæ¨¡å‹å’ŒJSONæ¨¡å‹è¿›è¡Œåˆ†æå’Œå¯¹æ¯” ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:2:2","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" ä¸‰ã€æ€§èƒ½æµ‹è¯•ç»“æœå¯¹æ¯”ä¸‹é¢æ˜¯ä¸¤ç§æ¨¡å‹å‚ä¸æ€§èƒ½æµ‹è¯•çš„SQLï¼ŒåŒ…æ‹¬æŸ¥è¯¢ï¼Œæ›´æ–°å’Œæ’å…¥æ•°æ®ï¼Œå¯ä»¥å¯¹æ¯”è§‚å¯Ÿä¸€ä¸‹ä¸åŒæ¨¡å‹SQLçš„å¤æ‚åº¦ï¼š ä¸‹é¢ä¸ºSQLåœ¨ä¸åŒé‡çº§çš„æ•°æ®é‡æ—¶ï¼Œä»æŸ¥è¯¢ã€æ›´æ–°ã€æ’å…¥ã€å»ºç«‹å­—æ®µå’Œç´¢å¼•ç­‰æ“ä½œç»´åº¦ï¼Œå¯¹æ¯”äº†EAVæ¨¡å‹ã€MySQL5.7çš„JSONæ¨¡å‹ å’Œ MySQL8.0çš„JSONæ¨¡å‹ çš„æ€§èƒ½ï¼Œå¦å¤–å¯¹æ¯”äº†ç£ç›˜ç©ºé—´å ç”¨å’Œæ•°æ®å¯¼å…¥æ€§èƒ½ å›¾è¡¨å±•ç¤ºï¼Œæ–¹ä¾¿æŸ¥çœ‹è¶‹åŠ¿ ç»“è®ºï¼š ä¸¤ç§æ¨¡å‹ä»æ“ä½œçš„å¤æ‚åº¦æ¯”è¾ƒï¼ŒEAVæ¨¡å‹è¦å¤æ‚å¾—å¤šï¼ŒæŸ¥è¯¢ä¸å®œè”æŸ¥è¿™ä¹ˆå¤šçš„è¡¨ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½å¿…é¡»åˆ†æ­¥éª¤ï¼ŒæŸ¥è¯¢æœ‰å“ªäº›å±æ€§å¹¶æ‹¿åˆ°å±æ€§IDï¼ˆå½“ç„¶å¯ä»¥åˆ©ç”¨ç¼“å­˜æ¥ä¼˜åŒ–ï¼‰ï¼ŒJSONæ¨¡å‹åªè¦æœ‰è™šæ‹Ÿåˆ—ï¼ŒæŸ¥è¯¢æ—¶ä¸æ™®é€šçš„æ–¹å¼æ²¡æœ‰å´åˆ«ï¼Œæ’å…¥æˆ–æ›´æ–°æ—¶éœ€è¦åˆ©ç”¨å‡½æ•°ï¼› ä»æŸ¥è¯¢æ€§èƒ½æ¥çœ‹ï¼ŒJSONæ¨¡å‹æ˜æ˜¾ä¼˜äºEAVæ¨¡å‹ã€‚ä¸è¿‡è™½ç„¶è¿™æ ·ï¼ŒEAVåªè¦åšå¥½é€‚å½“çš„ç¼“å­˜ä¼˜åŒ–ï¼Œå…¶å®æ˜¯å¯ä»¥æ»¡è¶³ä¸€å®šçš„åœºæ™¯å¹¶è¢«æ¥å—ï¼› æ— è®ºåœ¨é‚£ä¸ªæ•°é‡çº§ä¸‹ï¼ŒJSONæ¨¡å‹æ“ä½œè™šæ‹Ÿåˆ—æ—¶çš„æ¶ˆè€—éƒ½æ˜¯æå¿«ï¼Œè€Œå¯¹äºç»™è™šæ‹Ÿåˆ—æ·»åŠ ç´¢å¼•ï¼Œæ€§èƒ½ä¼šéšç€æ•°æ®é‡çº§çš„å¢å¤§è€Œå¢åŠ ï¼Œæ¯•ç«Ÿéœ€è¦å»ºç«‹ç´¢å¼•æ ‘ï¼Œä¹Ÿæ˜¯æ­£å¸¸æ“ä½œäº†ï¼Œä¸æ™®é€šåˆ—çš„ç´¢å¼•å·®ä¸å¤šï¼› MySQL8.0å¯¹JSONç±»å‹ä¹Ÿåšäº†å¢å¼ºï¼Œå¯¹æ¯”MySQL5.7ï¼Œåœ¨æ·»åŠ /åˆ é™¤ç´¢å¼•çš„æ€§èƒ½ä¸Šï¼Œæ€§èƒ½æå‡äº†æ¥è¿‘ä¸€å€ï¼Œè™šæ‹Ÿåˆ—çš„æ“ä½œæ€§èƒ½åœ¨ä¸åŒæ•°æ®é‡çº§ä¸‹ï¼Œæ›´åŠ ç¨³å®šï¼› ç”±äºæµ‹è¯•ç”¨ä¾‹è¿˜æ˜¯æ¯”è¾ƒç²—ç•¥ï¼Œæ‰€ä»¥ä¸ä¸€å®š100%ç²¾å‡†ï¼Œå‘ç°å“ªé‡Œæœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚ å¯¹EAVæ¨¡å‹å’ŒJSONæ¨¡å‹çš„è¡¨ç»“æ„å’Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œæ„Ÿå…´è¶£çš„ï¼Œè¯·çœ‹ç¬¬äº”èŠ‚â€åŠ¨æ€å­˜å‚¨æ¨¡å‹å®é™…æ¡ˆä¾‹â€ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:3:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" å››ã€æ€»ç»“æœ¬ç¯‡ä¸ºä½ ä»‹ç»äº†åŠ¨æ€ç»“æ„çš„åœºæ™¯ï¼Œå¹¶ä¸”åˆ—ä¸¾äº†å‡ ä¸ªå¯è¡Œçš„å­˜å‚¨æ¨¡å‹ï¼šåˆ—æ¨¡å‹ï¼ˆå®½è¡¨ï¼‰ï¼Œè¡Œæ¨¡å‹ï¼ŒEAVæ¨¡å‹å’ŒJSONæ¨¡å‹ï¼Œå¹¶ä¸”åˆ†æäº†å„ç§æ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹æ¥å¯¹æ¯”åˆ†æäº†EAVæ¨¡å‹å’ŒJSONæ¨¡å‹ï¼Œäº†è§£äº†è¿™ä¸¤ç§æ¨¡å‹çš„å®é™…æ“ä½œçš„SQLè¯­å¥ï¼Œå±•ç¤ºäº†ä¸åŒçš„æ•°æ®é‡çº§ä¸‹çš„æŸ¥è¯¢ã€æ’å…¥å’Œæ›´æ–°æ€§èƒ½ã€‚ ç»è¿‡ä¸€ç•ªå¯¹æ¯”ï¼Œç›¸ä¿¡ä½ å·²ç»é¢å¯¹â€åŠ¨æ€ç»“æ„â€çš„åœºæ™¯æ—¶å€™ï¼Œå·²ç»æœ‰æ®å¯ä¾äº†ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚ è‚æ–‡ç« ä¸æ˜“ï¼Œç‚¹ä¸ªèµå†èµ°ã€‚æ„Ÿè°¢ï¼ï¼ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:4:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" äº”ã€é™„åŠ ï¼šåŠ¨æ€å­˜å‚¨æ¨¡å‹å®é™…æ¡ˆä¾‹","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:5:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 1. EAVæ¨¡å‹ï¼ˆEntity-Attribute-Value Modelï¼‰ è¡¨ç»“æ„å±æ€§è¡¨ create table `eav_attribute` ( `id` int unsigned not null auto_increment comment 'å±æ€§ID', `entity_type_id` int unsigned not null default 0 comment 'å®ä½“ç±»å‹ID', `attribute_code` varchar(128) not null default '' comment 'å±æ€§Code', `attribute_name` varchar(128) not null default '' comment 'å±æ€§åç§°', `attribute_type` enum ('int', 'varchar', 'text', 'decimal', 'datetime') not null comment 'å±æ€§ç±»å‹', primary key (`id`), index `IDX_ENTITY_TYPE_ID` (`entity_type_id`), index `IDX_TYPE` (`attribute_type`) ) engine = innodb charset = utf8mb4 comment 'eavå±æ€§è¡¨'; ç”¨æˆ·å®ä½“è¡¨ create table `user_entity` ( id int auto_increment primary key comment 'ç”¨æˆ·å®ä½“ID', type_id int unsigned not null default 0 comment 'å®ä½“ç±»å‹ID', username varchar(32) default '' not null comment 'ç”¨æˆ·å' ) engine = innodb charset = utf8mb4 comment 'ç”¨æˆ·å®ä½“è¡¨'; ç”¨æˆ·æ•´å‹å€¼è¡¨ create table `user_int` ( `entity_id` int unsigned not null comment 'å®ä½“ID', `attribute_id` int unsigned not null comment 'å±æ€§ID', `value` int not null default 0 comment 'æ•´å‹å€¼', primary key (`entity_id`, `attribute_id`), index `IDX_VALUE` (`value`) ) engine = innodb charset = utf8mb4 comment 'useræ•´å‹å€¼è¡¨'; ç”¨æˆ·å­—ç¬¦ä¸²å€¼è¡¨ create table `user_varchar` ( `entity_id` int unsigned not null comment 'å®ä½“ID', `attribute_id` int unsigned not null comment 'å±æ€§ID', `value` varchar(255) not null default '' comment 'å­—ç¬¦å€¼', primary key (`entity_id`, `attribute_id`), index `IDX_VALUE` (`value`) ) engine = innodb charset = utf8mb4 comment 'userå­—ç¬¦å€¼è¡¨'; ç”¨æˆ·æ–‡æœ¬å€¼è¡¨ create table `user_text` ( `entity_id` int unsigned not null comment 'å®ä½“ID', `attribute_id` int unsigned not null comment 'å±æ€§ID', `value` text comment 'æ–‡æœ¬å€¼', primary key (`entity_id`, `attribute_id`) ) engine = innodb charset = utf8mb4 comment 'useræ–‡æœ¬å€¼è¡¨'; ç”¨æˆ·æµ®ç‚¹å‹å€¼è¡¨ create table `user_decimal` ( `entity_id` int unsigned not null comment 'å®ä½“ID', `attribute_id` int unsigned not null comment 'å±æ€§ID', `value` decimal(9, 2) unsigned not null comment 'æµ®ç‚¹å€¼', primary key (`entity_id`, `attribute_id`), index `IDX_VALUE` (`value`) ) engine = innodb charset = utf8mb4 comment 'useræµ®ç‚¹å€¼è¡¨'; ç”¨æˆ·æ—¥æœŸå‹å€¼è¡¨ create table `user_datetime` ( `entity_id` int unsigned not null comment 'å®ä½“ID', `attribute_id` int unsigned not null comment 'å±æ€§ID', `value` datetime not null comment 'æ—¥æœŸå€¼', primary key (`entity_id`, `attribute_id`), index `IDX_VALUE` (`value`) ) engine = innodb charset = utf8mb4 comment 'useræ—¥æœŸå€¼è¡¨'; æ’å…¥å±æ€§æ•°æ® INSERT INTO `eav_attribute` (id, entity_type_id, attribute_code, attribute_name, attribute_type) VALUES (1, 1, 'name', 'å§“å', 'varchar'), (2, 1, 'age', 'å¹´é¾„', 'int'), (3, 1, 'gender', 'æ€§åˆ«', 'varchar'), (4, 1, 'phone', 'ç”µè¯', 'varchar'), (5, 1, 'mobile', 'ç§»åŠ¨ç”µè¯', 'varchar'), (6, 1, 'address', 'å®¶åº­ä½å€', 'varchar'), (7, 1, 'height', 'èº«é«˜(cm)', 'decimal'), (8, 1, 'weight', 'ä½“é‡(kg)', 'decimal'), (9, 1, 'profile', 'ç®€ä»‹', 'text'), (10, 1, 'birthday', 'å‡ºç”Ÿå¹´æœˆ', 'datetime'); ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:5:1","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 2. JSONæ¨¡å‹ è¡¨ç»“æ„ ç”¨æˆ·è¡¨ create table `user` ( `id` int unsigned not null auto_increment comment 'ç”¨æˆ·ID', `username` varchar(32) not null default '' comment 'è´¦å·', primary key(`id`) ) engine = innodb charset = utf8mb4 comment 'ç”¨æˆ·ä¸»è¡¨'; ç”¨æˆ·æºæ•°æ®è¡¨ create table `user_metadata` ( `id` int unsigned not null auto_increment comment 'ç”¨æˆ·å…ƒæ•°æ®', `field_code` varchar(32) not null default '' comment 'å­—æ®µcode', `field_name` varchar(32) not null default '' comment 'å­—æ®µå', `field_type` varchar(32) not null default '' comment 'å­—æ®µç±»å‹', primary key(`id`), index `IDX_FIELD` (`field_name`, `field_type`) ) engine = innodb charset = utf8mb4 comment 'ç”¨æˆ·å…ƒæ•°æ®è¡¨'; ç”¨æˆ·æ‰©å±•å­—æ®µè¡¨ create table `user_extra_field` ( `id` int unsigned not null auto_increment comment 'å­—æ®µid', `user_id` int unsigned not null default 0 comment 'ç”¨æˆ·ID', `properties` json default null comment 'æ‰©å±•å­—æ®µ', primary key(`id`), index `IDX_USER_ID` (`user_id`) ) engine = innodb charset = utf8mb4 comment 'ç”¨æˆ·æ‰©å±•å­—æ®µè¡¨'; å…ƒæ•°æ® insert into `user_metadata` (id, field_code, field_name, field_type) VALUES (1, 'name', 'å§“å', 'varchar'), (2, 'age', 'å¹´é¾„', 'int'), (3, 'gender', 'æ€§åˆ«', 'varchar'), (4, 'phone', 'ç”µè¯', 'varchar'), (5, 'mobile', 'ç§»åŠ¨ç”µè¯', 'varchar'), (6, 'address', 'å®¶åº­ä½å€', 'varchar'), (7, 'height', 'èº«é«˜(cm)', 'decimal'), (8, 'weight', 'ä½“é‡(kg)', 'decimal'), (9, 'profile', 'ç®€ä»‹', 'text'), (10,'birthday', 'å‡ºç”Ÿå¹´æœˆ', 'datetime'); è¯´æ˜ï¼šç”±äºjsonç±»å‹é‡Œçš„æ•°æ®ç±»å‹ä¹Ÿæ˜¯åªæœ‰å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ï¼ˆJSON å¯¹è±¡ï¼‰ã€æ•°ç»„ã€å¸ƒå°”å’ŒNullï¼Œæ‰€ä»¥ä½¿ç”¨å…ƒæ•°æ®è¡¨æŠŠå±æ€§çš„å…·ä½“ç±»å‹å­˜å‚¨èµ·æ¥ï¼Œå¯ä»¥åœ¨å¿…è¦æ—¶å¯ä»¥åœ¨ä»£ç å±‚åšç±»å‹è½¬æ¢é€»è¾‘ã€‚ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:5:2","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" æ¨¡å‹æ“ä½œå¯¹æ¯”","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:6:0","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 1. å­—æ®µæ“ä½œ å¢åŠ ä¸€ä¸ªâ€eduâ€å­¦å†å­—æ®µEAVæ¨¡å‹ åªéœ€è¦åœ¨å±æ€§è¡¨eav_attributeä¸­å¢åŠ ä¸€è¡Œå³å¯ insert into eav_attribute (entity_type_id, attribute_code, attribute_name, attribute_type) values (1, 'edu', 'å­¦å†', 'varchar'); JSON éœ€è¦åœ¨å…ƒæ•°æ®è¡¨user_metadataå¢åŠ ä¸€è¡Œï¼Œå¹¶ä¸”å¢åŠ è™šæ‹Ÿåˆ—eduä»¥åŠå…¶ç´¢å¼• alter table user_extra_field add column `edu` varchar(32) GENERATED ALWAYS AS (json_extract(`properties`,'$.edu')) VIRTUAL; alter table user_extra_field add index `IDX_EDU` (`edu`); åˆ é™¤mobileå­—æ®µEAVæ¨¡å‹ éœ€è¦ä¸‰æ­¥ï¼š æŸ¥è¯¢mobileå±æ€§ åˆ é™¤å±æ€§è®°å½• åˆ é™¤å±æ€§å€¼ -- step1: æŸ¥è¯¢å±æ€§ä¿¡æ¯ select * from eav_attribute where entity_type_id = 1; -- step2: åˆ é™¤å­—æ®µ delete from eav_attribute where id = 5; -- step3: åˆ é™¤å€¼ delete from user_varchar where attribute_id = 5; JSONæ¨¡å‹ åˆ©ç”¨json_remove()æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤jsonå­—æ®µå¯¹åº”çš„å±æ€§ -- step1: åˆ é™¤å­—æ®µ delete from user_metadata where field_code = 'mobile'; -- step2: åˆ é™¤å€¼ update user_extra_field set properties = json_remove(properties, '$.mobile'); -- step3: åˆ é™¤è™šæ‹Ÿåˆ— alter table user_extra_field drop column `mobile`; æ³¨æ„ï¼Œç¬¬2ã€3æ­¥å¯ä»¥æ ¹æ®ä¸šåŠ¡è‡ªèº«è€ƒè™‘æ˜¯å¦æœ‰å¿…è¦ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œé‚£äº›ç¡®å®šä¸å†ä½¿ç”¨çš„å±æ€§å­—æ®µå¯ä»¥è€ƒè™‘åˆ é™¤ï¼Œç¼©å°jsonä½“ç§¯ã€‚ ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:6:1","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 2. æŸ¥è¯¢æ“ä½œ æŸ¥è¯¢èº«é«˜é«˜äº170cmï¼Œå¹´æ»¡18å²çš„ç”·æ€§ç”¨æˆ·EAVæ¨¡å‹ éœ€è¦åˆ†ä¸‰æ­¥è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯ä¸€æ­¥çš„ç»“æœä¼ é€’éœ€è¦ä»£ç é€»è¾‘å±‚å®ç°ï¼Œæ­¤å¤„ç›´æ¥è´´å‡ºæ‰€æœ‰çš„æŸ¥è¯¢SQL -- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§ select * from eav_attribute where entity_type_id = 1; -- step2: æ ¹æ®æ¡ä»¶è¿‡æ»¤å‡ºç”¨æˆ·ID select i.entity_id from user_int as i join user_varchar as v on i.entity_id = v.entity_id and v.value = 'ç”·' and v.attribute_id = 3 join user_decimal as d on v.entity_id = d.entity_id and d.value \u003e 170 and d.attribute_id = 7 where i.attribute_id = 2 and i.value \u003e 18; -- step3: æ ¹æ®ç”¨æˆ·IDä¸å±æ€§ï¼ŒæŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„å®ä½“ä¿¡æ¯ select entity_id as id, `value`, a.attribute_code from ( select entity_id, `value`, attribute_id from user_int where attribute_id = 2 and entity_id in (1,3,4,6,10,13,17,18) union all select entity_id, `value`, attribute_id from user_varchar where attribute_id in (1, 3) and entity_id in (1,3,4,6,10,13,17,18) union all select entity_id, `value`, attribute_id from user_datetime where attribute_id = 10 and entity_id in (1,3,4,6,10,13,17,18) union all select entity_id, `value`, attribute_id from user_decimal where attribute_id = 7 and entity_id in (1,3,4,6,10,13,17,18) ) as s join eav_attribute as a on s.attribute_id = a.id; æ³¨æ„ï¼šæŸ¥å‡ºæ¥çš„ç»“æœï¼Œè¿˜éœ€è¦è¿›è¡Œkey-valueçš„è½¬æ¢ JSONæ¨¡å‹ select u.id, json_unquote(f.properties -\u003e '$.name') as name, json_unquote(f.properties -\u003e '$.gender') as gender, f.properties -\u003e '$.height' as height, json_unquote(f.properties -\u003e '$.birthday') as birthday from user as u join user_extra_field as f on u.id = f.user_id and f.properties -\u003e '$.age' \u003e 18 and f.properties -\u003e '$.height' \u003e 170 and f.properties -\u003e '$.gender' = 'ç”·' åœ¨å»ºç«‹äº†è™šæ‹Ÿåˆ—çš„å‰æä¸‹ï¼ŒæŸ¥è¯¢ä¸ä¼ ç»Ÿçš„æ–¹å¼æ²¡æœ‰åŒºåˆ« select u.id,f.name,f.gender,f.height, f.birthday from user as u join user_extra_field as f on u.id = f.user_id and f.age \u003e 18 and f.height \u003e 170 and f.gender = 'ç”·' æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…ï¼šæŸ¥è¯¢ç”¨æˆ·IDä¸º3çš„ç”¨æˆ·ä¿¡æ¯EAVæ¨¡å‹ éœ€è¦åˆ†ä¸¤æ­¥ï¼š1. æŸ¥è¯¢æ‰€æœ‰çš„å±æ€§ï¼Œ2.æ ¹æ®å±æ€§IDå’Œç”¨æˆ·IDï¼ŒæŸ¥è¯¢å±æ€§å€¼ -- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§ select * from eav_attribute where entity_type_id = 1; -- step2: æ ¹æ®å±æ€§åŠidï¼ŒæŸ¥è¯¢idä¸º3çš„ç”¨æˆ·ä¿¡æ¯ select entity_id as id, `value`, a.attribute_code from ( select entity_id, `value`, attribute_id from user_int where attribute_id = 2 and entity_id = 3 union all select entity_id, `value`, attribute_id from user_varchar where attribute_id in (1,3,4,5,6) and entity_id = 3 union all select entity_id, `value`, attribute_id from user_decimal where attribute_id in (7, 8) and entity_id = 3 union all select entity_id, `value`, attribute_id from user_text where attribute_id = 9 and entity_id = 3 union all select entity_id, `value`, attribute_id from user_datetime where attribute_id = 10 and entity_id = 3 ) as s join eav_attribute as a on s.attribute_id = a.id JSONæ¨¡å‹ select u.id, u.username, f.properties from user as u join user_extra_field as f on u.id = f.user_id where u.id = 3; ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:6:2","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 3. æ’å…¥æ•°æ® æ–°å¢ä¸€æ¡æ•°æ® insert into user (id, username, name, age, gender, phone, address, profile, birthday) values (20, 'jayzone', 'å¼ ä¸‰', 22, 'ç”·', '13722211133', 'å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101', 'æˆ‘å¾ˆå¥½ï¼Œä½ å‘¢ï¼Ÿ', '1994-01-11'); EAVæ¨¡å‹ åˆ†ä¸¤æ­¥æ“ä½œ: 1.æŸ¥è¯¢æ‰€æœ‰å±æ€§ï¼Œ2.æ ¹æ®å±æ€§IDå’Œå€¼ï¼Œæ’å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­ -- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§ select * from eav_attribute where entity_type_id = 1; -- step2: æŠŠå€¼æ’å…¥åˆ°å¯¹åº”çš„è¡¨ insert into user_entity (id, username, type_id) values (20, 'jayzone', 1); insert into user_int (entity_id, attribute_id, value) values (20, 2, 22); insert into user_varchar (entity_id, attribute_id, value) values (20, 1, 'å¼ ä¸‰'), (20, 3, 'ç”·'), (20, 4, '13722211133'), (20, 6, 'å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101'); insert into user_text (entity_id, attribute_id, value) values (20, 9, 'æˆ‘å¾ˆå¥½ï¼Œä½ å‘¢ï¼Ÿ'); insert into user_datetime (entity_id, attribute_id, value) values (20, 10, '1994-01-11 00:00:00'); JSONæ¨¡å‹ éœ€è¦ä½¿ç”¨**json_object()**æ–¹æ³•æ„å»ºjsonå¯¹è±¡ï¼Œåœ¨å­˜å…¥JSONå­—æ®µä¸­ insert into user (id, username) values (20, 'jayzone'); insert into user_extra_field (user_id, properties) values (20, json_object('name', 'å¼ ä¸‰', 'age', 22, 'gender', 'ç”·', 'phone', '13722211133', 'address', 'å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101', 'profile', 'æˆ‘å¾ˆå¥½,ä½ å‘¢ï¼Ÿ', 'birthday', '1994-01-11')); ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:6:3","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 4. æ›´æ–°æ•°æ® æ–°å¢ä¸€ä¸ªå­—æ®µ, å¹¶ä¸”æ›´æ–°ç”¨æˆ·ID=3çš„ç”¨æˆ·å­¦å†ä¸ºæœ¬ç§‘EAVæ¨¡å‹ éœ€è¦åœ¨eav_attributeè¡¨ä¸­å¢åŠ ä¸€è¡Œè®°å½•ï¼Œç„¶åæ›´æ–°å¯¹åº”çš„å€¼ -- step1: æŸ¥è¯¢å±æ€§ select * from eav_attribute where entity_type_id = 1; -- step2: æ›´æ–°å¯¹åº”å±æ€§çš„å€¼ update user_varchar set value = 'æœ¬ç§‘' where entity_id = 3 and attribute_id = 11; JSONæ¨¡å‹ åˆ©ç”¨json_insert/json_setæ–¹æ³•æ›´æ–°å¯¹åº”å­—æ®µçš„å€¼ update user_extra_field set properties = json_set(properties, '$.phone', '15016716555') where id = 3; ","date":"2022-05-17","objectID":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/:6:4","tags":["MySQL","åŠ¨æ€å­—æ®µ","åŠ¨æ€è¡¨å•"],"title":"MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€","uri":"/posts/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/"},{"categories":["å­¦ä¹ "],"content":" 1ã€å¸è½½æ—§ç‰ˆæœ¬ sudo apt remove docker docker-engine docker.io containerd runc ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:1","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 2ã€å®‰è£…ç›¸å…³ä¾èµ–åŒ… sudo apt update \u0026\u0026 sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:2","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 3ã€æ·»åŠ è¯ä¹¦\u0026é•œåƒ å®˜æ–¹é•œåƒ # å®˜æ–¹é•œåƒ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - # å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Ubuntu 22.04 è¯·ä½¿ç”¨ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/aliyun-docker-archive-keyring.gpg sudo add-apt-repository \"deb [arch=arm64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" é˜¿é‡Œäº‘é•œåƒ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - # å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Ubuntu 22.04 è¯·ä½¿ç”¨ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg ï½œ sudo gpg --dearmor -o /usr/share/keyrings/aliyun-docker-archive-keyring.gpg sudo add-apt-repository \"deb [arch=arm64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\" å¦‚æœå¡ä½ä¸åŠ¨çš„è¯ï¼Œå¯ä»¥å…ˆ wget ä¸‹è½½æ–‡ä»¶ï¼Œç›´æ¥å¯¼å…¥ wget http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg sudo apt-key add ./gpg ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:3","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 4ã€å®‰è£… sudo apt update \u0026\u0026 sudo apt install -y containerd ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:4","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 5ã€ç”Ÿæˆé…ç½®æ–‡ä»¶ mkdir -p /etc/containerd \u0026\u0026 containerd config default | sudo tee /etc/containerd/config.toml # ä¿®æ”¹é…ç½®æ–‡ä»¶ # è€ç‰ˆæœ¬éœ€è¦æ‰‹åŠ¨æ·»åŠ  `SystemdCgroup = true` sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml \u0026\u0026 grep 'SystemdCgroup' -B 11 /etc/containerd/config.toml ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:5","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 6ã€é…ç½®é•œåƒåŠ é€Ÿå®˜æ–¹é“¾æ¥ # è¿™é‡Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿå™¨åœ°å€ sudo sed -i 's#endpoint = \"\"#endpoint = \"https://xxxxxx.mirror.aliyuncs.com\"#g' /etc/containerd/config.toml \u0026\u0026 grep 'endpoin' -B 5 /etc/containerd/config.toml sed -i 's#sandbox_image = \"k8s.gcr.io/pause#sandbox_image = \"registry.aliyuncs.com/google_containers/pause#g' /etc/containerd/config.toml \u0026\u0026 grep 'sandbox_image' /etc/containerd/config.toml ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:6","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 7ã€é‡è½½æœåŠ¡å™¨é…ç½® systemctl daemon-reload \u0026\u0026 systemctl restart containerd.service ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:7","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["å­¦ä¹ "],"content":" 8ã€æ£€æŸ¥è¿è¡Œæƒ…å†µ systemctl status containerd ","date":"2022-05-14","objectID":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/:0:8","tags":["k8s","containerd"],"title":"K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹","uri":"/posts/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"},{"categories":["æŠ˜è…¾"],"content":" 1ã€å¸è½½å¯èƒ½å­˜åœ¨çš„æ—§ç‰ˆæœ¬ sudo apt remove docker docker-engine docker-ce docker.io ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:1","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 2ã€å®‰è£…ä¾èµ–ä½¿ apt å¯é€šè¿‡ HTTPS ä¸‹è½½åŒ… sudo apt update \u0026\u0026 apt install -y apt-transport-https ca-certificates curl software-properties-common ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:2","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 3ã€æ·»åŠ  docker å¯†é’¥ 3.1ã€é˜¿é‡Œäº‘ docker æº curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - 3.2ã€å®˜æ–¹ docker æº curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:3","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 4ã€æ·»åŠ å¯¹åº”çš„ docker æºã€Œéœ€è¦å’Œç¬¬ä¸‰éƒ¨ä¸€è‡´ã€ 4.1ã€é˜¿é‡Œäº‘ ã€Œå®˜æ–¹æ–‡æ¡£ã€ sudo add-apt-repository \"deb [arch=arm64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\" 4.2ã€å®˜æ–¹æº sudo add-apt-repository \"deb [arch=arm64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" $(lsb_release -cs)æ˜¯è·å–å½“å‰ Ubuntu ä»£å· å¦‚æœæ²¡æœ‰ç§‘å­¦ä¸Šç½‘æ‰‹æ®µï¼Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘æº ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:4","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 5ã€å®‰è£… docker sudo apt update \u0026\u0026 apt install -y docker-ce ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:5","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 6ã€é…ç½®é•œåƒä»“åº“ mkdir /etc/docker cat \u003e /etc/docker/daemon.json \u003c\u003c EOF { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" }, \"registry-mirrors\": [\"https://xxx.mirror.aliyuncs.com\"] } EOF # è®¾ç½®å®Œæˆåé‡å¯ sudo systemctl daemon-reload sudo systemctl restart docker ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:6","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":" 7ã€éªŒè¯å®‰è£… systemstl status docker æ­£å¸¸è¿è¡Œåˆ™ä¼šæ˜¾ç¤º ","date":"2022-05-13","objectID":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/:0:7","tags":["Ubuntu","ARM","Docker"],"title":"Ubuntu ARM Docker å®‰è£…","uri":"/posts/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/"},{"categories":["æŠ˜è…¾"],"content":"åœ¨ Hugo çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ hasCJKLanguage = true # å­—æ•°ç»Ÿè®¡æ·»åŠ ä¸­æ–‡æ”¯æŒ é‡æ–°ç¼–è¯‘å³å¯ ","date":"2022-05-11","objectID":"/posts/%E8%A7%A3%E5%86%B3hugo%E5%AD%97%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%B8%8D%E6%AD%A3%E7%A1%AE/:0:0","tags":["Hugo"],"title":"è§£å†³Hugoå­—æ•°ç»Ÿè®¡ä¸æ­£ç¡®","uri":"/posts/%E8%A7%A3%E5%86%B3hugo%E5%AD%97%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%B8%8D%E6%AD%A3%E7%A1%AE/"},{"categories":["æŠ˜è…¾"],"content":" é—®é¢˜Typora å¯ä»¥æ–¹ä¾¿çš„å°†æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°ï¼Œä½†æ˜¯ä¸åˆç†çš„è®¾ç½®å°†æ— æ³•é€‚åº”å„ç§é™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼ˆæ¯”å¦‚ï¼šhugoï¼‰çš„å›¾ç‰‡å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥è¦å¯¹ Typora è¿›è¡Œè®¾ç½®ã€‚ ","date":"2022-05-11","objectID":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/:0:1","tags":["Typora","image"],"title":"å¦‚ä½•åœ¨Hugoå’ŒTyporaä¸­æ˜¾ç¤ºå›¾ç‰‡","uri":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/"},{"categories":["æŠ˜è…¾"],"content":" ç›®æ ‡hugo çš„é»˜è®¤å›¾ç‰‡è·¯å¾„ä¸º ${site}/static/imagesç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½® Typora çš„å›¾ç‰‡é»˜è®¤å¤åˆ¶åˆ°æ•´ä¸ªç›®å½•ã€‚å¹¶ä¸”è¾¾åˆ°åœ¨ç½‘ç«™å’Œ Typora ä¸­åŒæ—¶å¯æŸ¥çœ‹ã€‚ ","date":"2022-05-11","objectID":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/:0:2","tags":["Typora","image"],"title":"å¦‚ä½•åœ¨Hugoå’ŒTyporaä¸­æ˜¾ç¤ºå›¾ç‰‡","uri":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/"},{"categories":["æŠ˜è…¾"],"content":" è§£å†³å¯¹äº Typora å›¾ç‰‡çš„é»˜è®¤å¤åˆ¶è·¯å¾„å¯ä»¥ç›´æ¥è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¹Ÿå¯ä»¥å†åŠ ä¸Š static/images/${filename}/ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†å›¾ç‰‡ã€‚ ä½†æ˜¯è¿™æ ·é…ç½®å®Œä¼šå‘ç°ï¼ŒHugo è¯»å–å›¾ç‰‡çš„æ¡ä»¶æ»¡è¶³äº†ï¼ŒTypora é¢„è§ˆæ²¡æ³•æ»¡è¶³ï¼Œåœ¨è®¾ç½®é‡Œæˆ‘ä»¬ä¹Ÿæ‰¾åˆ°è°ƒæ•´çš„ä½ç½®ã€‚ å…¶å® Typora æœ‰ä¸€ä¸ªéšè—çš„é…ç½®ï¼Œæ ¼å¼( Format ) -\u003e å›¾åƒ( Image ) -\u003e è®¾ç½®å›¾ç‰‡æ ¹ç›®å½•( Use Image Root Path )ï¼Œå…·ä½“å¯ä»¥ä¾æ®ä¸‹å›¾ã€‚ é…ç½®æ˜¯åœ¨å½“ä¸ª md æ–‡ä»¶ä¸­ç”Ÿæ•ˆçš„ï¼Œåœ¨è®¾ç½®ååœ¨æ–‡ä»¶çš„å¼€å¤´ä¼šæ·»åŠ ä¸Štypora-root-url: ../../../static/ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„åŸç†äº†ã€‚ ","date":"2022-05-11","objectID":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/:0:3","tags":["Typora","image"],"title":"å¦‚ä½•åœ¨Hugoå’ŒTyporaä¸­æ˜¾ç¤ºå›¾ç‰‡","uri":"/posts/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/"},{"categories":["å­¦ä¹ "],"content":" å¸¸ç”¨å‘½ä»¤ rustc rustc xxx.rs // ç¼–è¯‘Rustç¨‹åº cargo cargo build // ç¼–è¯‘Rusté¡¹ç›®ï¼Œå¦‚blockåœ¨æ›´æ–°lockæ–‡ä»¶ï¼Œå¯æ‰§è¡Œ rm -rf ~/.cargo/.package-cache cargo run // ç«‹åˆ»è¿è¡ŒRusté¡¹ç›® cargo doc â€“open // ç”Ÿæˆå¹¶æ‰“å¼€é¡¹ç›®æ–‡æ¡£ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:1:0","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å¸¸è§æ¦‚å¿µ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:0","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å˜é‡å’Œå¯å˜æ€§ ä½¿ç”¨let xxx å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œæ­¤æ—¶è¿™ä¸ªå˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥è¢«éšè— ä½¿ç”¨let mut xxx å£°æ˜ä¸€ä¸ªå¯å˜å˜é‡ï¼Œæ­¤æ—¶å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼ ä½¿ç”¨const XXXå£°æ˜ä¸€ä¸ªå¸¸é‡ï¼Œå¸¸é‡ä¸å¯è¢«é‡æ–°èµ‹å€¼ éšè—â€‹ é‡å¤ä½¿ç”¨letå®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„å˜é‡ï¼Œæˆ‘ä»¬ç§°ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ªå˜é‡éšè—äº†ï¼Œæ­¤æ—¶ä½¿ç”¨è¯¥åç§°çš„å˜é‡ä¼šä½¿ç”¨ç¬¬äºŒä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤ä½¿ç”¨letæ¥å¤šæ¬¡éšè—ã€‚ fn main() { let x = 5; let x = x + 1; { let x = x * 2; println!(\"block inner x:{}\", x); } println!(\"block outer x:{}\", x); } ä¸Šé¢ä¾‹å­ä¼šè¾“å‡ºï¼š block inner x:12 block outer x:6 â€‹ è¿™ä¸ªç¨‹åºé¦–å…ˆå°† x ç»‘å®šåˆ°å€¼ 5 ä¸Šã€‚æ¥ç€é€šè¿‡ let x = éšè— xï¼Œè·å–åˆå§‹å€¼å¹¶åŠ  1ï¼Œè¿™æ · x çš„å€¼å°±å˜æˆ 6 äº†ã€‚ç„¶åï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸå†…ï¼Œç¬¬ä¸‰ä¸ª let è¯­å¥ä¹Ÿéšè—äº† xï¼Œå°†ä¹‹å‰çš„å€¼ä¹˜ä»¥ 2ï¼Œx å¾—åˆ°çš„å€¼æ˜¯ 12ã€‚å½“è¯¥ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œå†…éƒ¨ shadowing çš„ä½œç”¨åŸŸä¹Ÿç»“æŸäº†ï¼Œx åˆè¿”å›åˆ° 6ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:1","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" æ•°æ®ç±»å‹ æ ‡é‡ç±»å‹ æ•´å‹ é•¿åº¦ æœ‰ç¬¦å· æ— ç¬¦å· 8-bit i8 u8 16-bit i16 u16 32-bit i32 u32 64-bit i64 u64 128-bit i128 u128 arch isize usize æµ®ç‚¹å‹â€‹ Rust çš„æµ®ç‚¹æ•°ç±»å‹æ˜¯ f32 å’Œ f64ï¼Œåˆ†åˆ«å  32 ä½å’Œ 64 ä½ã€‚é»˜è®¤ç±»å‹æ˜¯ f64 å¸ƒå°”å‹â€‹ Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseã€‚Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨ bool è¡¨ç¤ºã€‚ å­—ç¬¦å‹â€‹ Rust çš„ char ç±»å‹çš„å¤§å°ä¸ºå››ä¸ªå­—èŠ‚(four bytes)ï¼Œå¹¶ä»£è¡¨äº†ä¸€ä¸ª Unicode æ ‡é‡å€¼ï¼ˆæ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨emojiï¼‰ã€‚ å¤åˆç±»å‹ å…ƒç»„ç±»å‹ç›¸å½“äºæŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªç±»å‹çš„å€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚å…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼šä¸€æ—¦å£°æ˜ã€‚å…¶é•¿åº¦ä¸ä¼šæ”¹å˜ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·ä¸­é€—å·åˆ†å‰²çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚ fn main() { let one: (i32, f64, u8) = (500, 6.4 ,1); let one = (500, 6.4 ,1); } åŒæ—¶å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œè§£æ„ï¼Œæˆ–è€…åªç”¨ç‚¹å·ï¼ˆ.ï¼‰è·Ÿç€å€¼çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ç›´æ¥è®¿é—® fn main() { let one = (500, 6.4 ,1); let (x, y, z) = one; println(\"x:{} y:{} z:{}\",x, y, z); println(\"x:{} y:{} z:{}\",one.0, one.1, one.2); } æ•°ç»„ç±»å‹å¦ä¸€ä¸ªåŒ…å«å¤šä¸ªå€¼çš„æ–¹å¼æ˜¯ æ•°ç»„ï¼ˆarrayï¼‰ã€‚ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚Rust ä¸­çš„æ•°ç»„ä¸ä¸€äº›å…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒï¼Œå› ä¸º Rust ä¸­çš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ï¼šä¸€æ—¦å£°æ˜ï¼Œå®ƒä»¬çš„é•¿åº¦ä¸èƒ½å¢é•¿æˆ–ç¼©å°ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å£°æ˜æ•°ç»„ï¼š fn main() { let a = [1, 2, 3, 4, 5]; // å½“ä½ æƒ³å®šä¹‰ç±»å‹æˆ–è€…é•¿åº¦æ—¶å¯ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ // åœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡ let a: [i64; 5] = [1, 2, 3, 4, 5]; } ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:2","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å‡½æ•°Rust ä¸­çš„å‡½æ•°å®šä¹‰ä»¥ fn å¼€å§‹å¹¶åœ¨å‡½æ•°ååè·Ÿä¸€å¯¹åœ†æ‹¬å·ã€‚å¤§æ‹¬å·å‘Šè¯‰ç¼–è¯‘å™¨å“ªé‡Œæ˜¯å‡½æ•°ä½“çš„å¼€å§‹å’Œç»“å°¾ã€‚ åœ¨å‡½æ•°ç­¾åä¸­ï¼Œå¿…é¡» å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€‚è¿™æ˜¯ Rust è®¾è®¡ä¸­ä¸€ä¸ªç»è¿‡æ…é‡è€ƒè™‘çš„å†³å®šï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ç±»å‹æ³¨è§£ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨ä¸éœ€è¦ä½ åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹æ³¨æ˜ç±»å‹æ¥æŒ‡å‡ºä½ çš„æ„å›¾ã€‚åœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œä½¿ç”¨,æ¥åˆ†å‰²å¤šä¸ªå‚æ•°ã€‚ å‡½æ•°å¯ä»¥å‘è°ƒç”¨å®ƒçš„ä»£ç è¿”å›å€¼ã€‚ä½¿ç”¨ï¼ˆ-\u003eï¼‰åå£°æ˜å®ƒçš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ return å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†å¤§éƒ¨åˆ†å‡½æ•°éšå¼çš„è¿”å›æœ€åçš„è¡¨è¾¾å¼ã€‚ fn five() -\u003e i32 { 5 } fn four() -\u003e i32 { let a = 4; return a; } fn main() { let x = five(); println!(\"The value of x is: {}\", x); } è¯­å¥å’Œè¡¨è¾¾å¼Rustæ˜¯ä¸€é—¨åŸºäºè¡¨è¾¾å¼ï¼ˆexpression-basedï¼‰çš„è¯­è¨€ã€‚ ä½¿ç”¨letå…³é”®å­—åˆ›å»ºå˜é‡å¹¶ç»‘å®šä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªè¯­å¥ï¼ˆlet y = 6;ï¼‰ã€‚ è¯­å¥ä¸è¿”å›å€¼ã€‚ä¸èƒ½æŠŠletè¯­å¥èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªå˜é‡ï¼ˆlet x = (let y = 6)ï¼‰ã€‚ è¡¨è¾¾å¼å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªå€¼ï¼Œè€ƒè™‘ä¸€ä¸ªæ•°å­¦è¿ç®—ï¼Œæ¯”å¦‚5+6ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å¹¶è®¡ç®—å‡ºå€¼11ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯è¯­å¥çš„ä¸€éƒ¨åˆ†ã€‚å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚æˆ‘ä»¬ç”¨æ¥åˆ›å»ºæ–°ä½œç”¨äºçš„å¤§æ‹¬å·ï¼ˆä»£ç å—ï¼‰ï¼Œ{}ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ fn main() { let x = 5; let y = { let x = 3; x + 1 } println!(\"x:{} y:{}\") } è¿™ä¸ªè¡¨è¾¾å¼ï¼š { let x = 3; x + 1 } æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå®ƒçš„å€¼æ˜¯ 4ã€‚è¿™ä¸ªå€¼ä½œä¸º let è¯­å¥çš„ä¸€éƒ¨åˆ†è¢«ç»‘å®šåˆ° y ä¸Šã€‚æ³¨æ„ç»“å°¾æ²¡æœ‰åˆ†å·çš„é‚£ä¸€è¡Œ x+1ï¼Œä¸ä½ è§è¿‡çš„å¤§éƒ¨åˆ†ä»£ç è¡Œä¸åŒã€‚è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚åœ¨æ¥ä¸‹æ¥æ¢ç´¢å…·æœ‰è¿”å›å€¼çš„å‡½æ•°å’Œè¡¨è¾¾å¼æ—¶è¦è°¨è®°è¿™ä¸€ç‚¹ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:3","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" æ§åˆ¶æµ ifè¡¨è¾¾å¼if è¡¨è¾¾å¼å…è®¸æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯ã€‚ä½ æä¾›ä¸€ä¸ªæ¡ä»¶å¹¶è¡¨ç¤º â€œå¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œè¿è¡Œè¿™æ®µä»£ç ï¼›å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œä¸è¿è¡Œè¿™æ®µä»£ç ã€‚â€ fn main() { let number = 3; if number \u003c 5 { // xxx } else { // yyy } } ä»£ç ä¸­çš„æ¡ä»¶å¿…é¡»æ˜¯boolå€¼ã€‚å¦‚æœä¸æ˜¯boolå€¼ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚ å› ä¸ºifæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨letè¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒã€‚æ³¨æ„ï¼Œifå’Œelseåˆ†æ”¯çš„ç»“æœéƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹ fn main() { let conditioin = true; let number = if condition { 5 } else { 6 }; println!(\"number:{}\", number); } ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:4","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å¾ªç¯Rust ä¸­æœ‰ä¸‰ç§å¾ªç¯ï¼šloopã€whileå’Œforã€‚ loopè¡¨è¾¾å¼loopå°±æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œéœ€è¦æ˜¾å¼çš„è°ƒç”¨breakæ¥é€€å‡ºè¿™ä¸ªå¾ªç¯ã€‚ å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œæ­¤æ—¶å•ç‹¬åªç”¨break å’Œ continueåªåº”ç”¨äºæ­¤æ—¶è¯­å¥æœ€å†…å±‚çš„å¾ªç¯ã€‚å¯ä»¥åœ¨å¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ªå¾ªç¯æ ‡ç­¾ï¼Œç„¶åå°†æ ‡ç­¾ä¸break å’Œ continueä¸€èµ·ä½¿ç”¨ï¼Œæ­¤æ—¶è¿™äº›å…³é”®å­—ç”Ÿæ•ˆçš„åˆ™æ˜¯å·²æ ‡è®°çš„å¾ªç¯ã€‚ fn main() { let mut count = 0; 'counting_up: loop { let mut remaining = 10; loop { println!(\"remaining = {}\", remaining); if remaining == 9 { break; } if count == 2 { break 'counting_up; } remaining -= 1; } count += 1; } println!(\"End count = {}\", count); } loopçš„å¦å¤–ä¸€ä¸ªç”¨æ³•æ˜¯é‡è¯•å¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œï¼Œæ¯”å¦‚æ£€æŸ¥çº¿ç¨‹æ˜¯å¦å®Œæˆäº†ä»»åŠ¡ã€‚å¦‚æœå°†è¿”å›å€¼åŠ å…¥ä½ ç”¨æ¥åœæ­¢å¾ªç¯çš„breakè¡¨è¾¾å¼ï¼Œå®ƒä¼šè¢«åœæ­¢çš„å¾ªç¯è¿”å›ã€‚ fn main() { let mut counter = 0; let result = loop { counter += 1; if counter == 10 { break counter * 2; } }; println!(\"The result is {}\", result); } whileæ¡ä»¶å¾ªç¯å½“æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œå¾ªç¯ã€‚å½“æ¡ä»¶ä¸å†ä¸ºçœŸï¼Œåˆ™åœæ­¢å¾ªç¯ã€‚è¿™ä¸ªå¾ªç¯ç±»å‹å¯ä»¥é€šè¿‡ç»„åˆ loopã€ifã€else å’Œ break æ¥å®ç°ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨whileã€‚ fn main() { let mut number = 3; while number != 0 { println!(\"{}!\", number); number = number - 1; } println!(\"LIFTOFF!!!\"); } foréå†é›†åˆå¯ä»¥ä½¿ç”¨ for å¾ªç¯æ¥å¯¹ä¸€ä¸ªé›†åˆçš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€äº›ä»£ç ã€‚ fn main() { let a = [10, 20, 30, 40, 50]; for element in a.iter() { println!(\"the value is: {}\", element); } } Rustçš„å¾ªç¯ä¸åƒâ€œCé£æ ¼â€çš„å¾ªç¯ for (x = 0; x \u003c 10; x++) { printf(\"%d\\n\", x); } ç›¸åï¼ŒRustæ˜¯è¿™æ ·çš„ for x in 0..10 { println!(\"{}\", x); } // å½“ä½ éœ€è¦ x \u003c= 10 è¿™ç§ç±»å‹çš„æ—¶å€™ for x in 0..=10 { println!(\"{}\", x); } å½“ä½ éœ€è¦çŸ¥é“å½“å‰å·²ç»å¾ªç¯å¤šå°‘æ¬¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨.enumerate()å‡½æ•° for (i,j) in (5..10).enumerate() { println!(\"i = {} and j = {}\", i, j); } è¾“å‡ºï¼š i = 0 and j = 5 i = 1 and j = 6 i = 2 and j = 7 i = 3 and j = 8 i = 4 and j = 9 ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:5","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" æ‰€æœ‰æƒé¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰€æœ‰æƒçš„è§„åˆ™ã€‚å½“æˆ‘ä»¬é€šè¿‡ä¸¾ä¾‹è¯´æ˜æ—¶ï¼Œè¯·è°¨è®°è¿™äº›è§„åˆ™ï¼š Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºå…¶ æ‰€æœ‰è€…ï¼ˆownerï¼‰çš„å˜é‡ã€‚ å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚ å˜é‡ä½œç”¨åŸŸå˜é‡ s ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼æ˜¯ç¡¬ç¼–ç è¿›ç¨‹åºä»£ç ä¸­çš„ã€‚è¿™ä¸ªå˜é‡ä»å£°æ˜çš„ç‚¹å¼€å§‹ç›´åˆ°å½“å‰ ä½œç”¨åŸŸ ç»“æŸæ—¶éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ç¤ºä¾‹ 4-1 çš„æ³¨é‡Šæ ‡æ˜äº†å˜é‡ s åœ¨ä½•å¤„æ˜¯æœ‰æ•ˆçš„ã€‚ { // s åœ¨è¿™é‡Œæ— æ•ˆ, å®ƒå°šæœªå£°æ˜ let s = \"hello\"; // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„ // ä½¿ç”¨ s } // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ å†…å­˜ä¸åˆ†é…é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å˜é‡çš„ä¸¤ç§å†…å­˜åˆ†é…ä½ç½®ï¼šå †å’Œæ ˆã€‚è¿™ä¸ªæ¦‚å¿µå†æ­¤ä¸åšèµ˜è¿°ã€‚ å½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Œå®ƒçš„å†…å­˜åˆ†é…åœ¨å †ä¸Šï¼Œæˆ‘è¿™ä¹ æƒ¯å°†å…¶æˆä¸ºå¼•ç”¨ç±»å‹ï¼Œå¦‚æœå®ƒçš„å†…å­˜åˆ†é…åœ¨æ ˆä¸Šï¼Œåˆ™ç§°ä¸ºå€¼ç±»å‹ã€‚ å€¼ç±»å‹ï¼Œå¦‚i32ã€f64ã€‚å¼•ç”¨ç±»å‹ï¼Œå¦‚stringï¼š fn main() { let x = 1;// i32 å€¼ç±»å‹ let str = String::from(\"hello world!\");// string å¼•ç”¨ç±»å‹ } å€¼ç±»å‹çš„ä¼ é€’æ–¹å¼éƒ½æ˜¯copy fn main() { let x = 1; let y = x; } æ­¤æ—¶ xã€yéƒ½åœ¨æ ˆä¸Šæ‹¥æœ‰å±äºè‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚ è€Œå¼•ç”¨ç±»å‹çš„ä¼ é€’æ–¹å¼åˆ™ä¸ä¸€æ ·ã€‚ fn main() { let x = String::from(\"hello world!\");// x è·å¾— string çš„æ‰€æœ‰æƒ let y = x;// string çš„æ‰€æœ‰æƒäº¤ç»™äº† y // æ­¤æ—¶ x ä¸ y çš„åœ°å€å…±åŒæŒ‡å‘å †çš„åŒä¸€ä¸ªåœ°æ–¹ // æˆ‘ä»¬åªæ‹·è´äº†å…¶é•¿åº¦å’Œå®¹é‡ä¿¡æ¯ï¼Œå…¶åœ¨å †ä¸Šçš„æŒ‡é’ˆæ˜¯ç›¸åŒçš„ // å¦‚æœæƒ³æ‹·è´å…¶åœ¨å †ä¸Šçš„æ•°æ® let z = y.clone();// z clone äº†ä¸€ä¸ª yï¼Œæ²¡æœ‰è·å¾— string çš„æ‰€æœ‰æƒ // æ­¤æ—¶åˆ™æ˜¯ z ä¸ y æ˜¯åœ°å€å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªå˜é‡ // å¦‚æœæˆ‘ä»¬åœ¨è¿™ä½¿ç”¨ let z = x.clone() åˆ™å¯¹å¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºRustç¦æ­¢ä½ ä½¿ç”¨æ— æ•ˆçš„å¼•ç”¨ } é‚£å¦‚æœæ˜¯åœ¨å‡½æ•°é‡Œå‘¢ï¼Ÿ fn main() { let str = String::from(\"hello world!\");// str è¿›å…¥ä½œç”¨åŸŸ test_one(str);// str æ‰€æœ‰æƒç§»åŠ¨åˆ°å‡½æ•°å†… // strå†æ­¤ä¸åœ¨æœ‰æ•ˆ let x = 12;// x è¿›å…¥ä½œç”¨åŸŸ test_two(x);// x copy è¿›å…¥å‡½æ•°å†… // x æ˜¯copyçš„,æ‰€ä»¥ x åœ¨æ­¤ä¾ç„¶æœ‰æ•ˆ }// xç§»é™¤ä½œç”¨åŸŸã€‚ str æ‰€æœ‰æƒå·²ç»ç§»äº¤ï¼Œä¸åšæ“ä½œ fn test_one(some_string: String) {// some_string è¿›å…¥ä½œç”¨åŸŸ println!(\"{}\", some_string); }// some_string ç¦»å¼€ä½œç”¨åŸŸï¼Œè°ƒç”¨ `drop` æ–¹æ³•é‡Šæ”¾å†…å­˜ fn test_two(some_integer: i32) {// some_integer è¿›å…¥ä½œç”¨åŸŸ println!(\"{}\", some_integer); }// some_integer ç¦»å¼€ä½œç”¨åŸŸï¼Œä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ å‡½æ•°çš„è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:6","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å¼•ç”¨ä¸å€Ÿç”¨è§„åˆ™ åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œè¦ä¹ˆ åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆ åªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ã€‚ å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³ä½¿ç”¨ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯è·å–è¿™ä¸ªå˜é‡çš„æ‰€æœ‰æƒã€‚æˆ‘ä»¬åˆ™éœ€è¦ä½¿ç”¨å¼•ç”¨è¿™ä¸ªæ“ä½œã€‚ fn main() { let s1 = String::from(\"hello\"); let len = calculate_length(\u0026s1); println!(\"The length of '{}' is {}.\", s1, len); } fn calculate_length(s: \u0026String) -\u003e usize { s.len() } æˆ‘ä»¬åœ¨è¿™é‡Œè·å¾—çš„æ˜¯s1çš„å¼•ç”¨ï¼Œå¹¶æ²¡æœ‰è·å–s1çš„æ‰€æœ‰æƒã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç å¯ä»¥æ­£å¸¸çš„è¿è¡Œã€‚ ä½¿ç”¨çš„\u0026ç¬¦å·å°±æ˜¯å¼•ç”¨ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨å€¼ä½†ä¸è·å–å…¶æ‰€æœ‰æƒã€‚å°±åƒå…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œè·å–ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆã€‚ å› ä¸ºæ²¡æœ‰è·å–åˆ°æ‰€æœ‰æƒï¼Œæ‰€ä»¥å½“å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¸ä¼šå°†å†…å­˜é‡Šæ”¾ã€‚ä½†æ˜¯è¿™é‡Œçš„å¼•ç”¨åªèƒ½ä½¿ç”¨è¢«å¼•ç”¨çš„å˜é‡ï¼Œå½“æˆ‘ä»¬æƒ³ä¿®æ”¹è¿™ä¸ªå˜é‡æ—¶ï¼Œåˆ™ä¼šå‘ç°ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚æ­£å¦‚å˜é‡é»˜è®¤ä¸å¯å˜ä¸€æ ·ï¼Œå¼•ç”¨é»˜è®¤ä¹Ÿæ˜¯ä¸å¯æ”¹å˜çš„ã€‚ fn main() { let s = String::from(\"hello\"); change(\u0026s); } fn change(some_string: \u0026String) { some_string.push_str(\", world\"); } error[E0596]: cannot borrow immutable borrowed content `*some_string` as mutable --\u003e error.rs:8:5 | 7 | fn change(some_string: \u0026String) { | ------- use `\u0026mut String` here to make mutable 8 | some_string.push_str(\", world\"); | ^^^^^^^^^^^ cannot borrow as mutable å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹ä¸€ä¸ªå¼•ç”¨çš„å€¼ï¼Œæˆ‘ä»¬åªéœ€åšä¸€ä¸ªå°è°ƒæ•´ï¼š fn main() { let mut s = String::from(\"hello\"); change(\u0026mut s); } fn change(some_string: \u0026mut String) { some_string.push_str(\", world\"); } è¿™é‡Œä½¿ç”¨\u0026mutè·å–åˆ°çš„æ˜¯ sçš„å¯å˜å¼•ç”¨ï¼Œè¿™å°±æ¸…é™¤çš„è¡¨æ˜ï¼Œæˆ‘éœ€è¦ä¿®æ”¹è¿™ä¸ªå¼•ç”¨çš„å€¼ã€‚ä¸è¿‡å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ã€‚ åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯¹æŸä¸€ç‰¹å®šæ•°æ®çš„å¯å˜å¼•ç”¨ è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚ ä¸å¯å˜å¼•ç”¨å¯ä»¥å­˜åœ¨å¤šä¸ªï¼Œä½†ä¸èƒ½åŒæ—¶ä¸å¯å˜å¼•ç”¨å­˜åœ¨ã€‚åŸå› ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œè°ä¹Ÿä¸æƒ³è‡ªå·±å¼•ç”¨çš„å˜é‡åœ¨æŸä¸€æ—¶é—´è¢«ä¿®æ”¹ã€‚ è¿™ç§æ¦‚å¿µå’Œè¯»å†™é”ç±»ä¼¼ã€‚å¯ä»¥æ‹¥æœ‰å¤šä¸ªè¯»é”ï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰ï¼Œåªèƒ½å­˜åœ¨ä¸€ä¸ªå†™é”å¹¶ä¸è¯»é”äº’æ–¥ï¼ˆå¯å˜å¼•ç”¨ï¼‰ã€‚å½“äº†è§£è¿™ä¸ªæ¦‚å¿µä¹‹åå°±å¾ˆå¥½ç†è§£äº†ã€‚ æ³¨æ„ä¸€ä¸ªå¼•ç”¨çš„ä½œç”¨åŸŸä»å£°æ˜çš„åœ°æ–¹å¼€å§‹ä¸€ç›´æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨ä¸ºæ­¢ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„ï¼š let mut s = String::from(\"hello\"); let r1 = \u0026s; // æ²¡é—®é¢˜ let r2 = \u0026s; // æ²¡é—®é¢˜ println!(\"{} and {}\", r1, r2); // æ­¤ä½ç½®ä¹‹å r1 å’Œ r2 ä¸å†ä½¿ç”¨ï¼Œä½œç”¨åŸŸä¹Ÿå†æ­¤ç»“æŸ let r3 = \u0026mut s; // æ²¡é—®é¢˜ r1ï¼Œr2çš„ä½œç”¨åŸŸå·²ç»ç»“æŸ println!(\"{}\", r3); ä¸å¯å˜å¼•ç”¨ r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨ println! æœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹åç»“æŸï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºå¯å˜å¼•ç”¨ r3 çš„åœ°æ–¹ã€‚å®ƒä»¬çš„ä½œç”¨åŸŸæ²¡æœ‰é‡å ï¼Œæ‰€ä»¥ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„ã€‚ç¼–è¯‘å™¨åœ¨ä½œç”¨åŸŸç»“æŸä¹‹å‰åˆ¤æ–­ä¸å†ä½¿ç”¨çš„å¼•ç”¨çš„èƒ½åŠ›è¢«ç§°ä¸ºéè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸï¼ˆNon-Lexical Lifetimesï¼Œç®€ç§°NLLï¼‰ã€‚ä½ å¯ä»¥åœ¨ The Edition Guide ä¸­é˜…è¯»æ›´å¤šå…³äºå®ƒçš„ä¿¡æ¯ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:7","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" ç»“æ„ä½“å®šä¹‰ç»“æ„ä½“ï¼Œéœ€è¦ä½¿ç”¨ struct å…³é”®å­—å¹¶ä¸ºæ•´ä¸ªç»“æ„ä½“æä¾›ä¸€ä¸ªåå­—ã€‚ç»“æ„ä½“çš„åå­—éœ€è¦æè¿°å®ƒæ‰€ç»„åˆçš„æ•°æ®çš„æ„ä¹‰ã€‚æ¥ç€ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå®šä¹‰æ¯ä¸€éƒ¨åˆ†æ•°æ®çš„åå­—å’Œç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¸º å­—æ®µï¼ˆfieldï¼‰ã€‚ä¾‹å¦‚ï¼Œç¤ºä¾‹ 5-1 å±•ç¤ºäº†ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯çš„ç»“æ„ä½“ï¼š struct User { username: String, email: String, sign_in_count: u64, active: bool, } å½“å˜é‡åä¸å­—æ®µåç›¸åŒæ—¶ï¼Œå¯ä»¥ç®€å†™ fn build_user(email: String, username: String) -\u003e User { User { email, username, active: true, sign_in_count: 1, } } æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³• let user2 = User { email: String::from(\"another@example.com\"), ..user1 }; åœ¨è¿™é‡Œ..user1å¿…é¡»æ”¾åœ¨æœ€åï¼Œå…¶ä»–å­—æ®µå®é™…æ˜¯ä½¿ç”¨=çš„èµ‹å€¼ï¼Œæ‰€ä»¥è¦æ³¨æ„æ‰€æœ‰æƒçš„ç§»åŠ¨ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºæ²¡æœ‰å­—æ®µçš„å…ƒç»„ç»“æ„ä½“ï¼Œä½¿ç”¨.æ¥ä¸Šç´¢å¼•æ¥è®¿é—®å•ç‹¬çš„å€¼ã€‚ struct Color(i32, i32, i32); struct Point(i32, i32, i32); let black = Color(0, 0, 0); let origin = Point(0, 0, 0); æˆ–è€…åˆ›å»ºä¸€ä¸ªæ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼ˆç±»å•å…ƒç»“æ„ä½“ï¼‰ å•å…ƒç»“æ„ä½“å¸¸å¸¸åœ¨ä½ æƒ³è¦åœ¨æŸä¸ªç±»å‹ä¸Šå®ç° trait ä½†ä¸éœ€è¦åœ¨ç±»å‹ä¸­å­˜å‚¨æ•°æ®çš„æ—¶å€™å‘æŒ¥ä½œç”¨ã€‚ struct AlwaysEqual; let subject = AlwaysEqual; todo å­—æ®µçš„ç”Ÿå‘½å‘¨æœŸ æ‰“å°ç»“æ„ä½“ #[derive(Debug)] struct Rectangle { width: u32, height: u32, } fn main() { let rect1 = Rectangle { width: 30, height: 50 }; println!(\"{:#?}\", rect1); println!(\"{:#?}\", rect1); dbg!(\u0026rect1); } åˆ†åˆ«è¾“å‡ºï¼š Rectangle { width: 30, height: 30, } Rectangle { width: 30, height: 30, } [src/main.rs:15] \u0026rect1 = Rectangle { width: 30, height: 30, } ç»™structç»‘å®šæ–¹æ³•å®šä¹‰æ–¹æ³• #[derive(Debug)] struct Rectangle { width: u32, height: u32, } impl Rectangle { fn area(\u0026self) -\u003e u32 { self.width * self.height } } fn main() { let rect1 = Rectangle { width: 30, height: 30, }; println!(\"è¿™ä¸ªé•¿æ–¹ä½“çš„é¢ç§¯æ˜¯ï¼š{}\", rect1.area()); } ä¸ºäº†ä½¿å‡½æ•°å®šä¹‰åœ¨Rectangleçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªimplå—ã€‚åœ¨è¿™ä¸ªå—ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¸Rectangleç›¸å…³è”ã€‚ åœ¨areaçš„å‡½æ•°å‰é¢ä¸Šï¼Œä½¿ç”¨\u0026selfæ¥ä»£æ›¿rectangle: \u0026Rectangleï¼Œ\u0026selfå…¶å®æ˜¯self: \u0026Selfçš„ç¼©å†™ã€‚åœ¨ä¸€ä¸ªimplå—ä¸­ï¼Œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æœ‰ä¸€ä¸ªåä¸ºselfçš„Selfç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥Ruståœ¨è¿™é‡Œæä¾›äº†selfè¿™ä¸ªåå­—æ¥ç¼©å†™ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨\u0026æ¥è¡¨ç¤ºåªæ˜¯å€Ÿç”¨è¿™ä¸ªç¤ºä¾‹ï¼Œå¹¶æ²¡æœ‰è·å–æ‰€æœ‰æƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸€æ ·å¯ä»¥è·å–æ‰€æœ‰æƒï¼Œæˆ–è€…å¯å˜å€Ÿç”¨ã€‚ é‚£æˆ‘ä»¬çš„\u0026è¿ç®—ç¬¦å»å“ªé‡Œäº†å‘¢ï¼Ÿ area()å‡½æ•°çš„å‚æ•°æ˜¯\u0026selfï¼Œä½†æ˜¯æˆ‘ä»¬è°ƒç”¨çš„åœ°æ–¹å¹¶æ²¡æœ‰å€Ÿç”¨rect1ï¼›é‚£æ˜¯Rustæœ‰ä¸€ä¸ªå«åšè‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨çš„åŠŸèƒ½ã€‚æ–¹æ³•è°ƒç”¨æ˜¯Rustä¸­å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹ã€‚ è¿™æ ·æˆ‘ä»¬çš„ä»£ç å®é™…æ˜¯è¿™æ ·å·¥ä½œçš„ï¼š rect1.area(); (\u0026rect1).area(); è¿™æ ·çœ‹èµ·æ¥ç¬¬ä¸€ç§æ–¹å¼ç®€æ´çš„å¤šã€‚ å…³è”å‡½æ•°æ‰€æœ‰åœ¨implå—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸ºå…³è”å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä»¥selfä¸ºç¬¬ä¸€å‚æ•°çš„å…³è”å‡½æ•°ï¼ˆå®ƒä¸æ˜¯æ–¹æ³•ï¼‰ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡è¿™æ ·çš„å‡½æ•°äº†ï¼ŒString::from()ã€‚é€šå¸¸è¿™æ ·çš„å‡½æ•°è¢«æˆ‘ä»¬ç”¨ä½œä¸ºè¿”å›ä¸€ä¸ªç»“æ„ä½“æ–°å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚ impl Rectangle { fn square(size: u32) -\u003e Rectangle { Rectangle { width: size, height: size } } } fn main() { let sq = Rectangle::square(3); } ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:8","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" æšä¸¾åœ¨ Rust ä¸­æˆ‘ä»¬ä½¿ç”¨enumæ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚ enum IpAddrKind { V4, V6, } åœ¨ä¸Šè¿°ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªIpAddrKindæšä¸¾æ¥åˆ—å‡ºå¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼ŒV4å’ŒV6ã€‚è¿™ä¸¤ç§ç±»å‹è¢«ç§°ä¸ºæšä¸¾çš„æˆå‘˜ã€‚ æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åˆ›å»ºIpAddrKindä¸¤ä¸ªä¸åŒæˆå‘˜çš„å®ä¾‹ã€‚ let four = IpAddrKind::V4; let six = IpAddrKind::V6; fn route(ip_type: IpAddrKind) {} route(four); route(six); å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„æˆå‘˜æ¥è°ƒç”¨routeå‡½æ•°ã€‚ æšä¸¾çš„æˆå‘˜ä¹Ÿå¯ä»¥å…³è”ä¸€ä¸ªå€¼ã€‚ enum IpAddr { V4(String), V6(String), } let home = IpAddr::V4(String::from(\"127.0.0.1\")); let loopback = IpAddr::V4(String::from(\"::1\")); æˆ–è€…å…³è”ä¸Šä¸€ä¸ªå…ƒç»„ã€‚ enum IpAddr { V4(u8, u8, u8, u8), V6(String), } let home = IpAddr::V4(127, 0, 0, 1); let loopback = IpAddr::V4(String::from(\"::1\")); æˆ‘ä»¬è¿˜å¯ä»¥å¯¹æšä¸¾ç±»å‹å…³è”ä¸Šæ–¹æ³•ã€‚ impl IpAddr { fn call(\u0026self) { dbg!(self) } } æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨home.call()æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ todo option","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:9","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" ç›¸å…³æ§åˆ¶æµè¿ç®—ç¬¦ matchè¿ç®—ç¬¦å¦‚æœæœ‰å…¶ä»–è¯­è¨€åŸºç¡€çš„è¯ï¼Œçœ‹åˆ°matchè¿™ä¸ªå…³é”®å­—ï¼Œåº”è¯¥èƒ½è”æƒ³åˆ°switchã€‚å®ƒçš„ç”¨æ³•å’Œswitchæ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯æœ‰ä¸€äº›ç»†èŠ‚ä¸åŒã€‚è¿™é‡Œæˆ‘ä»¬ç”¨ä¸Šé¢çš„IpAddrç»‘å®šçš„æ–¹æ³•callä¸¾ä¾‹ï¼š fn call(\u0026self) { match self { IpAddr::V4(a, b, c, d) =\u003e println!(\"{}:{}:{}:{}\", a, b, c, d), IpAddr::V6(str) =\u003e println!(\"{}\", str), } } å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†matchåŒ¹é…äº†selfè¿™ä¸ªå˜é‡ï¼Œåœ¨ case é‡Œæˆ‘ä»¬ç”¨ä¸Šäº†IpAddr::V4(a, b, c, d)ï¼Œä½¿ç”¨äº†a b c då››ä¸ªå˜é‡æ¥åˆ†åˆ«åŒ¹é…ç»‘å®šä¸Šçš„V4(u8, u8, u8, u8)4ä¸ªå€¼ã€‚è€Œåœ¨IpAddr::V6(str)ä½¿ç”¨äº†stræ¥æ¥æ”¶ç»‘å®šçš„Stringè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ä¸åŒçš„ç±»å‹åœ¨åšå‡ºä¸åŒçš„æ“ä½œäº†ã€‚ ä½†æ˜¯æ³¨æ„ Rust é»˜è®¤éœ€è¦æˆ‘ä»¬å¤„ç†matchåå˜é‡çš„æ‰€æœ‰å¯èƒ½æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹è¿°ä»£ç æ˜¯ä¸æ­£ç¡®çš„ï¼š fn call(\u0026self) { match self { IpAddr::V4(a, b, c, d) =\u003e println!(\"{}:{}:{}:{}\", a, b, c, d), } } Rust ä¼šæç¤ºæˆ‘ä»¬å°‘äº†IpAddr::V6çš„caseã€‚ ä¸Šè¿°ä¾‹å­åªæœ‰2ç§æƒ…å†µï¼Œé‚£å¦‚æœæ˜¯10ç§ï¼Ÿ20ç§å‘¢ï¼Ÿå¦‚æœçœŸçš„å…¨éƒ¨éƒ½è¦åˆ—å‡ºæ¥çš„è¯ï¼Œé‚£æœªå…å¤ªè ¢äº†ã€‚æ‰€ä»¥ Rust å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œæä¾›äº†ç±»ä¼¼defaultçš„åŠŸèƒ½ï¼Œä½¿ç”¨çš„å…³é”®å­—æ˜¯_ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¾‹å­ã€‚ fn call(\u0026self) { match self { IpAddr::V4(a, b, c, d) =\u003e println!(\"{}:{}:{}:{}\", a, b, c, d), _ =\u003e (), } } æ³¨æ„å¿…é¡»è¦æ˜¾å¼è°ƒç”¨_ =\u003e () Rustä¸ä¼šé»˜è®¤ç»™ä½ åŠ ä¸Šã€‚è¿™æ ·çš„è¯å°±å¯ä»¥å¿½ç•¥æ‰V6çš„åŒ¹é…äº†ã€‚ if letç®€å•æ§åˆ¶æµæƒ³ä¸Šé¢çš„ä¾‹å­ï¼Œåªæœ‰2ç§æƒ…å†µï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ˜¾å¼çš„ç”¨_å»å¿½ç•¥åŒ¹é…ï¼Œå®åœ¨æ˜¯è¿‡äºå†—é•¿ï¼Œæ‰€ä»¥ Rustç»™äº†æˆ‘ä»¬å¦å¤–ä¸€ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚ fn call(\u0026self) { if let IpAddr::V4(a, b, c, d) = self { println!(\"{}:{}:{}:{}\", a, b, c, d); } } è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†ç”¨é‚£ä¹ˆå†—é•¿çš„æ–¹å¼æ¥ç¼–å†™äº†ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:10","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" package / crate / module cargo newä¼šç”Ÿæˆé¡¹ç›®çš„é›å½¢ï¼Œæä¾›äº† src/main.rshe src/lib.rsæ–‡ä»¶ï¼Œéšç€é¡¹ç›®å¤æ‚åº¦çš„å¢é•¿ï¼Œä»£ç é‡ä¹Ÿä¼šéšä¹‹å¢é•¿ï¼Œå¦‚æœé ä¸€ä¸ªæ–‡ä»¶æ¥ç»´æŠ¤ä¸€å¤§å †ä»£ç ï¼Œè‚¯å®šæ˜¯ä¸åˆé€‚çš„ã€‚ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨æ¨¡å—æ¥æ‹†åˆ†æ–‡ä»¶ã€‚ åœ¨è¿™é‡Œå­¦ä¹ ä¸€ä¸‹rustä¸­ä»£ç çš„ç»„ç»‡æ–¹å¼ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸€ä¸‹å‡ ä¸ªåè¯ï¼š packageï¼šCargoä¸­çš„æ¦‚å¿µï¼Œç”¨äºç®¡ç†crate crateï¼šæ¨¡å—çš„é›†åˆï¼Œç¼–è¯‘å•ä½ï¼Œæœ‰binå’Œlibä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’Œä¾›ä»–äººè°ƒç”¨ moduleï¼šç”¨æˆ·åœ¨crateå†…ç»„ç»‡ä»£ç  workspaceï¼šé¡¹ç›®å¤æ‚æ—¶ï¼Œç®¡ç†å¤šä¸ªpackage packageä½¿ç”¨cargo newå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªpackageï¼Œé‡Œé¢å¸¦æœ‰ä¸€ä¸ªCargo.tomlæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰packageã€æ‰€éœ€å¤–éƒ¨ä¾èµ–ï¼Œä»¥åŠå¦‚ä½•ç¼–è¯‘crateç­‰ crateRusté‡Œæœ‰ä¸¤ç§crateï¼Œlibç±»å‹å’Œbinç±»å‹ï¼Œå¹¶ä¸”é»˜è®¤ä»¥æ–‡ä»¶åä¸ºæ ‡å‡†å¤„ç†crate: src/main.rsï¼šè¡¨ç¤ºè¯¥crateæ—¶ä¸€ä¸ªbinç±»å‹å¤§crate src/lib.rsï¼šè¡¨ç¤ºè¯¥crateæ—¶ä¸€ä¸ªlibç±»å‹çš„crate å¹¶ä¸”ï¼Œä¸€ä¸ªpackageä¸­çš„crateè¿˜æœ‰å¦‚ä¸‹ä¸çº¦æŸï¼š å¯ä»¥æœ‰å¤šä¸ªbinç±»å‹çš„crate åªèƒ½æœ‰0ä¸ªæˆ–è€…1ä¸ªlibç±»å‹çš„crate ä»¥ä¸Šä¸¤æ¡çº¦æŸå¹¶ä¸äº’æ–¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡¹ç›®ä¸‹å¯ä»¥æœ‰ä¸€ä¸ªlibå’Œå¤šä¸ªbinç±»å‹çš„crateï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç¼–è¯‘å‡ºå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ åªæ˜¯å¦‚æœæœ‰å¤šä¸ªbinç±»å‹çš„crateï¼Œä¸€ä¸ªsrc/main.rså°±ä¸å¤Ÿäº†ï¼Œéœ€è¦æ”¾åˆ°src/binä¸‹ï¼Œæ¯ä¸ªcrateä¸€ä¸ªæ–‡ä»¶ modå½“é¡¹ç›®é€æ¸è†¨èƒ€åï¼Œå¯ä»¥å¯¹ä»£ç ä»¥modã€Œæ–‡ä»¶/æ–‡ä»¶å¤¹ã€ä¸ºå•ä½è¿›è¡Œæ‹†åˆ†ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰ä»£ç éƒ½å†™åœ¨src/main.rsæˆ–è€…src/lib.rsé‡Œ ä»¥libç±»å‹çš„crateä¸ºä¾‹ï¼Œè¯¥ç±»å‹çš„crateå…¥å£åœ¨src/lib.rsï¼Œä¹Ÿå°±æ˜¯crateçš„æ ¹ã€‚å®šä¹‰ä¸€ä¸ªæ¨¡å—ä¹Ÿå¾ˆç®€å• // src/lib.rs mod testMod { fn test() { println!(\"test\") } } è€Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šåªæœ‰ä¸€ä¸ªlib.rsæ–‡ä»¶ï¼Œè€Œæ˜¯ä¼šå°†ä»£ç æŒ‰åŠŸèƒ½è¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªæ¨¡å— æ¨¡å—æ‹†åˆ†ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«çœ‹ä½œä¸ºä¸€ä¸ªmodï¼Œå¹¶ä¸”modå¯ä»¥åµŒå¥—å®šä¹‰ã€‚åµŒå¥—å®šä¹‰çš„modå¯ä»¥å¸è½½ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ–‡ä»¶å¤¹çš„å½¢å¼æ¥å®ç°ã€‚å…·ä½“çš„æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚ å‡è®¾å½“å‰é¡¹ç›®æ–‡ä»¶ç»“æ„å¦‚ä¸‹: src â”œâ”€â”€ lib.rs â”œâ”€â”€ mod_a â”‚ â”œâ”€â”€ mod.rs â”‚ â””â”€â”€ mod_b.rs â””â”€â”€ mod_c.rs åœ¨è¿™é‡Œå®šä¹‰äº†3ä¸ªmodï¼šmod_aã€mod_b å’Œ mod_cï¼Œå…¶ä¸­mod_aä¸ºæ–‡ä»¶å¤¹å½¢å¼ï¼Œè€Œmod_bå’Œmod_céƒ½æœ‰å¯¹åº”çš„æ–‡ä»¶ã€‚å…¶ä¸­mod_bæ˜¯mod_açš„å­æ¨¡å—ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹å„ä¸ªæ¨¡å—ä¹‹é—´å¦‚ä½•å£°æ˜å’Œå¼•ç”¨ã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹crateçš„æ ¹ï¼Œä¹Ÿå°±æ˜¯lib.rs pub mod mod_a; mod mod_c; åœ¨è¿™é‡Œå£°æ˜äº†ä¸¤ä¸ªmodï¼Œå¦‚æœéœ€è¦åœ¨crateå¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åœ¨modå‰é¢åŠ ä¸Špubå…³é”®å­—ã€‚æ³¨æ„è¿™é‡Œä¸éœ€è¦å£°æ˜mod_açš„å­æ¨¡å—mod_b,è¿™ä¸ªéœ€è¦mod_aæ¥å£°æ˜ã€‚ å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªmodã€‚å…ˆçœ‹mod_aï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹å½¢å¼å­˜åœ¨çš„modï¼ŒæŒ‰cargoè§„å®šï¼Œè¿™æ—¶å€™éœ€è¦åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªåä¸ºmod.rsçš„æ–‡ä»¶å®šä¹‰è¯¥modä¸‹çš„å†…å®¹ã€‚è¯¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š // src/mod_a/mod.rs pub mod mod_b; å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–‡ä»¶å’Œlib.rsç±»ä¼¼ï¼Œéƒ½å¯ä»¥å£°æ˜modã€‚ä½†è¯¥æ–‡ä»¶å£°æ˜çš„modå¯ä»¥ä¿å­˜åˆ°mod.rsï¼š // src/mod_a/mod_b.rs use super::super::mod_c; pub fn test() { println!(\"i'm mod_b\") } fn call_mod_c() { mod_c::test(); } æˆ‘ä»¬å†æ¥çœ‹çœ‹mod_c.rsçš„ä»£ç ï¼š // src/mod_c.rs use crate::mod_a::mod_b; pub fn test() { mod_b::test(); println!(\"i'm mod_c\"); } é™¤äº†å¦‚ä½•å®šä¹‰modï¼Œæˆ‘ä»¬è¿˜éœ€è¦çš„æ˜¯å¦‚ä½•å¼•ç”¨å…¶ä»–modçš„å®šä¹‰ã€‚åœ¨mod_cä¸­ï¼Œè¦æƒ³ä½¿ç”¨mod_bï¼Œå¯ä»¥ä½¿ç”¨ï¼š ç»å¯¹è·¯å¾„use crate::mod_a::mod_b è€Œåœ¨mod_bä¸­ä½¿ç”¨mod_cçš„æ—¶å€™ï¼Œä½¿ç”¨äº†use super::super::mod_cè¿™ç§ç›¸å¯¹è·¯å¾„çš„å½¢å¼ã€‚ æ·»åŠ main.rsæœ€ååœ¨ä¸Šé¢ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ main.rsï¼Œçœ‹çœ‹ä½œä¸ºå¤–éƒ¨crateå¦‚ä½•ä½¿ç”¨ä¸Šé¢çš„mod_a // src/main.rs use testlib::mod_a::mod_b; fn main() { println!(\"main\") mod_b::test(); } åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼•ç”¨è‡ªå·±libçš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨ä¸Šé¢è¯´çš„ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„è¿™ä¸¤ç§å¼•ç”¨æ–¹å¼ï¼Œå¿…é¡»ä½¿ç”¨è¯¥crateçš„åç§°ã€Œä¹Ÿå°±æ˜¯Cargo.tomlé‡Œçš„åç§°ã€æ¥åº”ç”¨ã€‚å› ä¸ºmainå’Œlibå±äºä¸åŒçš„crate pub ä¿®é¥°ç¬¦è¦æƒ³è®¿é—®å…¶ä»–modä¸­çš„ç»“æ„ä½“ã€æ–¹æ³•ã€æšä¸¾ç­‰ï¼Œéœ€è¦å¯¹æ–¹å£°æ˜ä¸ºpubã€‚å¦‚æœæ˜¯æƒ³æ“ä½œç»“æ„ä½“ä¸­çš„å­—æ®µï¼Œå¯ä»¥æœ‰ä¸€ä¸‹ä¸¤ç§æ–¹æ³• æä¾›å¯¹åº”çš„pubæ–¹æ³• ç›´æ¥ä¿®æ”¹å­—æ®µä¸ºpub use è¯­å¥è®²äº†è¿™ä¹ˆåšå¦‚ä½•å®šä¹‰modï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ åœ¨crateå’Œæ¨¡å—ä¸­æˆ‘ä»¬å¯èƒ½å®šä¹‰äº†å‡½æ•°ã€ç»“æ„ä½“ç­‰ï¼Œè¦æƒ³åœ¨å…¶ä»–æ¨¡å—æˆ–è€…crateä¸­ä½¿ç”¨ï¼Œéœ€è¦å°†å…¶å¼•å…¥åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œç±»ä¼¼phpçš„useï¼Œæˆ–è€…javaä¸­çš„importï¼Œåœ¨Rustä¸­æˆ‘ä»¬éœ€è¦ä½¿ç”¨use å¦‚ä½•è¡¨ç¤ºè¦è¢«å¼•ç”¨çš„å¯¹è±¡ï¼ŒRusté‡Œç§°ä¹‹ä¸ºpathï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶ç›®å½• pathæœ‰ä¸¤ç§å½¢å¼ï¼Œä¹Ÿå’Œæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œæœ‰ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼š ç»å¯¹è·¯å¾„å§‹äºcrateçš„æ ¹ï¼ˆsrc/main.rs or src/lib.rsï¼‰ï¼Œå¯ä»¥ä½¿ç”¨crateåæˆ–è€…crateè¿™ä¸ªå­—é¢å€¼è¡¨ç¤º ç›¸å¯¹è·¯å¾„å¯ä»¥ä½¿ç”¨å½“å‰æ¨¡å—åï¼Œå½“å‰æ¨¡å—ä¸­å¯ä»¥ä½¿ç”¨çš„å¯¹è±¡ï¼Œsuperå’Œselfç­‰ pathä¸­çš„å±‚çº§ä½¿ç”¨ä¸¤ä¸ªå†’å·::ï¼Œç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–œçº¿. å‡è®¾æœ‰ä¸€ä¸‹ä»£ç ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š mod front_of_house { pub mod hosting { pub fn add_to_waitlist() {} } } pub fn eat_at_restautant() { // ç»å¯¹è·¯å¾„ crate::front_of_house::hosting::add_to_waitlist(); // ç›¸å¯¹è·¯å¾„ front_of_house::hosting::add_to_waitlist(); } æœ‰ä¸€äº›é™åˆ¶ä¹Ÿéœ€è¦çŸ¥é“ï¼š åœ¨å¤«æ¨¡å—ä¸­ä¸èƒ½ä½¿ç”¨å­æ¨¡å—ä¸­çš„ç§æœ‰é¡¹ç›® å­æ¨¡å—å¯ä»¥ä½¿ç”¨çˆ¶æ¨¡å—ä¸­çš„æ‰€æœ‰é¡¹ç›® åŒä¸€æ¨¡å—å†…å¯ä»¥ç›´æ¥äº’ç›¸ä½¿ç”¨ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨äº†superçš„ä¾‹å­ï¼š fn server_order() {} mod back_of_house() { fn fix_incorrect_order() { cook_order(); super::server_order(); } fn cook_order() {} } fix_incorrect_orderæ–¹æ³•å’Œcook_orderåŒå±äºä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚server_orderæ–¹æ³•å’Œback_of_houseåŒçº§ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨superè®¿é—®åˆ°åŒçº§çš„server_orderæ–¹æ³• å¦‚æœuseåé¢çš„è·¯å¾„å…·æœ‰å…±åŒçš„çˆ¶è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ç®€åŒ–çš„æ¨¡å¼ã€‚æ¯”å¦‚ï¼š use std::io; use std::cmp::Ordering; å¯ä»¥ç®€åŒ–ä¸ºï¼š use std::{cmp::Ordering, io}; å¦‚æœuseçš„modç›´æ¥æœ‰çˆ¶å­å…³ç³»ï¼Œä¹Ÿå¯ä»¥åƒä¸Šé¢é‚£æ ·ç®€åŒ–ï¼Œä½¿ç”¨selfä»£è¡¨çˆ¶modã€‚æ¯”å¦‚ï¼š use std::io; use std::io::Write; å¯ä»¥ç®€åŒ–ä¸ºï¼š use std::io::{self, Write}; å¦‚æœæƒ³å°†æŸä¸€è·¯å¾„ä¸‹çš„æ‰€æœ‰pubçš„iteméƒ½å¼•å…¥åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨* use std::collections::*; ä¸€èˆ¬ä¼šåœ¨å•å…ƒæµ‹è¯•ä¸­å¸¸ç”¨ï¼Œä¸æ¨èåœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ #[cfg(test)] mod tests{ use super::*; #[test] fn it_works() {} } å¼•ç”¨å±‚çº§å¯¹æ¯”ä¸€ä¸‹ä¸¤ç§å¼•ç”¨æ–¹å¼: // case 1 use crate::front_of_house::hosting; hosting::add_to_waitlist(); // case 2 use crate::front_of_house::hosting::add_to_waitlist; add_to_waitlist(); è¿™ä¸¤ç§æ–¹æ³•çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥ç»™äººçš„æ„Ÿè§‰ä¸ä¸€æ ·ã€‚ä¸€èˆ¬æ¥è¯´æ¨èç¬¬ä¸€ä¸ª case ï¼Œè¿™æ ·èƒ½æ˜ç¡®çš„çŸ¥é“ä½¿ç”¨çš„æ–¹æ³•æ˜¯å¤–éƒ¨ hosting æ¨¡å—çš„æ–¹æ³•ï¼Œåè€…çš„è¯ä¸çŸ¥é“æ˜¯ use è¿›æ¥çš„ï¼Œè¿˜æ˜¯æœ¬æ¨¡å—å®šä¹‰çš„ é‡å‘½åæœ‰æ—¶å€™ä»ä¸åŒçš„ crate æˆ–è€… mod å¼•å…¥äº†åŒåçš„ itemï¼Œè¿™ä¸ªæ—¶å€™æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨aså…³é”®å­—è¿›è¡Œé‡å‘½åã€‚ use std::fmt; use std::io; fn function1() -\u003e fmt::Result {} fn function2() -\u003e io::Result\u003c()\u003e {} ########################### use std::fmt::Result; use std::io::Result as IoResult; fn function1() -\u003e Re","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:11","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" å¸¸è§é›†åˆä¸€èˆ¬æ¥è¯´åœ¨ Rust å¸¸ç”¨çš„é›†åˆ vectorå…è®¸æˆ‘ä»¬ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªåœ°å­˜å‚¨ä¸€ç³»åˆ—æ•°é‡å¯å˜çš„å€¼ å­—ç¬¦ä¸²æ˜¯å­—ç¬¦çš„é›†åˆï¼ŒString å“ˆå¸Œ map å…è®¸æˆ‘ä»¬å°†å€¼ä¸ä¸€ä¸ªç‰¹å®šçš„é”®ç›¸å…³è” vectoræ–°å»ºvector let v: Vec\u003ci32\u003e = Vec::new(); let v = vec![1, 2, 3]; æ›´æ–°vector let mut v = Vec::new(); v.push(1); v.push(2); let a = v.pop(); ç±»ä¼¼äºå…¶ä»–ä»»ä½•çš„structï¼Œvector åœ¨ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶ä¼šè¢«é‡Šæ”¾ã€‚ è®¿é—®vector let v = vec![1, 2, 3]; let v1 = \u0026v[1]; // ç´¢å¼•è¯­æ³• let v2 = v.get(2); // æ–¹æ³• ä½¿ç”¨ç´¢å¼•è¯­æ³•è®¿é—®vectorä¼šå¯¼è‡´ç¨‹åºpanicï¼Œè€Œä½¿ç”¨ get æ–¹æ³•è®¿é—®æ—¶ ä¼šè¿”å›ä¸€ä¸ª None åœ¨æ‹¿åˆ° vector ä¸­ä»»æ„ä¸€ä¸ªæœ‰æ•ˆçš„å¼•ç”¨ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨å°†ä¼šçª’æ¯æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™ï¼Œæ¥ç¡®ä¿ vector å†…å®¹çš„è¿™ä¸ªå¼•ç”¨å’Œä»»ä½•å…¶ä»–å¼•ç”¨ä¿æŒæœ‰æ•ˆã€‚å½“æˆ‘ä»¬è·å–åˆ°äº† vector çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸å¯å˜å¼•ç”¨å¹¶åœ¨ vector æœ«å°¾å¢åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ã€‚ let mut v = vec![1, 2, 3, 4, 5]; let first = \u0026v[0]; v.push(6); // ä¸é€šè¿‡ç¼–è¯‘ println!(\"The first element is: {}\", first); ä¸ºä»€ä¹ˆç¬¬ä¸€å…ƒç´ çš„å¼•ç”¨ä¼šå…³å¿ƒåˆ°æœ«å°¾çš„å˜åŒ–ï¼Ÿé‚£æ˜¯å› ä¸º vector å’Œ golang çš„ slice ä¸€æ ·ï¼Œåœ¨å†…éƒ¨çš„ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šè¿›è¡Œæ‹·è´æ‰©å®¹ï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨å°±æŒ‡å‘äº†è¢«é‡Šæ”¾çš„å†…å­˜ã€‚ éå† vector let mut v = vec![1, 2, 3]; for i in \u0026v { println!(\"{}\", i) } for i in \u0026mut v { *i += 50; } åŒæ—¶ vector ä¹Ÿå¯ä»¥ä½¿ç”¨æšä¸¾æ¥å­˜å‚¨å¤šç§ç±»å‹çš„å€¼ enum Test { Int(i32), Text(String), } let row = vec![ Test::Int(3), Test::Text(String::from(\"test\")) ]; å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² let s1 = String::new(); // åˆ›å»ºä¸€ä¸ªç©ºå­—ç¬¦ä¸² // ä½¿ç”¨åˆå§‹æ•°æ®åˆ›å»ºå­—ç¬¦ä¸² let s2 = \"test\".to_string(); let s3 = String::from(\"test\"); æ›´æ–°å­—ç¬¦ä¸² let mut s = String::from(\"foo\"); let mut x = String::from(\" bar\"); s.push_str(x); s.push('~'); println!(\"x is {}\", x); let s1 = String::from(\"Hello, \"); let s2 = String::from(\"world!\"); let s3 = s1 + \u0026s2; // è¿™é‡Œ s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨ æ‰§è¡Œä¸Šè¿°ä»£ç ä¹‹åï¼Œså°†ä¼šåŒ…å«xï¼Œxè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œå› ä¸ºpush_stræ–¹æ³•ä½¿ç”¨äº†å­—ç¬¦ä¸² sliceï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦è·å–å‚æ•°çš„æ‰€æœ‰æƒã€‚ ç„¶è€Œç›´æ¥ä½¿ç”¨+è¿ç®—ç¬¦å°†ä¸¤ä¸ªStringå€¼åˆå¹¶åˆ°ä¸€ä¸ªæ–°Stringå€¼ä¸­ï¼Œæ­¤æ—¶s1åœ¨ç›¸åŠ åå¤±å»äº†æ‰€æœ‰æƒã€‚å› ä¸º+è°ƒç”¨äº†addå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥åƒè¿™æ · fn add(self, s: \u0026str) -\u003e String{} è¿™å¹¶ä¸æ˜¯æ ‡å‡†åº“å½“ä¸­å®é™…çš„ç­¾åï¼Œæ ‡å‡†åº“ä¸­çš„addä½¿ç”¨æ³›å‹å®šä¹‰ã€‚ é‚£ä¸ºä»€ä¹ˆaddæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯\u0026strï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶å´æ˜¯\u0026Stringï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç¼–è¯‘ã€‚ é‚£æ˜¯å› ä¸º Rust ä½¿ç”¨äº†ä¸€ä¸ªè¢«ç§°ä¸º Deref å¼ºåˆ¶è½¬æ¢ çš„æŠ€æœ¯ï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠ\u0026s2å˜æˆäº†\u0026s2[..] å¹¶ä¸”åœ¨ç­¾åä¸­addæ–¹æ³•è·å–selfçš„æ‰€æœ‰æƒï¼Œè¿™æ„å‘³ç€s1çš„æ‰€æœ‰æƒå°†è¢«ç§»åŠ¨åˆ°addè°ƒç”¨ä¸­ï¼Œä¹‹åä¸åœ¨ç”Ÿæ•ˆï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸ä¼šç”Ÿæˆå¾ˆå¤šæ‹·è´ï¼Œè¿™ä¸ªå®ç°æ¯”æ‹·è´æ›´åŠ é«˜æ•ˆã€‚ å¦‚æœæƒ³è·å–å¤šä¸ªå­—ç¬¦ç›¸åŠ ï¼š let s1 = String::from(\"hello\"); let s2 = String::from(\" \"); let s3 = String::from(\"world\"); let s = format!(\"{}{}{}\", s1, s2, s3); ä¸Šè¿°ä»£ç ä¼šå°†sè®¾ç½®ä¸ºhello worldã€‚format!ä¸println!çš„å·¥ä½œåŸç†ç›¸åŒï¼Œå¹¶ä¸”å®ƒä½¿ç”¨ç´¢å¼•ä¸ä¼šè·å–ä»»ä½•å‚æ•°çš„æ‰€æœ‰æƒã€‚ ç´¢å¼•å­—ç¬¦ä¸²åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œé€šè¿‡ç´¢å¼•æ¥ä¸€ç”¨å­—ç¬¦ä¸²ä¸­çš„å•ç‹¬å­—ç¬¦æ˜¯å¾ˆå¸¸è§çš„æ“ä½œï¼Œæ¯”å¦‚è¯´ golangã€‚ç„¶è€Œåœ¨ Rust ä¸­ï¼Œä¸å…è®¸ä½¿ç”¨ç´¢å¼•è¯­æ³•è®¿é—®Stringçš„ä¸€éƒ¨åˆ†ï¼Œä¼šå‡ºç°é”™è¯¯ã€‚ let s = String::from(\"hello\"); let h = s[0]; // error åŸå› åˆ™æ˜¯åœ¨ Rust ä¸­ï¼ŒStringæ˜¯ä¸€ä¸ªVec\u003cu8\u003eçš„å°è£…ï¼Œç›¸å½“äºåœ¨åº•å±‚å­˜å‚¨çš„æ˜¯å­—èŠ‚ï¼Œå’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ã€‚ç›´æ¥ä½¿ç”¨ç´¢å¼•è¯­æ³•è·å–Stringçš„ä¸€éƒ¨åˆ†ï¼Œç›¸å½“äºè·å–UTF-8å­—ç¬¦çš„ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å¯èƒ½ä¼šè¿”å›æ„å¤–çš„å€¼ï¼ŒRust æ ¹æœ¬ä¸ä¼šç¼–è¯‘è¿™äº›ä»£ç ã€‚ åœ¨Golongä¸­å¯ä»¥ç›´æ¥ç´¢å¼•è®¿é—®ï¼Œé‚£æ˜¯å› ä¸ºGolangä¼šé»˜è®¤æŠŠå­—ç¬¦ä¸²æŒ‰ç…§runeæ¥ éå†ã€‚ åœ¨ Rust ä¸­ä¹Ÿæœ‰è¿™æ ·çš„æ“ä½œï¼Œåªä¸è¿‡éœ€è¦æ˜¾ç¤ºä½¿ç”¨ï¼š for c in \"hello world\".chars() { println!(\"{}\", c); } è¿™æ ·å¯ä»¥è·å–åˆ°æ¯ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ï¼Œä¹Ÿå°±ç›¸å½“äº Golang ä¸­çš„runeã€‚ fn main() { let s = String::from(\"ä½ å¥½ä¸–ç•ŒğŸ‘‹\"); let c = s.chars().nth(10000); match c { Some(tmp) =\u003e println!(\"{}\",tmp), None =\u003e ( println!(\"this index is none\") ), } } ä¸Šè¿°ä»£ç å¯ä»¥å®‰å…¨çš„ä½¿ç”¨ç´¢å¼•æ¥è·å–å•ä¸ªå­—ç¬¦ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:12","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["å­¦ä¹ "],"content":" Hash Map æ–°å»ºå¯ä»¥ä½¿ç”¨newæ¥åˆ›å»ºä¸€ä¸ªç©ºçš„HashMapï¼Œå¹¶ä½¿ç”¨insertå¢åŠ å…ƒç´ ã€‚ use std::collections::HashMap; let mut map = HashMap::new(); map.insert(String::from(\"hello\"), String::form(\"world\")); æ³¨æ„ï¼Œä½¿ç”¨HashMapéœ€è¦å¼•å…¥ è®¿é—®å¯ä»¥ ä½¿ç”¨getæ–¹æ³•ä¼ å…¥å¯¹åº”çš„é”®ï¼Œä»HashMapä¸­è·å–å€¼ let name = String::from(\"hello\"); let s = map.get(\u0026name); // s : Option\u003cV\u003e æˆ–è€…ä½¿ç”¨ä¸ vector ç±»ä¼¼çš„æ–¹å¼æ¥éå† for (key, value) in \u0026map { println!(\"{}: {}\", key, value); } æ›´æ–°ç›´æ¥ä½¿ç”¨ç›¸åŒçš„é”®é‡æ–°è°ƒç”¨insertæ–¹æ³•ï¼Œè¿™æ ·ä¼šç›´æ¥æ›¿æ¢æˆæ–°å€¼ã€‚ å½“æˆ‘ä»¬éœ€è¦æ£€æŸ¥å¯¹åº”é”®æ˜¯å¦å­˜åœ¨å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨entryæ–¹æ³• map.insert(String::from(\"Ronin\")); let s = map.entry(String::from(\"hello\")).or_insert(\"ä¸–ç•Œ\"); *s = farmat!(\"{}\", s, String::from(\"~\")); å¹¶ä¸”or_insertæ–¹æ³•è¿”å›è¿™ä¸ªå€¼çš„å¯å˜å¼•ç”¨\u0026mut Vï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¹å˜å®ƒã€‚ æ‰€æœ‰æƒå¯¹äºç±»ä¼¼i32è¿™æ ·å®ç°äº†Copy trait çš„ç±»å‹ï¼Œå€¼å¯ä»¥ç›´æ¥æ‹·è´è¿›HashMapã€‚å¯¹äºæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ï¼Œå…¶å€¼å°†è¢«ç§»åŠ¨è€ŒHashMapä¼šæˆä¸ºè¿™äº›å€¼çš„æ‰€æœ‰è€…ã€‚æˆ–è€…å°†å€¼çš„å¼•ç”¨ä¼ å…¥HashMapï¼Œä½†æ˜¯éœ€è¦ä¿è¯ç”Ÿå‘½å‘¨æœŸï¼Œåç»­ä¼šäº†è§£ã€‚ ","date":"2021-11-22","objectID":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:13","tags":["Rust"],"title":"Rustå®˜æ–¹æ–‡æ¡£å­¦ä¹ è®°å½•","uri":"/posts/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["æŠ˜è…¾"],"content":"ä»Šå¹´å«–äº†ä¸€æ³¢è‰¯å¿ƒäº‘çš„æœåŠ¡å™¨ï¼ˆ2c4g8mï¼‰ï¼Œæ‰“ç®—æŠŠ github pageè¿ç§»åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚ åˆä¸æƒ³æ¯æ¬¡éƒ½ ssh ä¸ŠæœåŠ¡å™¨å»æ‹‰å–ï¼Œä¹Ÿä¸æƒ³ ftp å»ä¸Šä¼ æ–‡ä»¶ï¼ˆå…¬å¸å®‰å…¨è¦æ±‚ï¼‰ã€‚æ‰€ä»¥æƒ³é€šè¿‡webhooksé€šçŸ¥ï¼Œè®©æœåŠ¡å™¨è‡ªåŠ¨çš„å»æ›´æ–°åšå®¢ã€‚å…·ä½“å®ç°å¸Œæœ›é€šè¿‡ docker æ¥è§£å†³ï¼Œè¿™æ ·å¯ä»¥é€šç”¨ï¼Œä¸‹æ¬¡è¿ç§»æœåŠ¡çš„æ—¶å€™å¯ä»¥ç›´æ¥æ‹¿ä¸ª docker-compose æ–‡ä»¶å°±è¿ç§»å®Œæˆäº†ã€‚æ¯•ç«Ÿè‰¯å¿ƒäº‘ç»­è´¹å¯ä¸è‰¯å¿ƒã€‚ è¯´å¹²å°±å¹²ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½æ¥æ”¶åˆ°è¯·æ±‚çš„ä¸œè¥¿ï¼Œä»»æ„æ–¹å¼éƒ½è¡Œï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ golang ã€‚ buildé•œåƒéœ€è¦ä»¥ä¸‹ç›®å½•ç»“æ„ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œè°ƒæ•´ã€‚ . â”œâ”€â”€ Dockerfile â”œâ”€â”€ src â”‚ â”œâ”€â”€ cmd â”‚ â”‚ â”œâ”€â”€ main.go â”‚ â”‚ â””â”€â”€ sync.sh â”‚ â”œâ”€â”€ go.mod â”‚ â””â”€â”€ go.sum â””â”€â”€ ssh â”œâ”€â”€ id_rsa â”œâ”€â”€ id_rsa.pub â””â”€â”€ known_hosts main.go package main import ( \"fmt\" \"net/http\" \"os/exec\" \"github.com/go-playground/webhooks/v6/github\" ) const ( path = \"/webhooks\" // å¯ä»¥è‡ªè¡Œä¿®æ”¹ ) func main() { hook, err := github.New(github.Options.Secret(\"ä½ è‡ªå·±è®¾ç½®çš„ç§˜é’¥\")) if err != nil { panic(err) } http.HandleFunc(path, func(w http.ResponseWriter, r *http.Request) { cmd := exec.Command(\"/bin/sh\", \"./cmd/sync.sh\") out, err := cmd.Output() if err != nil { fmt.Println(err) } fmt.Println(out) payload, err := hook.Parse(r, github.ReleaseEvent, github.PushEvent) if err != nil { if err == github.ErrEventNotFound { fmt.Println(err) } } switch payload.(type) { case github.PushPayload: fmt.Println(\"received push event\") exec.Command(\"/bin/sh\", \"./cmd/sync.sh\").Run() default: fmt.Println(payload) } }) http.ListenAndServe(\":8888\", nil) } æ¥æ”¶åˆ°è¯·æ±‚å¹¶æ ¡éªŒé€šè¿‡ä¹‹åï¼Œä¼šæ‰§è¡Œ sync.sh è„šæœ¬ã€‚é‡Œé¢çš„å†…å®¹å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è¿›è¡Œä¿®æ”¹ sync.sh #!/bin/bash cd /data/www echo $(pwd) echo $(git pull) è¿è¡Œçš„æœåŠ¡ç°åœ¨å‡†å¤‡å¥½äº†ï¼Œå¾—å‡†å¤‡è¿è¡Œçš„ç¯å¢ƒ å› ä¸ºæ˜¯ä¸ªå°åŠŸèƒ½æ‰€ä»¥ä½¿ç”¨çš„é•œåƒä¹Ÿå¸Œæœ›è½»é‡ä¸€äº›ï¼Œé€‰ç”¨çš„æ˜¯ golang:alpineé•œåƒ å¦‚æœéœ€è¦å…¶ä»–åŠŸèƒ½ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ Dockerfile FROM golang:alpine # è®¾ç½® go mod ä»£ç† ENV GOPROXY=https://goproxy.cn,direct # æ›¿æ¢apké•œåƒæº RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories # è®¾ç½®ssh pub key COPY ./ssh /root/.ssh RUN chmod -R 600 /root/.ssh # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /tmp/src # å¤åˆ¶ä»£ç  COPY ./src /tmp/src RUN apk update RUN apk add git \u0026\u0026 apk add openssh RUN go mod tidy RUN go build -o bin/hugo cmd/main.go ENTRYPOINT [\"./bin/hugo\"] CMD [\"-logtostderr\"] å¯ä»¥çœ‹åˆ°è¿™é‡Œéœ€è¦sshä¿¡æ¯ï¼Œè‡ªè¡Œæ·»åŠ æ–‡ä»¶å³å¯ã€‚ è¿™é‡Œä¹Ÿç›´æ¥ç»™å‡º docker-compose æ–‡ä»¶ hugo: container_name: hugo build: ./services/go-hugo/ volumes: - {ä½ éœ€è¦åŒæ­¥çš„gitç›®å½•}:/data/www:rw # èµ„æºç›®å½• links: - nginx # å¦‚æœä½ ä¸éœ€è¦nginxåšè½¬å‘ï¼Œå¯ä»¥å»é™¤è¿™é‡Œ nginx: container_name: nginx build: context: ./services/nginx args: NGINX_VERSION: 1.21.3-alpine CONTAINER_PACKAGE_URL: mirrors.aliyun.com ports: - \"80:80\" - \"443:443\" volumes: - {ä½ çš„èµ„æºç›®å½•}:/www/:rw - {ä½ çš„httpsç›®å½•}:/ssl:rw - {ä½ çš„é…ç½®æ–‡ä»¶ç›®å½•}:/etc/nginx/conf.d/:rw - {ä½ çš„æ ¹é…ç½®æ–‡ä»¶}:/etc/nginx/nginx.conf:ro - {nginxæ—¥å¿—ç›®å½•}:/var/log/nginx/:rw environment: TZ: \"Asia/Shanghai\" restart: always networks: - default å¯ä»¥ç›´æ¥æŠŠç«¯å£æš´éœ²å‡ºå…¬ç½‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨nginxåšä¸€å±‚è½¬å‘ï¼Œå¯ä»¥æé«˜å®‰å…¨æ€§ä¸æš´éœ²ç«¯å£ nginxçš„Dockerfile ARG NGINX_VERSION FROM nginx:${NGINX_VERSION} ARG TZ ARG NGINX_VERSION ARG CONTAINER_PACKAGE_URL ARG NGINX_INSTALL_APPS ENV INSTALL_APPS=\",${NGINX_INSTALL_APPS},\" RUN if [ \"${CONTAINER_PACKAGE_URL}\" != \"\" ]; then \\ sed -i \"s/dl-cdn.alpinelinux.org/${CONTAINER_PACKAGE_URL}/g\" /etc/apk/repositories; \\ fi RUN if [ -z \"${INSTALL_APPS##*,certbot,*}\" ]; then \\ echo \"---------- Install certbot ----------\"; \\ apk add --no-cache certbot; \\ fi WORKDIR /www nginxé…ç½®æ–‡ä»¶ server { listen 80; server_name ä½ çš„åŸŸå; return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name ä½ çš„åŸŸå; # server_name localhost; root {æ ¹åœ°å€}; # sslè¯ä¹¦åœ°å€ ssl_certificate /ssl/xxx.pem; # pemæ–‡ä»¶çš„è·¯å¾„ ssl_certificate_key /ssl/xxx.key; # keyæ–‡ä»¶çš„è·¯å¾„ location /webhook { proxy_pass http://hugo:8888; # HTTP ä»£ç†è½¬å‘portã€‚è¿™é‡Œå› ä¸ºä½¿ç”¨äº†å·²å‘½åä¸º hugo çš„ docker å®¹å™¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨nginxé…ç½®ä¸­ç›´æ¥ä½¿ç”¨ã€‚ proxy_set_header Host localhost; # ä¸è¦å¿˜è®°è¿™å¥ Host $host proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-Proto https; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } location / { index index.html; } } é…ç½®éƒ½å®Œæˆåï¼Œç›´æ¥ä½¿ç”¨ docker-compose up -d å¯åŠ¨å®¹å™¨ã€‚åœ¨githubä¸Šè®¾ç½®webhooksçš„éƒ¨åˆ†å°±ä¸å†æ­¤èµ˜è¿°ã€‚ ","date":"2021-11-08","objectID":"/posts/webhooks%E5%AE%9E%E7%8E%B0%E5%8D%9A%E5%AE%A2%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/:0:0","tags":["Webhooks","docker"],"title":"Webhookså®ç°åšå®¢è‡ªåŠ¨æ›´æ–°","uri":"/posts/webhooks%E5%AE%9E%E7%8E%B0%E5%8D%9A%E5%AE%A2%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"categories":["å­¦ä¹ "],"content":" é¢˜ç›®è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚é˜Ÿåˆ—åº”å½“æ”¯æŒä¸€èˆ¬é˜Ÿåˆ—çš„æ”¯æŒçš„æ‰€æœ‰æ“ä½œï¼ˆpushã€popã€peekã€emptyï¼‰ï¼š å®ç° MyQueue ç±»ï¼š void push(int x) å°†å…ƒç´  x æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾ int pop() ä»é˜Ÿåˆ—çš„å¼€å¤´ç§»é™¤å¹¶è¿”å›å…ƒç´  int peek() è¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´  boolean empty() å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false è¯´æ˜ï¼š ä½ åªèƒ½ä½¿ç”¨æ ‡å‡†çš„æ ˆæ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯åªæœ‰ push to top, peek/pop from top, size, å’Œ is empty æ“ä½œæ˜¯åˆæ³•çš„ã€‚ ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒæ ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ list æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆï¼Œåªè¦æ˜¯æ ‡å‡†çš„æ ˆæ“ä½œå³å¯ã€‚ è¿›é˜¶ï¼š ä½ èƒ½å¦å®ç°æ¯ä¸ªæ“ä½œå‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„é˜Ÿåˆ—ï¼Ÿæ¢å¥è¯è¯´ï¼Œæ‰§è¡Œ n ä¸ªæ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n) ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªæ“ä½œå¯èƒ½èŠ±è´¹è¾ƒé•¿æ—¶é—´ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š [\"MyQueue\", \"push\", \"push\", \"peek\", \"pop\", \"empty\"] [[], [1], [2], [], [], []] è¾“å‡ºï¼š [null, null, null, 1, 1, false] è§£é‡Šï¼š MyQueue myQueue = new MyQueue(); myQueue.push(1); // queue is: [1] myQueue.push(2); // queue is: [1, 2] (leftmost is front of the queue) myQueue.peek(); // return 1 myQueue.pop(); // return 1, queue is [2] myQueue.empty(); // return false æç¤ºï¼š 1 \u003c= x \u003c= 9 æœ€å¤šè°ƒç”¨ 100 æ¬¡ pushã€popã€peek å’Œ empty å‡è®¾æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰æ•ˆçš„ ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç©ºçš„é˜Ÿåˆ—ä¸ä¼šè°ƒç”¨ pop æˆ–è€… peek æ“ä½œï¼‰ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/implement-queue-using-stacks è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ","date":"2021-03-05","objectID":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/:0:1","tags":["LeetCode"],"title":"LeetCode 232:ç”¨æ ˆå®ç°é˜Ÿåˆ—","uri":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"},{"categories":["å­¦ä¹ "],"content":" æ€è·¯è¿™é¢˜æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å®ç°é˜Ÿåˆ—çš„åŸºæœ¬åŠŸèƒ½ï¼Œå³å…ˆè¿›å…ˆå‡ºã€‚è€Œæˆ‘ä»¬çŸ¥é“æ ˆæ˜¯å…ˆè¿›åå‡ºçš„ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬é¢å¤–çš„æ“ä½œäº†ã€‚ é¢˜ç›®æç¤ºçš„æ¯”è¾ƒæ˜æ˜¾ï¼Œä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ã€‚æˆ‘ä»¬å¯ä»¥åšå‡ºå¦‚ä¸‹æ¨¡å‹ï¼š ä¸¤ä¸ªæ ˆåˆ†åˆ«ä¸ºè¾“å…¥æ ˆå’Œè¾“å‡ºæ ˆ è¾“å…¥æ ˆè´Ÿè´£æ¥æ”¶ push çš„å†…å®¹ è¾“å‡ºæ ˆè´Ÿè´£ pop å’Œ peek çš„å†…å®¹ å½“æ‰§è¡Œ pop æˆ–è€… peek æ—¶ï¼Œå½“è¾“å‡ºæ ˆä¸ºç©ºæ—¶ï¼Œå°†è¾“å…¥æ ˆçš„å†…å®¹è¾“å‡ºåˆ°è¾“å…¥æ ˆä¸­ in : [] out: [] --push(1) in : [1] out: [] --push(2) in : [2,1] out: [] --peek in : [] out: [1,2] peek = 1 --pop in : [] out: [2] pop = 1 --isEmpty isEmpty(in) \u0026\u0026 isEmpty(out) ","date":"2021-03-05","objectID":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/:0:2","tags":["LeetCode"],"title":"LeetCode 232:ç”¨æ ˆå®ç°é˜Ÿåˆ—","uri":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"},{"categories":["å­¦ä¹ "],"content":" ä»£ç  // MyQueue é˜Ÿåˆ— type MyQueue struct { in Stack out Stack } // Constructor MyQueueæ„é€ æ–¹æ³• func Constructor() MyQueue { in := new(Stack) out := new(Stack) return MyQueue{ in: *in, out: *out, } } func (mq *MyQueue) in2out() { for len(mq.in) \u003e 0 { mq.out.Push(mq.in.Pop()) } } // Push Push func (mq *MyQueue) Push(x int) { mq.in.Push(x) } // Pop Pop func (mq *MyQueue) Pop() int { if mq.out.Len() == 0 { mq.in2out() } return mq.out.Pop() } // Peek Peek func (mq *MyQueue) Peek() int { if mq.out.Len() == 0 { mq.in2out() } return mq.out.Top() } // Empty Empty func (mq *MyQueue) Empty() bool { return mq.in.IsEmpty() \u0026\u0026 mq.out.IsEmpty() } // ------------------------------------------------------- // Stack æ ˆ type Stack []int // Len è·å–æ ˆçš„é•¿åº¦ func (stack *Stack) Len() int { return len(*stack) } // Push push func (stack *Stack) Push(value int) { *stack = append(*stack, value) } // Top è·å–æ ˆçš„ç¬¬ä¸€ä¸ª func (stack *Stack) Top() int { return (*stack)[len(*stack)-1] } // Pop å¼¹å‡ºæœ€åä¸€ä¸ª func (stack *Stack) Pop() int { value := (*stack)[len(*stack)-1] *stack = (*stack)[:len(*stack)-1] return value } // IsEmpty åˆ¤æ–­æ˜¯å¦ä¸ºç©º func (stack *Stack) IsEmpty() bool { return len(*stack) == 0 } ","date":"2021-03-05","objectID":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/:0:3","tags":["LeetCode"],"title":"LeetCode 232:ç”¨æ ˆå®ç°é˜Ÿåˆ—","uri":"/posts/leetcode-232%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"},{"categories":["å­¦ä¹ "],"content":" é¢˜ç›®ç»™å®šä¸€äº›æ ‡è®°äº†å®½åº¦å’Œé«˜åº¦çš„ä¿¡å°ï¼Œå®½åº¦å’Œé«˜åº¦ä»¥æ•´æ•°å¯¹å½¢å¼ (w, h) å‡ºç°ã€‚å½“å¦ä¸€ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦éƒ½æ¯”è¿™ä¸ªä¿¡å°å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªä¿¡å°å°±å¯ä»¥æ”¾è¿›å¦ä¸€ä¸ªä¿¡å°é‡Œï¼Œå¦‚åŒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚ è¯·è®¡ç®—æœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªä¿¡å°èƒ½ç»„æˆä¸€ç»„â€œä¿„ç½—æ–¯å¥—å¨ƒâ€ä¿¡å°ï¼ˆå³å¯ä»¥æŠŠä¸€ä¸ªä¿¡å°æ”¾åˆ°å¦ä¸€ä¸ªä¿¡å°é‡Œé¢ï¼‰ã€‚ è¯´æ˜: ä¸å…è®¸æ—‹è½¬ä¿¡å°ã€‚ ç¤ºä¾‹: è¾“å…¥: envelopes = [[5,4],[6,4],[6,7],[2,3]] è¾“å‡º: 3 è§£é‡Š: æœ€å¤šä¿¡å°çš„ä¸ªæ•°ä¸º 3, ç»„åˆä¸º: [2,3] =\u003e [5,4] =\u003e [6,7]ã€‚ ","date":"2021-03-05","objectID":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/:0:1","tags":["LeetCode"],"title":"LeetCode 354:ä¿„ç½—æ–¯ä¿¡å°å¥—å¨ƒé—®é¢˜","uri":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/"},{"categories":["å­¦ä¹ "],"content":" æ€è·¯ æ¥æºï¼šlabuladong è¿™é“é¢˜ç›®å…¶å®æ˜¯æœ€é•¿é€’å¢å­åºåˆ— (Longes Increasing Subsequence, ç®€å†™ä¸º LIS) çš„ä¸€ä¸ªå˜ç§ï¼Œå› ä¸ºå¾ˆæ˜¾ç„¶ï¼Œæ¯æ¬¡åˆæ³•çš„åµŒå¥—éƒ½æ˜¯å¤§çš„å¥—å°çš„ï¼Œç›¸å½“äºæ‰¾ä¸€ä¸ªæœ€é•¿é€’å¢çš„å­åºåˆ—ï¼Œå…¶é•¿åº¦å°±æ˜¯æœ€å¤šèƒ½åµŒå¥—çš„ä¿¡å°ä¸ªæ•°ã€‚ ä½†æ˜¯éš¾ç‚¹åœ¨äºï¼Œæ ‡å‡†çš„LISç®—æ³•åªèƒ½åœ¨æ•°ç»„ä¸­å¯»æ‰¾æœ€é•¿å­åºåˆ—ï¼Œè€Œæˆ‘ä»¬çš„ä¿¡å°æ˜¯ç”±[w, h]è¿™æ ·çš„äºŒç»´æ•°å¯¹å½¢å¼è¡¨ç¤ºçš„ï¼Œå¦‚ä½•æŠŠLISç®—æ³•è¿ç”¨è¿‡æ¥å‘¢ï¼Ÿ w * hè®¡ç®—é¢ç§¯çš„å½¢å¼æ˜¯è¡Œä¸é€šçš„ï¼Œ1 * 10 å¤§äº 3 * 3ï¼Œä½†æ˜¯æ˜æ˜¾è¿™æ ·çš„ä¸¤ä¸ªä¿¡å°æ˜¯æ— æ³•ç›¸äº’åµŒå¥—çš„ã€‚ ","date":"2021-03-05","objectID":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/:0:2","tags":["LeetCode"],"title":"LeetCode 354:ä¿„ç½—æ–¯ä¿¡å°å¥—å¨ƒé—®é¢˜","uri":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/"},{"categories":["å­¦ä¹ "],"content":" è§£æ³•è¿™é“é¢˜çš„è§£æ³•æ˜¯æ¯”è¾ƒå·§å¦™çš„ï¼š å…ˆå¯¹å®½åº¦ w è¿›è¡Œå‡åºæ’åˆ—ï¼Œå¦‚æœé‡åˆ° w ç›¸åŒçš„æƒ…å†µï¼Œåˆ™æŒ‰ç…§é«˜åº¦ h é™åºæ’åˆ—ã€‚ä¹‹åæŠŠæ‰€æœ‰çš„ h å–å‡ºï¼Œå¡«å…¥ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨è¿™ä¸ªæ•°ç»„ä¸Šè®¡ç®— LIS çš„é•¿åº¦å°±æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆã€‚ ç¤ºä¾‹ï¼š | å®½åº¦w é«˜åº¦h | [ 1 , 8 ] | [ 2 , 3 ] | [ 5 , 4 ]|é™ | [ 5 , 2 ]|åº | [ 6 , 7 ]|é™ | [ 6 , 4 ]|åº å‡ åº å¾ˆæ˜æ˜¾ï¼Œé«˜åº¦ h ç»„æˆçš„æ•°ç»„ä¸­ 3 -\u003e 4 -\u003e 7 ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„LISï¼Œå…¶æœ€å¤§é•¿åº¦ä¸º3 è¿™ä¸ªè§£æ³•çš„å…³é”®åœ¨äºï¼Œå¯¹äºå®½åº¦ w ç›¸åŒçš„æ•°å¯¹ï¼Œè¦å¯¹å…¶é«˜åº¦ h è¿›è¡Œé™åºæ’åºã€‚å› ä¸ºä¸¤ä¸ªå®½åº¦ç›¸åŒçš„ä¿¡å°ä¸èƒ½ç›¸äº’åŒ…å«çš„ï¼Œé€†åºæ’åºä¿è¯ w ç›¸åŒçš„æ•°å¯¹ä¸­æœ€å¤šåªé€‰å–ä¸€ä¸ªã€‚ ","date":"2021-03-05","objectID":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/:0:3","tags":["LeetCode"],"title":"LeetCode 354:ä¿„ç½—æ–¯ä¿¡å°å¥—å¨ƒé—®é¢˜","uri":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/"},{"categories":["å­¦ä¹ "],"content":" ä»£ç  func maxEnvelopes(envelopes [][]int) int { count := len(envelopes) // å¿«é€Ÿæ’åº sort.Slice(envelopes, func(i, j int) bool { if envelopes[i][0] == envelopes[j][0] { return envelopes[i][1] \u003e envelopes[j][1] } return envelopes[i][0] \u003c envelopes[j][0] }) // å–å‡ºh height := make([]int, count) for i := 0; i \u003c count; i++ { height[i] = envelopes[i][1] } // è®¡ç®—LIS return lengthOfLIS(height) } // LIS è®¡ç®— func lengthOfLIS(nums []int) int { piles, count := 0, len(nums) top := make([]int, count) for i := 0; i \u003c count; i++ { num := nums[i] left, right := 0, piles for left \u003c right { mid := (left + right) / 2 if top[mid] \u003e= num { right = mid } else { left = mid + 1 } } if left == piles { piles++ } top[left] = num } return piles } ","date":"2021-03-05","objectID":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/:0:4","tags":["LeetCode"],"title":"LeetCode 354:ä¿„ç½—æ–¯ä¿¡å°å¥—å¨ƒé—®é¢˜","uri":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/"},{"categories":["å­¦ä¹ "],"content":" wiki æœ€é•¿é€’å¢å­åºåˆ—æ‰©å±•åˆ°äºŒç»´è€Œå·² åŠ¨æ€è§„åˆ’è®¾è®¡æ–¹æ³•\u0026\u0026çº¸ç‰Œæ¸¸æˆè®²è§£äºŒåˆ†è§£æ³• ","date":"2021-03-05","objectID":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/:0:5","tags":["LeetCode"],"title":"LeetCode 354:ä¿„ç½—æ–¯ä¿¡å°å¥—å¨ƒé—®é¢˜","uri":"/posts/leetcode-354%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98/"},{"categories":["å­¦ä¹ "],"content":" é¢˜ç›®ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numã€‚å¯¹äº 0 â‰¤ i â‰¤ num èŒƒå›´ä¸­çš„æ¯ä¸ªæ•°å­— i ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶æ•°ä¸­çš„ 1 çš„æ•°ç›®å¹¶å°†å®ƒä»¬ä½œä¸ºæ•°ç»„è¿”å› ç¤ºä¾‹1: è¾“å…¥: 2 è¾“å‡º: [0, 1, 1] ç¤ºä¾‹2: è¾“å…¥: 5 è¾“å‡º: [0, 1, 1, 2, 1, 2] è¿›é˜¶: ç»™å‡ºæ—¶é—´å¤æ‚åº¦ä¸º O(n * sizeof(integer)) çš„è§£ç­”éå¸¸å®¹æ˜“. ä½†ä½ å¯ä»¥åœ¨çº¿æ€§æ—¶é—´ O(n) å†…ç”¨ä¸€è¶Ÿæ‰«æåšåˆ°å—? è¦æ±‚ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸º O(n) ä½ èƒ½è¿›ä¸€æ­¥å®Œå–„è§£æ³•å—ï¼Ÿè¦æ±‚åœ¨C++æˆ–ä»»ä½•å…¶ä»–è¯­è¨€ä¸­ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°ï¼ˆå¦‚ C++ ä¸­çš„ __builtin_popcountï¼‰æ¥æ‰§è¡Œæ­¤æ“ä½œ ","date":"2021-03-03","objectID":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/:0:1","tags":["LeetCode"],"title":"LeetCode 338:æ¯”ç‰¹ä½è®¡æ•°","uri":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/"},{"categories":["å­¦ä¹ "],"content":" å¼€å§‹çš„æ€è·¯å…ˆä¸è€ƒè™‘è¿›é˜¶, ä½¿ç”¨è¯­è¨€è‡ªå¸¦çš„å‡½æ•°è¿›è¡Œè§£ç­”ï¼ŒGolangä¸­å¯ä»¥ä½¿ç”¨bits.OnesCount()å‡½æ•°æ¥è®¡ç®— func countBits(num int) []int { nums := make([]int, num+1) for i := 0; i \u003c= num; i++ { nums[i] = bits.OnesCount(uint(i)) } return nums } è¿™ç§è§£ç­”ååˆ†ç®€å•ï¼Œæˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹æ‰‹å†™ä¸€ä¸ª OneCount() leetcode å®˜æ–¹è§£ç­”å†…æåˆ°æœ‰ä¸€ä¸ªä½è¿ç®—çš„å°æŠ€å·§ å¯¹äºä»»æ„æ•´æ•°x, ä»¤ x = x \u0026 (x - 1) , è¯¥è¿ç®—å°† x çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„æœ€åä¸€ä¸ª1å˜æˆ0. å› æ­¤, å¯¹xé‡å¤è¯¥æ“ä½œ, ç›´åˆ°xå˜æˆ0, åˆ™æ“ä½œæ¬¡æ•°å³ä¸ºxçš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹è¯•è¯• // 8çš„äºŒè¿›åˆ¶ä¸º 1000 // 7çš„äºŒè¿›åˆ¶ä¸º 0111 // æˆ‘ä»¬è¿›è¡Œ \u0026 æ“ä½œ 1000 \u0026 0111 = 0000 // x å˜æˆäº† 0 , 8çš„äºŒè¿›åˆ¶æ•°ä¸º1, è¿™ç¬¦åˆæˆ‘ä»¬çš„ç­”æ¡ˆ // è®©æˆ‘ä»¬å†æ¥ä¸€ä¸ª // 6çš„äºŒè¿›åˆ¶ä¸º 0110 // 5çš„äºŒè¿›åˆ¶ä¸º 0101 // 4çš„äºŒè¿›åˆ¶ä¸º 0100 // 3çš„äºŒè¿›åˆ¶ä¸º 0011 0111 \u0026 0110 = 0110 // ones + 1 0110 \u0026 0101 = 0100 // ones + 1 0101 \u0026 0100 = 0100 // ones + 1 0100 \u0026 0011 = 0000 // ones = 3 // å¯¹æ­¤æˆ‘åªèƒ½å‘å‡ºå’¸é±¼çš„å£°éŸ³ï¼Œå¦™å•Š å¯¹æ­¤æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡º: func onesCount(x int) (ones int) { for ; x \u003e 0; x \u0026= x - 1 { ones++ } return } ä½†æ˜¯è¿™ä¾ç„¶ä¸æ»¡è¶³è¿›é˜¶è§£ç­”çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­ ","date":"2021-03-03","objectID":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/:0:2","tags":["LeetCode"],"title":"LeetCode 338:æ¯”ç‰¹ä½è®¡æ•°","uri":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/"},{"categories":["å­¦ä¹ "],"content":" è¿›é˜¶è¦ç»™å‡ºæ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•, ä»£è¡¨æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç³»ç»Ÿçš„å†…ç½®å‡½æ•°, ä¸”ä¸èƒ½è¿›å…¥å¾ªç¯. æˆ‘ä»¬å¿…é¡»è¿›è¡Œé€»è¾‘æ¢³ç† å®˜æ–¹ç»™å‡ºçš„è§£ç­”: åŠ¨æ€è§„åˆ’â€“æœ€é«˜æœ‰æ•ˆä½ æœ‰äº›æ™¦æ¶©éš¾æ‡‚ éœ€è¦å¯¹æ¯ä¸ªæ•°éå†å…¶äºŒè¿›åˆ¶è¡¨ç¤ºçš„æ¯ä¸€ä½ã€‚å¯ä»¥æ¢ä¸€ä¸ªæ€è·¯ï¼Œå½“è®¡ç®— i çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€æ—¶ï¼Œå¦‚æœå­˜åœ¨ 0 â‰¤ j \u003c iï¼Œj çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€å·²çŸ¥ï¼Œä¸” i å’Œ j ç›¸æ¯”ï¼Œi çš„äºŒè¿›åˆ¶è¡¨ç¤ºåªå¤šäº†ä¸€ä¸ª 1ï¼Œåˆ™å¯ä»¥å¿«é€Ÿå¾—åˆ° i çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ã€‚ ä»¤ bits[i] è¡¨ç¤º i çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ï¼Œåˆ™ä¸Šè¿°å…³ç³»å¯ä»¥è¡¨ç¤ºæˆï¼šbits[i] = bits[j] + 1ã€‚ å¯¹äºæ­£æ•´æ•° xï¼Œå¦‚æœå¯ä»¥çŸ¥é“æœ€å¤§çš„æ­£æ•´æ•° yï¼Œä½¿å¾— y â‰¤ x ä¸” y æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œåˆ™ y çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰æœ€é«˜ä½æ˜¯ 1ï¼Œå…¶ä½™éƒ½æ˜¯ 0ï¼Œæ­¤æ—¶ç§° y ä¸º x çš„ã€Œæœ€é«˜æœ‰æ•ˆä½ã€ã€‚ä»¤ z = x âˆ’ yï¼Œæ˜¾ç„¶ 0 â‰¤ z \u003c xï¼Œåˆ™ bits[x] = bits[z] + 1ã€‚ ä¸ºäº†åˆ¤æ–­ä¸€ä¸ªæ­£æ•´æ•°æ˜¯ä¸æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œå¯ä»¥åˆ©ç”¨æ–¹æ³•ä¸€ä¸­æåˆ°çš„æŒ‰ä½ä¸è¿ç®—çš„æ€§è´¨ã€‚å¦‚æœæ­£æ•´æ•° y æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œåˆ™ y çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰æœ€é«˜ä½æ˜¯ 1ï¼Œå…¶ä½™éƒ½æ˜¯ 0ï¼Œå› æ­¤ y \u0026 ( y âˆ’ 1 ) = 0ã€‚ç”±æ­¤å¯è§ï¼Œæ­£æ•´æ•° y æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œå½“ä¸”ä»…å½“ y \u0026 ( y âˆ’ 1 ) = 0ã€‚ æ˜¾ç„¶ï¼Œ0 çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º 0ã€‚ä½¿ç”¨ highBit è¡¨ç¤ºå½“å‰çš„æœ€é«˜æœ‰æ•ˆä½ï¼Œéå†ä» 1 åˆ° num çš„æ¯ä¸ªæ­£æ•´æ•° iï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚ å¦‚æœ i\u0026(iâˆ’1)=0ï¼Œåˆ™ä»¤ highBit = iï¼Œæ›´æ–°å½“å‰çš„æœ€é«˜æœ‰æ•ˆä½ã€‚ i æ¯” iâˆ’highBit çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€å¤š 1ï¼Œç”±äºæ˜¯ä»å°åˆ°å¤§éå†æ¯ä¸ªæ•°ï¼Œå› æ­¤éå†åˆ° i æ—¶ï¼Œiâˆ’highBit çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€å·²çŸ¥ï¼Œä»¤ bits[i] = bits[iâˆ’highBit] + 1ã€‚ æœ€ç»ˆå¾—åˆ°çš„æ•°ç»„ bits å³ä¸ºç­”æ¡ˆã€‚ ä½œè€…ï¼šLeetCode-Solution é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/counting-bits/solution/bi-te-wei-ji-shu-by-leetcode-solution-0t1i/ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ æˆ‘è¿™å°è¯•åšå‡ºè‡ªå·±çš„è§£é‡Šï¼š å½“ä¸€ä¸ªæ•°æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚æ—¶, å®ƒçš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡åªä¼šæ˜¯1 å½“ä¸€ä¸ªæ•°ä¸æ˜¯2çš„æ•´æ•°æ¬¡å¹‚æ—¶ï¼Œå®ƒçš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡ä¸º (å®ƒ ä¸ å®ƒä¸Šæ¬¡ä¸º2çš„æ•´æ•°æ¬¡å¹‚çš„æ•°çš„å·®å€¼)çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€+ 1 æˆ‘ä»¬å¯ä»¥æ¥å®é™…è¯•è¯•: // 8çš„äºŒè¿›åˆ¶ä¸º 1000 å®ƒæ˜¯2çš„æ•´æ•°æ¬¡å¹‚ æ‰€ä»¥å®ƒçš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡åªä¼šæ˜¯1 // é‚£ 9 å‘¢ï¼Ÿæ ¹æ®ä¸Šé¢çš„æ€»ç»“ å®ƒçš„ä¸Šæ¬¡2çš„æ•´æ•°æ¬¡å¹‚çš„æ•°ä¸º 8,9-8=1(0001) çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º1 // 9 çš„äºŒè¿›åˆ¶ä½æ˜¯ 1001 ,ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º 2, å®Œç¾ // é‚£ 10 å‘¢ï¼Ÿå®ƒçš„ä¸Šæ¬¡2çš„æ•´æ•°æ¬¡å¹‚çš„æ•°ä¾ç„¶ä¸º 8, 10-8=2(0010) çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º1 // 10 çš„äºŒè¿›åˆ¶ä½ä¸º 1010, ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º 2 // ç»§ç»­ 11 äºŒè¿›åˆ¶ä¸º 1011, 11-8=3 , 3(0011)çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º2 // å¯¹æ­¤æˆ‘åªèƒ½å‘å‡ºå’¸é±¼çš„å£°éŸ³ï¼Œå¦™å•Š // æ‰€ä»¥æˆ‘ä»¬èƒ½å†™å‡ºä¸‹é¢çš„æ–¹æ³• func countBits(num int) []int { bits := make([]int, num+1) highBit := 0 // æœ€é«˜æ¯”ç‰¹ä½ å³ ä¸Šæ¬¡ä¸º2çš„æ•´æ•°æ¬¡å¹‚çš„æ•° // 0çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€ä¸º 0ï¼Œä¸éœ€è¦è¿›å…¥å¾ªç¯ for i := 1; i \u003c= num; i++ { // è¿™é‡Œæ˜¯æ ¹æ®ä¸Šé¢çš„ä½è¿ç®—çš„æŠ€å·§ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º2çš„æ•´æ•°æ¬¡å¹‚ï¼Œå› ä¸º2çš„æ•´æ•°æ¬¡å¹‚åªæœ‰ä¸€ä¸ª1 if i\u0026(i-1) == 0 { highBit = i // æ›´æ–°æœ€é«˜æ¯”ç‰¹ä½ } // å®ƒä¸å®ƒä¸Šæ¬¡ä¸º2çš„æ•´æ•°æ¬¡å¹‚çš„æ•°çš„å·®å€¼ çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€+ 1 bits[i] = bits[i-highBit] + 1 } return bits } åº”è¯¥è¿˜æ˜¯æœ‰äº›æ™¦æ¶©éš¾æ‡‚ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡å¾—åŠæ³•ï¼Œè¿™å¤ªæŠ½è±¡äº†ï¼Œå®˜æ–¹è§£ç­”çš„å…¶ä»–åŠ¨æ€è§„åˆ’æ€æƒ³å°±ä¸ç»§ç»­äº†ï¼Œæˆ‘ä»¬è¿˜æœ‰æ–°åŠæ³•ã€‚ ","date":"2021-03-03","objectID":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/:0:3","tags":["LeetCode"],"title":"LeetCode 338:æ¯”ç‰¹ä½è®¡æ•°","uri":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/"},{"categories":["å­¦ä¹ "],"content":" æ–°çš„åŠæ³•å¯¹äºæ‰€æœ‰çš„æ•°å­—ï¼Œåªæœ‰ä¸¤ç±» å¥‡æ•°|å¶æ•°: å¥‡æ•°: åœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤ºï¼Œå¥‡æ•°ä¸€å®šæ¯”å‰é¢çš„é‚£ä¸ªå¶æ•°å¤šä¸€ä¸ª1ï¼Œå¤šçš„å°±æ˜¯æœ€ä½ä½çš„1 ä¸¾ä¾‹ï¼š 0 = 0000 1 = 0001 2 = 0010 3 = 0011 å‘ç°äº†æ²¡æœ‰ï¼Œå¶æ•°çš„æœ€ä½ä½æ€»æ˜¯0ï¼Œå¥‡æ•°çš„æœ€ä½ä½æ€»æ˜¯1ï¼Œæˆ‘ä»¬å†è€ƒè™‘å¶æ•° å¶æ•°: äºŒè¿›åˆ¶ä¸­ï¼Œå¶æ•°ä¸­çš„1ä¸€å®šå’Œé™¤ä»¥2ä¹‹åçš„é‚£ä¸ªæ•°ä¸€æ ·å¤šï¼Œå› ä¸ºå¶æ•°çš„æœ€ä½ä½æ€»æ˜¯0 é™¤ä»¥2å°±åªæ˜¯å³ç§»ä¸€ä½ï¼ŒæŠŠæœ€ä½ä½çš„0å»æ‰è€Œå·²ï¼Œæ‰€ä»¥1çš„æ•°é‡æ˜¯ä¸å˜çš„ ä¸¾ä¾‹: 0 = 0000 1 = 0001 // 0ä¸ç®—, 1çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€= 0 + 1 2 = 0010 3 = 0011 // 2 / 2 = 1, 1çš„ã€Œä¸€æ¯”ç‰¹æ•°ã€= 1 â€¦ 4 = 0100 5 = 0101 6 = 0110 7 = 0111 æˆ‘ä»¬èƒ½æ ¹æ®ä¸Šé¢çš„è§„å¾‹æ¥å†™å‡ºä»¥ä¸‹ä»£ç  func countBits(num int) []int { nums := make([]int, num+1) for i := 1; i \u003c= num; i++ { // åˆ¤æ–­æ˜¯å¦ä¸ºå¶æ•°ï¼Œå¥‡æ•°çš„æœ€åä¸€ä½æ°¸è¿œæ˜¯1 if i\u00261 == 1 { nums[i] = nums[i-1] + 1 } else { nums[i] = nums[i/2] } } return nums } ä»¥ä¸Šæ€è·¯æ¥è‡ª: ä½œè€…ï¼šduadua é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/counting-bits/solution/hen-qing-xi-de-si-lu-by-duadua/ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ ","date":"2021-03-03","objectID":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/:0:4","tags":["LeetCode"],"title":"LeetCode 338:æ¯”ç‰¹ä½è®¡æ•°","uri":"/posts/leetcode-338%E6%AF%94%E7%89%B9%E4%BD%8D%E8%AE%A1%E6%95%B0/"},{"categories":["å­¦ä¹ "],"content":" æœ¬ä¸»é¢˜ä¸ºç³»åˆ—æ–‡ç« ï¼Œåˆ†ä¸Šä¸‹ä¸¤ç¯‡ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» time/rate çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œå¦å¤–ä¸€ç¯‡æ–‡ç«  ã€ŠGolang é™æµå™¨ time/rate å®ç°å‰–æã€‹ åˆ™ç€é‡ä»‹ç»å…¶å†…éƒ¨å®ç°åŸç†ã€‚ é™æµå™¨æ˜¯åå°æœåŠ¡ä¸­çš„éå¸¸é‡è¦çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨æ¥é™åˆ¶è¯·æ±‚é€Ÿç‡ï¼Œä¿æŠ¤æœåŠ¡ï¼Œä»¥å…æœåŠ¡è¿‡è½½ã€‚ é™æµå™¨çš„å®ç°æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚æ»‘åŠ¨çª—å£æ³•ã€Token Bucketã€Leaky Bucket ç­‰ã€‚ å…¶å® Golang æ ‡å‡†åº“ä¸­å°±è‡ªå¸¦äº†é™æµç®—æ³•çš„å®ç°ï¼Œå³ golang.org/x/time/rateã€‚è¯¥é™æµå™¨æ˜¯åŸºäº Token Bucket(ä»¤ç‰Œæ¡¶) å®ç°çš„ã€‚ ç®€å•æ¥è¯´ï¼Œä»¤ç‰Œæ¡¶å°±æ˜¯æƒ³è±¡æœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ¡¶ï¼Œç³»ç»Ÿä¼šä»¥æ’å®šé€Ÿç‡å‘æ¡¶ä¸­æ”¾ Tokenï¼Œæ¡¶æ»¡åˆ™æš‚æ—¶ä¸æ”¾ã€‚ è€Œç”¨æˆ·åˆ™ä»æ¡¶ä¸­å– Tokenï¼Œå¦‚æœæœ‰å‰©ä½™ Token å°±å¯ä»¥ä¸€ç›´å–ã€‚å¦‚æœæ²¡æœ‰å‰©ä½™ Tokenï¼Œåˆ™éœ€è¦ç­‰åˆ°ç³»ç»Ÿä¸­è¢«æ”¾ç½®äº† Token æ‰è¡Œã€‚ æœ¬æ–‡åˆ™ä¸»è¦é›†ä¸­ä»‹ç»ä¸‹è¯¥ç»„ä»¶çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼š æ„é€ ä¸€ä¸ªé™æµå™¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ„é€ ä¸€ä¸ªé™æµå™¨å¯¹è±¡ï¼š limiter := NewLimiter(10, 1); è¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ r Limitã€‚ä»£è¡¨æ¯ç§’å¯ä»¥å‘ Token æ¡¶ä¸­äº§ç”Ÿå¤šå°‘ tokenã€‚Limit å®é™…ä¸Šæ˜¯ float64 çš„åˆ«åã€‚ ç¬¬äºŒä¸ªå‚æ•°æ˜¯ b intã€‚b ä»£è¡¨ Token æ¡¶çš„å®¹é‡å¤§å°ã€‚ é‚£ä¹ˆï¼Œå¯¹äºä»¥ä¸Šä¾‹å­æ¥è¯´ï¼Œå…¶æ„é€ å‡ºçš„é™æµå™¨å«ä¹‰ä¸ºï¼Œå…¶ä»¤ç‰Œæ¡¶å¤§å°ä¸º 1, ä»¥æ¯ç§’ 10 ä¸ª Token çš„é€Ÿç‡å‘æ¡¶ä¸­æ”¾ç½® Tokenã€‚ é™¤äº†ç›´æ¥æŒ‡å®šæ¯ç§’äº§ç”Ÿçš„ Token ä¸ªæ•°å¤–ï¼Œè¿˜å¯ä»¥ç”¨ Every æ–¹æ³•æ¥æŒ‡å®šå‘ Token æ¡¶ä¸­æ”¾ç½® Token çš„é—´éš”ï¼Œä¾‹å¦‚ï¼š limit := Every(100 * time.Millisecond); limiter := NewLimiter(limit, 1); ä»¥ä¸Šå°±è¡¨ç¤ºæ¯ 100ms å¾€æ¡¶ä¸­æ”¾ä¸€ä¸ª Tokenã€‚æœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯ä¸€ç§’é’Ÿäº§ç”Ÿ 10 ä¸ªã€‚ Limiter æä¾›äº†ä¸‰ç±»æ–¹æ³•ä¾›ç”¨æˆ·æ¶ˆè´¹ Tokenï¼Œç”¨æˆ·å¯ä»¥æ¯æ¬¡æ¶ˆè´¹ä¸€ä¸ª Tokenï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æ¶ˆè´¹å¤šä¸ª Tokenã€‚ è€Œæ¯ç§æ–¹æ³•ä»£è¡¨äº†å½“ Token ä¸è¶³æ—¶ï¼Œå„è‡ªä¸åŒçš„å¯¹åº”æ‰‹æ®µã€‚ Wait/WaitN func (lim *Limiter) Wait(ctx context.Context) (err error) func (lim *Limiter) WaitN(ctx context.Context, n int) (err error) Wait å®é™…ä¸Šå°±æ˜¯ WaitN(ctx,1)ã€‚ å½“ä½¿ç”¨ Wait æ–¹æ³•æ¶ˆè´¹ Token æ—¶ï¼Œå¦‚æœæ­¤æ—¶æ¡¶å†… Token æ•°ç»„ä¸è¶³ (å°äº N)ï¼Œé‚£ä¹ˆ Wait æ–¹æ³•å°†ä¼šé˜»å¡ä¸€æ®µæ—¶é—´ï¼Œç›´è‡³ Token æ»¡è¶³æ¡ä»¶ã€‚å¦‚æœå……è¶³åˆ™ç›´æ¥è¿”å›ã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒWait æ–¹æ³•æœ‰ä¸€ä¸ª context å‚æ•°ã€‚ æˆ‘ä»¬å¯ä»¥è®¾ç½® context çš„ Deadline æˆ–è€… Timeoutï¼Œæ¥å†³å®šæ­¤æ¬¡ Wait çš„æœ€é•¿æ—¶é—´ã€‚ Allow/AllowN func (lim *Limiter) Allow() bool func (lim *Limiter) AllowN(now time.Time, n int) bool Allow å®é™…ä¸Šå°±æ˜¯ AllowN(time.Now(),1)ã€‚ AllowN æ–¹æ³•è¡¨ç¤ºï¼Œæˆªæ­¢åˆ°æŸä¸€æ—¶åˆ»ï¼Œç›®å‰æ¡¶ä¸­æ•°ç›®æ˜¯å¦è‡³å°‘ä¸º n ä¸ªï¼Œæ»¡è¶³åˆ™è¿”å› trueï¼ŒåŒæ—¶ä»æ¡¶ä¸­æ¶ˆè´¹ n ä¸ª tokenã€‚ åä¹‹è¿”å›ä¸æ¶ˆè´¹ Tokenï¼Œfalseã€‚ é€šå¸¸å¯¹åº”è¿™æ ·çš„çº¿ä¸Šåœºæ™¯ï¼Œå¦‚æœè¯·æ±‚é€Ÿç‡è¿‡å¿«ï¼Œå°±ç›´æ¥ä¸¢åˆ°æŸäº›è¯·æ±‚ã€‚ Reserve/ReserveN func (lim *Limiter) Reserve() *Reservation func (lim *Limiter) ReserveN(now time.Time, n int) *Reservation Reserve ç›¸å½“äº ReserveN(time.Now(), 1)ã€‚ ReserveN çš„ç”¨æ³•å°±ç›¸å¯¹æ¥è¯´å¤æ‚ä¸€äº›ï¼Œå½“è°ƒç”¨å®Œæˆåï¼Œæ— è®º Token æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª Reservation * å¯¹è±¡ã€‚ ä½ å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„ Delay() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›äº†éœ€è¦ç­‰å¾…çš„æ—¶é—´ã€‚å¦‚æœç­‰å¾…æ—¶é—´ä¸º 0ï¼Œåˆ™è¯´æ˜ä¸ç”¨ç­‰å¾…ã€‚ å¿…é¡»ç­‰åˆ°ç­‰å¾…æ—¶é—´ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„å·¥ä½œã€‚ æˆ–è€…ï¼Œå¦‚æœä¸æƒ³ç­‰å¾…ï¼Œå¯ä»¥è°ƒç”¨ Cancel() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°† Token å½’è¿˜ã€‚ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨ Reserve æ–¹æ³•ã€‚ r := lim.Reserve() f !r.OK() { // Not allowed to act! Did you remember to set lim.burst to be \u003e 0 ? return } time.Sleep(r.Delay()) Act() // æ‰§è¡Œç›¸å…³é€»è¾‘ åŠ¨æ€è°ƒæ•´é€Ÿç‡Limiter æ”¯æŒå¯ä»¥è°ƒæ•´é€Ÿç‡å’Œæ¡¶å¤§å°ï¼š SetLimit(Limit) æ”¹å˜æ”¾å…¥ Token çš„é€Ÿç‡ SetBurst(int) æ”¹å˜ Token æ¡¶å¤§å° æœ‰äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ç°æœ‰ç¯å¢ƒå’Œæ¡ä»¶ï¼Œæ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼ŒåŠ¨æ€çš„æ”¹å˜ Token æ¡¶å¤§å°å’Œé€Ÿç‡ã€‚ ç›¸å…³æ–‡ç«  Golang é™æµå™¨ time/rate å®ç°å‰–æ uber-go æ¼æ¡¶é™æµå™¨ä½¿ç”¨ä¸åŸç†åˆ†æ æœ¬æ–‡ä½œè€…ï¼š cyhone æœ¬æ–‡é“¾æ¥ï¼š https://www.cyhone.com/articles/usage-of-golang-rate/ ç‰ˆæƒå£°æ˜ï¼š æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼ ","date":"2021-03-03","objectID":"/posts/golang%E6%A0%87%E5%87%86%E5%BA%93%E9%99%90%E6%B5%81%E5%99%A8timerate%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/:0:0","tags":["Goæ ‡å‡†åº“"],"title":"Golangæ ‡å‡†åº“é™æµå™¨timerateä½¿ç”¨ä»‹ç»","uri":"/posts/golang%E6%A0%87%E5%87%86%E5%BA%93%E9%99%90%E6%B5%81%E5%99%A8timerate%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["å­¦ä¹ "],"content":"é™æµå™¨æ˜¯å¾®æœåŠ¡ä¸­å¿…ä¸ç¼ºå°‘çš„ä¸€ç¯ï¼Œå¯ä»¥èµ·åˆ°ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡ï¼Œé˜²æ­¢æœåŠ¡è¿‡è½½ç­‰ä½œç”¨ã€‚ä¸Šä¸€ç¯‡æ–‡ç«  ã€ŠGolang é™æµå™¨ time/rate ä½¿ç”¨ä»‹ç»ã€‹ ç®€å•ä»‹ç»äº† time/rate çš„ä½¿ç”¨æ–¹æ³•ï¼Œæœ¬æ–‡åˆ™ç€é‡åˆ†æä¸‹å…¶å®ç°åŸç†ã€‚å»ºè®®åœ¨æ­£å¼é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå…ˆé˜…è¯»ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« ã€‚ ä¸Šä¸€ç¯‡æ–‡ç« è®²åˆ°ï¼Œtime/rate æ˜¯åŸºäº Token Bucket(ä»¤ç‰Œæ¡¶) ç®—æ³•å®ç°çš„é™æµã€‚æœ¬æ–‡å°†ä¼šåŸºäºæºç ï¼Œæ·±å…¥å‰–æä¸‹ Golang æ˜¯å¦‚ä½•å®ç° Token Bucket çš„ã€‚å…¶ä»£ç ä¹Ÿéå¸¸ç®€æ´ï¼Œå»é™¤æ³¨é‡Šåï¼Œä¹Ÿå°± 200 è¡Œå·¦å³çš„ä»£ç é‡ã€‚ åŒæ—¶ï¼Œæˆ‘ä¹Ÿæä¾›äº† time/rate æ³¨é‡Šç‰ˆï¼Œè¾…åŠ©å¤§å®¶ç†è§£è¯¥ç»„ä»¶çš„å®ç°ã€‚ èƒŒæ™¯ç®€å•æ¥è¯´ï¼Œä»¤ç‰Œæ¡¶å°±æ˜¯æƒ³è±¡æœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ¡¶ï¼Œç³»ç»Ÿä¼šä»¥æ’å®šé€Ÿç‡å‘æ¡¶ä¸­æ”¾ Tokenï¼Œæ¡¶æ»¡åˆ™æš‚æ—¶ä¸æ”¾ã€‚ è€Œç”¨æˆ·åˆ™ä»æ¡¶ä¸­å– Tokenï¼Œå¦‚æœæœ‰å‰©ä½™ Token å°±å¯ä»¥ä¸€ç›´å–ã€‚å¦‚æœæ²¡æœ‰å‰©ä½™ Tokenï¼Œåˆ™éœ€è¦ç­‰åˆ°ç³»ç»Ÿä¸­è¢«æ”¾ç½®äº† Token æ‰è¡Œã€‚ ä¸€èˆ¬ä»‹ç» Token Bucket çš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰ä¸€å¼ è¿™æ ·çš„åŸç†å›¾ï¼š ä»è¿™ä¸ªå›¾ä¸­çœ‹èµ·æ¥ï¼Œä¼¼ä¹ä»¤ç‰Œæ¡¶å®ç°åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š æœ‰ä¸€ä¸ª Timer å’Œä¸€ä¸ª BlockingQueueã€‚Timer å›ºå®šçš„å¾€ BlockingQueue ä¸­æ”¾ tokenã€‚ç”¨æˆ·åˆ™ä» BlockingQueue ä¸­å–æ•°æ®ã€‚ è¿™å›ºç„¶æ˜¯ Token Bucket çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿™ä¹ˆåšä¹Ÿéå¸¸ç›´è§‚ï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½äº†ï¼šæˆ‘ä»¬éœ€è¦ä¸ä»…å¤šç»´æŠ¤ä¸€ä¸ª Timer å’Œ BlockingQueueï¼Œè€Œä¸”è¿˜è€—è´¹äº†ä¸€äº›ä¸å¿…è¦çš„å†…å­˜ã€‚ åœ¨ Golang çš„ timer/rate ä¸­çš„å®ç°, å¹¶æ²¡æœ‰å•ç‹¬ç»´æŠ¤ä¸€ä¸ª Timerï¼Œè€Œæ˜¯é‡‡ç”¨äº† lazyload çš„æ–¹å¼ï¼Œç›´åˆ°æ¯æ¬¡æ¶ˆè´¹ä¹‹å‰æ‰æ ¹æ®æ—¶é—´å·®æ›´æ–° Token æ•°ç›®ï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯ç”¨ BlockingQueue æ¥å­˜æ”¾ Tokenï¼Œè€Œæ˜¯ä»…ä»…é€šè¿‡è®¡æ•°çš„æ–¹å¼ã€‚ Token çš„ç”Ÿæˆå’Œæ¶ˆè´¹æˆ‘ä»¬åœ¨ ä¸Šä¸€ç¯‡æ–‡ç«  ä¸­è®²åˆ°ï¼ŒToken çš„æ¶ˆè´¹æ–¹å¼æœ‰ä¸‰ç§ã€‚ä½†å…¶å®åœ¨å†…éƒ¨å®ç°ï¼Œæœ€ç»ˆä¸‰ç§æ¶ˆè´¹æ–¹å¼éƒ½è°ƒç”¨äº† reserveN å‡½æ•°æ¥ç”Ÿæˆå’Œæ¶ˆè´¹ Tokenã€‚ æˆ‘ä»¬çœ‹ä¸‹ reserveN å‡½æ•°çš„å…·ä½“å®ç°ï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ã€‚åœ¨æ­£å¼è®²ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼š åœ¨ time/rate ä¸­ï¼ŒNewLimiter çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€Ÿç‡ limitï¼Œä»£è¡¨äº†ä¸€ç§’é’Ÿå¯ä»¥äº§ç”Ÿå¤šå°‘ Tokenã€‚ é‚£ä¹ˆç®€å•æ¢ç®—ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ä¸€ä¸ª Token çš„ç”Ÿæˆé—´éš”æ˜¯å¤šå°‘ã€‚ æœ‰äº†è¿™ä¸ªç”Ÿæˆé—´éš”ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ˜“åœ°å¾—åˆ°ä¸¤ä¸ªæ•°æ®ï¼š 1. ç”Ÿæˆ N ä¸ªæ–°çš„ Token ä¸€å…±éœ€è¦å¤šä¹…ã€‚time/rate ä¸­å¯¹åº”çš„å®ç°å‡½æ•°ä¸º durationFromTokensã€‚ 2. ç»™å®šä¸€æ®µæ—¶é•¿ï¼Œè¿™æ®µæ—¶é—´ä¸€å…±å¯ä»¥ç”Ÿæˆå¤šå°‘ä¸ª Tokenã€‚time/rate ä¸­å¯¹åº”çš„å®ç°å‡½æ•°ä¸º tokensFromDurationã€‚ é‚£ä¹ˆï¼Œæœ‰äº†è¿™äº›è½¬æ¢å‡½æ•°ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±å¾ˆæ¸…æ™°äº†ï¼Œå¦‚ä¸‹ï¼š è®¡ç®—ä»ä¸Šæ¬¡å– Token çš„æ—¶é—´åˆ°å½“å‰æ—¶åˆ»ï¼ŒæœŸé—´ä¸€å…±æ–°äº§ç”Ÿäº†å¤šå°‘ Tokenï¼š æˆ‘ä»¬åªåœ¨å– Token ä¹‹å‰ç”Ÿæˆæ–°çš„ Tokenï¼Œä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡å– Token çš„é—´éš”ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç”Ÿæˆ Token çš„é—´éš”ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ tokensFromDuration, è½»æ˜“çš„ç®—å‡ºè¿™æ®µæ—¶é—´ä¸€å…±äº§ç”Ÿ Token çš„æ•°ç›®ã€‚ é‚£ä¹ˆï¼Œå½“å‰ Token æ•°ç›® = æ–°äº§ç”Ÿçš„ Token æ•°ç›® + ä¹‹å‰å‰©ä½™çš„ Token æ•°ç›® - è¦æ¶ˆè´¹çš„ Token æ•°ç›®ã€‚ å¦‚æœæ¶ˆè´¹åå‰©ä½™ Token æ•°ç›®å¤§äºé›¶ï¼Œè¯´æ˜æ­¤æ—¶ Token æ¡¶å†…ä»ä¸ä¸ºç©ºï¼Œæ­¤æ—¶ Token å……è¶³ï¼Œæ— éœ€è°ƒç”¨ä¾§ç­‰å¾…ã€‚ å¦‚æœ Token æ•°ç›®å°äºé›¶ï¼Œåˆ™éœ€ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ durationFromTokens å°†å½“å‰è´Ÿå€¼çš„ Token æ•°è½¬åŒ–ä¸ºéœ€è¦ç­‰å¾…çš„æ—¶é—´ã€‚ å°†éœ€è¦ç­‰å¾…çš„æ—¶é—´ç­‰ç›¸å…³ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹ã€‚ ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå…¶å®æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ©ç”¨äº† Token æ•°å¯ä»¥å’Œæ—¶é—´ç›¸äº’è½¬åŒ– çš„åŸç†ã€‚è€Œå¦‚æœ Token æ•°ä¸ºè´Ÿï¼Œåˆ™éœ€è¦ç­‰å¾…ç›¸åº”æ—¶é—´å³å¯ã€‚ æ³¨æ„ å¦‚æœå½“æ¶ˆè´¹æ—¶ï¼ŒToken æ¡¶ä¸­çš„ Token æ•°ç›®å·²ç»ä¸ºè´Ÿå€¼äº†ï¼Œä¾ç„¶å¯ä»¥æŒ‰ç…§ä¸Šè¿°æµç¨‹è¿›è¡Œæ¶ˆè´¹ã€‚éšç€è´Ÿå€¼è¶Šæ¥è¶Šå°ï¼Œç­‰å¾…çš„æ—¶é—´å°†ä¼šè¶Šæ¥è¶Šé•¿ã€‚ ä»ç»“æœæ¥çœ‹ï¼Œè¿™ä¸ªè¡Œä¸ºè·Ÿç”¨ Timer+BlockQueue å®ç°æ˜¯ä¸€æ ·çš„ã€‚ æ­¤å¤–ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ›´æ–°ä»¤ç‰Œæ¡¶ç›¸å…³æ•°æ®æ—¶éƒ½ç”¨äº† mutex åŠ é”ã€‚ æˆ‘ä»¬æ¨¡æ‹Ÿä¸‹è¯·æ±‚ä¸ Token æ•°å˜åŒ–çš„å…³ç³»ï¼š å½“æŸä¸€æ—¶é—´ï¼Œæ¡¶å†… Token æ•°ä¸º 3, æ­¤æ—¶ A çº¿ç¨‹è¯·æ±‚ 5 ä¸ª Tokenã€‚é‚£ä¹ˆæ­¤æ—¶æ¡¶å†… Token ä¸è¶³ï¼Œå› æ­¤ A çº¿ç¨‹éœ€è¦ç­‰å¾… 2 ä¸ª Token çš„æ—¶é—´ã€‚ ä¸”æ­¤æ—¶æ¡¶å†… Token æ•°å˜ä¸º - 2ã€‚ åŒæ—¶ï¼ŒB çº¿ç¨‹è¯·æ±‚ 4 ä¸ª Tokenï¼Œæ­¤æ—¶æ¡¶å†… Token æ•°ä¸º - 2ï¼Œå› æ­¤ B çº¿ç¨‹éœ€è¦ç­‰å¾… 2+4=6 ä¸ª Token çš„æ—¶é—´ï¼Œä¸”æ­¤æ—¶æ¡¶å†… Token æ•°å˜ä¸º - 6ã€‚ å¯¹äº Allow å‡½æ•°å®ç°æ—¶ï¼Œåªè¦åˆ¤æ–­éœ€è¦ç­‰å¾…çš„æ—¶é—´æ˜¯å¦ä¸º 0 å³å¯ï¼Œå¦‚æœå¤§äº 0 è¯´æ˜éœ€è¦ç­‰å¾…ï¼Œåˆ™è¿”å› Falseï¼Œåä¹‹è¿”å› Trueã€‚ å¯¹äº Wait å‡½æ•°ï¼Œç›´æ¥ t := time.NewTimer(delay)ï¼Œç­‰å¾…å¯¹åº”çš„æ—¶é—´å³å¯ã€‚ float ç²¾åº¦é—®é¢˜ä»ä¸Šé¢åŸç†è®²è¿°å¯ä»¥çœ‹å‡ºï¼Œåœ¨ Token å’Œæ—¶é—´çš„ç›¸äº’è½¬åŒ–å‡½æ•° durationFromTokens å’Œ tokensFromDuration ä¸­ï¼Œæ¶‰åŠåˆ° float64 çš„ä¹˜é™¤è¿ç®—ã€‚ ä¸€è°ˆåˆ° float çš„ä¹˜é™¤ï¼Œæˆ‘ä»¬å°±éœ€è¦å°å¿ƒç²¾åº¦é—®é¢˜äº†ã€‚ è€Œ Golang åœ¨è¿™é‡Œä¹Ÿè¸©äº†å‘ï¼Œä»¥ä¸‹æ˜¯ tokensFromDuration æœ€åˆçš„å®ç°ç‰ˆæœ¬ func (limit Limit) tokensFromDuration(d time.Duration) float64 { return d.Seconds() * float64(limit) } è¿™ä¸ªæ“ä½œçœ‹èµ·æ¥ä¸€ç‚¹é—®é¢˜éƒ½æ²¡ï¼šæ¯ç§’ç”Ÿæˆçš„ Token æ•°ä¹˜äºç§’æ•°ã€‚ ç„¶è€Œï¼Œè¿™é‡Œçš„é—®é¢˜åœ¨äºï¼Œd.Seconds() å·²ç»æ˜¯å°æ•°äº†ã€‚ä¸¤ä¸ªå°æ•°ç›¸ä¹˜ï¼Œä¼šå¸¦æ¥ç²¾åº¦çš„æŸå¤±ã€‚ æ‰€ä»¥å°±æœ‰äº†è¿™ä¸ª issue:golang.org/issues/34861ã€‚ ä¿®æ”¹åæ–°çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š func (limit Limit) tokensFromDuration(d time.Duration) float64 { sec := float64(d/time.Second) * float64(limit) nsec := float64(d%time.Second) * float64(limit) return sec + nsec/1e9 } time.Duration æ˜¯ int64 çš„åˆ«åï¼Œä»£è¡¨çº³ç§’ã€‚åˆ†åˆ«æ±‚å‡ºç§’çš„æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼Œè¿›è¡Œç›¸ä¹˜åå†ç›¸åŠ ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°æœ€ç²¾ç¡®çš„ç²¾åº¦ã€‚ æ•°å€¼æº¢å‡ºé—®é¢˜æˆ‘ä»¬è®² reserveN å‡½æ•°çš„å…·ä½“å®ç°æ—¶ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è®¡ç®—ä»å½“å‰æ—¶é—´åˆ°ä¸Šæ¬¡å– Token çš„æ—¶åˆ»ï¼ŒæœŸé—´ä¸€å…±æ–°äº§ç”Ÿäº†å¤šå°‘ Tokenï¼ŒåŒæ—¶ä¹Ÿå¯å¾—å‡ºå½“å‰çš„ Token æ˜¯å¤šå°‘ã€‚ æˆ‘æœ€å¼€å§‹çš„ç†è§£æ˜¯ï¼Œç›´æ¥å¯ä»¥è¿™ä¹ˆåšï¼š // elapsed è¡¨ç¤ºè¿‡å»çš„æ—¶é—´å·® elapsed := now.Sub(lim.last) // delta è¡¨ç¤ºè¿™æ®µæ—¶é—´ä¸€å…±æ–°äº§ç”Ÿäº†å¤šå°‘ Token delta = tokensFromDuration(now.Sub(lim.last)) tokens := lim.tokens + delta if(token\u003e lim.burst){ token = lim.burst } å…¶ä¸­ï¼Œlim.tokens æ˜¯å½“å‰å‰©ä½™çš„ Tokenï¼Œlim.last æ˜¯ä¸Šæ¬¡å– token çš„æ—¶åˆ»ã€‚lim.burst æ˜¯ Token æ¡¶çš„å¤§å°ã€‚ ä½¿ç”¨ tokensFromDuration è®¡ç®—å‡ºæ–°ç”Ÿæˆäº†å¤šå°‘ Tokenï¼Œç´¯åŠ èµ·æ¥åï¼Œä¸èƒ½è¶…è¿‡æ¡¶çš„å®¹é‡å³å¯ã€‚ è¿™ä¹ˆåšçœ‹èµ·æ¥ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œç„¶è€Œå¹¶ä¸æ˜¯è¿™æ ·ã€‚ åœ¨ time/rate é‡Œé¢æ˜¯è¿™ä¹ˆåšçš„ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š maxElapsed := lim.limit.durationFromTokens(float64(lim.burst) - lim.tokens) elapsed := now.Sub(last) if elapsed \u003e maxElapsed { elapsed = maxElapsed } delta := lim.limit.tokensFromDuration(elapsed) tokens := lim.tokens + delta if burst := float64(lim.burst); tokens \u003e burst { tokens = burst } ä¸æˆ‘ä»¬æœ€å¼€å§‹çš„ä»£ç ä¸ä¸€æ ·çš„æ˜¯ï¼Œå®ƒæ²¡æœ‰ç›´æ¥ç”¨ now.Sub(lim.last) æ¥è½¬åŒ–ä¸ºå¯¹åº”çš„ Token æ•°ï¼Œè€Œæ˜¯ å…ˆç”¨ lim.limit.durationFromTokens(float64(lim.burst) - lim.tokens)ï¼Œè®¡ç®—æŠŠæ¡¶å¡«æ»¡çš„æ—¶é—´ maxElapsedã€‚ å– elapsed å’Œ maxElapsed çš„æœ€å°å€¼ã€‚ è¿™ä¹ˆåšç®—å‡ºçš„ç»“æœè‚¯å®šæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿™ä¹ˆåšç›¸æ¯”äºæˆ‘ä»¬çš„åšæ³•ï¼Œå¥½å¤„åœ¨å“ªé‡Œï¼Ÿ å¯¹äºæˆ‘ä»¬çš„ä»£ç ï¼Œå½“ last éå¸¸å°çš„æ—¶å€™ï¼ˆæˆ–è€…å½“å…¶ä¸ºåˆå§‹å€¼ 0 çš„æ—¶å€™ï¼‰ï¼Œæ­¤æ—¶ now.Sub(lim.last) çš„å€¼å°±ä¼šéå¸¸å¤§ï¼Œå¦‚æœ lim.limit å³æ¯ç§’ç”Ÿæˆçš„ Token æ•°ç›®ä¹Ÿéå¸¸å¤§æ—¶ï¼Œç›´æ¥å°†äºŒè€…è¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œç»“æœæœ‰å¯èƒ½ä¼šæº¢å‡ºã€‚ å› æ­¤ï¼Œtime/rate å…ˆè®¡ç®—äº†æŠŠæ¡¶å¡«æ»¡çš„æ—¶é—´ï¼Œå°†å…¶ä½œä¸ºæ—¶é—´å·®å€¼çš„ä¸Šé™ï¼Œè¿™æ ·å°±è§„é¿äº†æº¢å‡ºçš„é—®é¢˜ã€‚ Token çš„å½’è¿˜è€Œå¯¹äº Reserve å‡½æ•°ï¼Œè¿”å›çš„","date":"2021-03-03","objectID":"/posts/golang%E6%A0%87%E5%87%86%E5%BA%93%E9%99%90%E6%B5%81%E5%99%A8timerate%E5%AE%9E%E7%8E%B0%E5%89%96%E6%9E%90/:0:0","tags":["Goæ ‡å‡†åº“"],"title":"Golangæ ‡å‡†åº“é™æµå™¨timerateå®ç°å‰–æ","uri":"/posts/golang%E6%A0%87%E5%87%86%E5%BA%93%E9%99%90%E6%B5%81%E5%99%A8timerate%E5%AE%9E%E7%8E%B0%E5%89%96%E6%9E%90/"},{"categories":null,"content":"ä¸ªäººåšå®¢ï¼Œçå†™å†™ OTG ","date":"2021-03-03","objectID":"/about/:0:0","tags":null,"title":"å…³äº","uri":"/about/"}]