<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
  <channel>
    <title>æ‰€æœ‰æ–‡ç«  - RoninZc çš„ä¸ªäººåšå®¢</title>
    <link>https://ronin-zc.com/posts/</link>
    <description>æ‰€æœ‰æ–‡ç«  | RoninZc çš„ä¸ªäººåšå®¢</description>
    <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>devroninzc@gmail.com (RoninZc)</managingEditor>
      <webMaster>devroninzc@gmail.com (RoninZc)</webMaster><lastBuildDate>Tue, 04 Apr 2023 23:02:13 &#43;0800</lastBuildDate><atom:link href="https://ronin-zc.com/posts/" rel="self" type="application/rss+xml" /><item>
  <title>Mac ARM åŒ…æŸåä¿®å¤</title>
  <link>https://ronin-zc.com/mac-arm-%E5%8C%85%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D/</link>
  <pubDate>Tue, 04 Apr 2023 23:02:13 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/mac-arm-%E5%8C%85%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D/</guid>
  <description><![CDATA[<p>ä¹‹å‰ä¸‹è½½çš„ CFW å’Œ PicGo çš„ ARM ç‰ˆæœ¬ä¸€ç›´æç¤ºæŸåğŸ˜«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo xattr -d com.apple.quarantine <span class="s2">&#34;/Applications/Clash for Windows.app&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œå®Œæˆé‡æ–°æ‰“å¼€å³å¯</p>
]]></description>
</item><item>
  <title>CFW ä¸ªäººä½¿ç”¨è®°å½•</title>
  <link>https://ronin-zc.com/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</link>
  <pubDate>Tue, 04 Apr 2023 22:18:13 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/cfw%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</guid>
  <description><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘ä¸€ç›´åœ¨æŠ˜è…¾å…³äº Clash ç›¸å…³çš„å†…å®¹ï¼Œä¸€ç›´æ²¡ä»”ç»†äº†è§£å…·ä½“çš„åŠŸèƒ½</p>
<p>æ­£å¥½æœ‰ç‚¹æ—¶é—´ä¸Šç½‘å†²æµªğŸ„ï¼ˆä¸æ˜¯æ‘¸é±¼ï¼‰</p>
<p>ä¹Ÿå› ä¸º mac ä½¿ç”¨ doh ç”¨ cloudflared ä¸€ç›´ä¸ç¨³å®šï¼Œæ— æ³•æ­£å¸¸è§£æå¯¼è‡´æœ‰ç‚¹çƒ¦èº</p>
<p>ä¸€ä¸åšäºŒä¸ä¼‘å°è¯•ä¸€ä¸‹ CFW çš„ TUN æ¨¡å¼</p>
<h2 id="æ“ä½œ">æ“ä½œ</h2>
<blockquote>
<p><a
  href="https://github.com/Fndroid/clash_for_windows_pkg"
  
  
    
    
    target="_blank"
  
  
    rel="external nofollow noopener noreferrer"
  
  
  
>Fndroid/clash_for_windows_pkg (github.com)</a></p>
<p>CFW ç‰ˆæœ¬ v0.20.19</p>
</blockquote>
<h3 id="1å®‰è£…-service">1ã€å®‰è£… Service</h3>
<p>ä¹Ÿå°±æ˜¯å·¦è¾¹èœå•ä¸Šçš„ General -&gt; Service Modelï¼Œç‚¹å‡»å³ä¾§çš„ Manage å†ç‚¹å‡» install å³å¯ï¼Œå¦‚ä¹‹å‰å·²ç»å®‰è£…è¿‡å¯ç‚¹å‡» update</p>
<p>æ­¤æ—¶ Service Mode å³ä¾§çš„å°åœ°çƒå˜ç»¿äº†ï¼Œå°±ä»£è¡¨ä½ <del>ç»¿</del>å®‰è£…æˆåŠŸäº†</p>
<p></p>
<h3 id="2mixin-é…ç½®">2ã€Mixin é…ç½®</h3>
<p>ä¸‹é¢ç»™å‡ºæˆ‘è‡ªå·±å¸¸ç”¨çš„ Mixin é…ç½®</p>
<p>ç‚¹å‡» Mixin å³ä¾§çš„å°é½¿è½® âš™ï¸ï¼Œåœ¨å¼¹å‡ºçš„ç¼–è¾‘å™¨é‡Œå°†ä¸‹åˆ—å†…å®¹ç›´æ¥å…¨éƒ¨ç²˜è´´å¤åˆ¶</p>
<p>æ³¨æ„é…ç½®ç”Ÿæ•ˆéœ€è¦å¼€å…³ä¸€æ¬¡ Mixin æ¨¡å¼ï¼Œä¹Ÿå¯ç‚¹å‡» Clash Core å³ä¾§çš„èŠ¯ç‰‡æŒ‰é’®ï¼ˆå¯èƒ½ï¼‰å¯ä»¥æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">mixin</span><span class="p">:</span><span class="w"> </span><span class="c"># Mixin é…ç½®æ–‡ä»¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># DNSæœåŠ¡å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">dns</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># å¼€å¯Clashå†…ç½®DNSæœåŠ¡å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># é»˜è®¤ä¸ºfalse</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># ä½¿ç”¨ ipv6 è§£æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># é»˜è®¤ä¸º false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># DNS ç›‘å¬ç«¯å£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">listen</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.0.0</span><span class="p">:</span><span class="m">53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># è§£ænameserverå’Œfallbackçš„DNSæœåŠ¡å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># å¡«å…¥çº¯IPçš„DNSæœåŠ¡å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">default-nameserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">114.114.114.114</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">119.29.29.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">223.5.5.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">223.6.6.6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8.8.8.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8.8.4.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">4.2.2.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">4.2.2.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.1.1.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># æ¨¡å¼fake-ip  or  redir-host</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enhanced-mode</span><span class="p">:</span><span class="w"> </span><span class="l">fake-ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># ä½¿ç”¨æœ¬åœ° hosts æ–‡ä»¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">use-hosts</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nameserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># è…¾è®¯DoH DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://doh.pub/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://sm2.doh.pub/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># è…¾è®¯DoT DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">tls://dot.pub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># é˜¿é‡ŒDoH DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://dns.alidns.com/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># é˜¿é‡ŒDoT DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">tls://dns.alidns.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 360 DoH DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://doh.360.cn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 360 DoT DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">tls://dot.360.cn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">fallback</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Google DoH DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://dns.google/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Google DoT DNS Serveråœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">tls://dns.google</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># fake-ipä»…æœ‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">fake-ip-filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*.lan&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*.local&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*.localhost&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*.msftconnecttest.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*.msftncsi.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">msftconnecttest.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">msftncsi.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># fake-ipä»…æœ‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">fallback-filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">geoip</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">geoip-code</span><span class="p">:</span><span class="w"> </span><span class="l">CN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ipcidr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">0.0.0.0</span><span class="l">/8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">10.0.0.0</span><span class="l">/8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">100.64.0.0</span><span class="l">/10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">127.0.0.0</span><span class="l">/8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">169.254.0.0</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">172.16.0.0</span><span class="l">/12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">192.0.0.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">192.0.2.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">192.168.0.0</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">192.88.99.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">198.18.0.0</span><span class="l">/15</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">198.51.100.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">203.0.113.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">224.0.0.0</span><span class="l">/4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">240.0.0.0</span><span class="l">/4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">255.255.255.255</span><span class="l">/32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">domain</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;+.facebook.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;+.google.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;+.youtube.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tun</span><span class="p">:</span><span class="w"> </span><span class="c"># Tun é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c"># å¯ç”¨ Tun æ¨¡å¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">stack</span><span class="p">:</span><span class="w"> </span><span class="l">system</span><span class="w"> </span><span class="c"># gvisor/system ä½¿ç”¨ system stack è¯·æŒ‰ç…§æœ¬æ–‡åé¢é˜²ç«å¢™æ”¾è¡Œç¨‹åº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">dns-hijack</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">198.18.0.2</span><span class="p">:</span><span class="m">53</span><span class="w"> </span><span class="c"># æœ¬åœ°åŠ«æŒ DNS åœ°å€ï¼Œæ— éœ€ä¿®æ”¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">auto-route</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">auto-detect-interface</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c"># è‡ªåŠ¨æ£€æµ‹å‡ºå£ç½‘å¡</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3ä½¿ç”¨">3ã€ä½¿ç”¨</h3>
<p>åœ¨æ§åˆ¶å°ä¸­ <code>ping google.com</code></p>
<p></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»è¢«ä»£ç†åˆ° fake-ip ï¼Œå†æ‰§è¡Œ <code>curl google -v</code></p>
<p></p>
<p>æ­å–œä½ å·²ç»æˆåŠŸäº†ï½</p>
]]></description>
</item><item>
  <title>MacOSä½¿ç”¨DoH</title>
  <link>https://ronin-zc.com/macos%E4%BD%BF%E7%94%A8doh/</link>
  <pubDate>Wed, 08 Feb 2023 13:45:00 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/macos%E4%BD%BF%E7%94%A8doh/</guid>
  <description><![CDATA[<h3 id="å®‰è£…-homebrewå·²æœ‰åˆ™å¿½ç•¥">å®‰è£… HomeBrewï¼ˆå·²æœ‰åˆ™å¿½ç•¥ï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/bin/bash -c <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh<span class="k">)</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…-cloudflared">å®‰è£… cloudflared</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install cloudflare/cloudflare/cloudflared
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶">åˆ›å»ºé…ç½®æ–‡ä»¶</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /usr/local/etc/cloudflared
</span></span><span class="line"><span class="cl">vim /usr/local/etc/cloudflared/config.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">proxy-dns</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxy-dns-upstream</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">https://doh.pub/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">https://1.1.1.1/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">https://1.0.0.1/dns-query</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯é»˜è®¤ DNSPod çš„ DoH æœåŠ¡
ä¸‹åˆ—ä¸¤ä¸ªæ˜¯ Cloudflare æä¾›çš„ DoH æœåŠ¡ç”¨äºå†—ä½™</p>
</blockquote>
<h3 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cloudflared service install
</span></span><span class="line"><span class="cl">// ä¹‹åä¸æƒ³ä½¿ç”¨çš„è¯å¯ä»¥æ‰§è¡Œ sudo cloudflared service uninstall
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¿®æ”¹æœ¬æœºè®¾å®š">ä¿®æ”¹æœ¬æœºè®¾å®š</h3>
<p>ã€Œç³»ç»Ÿè®¾ç½®ã€-&gt;ã€ŒWi-Fiã€-&gt;ã€Œè¯¦ç»†ä¿¡æ¯ã€-&gt;ã€ŒDNSã€</p>
<p></p>
<p></p>
<h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dig ronin-zc.com
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ç›¸åº”è¯·æ±‚çš„ DNS æœåŠ¡å™¨ ip</p>
]]></description>
</item><item>
  <title>Docker éƒ¨ç½² Nginx å‡ºç°ã€Œhost not found in upstreamã€é—®é¢˜è§£å†³</title>
  <link>https://ronin-zc.com/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</link>
  <pubDate>Wed, 20 Jul 2022 15:17:19 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/docker%E9%83%A8%E7%BD%B2nginx%E5%87%BA%E7%8E%B0host-not-found-in-upstream%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</guid>
  <description><![CDATA[<h2 id="é—®é¢˜">é—®é¢˜</h2>
<p>è¿™ä¸ªé—®é¢˜æ˜¯æœ¬äººåœ¨æŠ˜è…¾è‡ªå·±çš„<del>è‰¯å¿ƒäº‘</del>ï¼ˆå‡‰å¿ƒäº‘ï¼‰çš„æ—¶å€™å‘ç°çš„ï¼Œå½“æ—¶æ˜¯æƒ³ä½¿ç”¨ä¸€ä¸ªå‰ç½® Nginx è½¬å‘æ‰€æœ‰çš„è¯·æ±‚ï¼ŒåŒæ—¶è¿›è¡Œæ—¥å¿—çš„è®°å½•ç­‰ç­‰ã€‚</p>
<p>å½“æˆ‘å†™å®Œé…ç½®æ–‡ä»¶ï¼Œæµ‹è¯•æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯å½“æˆ‘å…³é—­äº†è‡ªå·±æ­å»ºçš„ es æœåŠ¡ï¼Œæˆ‘å‘ç°æˆ‘è®¿é—®æ‰€æœ‰çš„æœåŠ¡éƒ½ 500 äº†ï¼Œè¿™æ—¶æˆ‘æŸ¥çœ‹ nginx error æ—¥å¿—ï¼Œè®°å½•å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[emerg] 1#1: host not found in upstream &#34;es&#34; in /etc/nginx/conf.d/es.conf:13
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è§£å†³">è§£å†³</h2>
<p>åœ¨ nginx çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kn">server_name</span> <span class="s">test.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># æ·»åŠ é¢å¤–çš„ dns è§£æåœ°å€ï¼Œæ­¤åœ°å€ä¸º docker å†…éƒ¨ dns åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># å½“ proxy_pass ä¸ºå˜é‡æ—¶ å¿…é¡»æ·»åŠ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kn">resolver</span> <span class="mi">127</span><span class="s">.0.0.11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">set</span> <span class="nv">$tmp</span> <span class="s">es</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">http://</span><span class="nv">$tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŸç†">åŸç†</h3>
<p>nginx å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å…¶é…ç½®çš„ upstream è¿›è¡Œ DNS è§£ææµ‹è¯•ï¼Œå¦‚æœæ— æ³•è§£ææˆåŠŸåˆ™ä¼šæŠ¥é”™æ— æ³•å¯åŠ¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°† upstream ä¿®æ”¹ä¸º<strong>å˜é‡</strong>æ—¶ï¼Œnginx ä¸ä¼šè¿›è¡Œæµ‹è¯•ï¼Œä»¥æ­¤ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>resolver åˆ™ä¸º Nginx è®¾ç½® DNS æœåŠ¡å™¨ï¼ŒNginxä¼šåŠ¨æ€åˆ©ç”¨ resolver è®¾ç½®çš„DNSæœåŠ¡å™¨ï¼ˆæœ¬æœºè®¾ç½®çš„ DNS æœåŠ¡å™¨æˆ– /etc/hosts æ— æ•ˆï¼‰ï¼Œå°†åŸŸåè§£ææˆ IPï¼Œproxy æ¨¡å—ä¼šå°†è¯·æ±‚è½¬å‘åˆ°è§£æåçš„IPä¸Šã€‚</p>
<p>å¦‚æœä¸æ·»åŠ çš„è¯ï¼Œè®¿é—®å°†ä¼š<code>502 Bad Gateway</code>ï¼ŒåŒæ—¶æ—¥å¿—ä¼šæ˜¾ç¤º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">no resolver defined to resolve es
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
  <title>K8Så­¦ä¹ ç¬”è®°</title>
  <link>https://ronin-zc.com/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</link>
  <pubDate>Tue, 07 Jun 2022 10:45:00 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/k8s%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</guid>
  <description><![CDATA[<blockquote>
<p>è¿™ç¯‡æ–‡ç« ç”¨ä½œè‡ªå·±å­¦ä¹  k8s çš„ç¬”è®°ï¼Œå­¦ä¹ çš„èµ„æ–™ä¸ºbç«™çš„è§†é¢‘</p>
<p><a
  href="https://www.bilibili.com/video/BV1Hq4y1y7rL"
  
  
    
    
    target="_blank"
  
  
    rel="external nofollow noopener noreferrer"
  
  
  
>2021 å¹´æœ«å€¾åŠ›æ‰“é€  Kubernetes å…¥é—¨è‡³ç²¾é€š - 2022 å¹´å¹¸ç¦çš„å¼€èƒƒèœ_å“”å“©å“”å“©_bilibili</a></p>
<p>æœ¬æ–‡ç« ä¸ºæœ¬äººå­¦ä¹ æ‰€ç”¨ï¼Œå¦‚éœ€è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>
</blockquote>
<h2 id="1åŸºç¡€æ¦‚å¿µ">1ã€åŸºç¡€æ¦‚å¿µ</h2>
<p></p>
<ul>
<li>åŸºç¡€ç»„ä»¶
<ol>
<li>kubectl</li>
<li>api server</li>
<li>scheduler</li>
<li>replication controller</li>
<li>etcd</li>
<li>kubelet</li>
<li>kube proxy</li>
<li>firewall</li>
</ol>
</li>
<li>æ’ä»¶
<ol>
<li>CoreDNS è´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾› DNS æœåŠ¡</li>
<li>Ingress Controller ä¸º k8s ä¸­çš„æœåŠ¡æä¾›å¤–ç½‘å…¥å£</li>
<li>Prometheus ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›èµ„æºç›‘æ§èƒ½åŠ›ï¼Œæ—¶åºæ•°æ®åº“</li>
<li>Dashboard æä¾› B/S çš„è®¿é—®ä½“ç³»ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ web è¿›è¡Œé›†ç¾¤ç®¡ç†å’Œè®¾ç½®ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å¦‚ï¼šrancher</li>
<li>Federation æä¾›è·¨å¯ç”¨åŒºçš„é›†ç¾¤ï¼Œæä¾›ä¸åŒæ•°æ®ä¸­å¿ƒçš„ K8S é›†ç¾¤çš„ç®¡ç†èƒ½åŠ›</li>
</ol>
</li>
</ul>
<h2 id="2pod">2ã€Pod</h2>
<p>åœ¨ä¸‹è¾¾åˆ›å»º pod çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªè¢«åˆå§‹åŒ–çš„å®¹å™¨ä¸º<code>pause</code>ï¼Œä½œç”¨ä¸ºåˆå§‹åŒ–ç½‘ç»œæ ˆï¼ŒæŒ‚è½½å­˜å‚¨å·ç­‰ã€‚åç»­ç»§ç»­åˆ›å»ºå¯¹åº”çš„ containerï¼Œè¿™äº›åˆ›å»ºçš„ container éƒ½ä¼šä¸åˆå§‹å®¹å™¨<code>pause</code> å…±äº«ç½‘ç»œæ ˆå’Œå­˜å‚¨ç­‰ï¼Œç±»ä¼¼ docker ä¸­çš„<code>--net</code>å’Œ<code>--volumes-from</code>ã€‚è¿™æ ·åœ¨ä¸€ä¸ª Pod ä¸­çš„ container å¯ä»¥ç›´æ¥é€šè¿‡å›ç¯æ¥å£ç›¸äº’è®¿é—®ã€‚</p>
<h3 id="podç§ç±»">Podç§ç±»</h3>
<ol>
<li>
<p>è‡ªä¸»å¼ Pod</p>
</li>
<li>
<p>æ§åˆ¶å™¨ç®¡ç†çš„ Podï¼ˆæ¨èï¼‰</p>
<ul>
<li>ReplicationController &amp; ReplicaSet &amp; Deployment
<ul>
<li>HPAï¼ˆHorizontalPodAutoScaleï¼‰</li>
</ul>
</li>
<li>StatefullSet</li>
<li>DarmonSet</li>
<li>Job &amp; Cronjob</li>
<li>è‡ªå®šä¹‰æ§åˆ¶å™¨&hellip; ä¸åšè®¨è®º</li>
</ul>
</li>
</ol>
<h3 id="æ§åˆ¶å™¨ç§ç±»">æ§åˆ¶å™¨ç§ç±»</h3>
<h4 id="replication-controller-rc-replicasetrs--deployment">Replication Controller ï¼ˆRCï¼‰&amp; ReplicaSetï¼ˆRSï¼‰ &amp; Deployment</h4>
<p>ç”¨æ¥ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod æ¥æ›¿ä»£ï¼Œè€Œå¦‚æœå¼‚å¸¸å¤šå‡ºçš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ã€‚</p>
<p>åœ¨æ–°ç‰ˆæœ¬çš„ K8S ä¸­å»ºè®®ä½¿ç”¨ RS æ¥å–ä»£ RCã€‚</p>
<p>RS çš„æœ¬è´¨å’Œ RC æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œå¹¶ä¸” RS æ”¯æŒé›†åˆå¼çš„æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆtag selectorï¼‰ã€‚</p>
<p>è™½ç„¶ RS å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬å»ºè®®ä½¿ç”¨ Deployment æ¥è‡ªåŠ¨ç®¡ç† RSï¼Œè¿™æ ·å¯ä»¥æ— éœ€æ‹…å¿ƒå’Œå…¶ä»–æœºåˆ¶ä¸å…¼å®¹çš„é—®é¢˜ã€‚æ¯”å¦‚ RS ä¸æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼ˆrolling-updateï¼‰ä½† Deployment æ”¯æŒã€‚</p>
<h5 id="æ»šåŠ¨æ›´æ–°">æ»šåŠ¨æ›´æ–°</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ›´æ–°å‰</span>
</span></span><span class="line"><span class="cl">Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€
</span></span><span class="line"><span class="cl">â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š3ã€
</span></span><span class="line"><span class="cl">		â”œâ”€ Pod:v1
</span></span><span class="line"><span class="cl">		â”œâ”€ Pod:v1
</span></span><span class="line"><span class="cl">		â””â”€ Pod:v1
</span></span><span class="line"><span class="cl"><span class="c1"># æ›´æ–°Podæ¨¡æ¿:v2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ›´æ–°ä¸­ï¼š</span>
</span></span><span class="line"><span class="cl">Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€
</span></span><span class="line"><span class="cl">â”œâ”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š2ã€
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€â”€ Pod:v1
</span></span><span class="line"><span class="cl">â”‚  â””â”€â”€ Pod:v1
</span></span><span class="line"><span class="cl">â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š1ã€
</span></span><span class="line"><span class="cl">	 â””â”€ Pod:v2
</span></span><span class="line"><span class="cl"><span class="c1"># æ›´æ–°å®Œæ¯•ï¼š</span>
</span></span><span class="line"><span class="cl">Deploymentã€ŒPodæ¨¡æ¿:v1ï¼Œå‰¯æœ¬æ•°é‡ï¼š3ã€
</span></span><span class="line"><span class="cl">â”œâ”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š0ã€
</span></span><span class="line"><span class="cl">â””â”€ RSã€Œå‰¯æœ¬æ•°é‡ï¼š3ã€
</span></span><span class="line"><span class="cl">		â”œâ”€ Pod:v2
</span></span><span class="line"><span class="cl">		â”œâ”€ Pod:v2
</span></span><span class="line"><span class="cl">		â””â”€ Pod:v2
</span></span><span class="line"><span class="cl">	 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ»šåŠ¨æ›´æ–°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ RS æ§åˆ¶å™¨ï¼Œä»¥æ­¤æ¥åˆ›å»ºæ–°ç‰ˆæœ¬çš„ Podï¼Œæ­¤æ—¶æŠŠè€ç‰ˆæœ¬çš„ RS æ§åˆ¶å™¨çš„æœŸæœ›æ•°é‡ä¸€ä¸ªä¸ªè°ƒæ•´è‡³0ï¼Œè¿™æ ·å°±å®Œæˆäº†æ»šåŠ¨æ›´æ–°ã€‚</p>
<h5 id="hpahorizontalpodautoscaleè‡ªåŠ¨æ‰©ç¼©å®¹">HPAï¼ˆHorizontalPodAutoScaleï¼‰è‡ªåŠ¨æ‰©ç¼©å®¹</h5>
<p>å¯ä»¥æ ¹æ® Pod çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œè°ƒæ•´å‰¯æœ¬æ•°é‡ï¼Œä¾èµ–äº RCã€RSã€Deployment ä¹‹ä¸Š</p>
<h4 id="statefulset">StatefulSet</h4>
<blockquote>
<p>æœåŠ¡åˆ†ç±»</p>
<ul>
<li>æœ‰çŠ¶æ€çš„æœåŠ¡</li>
<li>æ— çŠ¶æ€æœåŠ¡</li>
<li>ä¸­å¿ƒåŒ–æœåŠ¡</li>
<li>å»ä¸­å¿ƒåŒ–æœåŠ¡</li>
</ul>
</blockquote>
<p>ä¸ºäº†è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜è€Œè®¾è®¡å‡ºæ¥ï¼Œå¯ç”¨æ¥æœ‰åºæ‰©å®¹ç¼©ï¼Œå…¶åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ï¼Œå³ Pod é‡æ–°è°ƒåº¦åè¿˜æ˜¯èƒ½è®¿é—®åˆ°ç›¸åŒçš„æŒä¹…åŒ–æ•°æ®ï¼ŒåŸºäº PVC å®ç°</li>
<li>ç¨³å®šçš„ç½‘ç»œæ ‡å¿—ï¼Œå³ Pod é‡æ–°è°ƒåº¦åï¼Œå…¶ PodName å’Œ HostName ä¸å˜ï¼ŒåŸºäº Headless Serviceï¼ˆå³æ²¡æœ‰ Cluster IP çš„ Serviceï¼‰å®ç°</li>
<li>æœ‰åºéƒ¨ç½²ï¼Œæœ‰åºæ‰©å±•ï¼Œå³ Pod æ˜¯æœ‰é¡ºåºçš„ï¼Œåœ¨éƒ¨ç½²æˆ–è€…æ‰©å±•çš„æ—¶å€™è¦ä¾æ®å®šä¹‰çš„é¡ºåºä¾æ¬¡è¿›è¡Œï¼ˆå³ä» 0 åˆ° N-1ï¼Œåœ¨ä¸‹ä¸€ä¸ª Pod è¿è¡Œä¹‹å‰ï¼Œæ‰€æœ‰ä¹‹å‰çš„ Pod å¿…é¡»éƒ½æ˜¯ Running å’Œ Ready çŠ¶æ€ï¼‰ï¼ŒåŸºäº init containers æ¥å®ç°</li>
<li>æœ‰åºæ”¶ç¼©ï¼Œæœ‰åºåˆ é™¤ï¼ˆå³ N-1åˆ° 0ï¼‰</li>
</ul>
<h4 id="daemonset">DaemonSet</h4>
<p>ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰ Node åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Podã€‚å½“æœ‰ Node ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤æ‰€æœ‰ç”±å®ƒåˆ›å»ºçš„ Pod</p>
<p>ç»å…¸ç”¨æ³•ï¼š</p>
<ul>
<li>è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œ glusterdï¼Œceph</li>
<li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œæ—¥å¿—æ‰‹æœº deamonï¼Œä¾‹å¦‚ fluentdï¼Œlogstash</li>
<li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œç›‘æ§ deamonï¼Œä¾‹å¦‚ Prometheus Node Exporter</li>
</ul>
<h4 id="job--cronjob">Job &amp; cronJob</h4>
<p>Job è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ª Pod æˆåŠŸç»“æŸ</p>
<p>Cron Job ç®¡ç†åŸºäºæ—¶é—´çš„ Jobï¼Œå³ï¼š</p>
<ul>
<li>åœ¨ç»™å®šæ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡</li>
<li>å‘¨æœŸæ€§çš„åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ</li>
</ul>
<h3 id="ç½‘ç»œæ¨¡å‹">ç½‘ç»œæ¨¡å‹</h3>
<p>K8S çš„ç½‘ç»œæ¨¡å‹å‡å®šäº†æ‰€æœ‰ Pod éƒ½åœ¨ä¸€ä¸ªå¯ä»¥ç›´æ¥è¿é€šçš„æ‰å¹³çš„ç½‘ç»œç©ºé—´ä¸­ï¼Œè¿™åœ¨ GCEï¼ˆGoogle Compute Engineï¼‰é‡Œé¢æ˜¯ç°æˆçš„ç½‘ç»œæ¨¡å‹ï¼ŒK8S å‡å®šè¿™ä¸ªç½‘ç»œå·²ç»å­˜åœ¨ã€‚è€Œåœ¨ç§æœ‰äº‘é‡Œæ­å»º K8S é›†ç¾¤ï¼Œå°±ä¸èƒ½å‡å®šè¿™ä¸ªç½‘ç»œå·²ç»å­˜åœ¨äº†ã€‚æˆ‘ä»¬éœ€è¦<strong>è‡ªå·±å®ç°</strong>è¿™ä¸ªç½‘ç»œå‡è®¾ï¼Œå°†ä¸åŒèŠ‚ç‚¹ä¸Šçš„ Docker å®¹å™¨ä¹‹é—´çš„äº’ç›¸è®¿é—®å…ˆæ‰“é€šï¼Œç„¶åè¿è¡Œ K8Sã€‚</p>
<h4 id="flannel">Flannel</h4>
<p>Flannel æ˜¯ CoreOS å›¢é˜Ÿé’ˆå¯¹ Kubernetes è®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„ Docker å®¹å™¨éƒ½å…·æœ‰<strong>å…¨é›†ç¾¤å”¯ä¸€</strong>çš„è™šæ‹Ÿ IP åœ°å€ã€‚è€Œä¸”å®ƒè¿˜èƒ½åœ¨è¿™äº› IP åœ°å€ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¦†ç›–ç½‘ç»œï¼ˆOverlay Networkï¼‰ï¼Œé€šè¿‡è¿™ä¸ªè¦†ç›–ç½‘ç»œï¼Œå°†æ•°æ®åŒ…åŸå°ä¸åŠ¨åœ°ä¼ è¾“åˆ°ç›®æ ‡å®¹å™¨å†…ã€‚åŸºäº etcd å®ç°ã€‚</p>
<p></p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<ol>
<li>Flanneld å‘ etcd ç”³è¯·å½“å‰ Pod çš„ç½‘æ®µï¼Œä¿®æ”¹å½“å‰ Docker0 çš„IP
<ul>
<li>ä¼šå¸¦ä¸Šå½“å‰æœºå™¨çš„ç‰©ç†ç½‘å¡åœ°å€ï¼Œè¿™æ ·å°±åœ¨ etcd é‡Œæ ‡è¯†äº†è™šæ‹Ÿç½‘æ®µä¸çœŸå®IPä¹‹é—´çš„å…³ç³»</li>
<li>å½“ä¸€ä¸ª Pod å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡å¯¹æ–¹çš„è™šæ‹ŸIPå°±å¯ä»¥æ‰¾åˆ°çœŸå®IPäº†</li>
</ul>
</li>
<li>è¯·æ±‚æµè½¬ï¼ˆæ ¹æ®å›¾è§‚å¯Ÿï¼‰
<ol>
<li>app2 å‘é€ä¸€ä¸ªæ•°æ®åŒ…ç»™<code>10.1.20.3</code>ï¼Œå‘ç°æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ•°æ®åŒ…ä¼ é€’ç»™ç½‘å…³</li>
<li>æ­¤æ—¶æ•°æ®åŒ…è¢« Flanneld æ‰€æ•è·ï¼ˆFlannel0 ç›‘å¬çš„ä¸º 10.1.15.0ï¼Œæ³¨æ„è¿™ä¸ª0ï¼‰ä¼ é€’ç»™å¯¹åº”çš„å¦å¤–ä¸€ä¸ª Flanneldï¼ˆä»etcdè·å–ï¼‰
<ul>
<li>æ­¤æ—¶ Flanneld ä¼šå¯¹æ•°æ®åŒ…è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œç±»ä¼¼ä¸€ä¸ªå¿«é€’é‡Œæ˜¯å¦å¤–ä¸€ä¸ªå¿«é€’</li>
</ul>
</li>
<li>æ¥æ”¶åˆ°æ•°æ®åŒ…åè¿›è¡Œæ‹†åŒ…ï¼Œåœ¨å¯¹åº”çš„ Docker0 ä¸­å¹¿æ’­ï¼Œè¿™æ ·ä¹Ÿå°±èƒ½æ”¶åˆ°äº†</li>
</ol>
</li>
<li>å›åº”åŒç†</li>
</ol>
<h4 id="ç½‘ç»œé€šè®¯æ¨¡å¼">ç½‘ç»œé€šè®¯æ¨¡å¼</h4>
<ul>
<li>åŒ Pod é—´ä¸åŒå®¹å™¨é—´çš„ç½‘ç»œé€šè®¯ï¼šæœ¬åœ°å›ç¯</li>
<li>ä¸åŒ Pod é—´çš„é€šè®¯
<ul>
<li>åŒç‰©ç†æœºï¼šDocker0 ç½‘æ¡¥å®ç°æŠ¥æ–‡è½¬å‘</li>
<li>ä¸åŒç‰©ç†æœºï¼šflannel UDP æ•°æ®åŒ…äºŒæ¬¡å°è£…</li>
</ul>
</li>
<li>svc ç½‘ç»œä¸ Pod é—´çš„é€šè®¯</li>
<li>éš”ç¦»ï¼šnamespace network</li>
</ul>
<h2 id="3k8så®‰è£…">3ã€K8Så®‰è£…</h2>
<h3 id="å‰ç½®å‡†å¤‡">å‰ç½®å‡†å¤‡</h3>
<ol>
<li>
<p>å®‰è£…é…ç½®</p>
<ul>
<li>æ¨èå®‰è£…åœ¨å•ç½‘å¡æœºå™¨</li>
<li>CPU &gt;= 2ï¼Œå†…å­˜ 3G ä»¥ä¸Šï¼Œç£ç›˜ 100G</li>
<li>å…³é—­ SWAP</li>
<li>åˆ†åŒº
<ul>
<li>/boot 800m</li>
<li>/ å…¨éƒ¨</li>
</ul>
</li>
<li>seliunxï¼Œfirewall stopï¼Œiptable none</li>
</ul>
</li>
<li>
<p>K8Så®‰è£…3ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªè½¯è·¯ç”±ï¼ŒåŒç½‘å¡</p>
<ul>
<li>ç½‘å¡1: ä»…ä¸»æœº</li>
<li>ç½‘å¡2: NAT ä¸Šç½‘</li>
</ul>
</li>
<li>
<p>å®‰è£…å·¥å…·åŒ…ï¼ˆå¯é€‰ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install -y conntrack ntpdate ntp ipvsadm ipset iptables curl sysstat  wget net-tools git
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>åŒæ­¥æ—¶åŒº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt install ntpdate
</span></span><span class="line"><span class="cl">sudo ntpdate ntp.aliyun.com
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å…³é—­<code>swap</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo swapoff -a <span class="c1"># ä¸´æ—¶å…³é—­</span>
</span></span><span class="line"><span class="cl">sed -ri <span class="s1">&#39;s/.swap./#&amp;/&#39;</span> /etc/fstab <span class="c1"># æ°¸ä¹…å…³é—­</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å…è®¸ iptables æ¡¥æ¥æµé‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span class="line"><span class="cl"><span class="s">br_netfilter
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®ç½‘å¡å…è®¸è½¬å‘ ipv4 æµé‡</span>
</span></span><span class="line"><span class="cl">sudo sysctl -w net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo sysctl --system
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="å®‰è£…-kubernetes">å®‰è£… Kubernetes</h3>
<ul>
<li>æºç åŒ…ç¼–è¯‘å®‰è£…ï¼ˆéš¾åº¦è¿‡é«˜ï¼‰
<ul>
<li>å¯å‚è€ƒ<a
  href="https://cloudmessage.top/archives/2kubernetes%e5%ae%89%e8%a3%85md"
  
  
    
    
    target="_blank"
  
  
    rel="external nofollow noopener noreferrer"
  
  
  
>Kubernetes - äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£… - v1.18 (cloudmessage.top)</a></li>
</ul>
</li>
<li>å®¹å™¨åŒ–å®‰è£…
<ul>
<li>kubeadm å®˜æ–¹
<ul>
<li>è¯ä¹¦æœ‰æ•ˆæœŸ 1 å¹´ï¼ˆéœ€è¦ä¿®æ”¹æºç ï¼Œè®¾ç½®ç”Ÿæˆè¯ä¹¦æœ‰æ•ˆæ—¶é—´ï¼‰</li>
</ul>
</li>
<li>rancher</li>
<li>sealos</li>
</ul>
</li>
</ul>
<h4 id="1å®‰è£…å®¹å™¨ç»„ä»¶">1ã€å®‰è£…å®¹å™¨ç»„ä»¶</h4>
<ul>
<li>docker
<ul>
<li><a
  href="../ubuntu-arm-docker-%e5%ae%89%e8%a3%85/"
  
  
  
  
  
>ARM ç³»ç»Ÿå®‰è£…</a></li>
<li>X86_64 å¯å‚è€ƒä¸Šæ–‡ï¼Œæ³¨æ„ä¿®æ”¹å¯¹åº”ç³»ç»Ÿæ¶æ„å³å¯</li>
</ul>
</li>
<li>containerd k8s v1.24.0å <a
  href="../k8sv1.24.0-containerd%e5%ae%89%e8%a3%85%e6%95%99%e7%a8%8b"
  
  
  
  
  
>K8Sv1.24.0-containerdå®‰è£…æ•™ç¨‹</a></li>
</ul>
<h4 id="2å®‰è£…-kubeadm-ä¸»ä»é…ç½®">2ã€å®‰è£… Kubeadm ï¼ˆä¸»ä»é…ç½®ï¼‰</h4>
<blockquote>
<p>Kubeadm å¯åŠ¨æµç¨‹</p>
<p>Master
Systemd &gt; kubelet &gt; å®¹å™¨ç»„ä»¶ &gt; Kubernetes</p>
<p>å®¹å™¨ç»„ä»¶åœ¨ k8s v1.24.0 ç‰ˆæœ¬å·²å¼ƒç”¨ Docker shim
ä½¿ç”¨äº†æ–°ç»„ä»¶ CRI DOCKERD</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ·»åŠ é˜¿é‡Œäº‘é•œåƒæº</span>
</span></span><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y apt-transport-https
</span></span><span class="line"><span class="cl">sudo curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="p">|</span> sudo apt-key add - 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ é˜¿é‡Œäº‘æˆ–è€…å®˜æ–¹ api æº</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é˜¿é‡Œäº‘</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span class="line"><span class="cl"><span class="c1"># å®˜æ–¹</span>
</span></span><span class="line"><span class="cl">sudo curl -o /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg 
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…è½¯ä»¶</span>
</span></span><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y kubelet kubeadm kubectl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¼€æœºè‡ªå¯</span>
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> kubelet.service
</span></span><span class="line"><span class="cl"><span class="c1"># æ³¨æ„ï¼Œæ­¤æ—¶å¯èƒ½ kublet æ²¡æ­£å¸¸è¿è¡Œï¼Œä¸ç”¨ç®¡ç»§ç»­å¾€ä¸‹èµ°</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3åˆå§‹åŒ–ä¸»èŠ‚ç‚¹">3ã€åˆå§‹åŒ–ä¸»èŠ‚ç‚¹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ‰“å° kubeadm é»˜è®¤é…ç½®</span>
</span></span><span class="line"><span class="cl">sudo kubeadm config print init-defaults &gt; kubeadm-config.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹ï¼š`localAPIEndpoint.advertiseAddress`çš„å€¼ä¸ºå½“å‰ä¸»èŠ‚ç‚¹çš„ ip åœ°å€</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">localAPIEndpoint:
</span></span><span class="line"><span class="cl">  advertiseAddress: 1.2.3.4 <span class="c1"># è¿™é‡Œ</span>
</span></span><span class="line"><span class="cl">  bindPort: <span class="m">6443</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹ï¼š`nodeRegistration.name` çš„å€¼ä¸ºå½“å‰ä¸»èŠ‚ç‚¹åç§°</span>
</span></span><span class="line"><span class="cl">Â·Â·Â·
</span></span><span class="line"><span class="cl">nodeRegistration:
</span></span><span class="line"><span class="cl">  criSocket: unix:///var/run/containerd/containerd.sock
</span></span><span class="line"><span class="cl">  imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">  name: k8s-master01 <span class="c1"># è¿™é‡Œ</span>
</span></span><span class="line"><span class="cl">  taints: null
</span></span><span class="line"><span class="cl">Â·Â·Â·
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ  Pod ç½‘æ®µï¼ŒFlannel éœ€è¦å·¥ä½œåœ¨æŒ‡å®šçš„ç½‘æ®µ</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">networking:
</span></span><span class="line"><span class="cl">  dnsDomain: cluster.local
</span></span><span class="line"><span class="cl">  serviceSubnet: 10.96.0.0/12
</span></span><span class="line"><span class="cl">  podSubnet: 10.244.0.0/16 <span class="c1"># æ–°å¢è¯¥è¡Œ</span>
</span></span><span class="line"><span class="cl">Â·Â·Â·
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®è´Ÿè½½å‡è¡¡æ–¹å¼ä¸º ipvsï¼ˆå¯é€‰ï¼‰ï¼Œä¸‹åˆ—é…ç½®æ·»åŠ åˆ°æœ«å°¾ï¼Œæ³¨æ„ --- ä¹Ÿéœ€è¦æ·»åŠ </span>
</span></span><span class="line"><span class="cl">Â·Â·Â·
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: KubeProxyConfiguration
</span></span><span class="line"><span class="cl">featureGates:
</span></span><span class="line"><span class="cl">	SupportIPVSProxyMode: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">mode: ipvs
</span></span><span class="line"><span class="cl">Â·Â·Â·
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># k8s.gcr.io å›½å†…æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒåœ°å€</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/k8s.gcr.io/registry.cn-hangzhou.aliyuncs.com\/google_containers/g&#39;</span> kubeadm-config.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®æ–‡ä»¶å‡†å¤‡å®Œæ¯•ï¼Œå¼€å§‹åˆå§‹åŒ–</span>
</span></span><span class="line"><span class="cl">sudo kubeadm init --config<span class="o">=</span>kubeadm-config.yaml --ignore-preflight-errors<span class="o">=</span>all --v<span class="o">=</span><span class="m">5</span> <span class="p">|</span> tee kubeadm-init.log
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå§‹åŒ–æˆåŠŸæ ¹æ®é¡µé¢æç¤º</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># é root ç”¨æˆ·</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">  sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">  sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">  <span class="c1"># root ç”¨æˆ·</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">kubectl cluster-info
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4å·¥ä½œèŠ‚ç‚¹åŠ å…¥">4ã€å·¥ä½œèŠ‚ç‚¹åŠ å…¥</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åœ¨åˆå§‹åŒ–ä¸»èŠ‚ç‚¹æˆåŠŸåï¼Œæ‰“å°å‡ºçš„æ—¥å¿—å†…çš„æœ€åä¸€æ®µï¼Œå‘Šè¯‰äº†æˆ‘ä»¬åº”è¯¥å¦‚ä½•åŠ å…¥ä¸€ä¸ªä¸»èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä¹Ÿå¯ä»¥ cat kubeadm-init.log æŸ¥çœ‹</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å…¥å‰æŸ¥çœ‹å½“å‰ä¸»æœºåç§° hostnamectlï¼Œå¯ä»¥ä¿®æ”¹ä¸ºè‡ªå·±ä¾¿äºè¯†åˆ«çš„åç§°</span>
</span></span><span class="line"><span class="cl">sudo hostnamectl set-hostname k8s-node01 --static
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å…¥èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">sudo kubeadm join 192.168.31.100:6443 --token xxx.xxx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --discovery-token-ca-cert-hash sha256:xxx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœæç¤º unable to fetch the kubeadm-config ConfigMap: faild to get config map: Unauthorized</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™ä¸ªä»£è¡¨ token è¿‡æœŸï¼Œé‡æ–°ç”Ÿæˆå³å¯</span>
</span></span><span class="line"><span class="cl">sudo kubeadm token create --ttl <span class="m">0</span> --print-join-command
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœæç¤º</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [kubelet-check] Initial timeout of 40s passed.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># error execution phase kubelet-start: error uploading crisocket: timed out waiting for the condition</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To see the stack trace of this error execute with --v=5 or higher</span>
</span></span><span class="line"><span class="cl">sudo kubeadm reset -f
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5å·¥ä½œèŠ‚ç‚¹é€€å‡º">5ã€å·¥ä½œèŠ‚ç‚¹é€€å‡º</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 1ã€å°†èŠ‚ç‚¹è®¾ç½®ä¸ºç»´æŠ¤æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">kubectl drain k8s-node01 --delete-local-data --force --ignore-daemonsets node/k8s-node01
</span></span><span class="line"><span class="cl"><span class="c1"># 2ã€åˆ é™¤èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">kubectl delete node k8s-node01
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç™»é™†ä¸ŠèŠ‚ç‚¹æœºå™¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3ã€åœæ­¢ kubelet</span>
</span></span><span class="line"><span class="cl">systemctl stop kubelet
</span></span><span class="line"><span class="cl"><span class="c1"># 4ã€k8s é‡ç½®</span>
</span></span><span class="line"><span class="cl">sudo kubeadm reset -f
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6åˆ›å»ºç½‘ç»œflannel">6ã€åˆ›å»ºç½‘ç»œã€Œflannelã€</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ‹·è´é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">sudo mkdir -p /usr/local/kubernetes/cni/flannel/
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /usr/local/kubernetes/cni/flannel/
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åº”ç”¨é…ç½®</span>
</span></span><span class="line"><span class="cl">kubectl apply -f kube-flannel.yml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­‰å¾…2ï½3åˆ†é’Ÿï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸ</span>
</span></span><span class="line"><span class="cl">kubectl get nodes
</span></span><span class="line"><span class="cl"><span class="c1"># å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¾ç¤º ready</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="7é›†ç¾¤æµ‹è¯•">7ã€é›†ç¾¤æµ‹è¯•</h4>
<h5 id="71åˆ›å»ºpod">7.1ã€åˆ›å»ºpod</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ª deployment ä»»åŠ¡ æŒ‡å®šé•œåƒ</span>
</span></span><span class="line"><span class="cl">kubectl create deployment nginx --image<span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="c1"># è·å– pod åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">kubectl get po -o wide
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<h5 id="72åˆ›å»º-svc-ç½‘ç»œ">7.2ã€åˆ›å»º svc ç½‘ç»œ</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ª svc ç½‘ç»œ</span>
</span></span><span class="line"><span class="cl">kubectl create svc clusterip nginx --tcp<span class="o">=</span>80:80
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å½“å‰ svc ç½‘ç»œ</span>
</span></span><span class="line"><span class="cl">kubectl get svc
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<h2 id="4èµ„æºæ¸…å•">4ã€èµ„æºæ¸…å•</h2>
<blockquote>
<p>åœ¨ k8s ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯èµ„æºï¼Œèµ„æºå®ä¾‹åŒ–ä¹‹åï¼Œå«åšå¯¹è±¡</p>
<p>èµ„æºï¼š</p>
<ul>
<li>å‘½åç©ºé—´çº§åˆ«
<ul>
<li>å·¥ä½œè´Ÿè½½å‹èµ„æºï¼šPodã€ReplicaSetã€Deployment ç­‰</li>
<li>æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡å‹èµ„æºï¼šServiceã€Ingress ç­‰</li>
<li>é…ç½®ä¸å­˜å‚¨å‹èµ„æºï¼šVolumeã€CSI ç­‰</li>
<li>ç‰¹æ®Šç±»å‹çš„å­˜å‚¨å·ï¼šConfigMapã€Secre ç­‰</li>
</ul>
</li>
<li>é›†ç¾¤çº§èµ„æº
<ul>
<li>Namespaceã€Nodeã€ClusterRoleã€ClusterRoleBinding</li>
</ul>
</li>
<li>å…ƒæ•°æ®ç±»å‹èµ„æº
<ul>
<li>HPAã€PodTemplateã€LimitRange</li>
</ul>
</li>
</ul>
<p>åœ¨ k8s ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ yaml æ ¼å¼çš„æ–‡ä»¶æ¥åˆ›å»ºç¬¦åˆæˆ‘ä»¬é¢„æœŸæœŸæœ›çš„å¯¹è±¡ï¼Œè¿™æ ·çš„ yaml æ–‡ä»¶æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºèµ„æºæ¸…å•</p>
</blockquote>
<h3 id="æ ¼å¼">æ ¼å¼</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">group/apiversion</span><span class="w"> </span><span class="c"># å¦‚æœæ²¡æœ‰ç»™å®š group åç§°ï¼Œé‚£ä¹ˆé»˜è®¤ä¸º coreï¼Œå¯ä»¥ä½¿ç”¨ kubectl apt-versions è·å–å½“å‰ k8s ç‰ˆæœ¬ä¸Šæ‰€æœ‰çš„ apiVersion ç‰ˆæœ¬ä¿¡æ¯ï¼ˆæ¯ä¸ªç‰ˆæœ¬å¯èƒ½ä¸åŒï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="c"># èµ„æºç±»åˆ«</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadate</span><span class="p">:</span><span class="w"> </span><span class="c"># èµ„æºå…ƒæ•°æ®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="l">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="l">namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="l">lables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="l">annotations</span><span class="w"> </span><span class="c"># ä¸»è¦ç›®çš„æ˜¯æ–¹ä¾¿ç”¨æˆ·é˜…è¯»æŸ¥æ‰¾</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># æœŸæœ›çš„çŠ¶æ€ ï¼ˆdisired stateï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="c"># å½“å‰çŠ¶æ€ï¼Œæœ¬å­—æ®µç”± kubernetes è‡ªèº«ç»´æŠ¤ï¼Œç”¨æˆ·ä¸èƒ½å®šä¹‰</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p>å¿…é¡»è®°ä½çš„å‘½ä»¤ <code>kubectl explain xxx.xxx</code>
å¿…é¡»è®°ä½çš„å‘½ä»¤ <code>kubectl explain xxx.xxx</code>
å¿…é¡»è®°ä½çš„å‘½ä»¤ <code>kubectl explain xxx.xxx</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -n æŒ‡å®šå‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default</span>
</span></span><span class="line"><span class="cl">kuebctl get pod -o wide -l <span class="o">[</span>key/key<span class="o">=</span>values<span class="o">]</span> <span class="c1"># è·å– pod åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">kubectl get pod podName -o json/yaml <span class="c1"># è·å– pod è¯¦ç»†ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">kubectl log podName <span class="c1"># è·å– pod æ—¥å¿—</span>
</span></span><span class="line"><span class="cl">kubectl describe pod podName <span class="c1"># è·å– pod äº‹ä»¶ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ“ä½œ</span>
</span></span><span class="line"><span class="cl">kubectl create -f filename <span class="c1"># åˆ›å»ºèµ„æº</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it podName -c containerName -- <span class="o">[</span>script<span class="o">]</span> <span class="c1"># åœ¨æŸä¸ªå®¹å™¨å†…æ‰§è¡Œè„šæœ¬</span>
</span></span><span class="line"><span class="cl">kubectl delete <span class="o">[</span>res<span class="o">]</span> <span class="o">[</span>--all <span class="p">|</span> name<span class="o">]</span> <span class="c1"># åˆ é™¤èµ„æº</span>
</span></span><span class="line"><span class="cl">kubectl scale --replicas<span class="o">=[</span>num<span class="o">]</span> <span class="o">[</span>controllerKind<span class="o">]</span>/<span class="o">[</span>resName<span class="o">]</span> <span class="c1"># ä¿®æ”¹æŸä¸ªæ§åˆ¶å™¨çš„å‰¯æœ¬æ•°é‡</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è·å–-apiversion-ç‰ˆæœ¬ä¿¡æ¯">è·å– apiversion ç‰ˆæœ¬ä¿¡æ¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl api-versions
</span></span><span class="line"><span class="cl"><span class="c1"># output:</span>
</span></span><span class="line"><span class="cl">admissionregistration.k8s.io/v1
</span></span><span class="line"><span class="cl">apiextensions.k8s.io/v1
</span></span><span class="line"><span class="cl">apiregistration.k8s.io/v1
</span></span><span class="line"><span class="cl">apps/v1
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å­—æ®µé…ç½®æ ¼å¼">å­—æ®µé…ç½®æ ¼å¼</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">apiVersion &lt;string&gt;        <span class="c1"># è¡¨ç¤ºå­—ç¬¦ä¸²ç±»å‹</span>
</span></span><span class="line"><span class="cl">metadata &lt;object&gt;          <span class="c1"># è¡¨ç¤ºéœ€è¦åµŒå¥—å¤šå±‚å­—æ®µ</span>
</span></span><span class="line"><span class="cl">labels &lt;map<span class="o">[</span>string<span class="o">]</span>string&gt; <span class="c1"># è¡¨ç¤ºç”± k:v ç»„æˆçš„æ˜ å°„</span>
</span></span><span class="line"><span class="cl">finalizers &lt;<span class="o">[]</span>string&gt;      <span class="c1"># è¡¨ç¤ºå­—ç¬¦ä¸²åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">ownerReferences &lt;<span class="o">[]</span>object&gt; <span class="c1"># è¡¨ç¤ºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">hostPID &lt;boolean&gt;          <span class="c1"># true | flase</span>
</span></span><span class="line"><span class="cl">priority &lt;integer&gt;         <span class="c1"># æ•´å‹</span>
</span></span><span class="line"><span class="cl">name &lt;string&gt; -required-   <span class="c1"># å¦‚æœç±»å‹åé¢æ¥ requiredï¼Œè¡¨ç¤ºä¸ºå¿…å¡«å­—æ®µ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é€šè¿‡å®šä¹‰æ¸…å•æ–‡ä»¶åˆ›å»º-pod">é€šè¿‡å®šä¹‰æ¸…å•æ–‡ä»¶åˆ›å»º Pod</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pod-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">lables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myPod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myPod-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myPod-2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybos:1.34.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;/bin/sh&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;-c&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;sleep 3600&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨ -o é€‰é¡¹åŠ  yamlï¼Œå¯ä»¥å°†èµ„æºçš„é…ç½®ä»¥ yaml çš„æ ¼å¼è¾“å‡ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ json</span>
</span></span><span class="line"><span class="cl">kubectl get pod xxx.xxx.xxx -o yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5pod-ç”Ÿå‘½å‘¨æœŸ">5ã€Pod ç”Ÿå‘½å‘¨æœŸ</h2>
<h3 id="æ‰§è¡Œæµç¨‹">æ‰§è¡Œæµç¨‹</h3>
<p></p>
<ol>
<li>Pauseï¼šåœ¨ä¸€ä¸ª Pod å¯åŠ¨å‰ï¼Œä¼šå…ˆå¯åŠ¨ä¸€ä¸ª Pause å®¹å™¨ã€‚å®ƒä¼šåˆå§‹åŒ–ç›¸åº”çš„ç½‘ç»œæ ˆï¼ŒåŒæ—¶æŠŠè‡ªèº«çš„ç½‘ç»œå·å…±äº«ç»™ Pod å†…çš„å®¹å™¨</li>
<li>åˆå§‹åŒ–å®¹å™¨ã€ŒinitCã€ï¼Œå¯ä»¥æœ‰0åˆ°æ— é™ä¸ª
<ul>
<li>å®ƒæ˜¯æ‰¹å¤„ç†ç±»å‹çš„ä»»åŠ¡</li>
<li>å®ƒçš„è¿è¡Œæ˜¯æœ‰åºçš„ï¼Œç¬¬ä¸€ä¸ªä¸è¿è¡ŒæˆåŠŸï¼Œç¬¬äºŒä¸ªä¸ä¼šè¿è¡Œ</li>
<li>å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œä¼šç›´æ¥é‡è½½æ•´ä¸ª Podï¼Œç›´åˆ° Init å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod å¯¹åº”çš„ restartPolicy ä¸º Never åˆ™ä¸ä¼šé‡å¯</li>
</ul>
</li>
<li>ä¸»å®¹å™¨ã€ŒmainCã€ï¼Œè‡³å°‘å­˜åœ¨ä¸€ä¸ª
<ul>
<li>å¤šä¸ª mainC å¹¶è¡Œå¯åŠ¨</li>
<li>å¤šä¸ª mainC å…±äº«åŒä¸€ä¸ªç½‘ç»œå·ï¼Œç»‘å®šçš„ç«¯å£ä¸èƒ½é‡å¤</li>
<li>hook
<ul>
<li>å¯åŠ¨å‰ã€Œå’Œä¸»è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œä¸ä¸€å®šåœ¨ä¸»è¿›ç¨‹è¿è¡Œå‰æ‰§è¡Œå®Œæˆã€</li>
<li>å…³é—­å‰ã€Œå¯ä»¥ä¿è¯åœ¨å…³é—­å‰æ‰§è¡Œå®Œæˆã€</li>
</ul>
</li>
<li>æ¢é’ˆã€Œtcpï½œhttpï½œscriptã€
<ul>
<li>å¯ä»¥è¿›è¡Œå°±ç»ªã€å­˜æ´»æ¢æµ‹æ¢é’ˆï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œåç»­æ¢é’ˆï¼Œæ–°ç‰ˆæœ¬æ‰å­˜åœ¨</li>
<li>å°±ç»ªæ¢é’ˆï¼šåˆ¤æ–­ä¸€ä¸ª mainC æ˜¯å¦å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡ï¼Œå¯ä»¥å®šä¹‰æ¢æµ‹é—´éš”</li>
<li>å­˜æ´»æ¢é’ˆï¼šåˆ¤æ–­ä¸€ä¸ª mainC æ˜¯å¦å­˜æ´»ï¼Œå¦‚æ— å“åº”åˆ™é‡å¯å®¹å™¨</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="init-å®¹å™¨">init å®¹å™¨</h3>
<p>å› ä¸º Init å®¹å™¨å…·æœ‰ä¸åº”ç”¨å®¹å™¨åˆ†ç¦»çš„å•ç‹¬é•œåƒï¼Œæ‰€ä»¥å®ƒä»¬çš„å¯åŠ¨ç›¸å…³ä»£ç å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å®ƒä»¬å¯ä»¥åŒ…å«å¹¶è¿è¡Œå®ç”¨å·¥å…·ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸å»ºè®®åœ¨åº”ç”¨å®¹å™¨é•œåƒä¸­åŒ…å«è¿™äº›å·¥å…·</li>
<li>åº”ç”¨ç¨‹åºé•œåƒå¯ä»¥åˆ†ç¦»å‡ºåˆ›å»ºå’Œéƒ¨ç½²çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¿…è¦è”åˆå®ƒä»¬æ„å»ºä¸€ä¸ªå•ç‹¬çš„é•œåƒ</li>
<li>Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹äºåº”ç”¨å®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œä»–ä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºåˆ™ä¸èƒ½</li>
<li>ä»–ä»¬å¿…é¡»åœ¨åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œå®Œæˆï¼Œè€Œåº”ç”¨å®¹å™¨æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œæ‰€ä»¥ Init å®¹å™¨èƒ½å¤Ÿæä¾›ä¸€ç§ç®€å•çš„é˜»å¡æˆ–å»¶è¿Ÿåº”ç”¨å®¹å™¨å¯åŠ¨çš„æ–¹æ³•ï¼Œç›´åˆ°æ»¡è¶³å•¦ä¸€ç»„å…ˆå†³æ¡ä»¶</li>
<li>Init å®¹å™¨å…·æœ‰åº”ç”¨å®¹å™¨çš„æ‰€æœ‰å­—æ®µã€‚é™¤äº† readinessProbeï¼Œå› ä¸º Init å®¹å™¨æ— æ³•å®šä¹‰ä¸åŒäºå®Œæˆå’Œå°±ç»ªä¹‹å¤–çš„å…¶ä»–çŠ¶æ€ï¼Œè¿™ä¼šåœ¨éªŒè¯è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œ</li>
<li>åœ¨ Pod ä¸­çš„æ¯ä¸ª app å’Œ init å®¹å™¨çš„åç§°å¿…é¡»å”¯ä¸€ï¼›ä¸å…¶ä»–ä»»ä½•å®¹å™¨å…±äº«åŒä¸€ä¸ªåç§°ï¼Œä¼šåœ¨éªŒè¯æ—¶æŠ›å‡ºé”™è¯¯</li>
</ul>
<h3 id="ç®€å•å®æ“">ç®€å•å®æ“</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># testpod.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-nginx-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">initContainers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">init-my-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;until nslookup my-service; do echo waiting for my-service; sleep 2; done;&#39;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">init-my-db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;until nslookup my-db; do echo waiting for my-db; sleep 2; done;&#39;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># init-testpod.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">9376</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">9377</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆåˆ›å»º init æ¨¡æ¿</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create -f init-pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ Pod çŠ¶æ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get po
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>æŸ¥çœ‹åˆå§‹åŒ–å®¹å™¨æ—¥å¿—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl logs my-nginx-pod -c init-my-service
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>å‘ç°ä¸€ç›´åœ¨è§£æåŸŸåï¼Œè¿™æ—¶æˆ‘ä»¬åˆ›å»ºå“åº”çš„ service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create -f init-test-pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>ç„¶åæˆ‘ä»¬å†å»æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ä¸€å®šçš„æ—¶é—´</p>
<p></p>
<h3 id="æ¢é’ˆ">æ¢é’ˆ</h3>
<p>æ¢é’ˆæ˜¯ç”± kubelet å¯¹å®¹å™¨æ‰§è¡Œçš„å®šæœŸè¯Šæ–­ï¼Œè¦æ‰§è¡Œè¯Šæ–­ï¼Œkubelet è°ƒç”¨å®¹å™¨å®ç°çš„ Handlerã€‚æœ‰ä¸‰ç§ç±»å‹çš„å¤„ç†ç¨‹åºï¼š</p>
<ul>
<li>ExecActionï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸ</li>
<li>TCPSocketActionï¼šå¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨ IP åœ°å€è¿›è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«ä»»åŠ¡æ—¶æˆåŠŸçš„</li>
<li>HTTPGetActionï¼šå¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨ IP åœ°å€æ‰§è¡Œ HTTP Get è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº 200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„</li>
</ul>
<p>æ¯æ¬¡æ¢æµ‹éƒ½å°†è·å¾—ä»¥ä¸‹ä¸‰ç§ç»“æœï¼š</p>
<ul>
<li>æˆåŠŸï¼šå®¹å™¨é€šè¿‡è¯Šæ–­</li>
<li>å¤±è´¥ï¼šå®¹å™¨æœªé€šè¿‡è¯Šæ–­</li>
<li>æœªçŸ¥ï¼šè¯Šæ–­å¤±è´¥ï¼Œä½†ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨</li>
</ul>
<h4 id="readinessprobeå°±ç»ªæ¢é’ˆ"><strong>readinessProbeã€Œå°±ç»ªæ¢é’ˆã€</strong></h4>
<p>æŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢æµ‹å¤±è´¥ï¼Œç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸ Pod åŒ¹é…çš„æ‰€æœ‰ Service çš„ç«¯ç‚¹ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚åˆå§‹å»¶è¿Ÿå‰çš„å°±ç»ªçŠ¶æ€é»˜è®¤ä¸º Failureã€‚å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º SUCCESS</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># readinessProbe-httpget</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">reaadiness-httpget-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">readiness-httpget-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">imagePullPolice</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># é…ç½®å°±ç»ªæ¢é’ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£å’Œ path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">readiness.html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># å¼€å§‹æ¢æµ‹å»¶è¿Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># æ¢æµ‹é—´éš”</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºè¯¥ Pod åï¼Œä¼šå‘ç° Pod å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯ READY å´æ˜¯ <code>0/1</code>ã€‚è¿™æ—¶æˆ‘ä»¬æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œå‘ç°æ¢é’ˆè¿”å›ä¸º 404ï¼Œæ­¤æ—¶è¡¨ç¤ºæ¢é’ˆæ­£å¸¸ç”Ÿæ•ˆã€‚</p>
<p>æˆ‘ä»¬è¿›å…¥å®¹å™¨ï¼Œåœ¨ nginx çš„æ ¹ç›®å½•ä¸‹åˆ›å»º<code>readiness.html</code>æ–‡ä»¶ï¼Œé€€å‡ºåå‘ç°å®¹å™¨å·²å¤„äºå°±ç»ªçŠ¶æ€ã€‚</p>
<h4 id="livenessprobeå­˜æ´»æ¢é’ˆ"><strong>livenessProbeã€Œå­˜æ´»æ¢é’ˆã€</strong></h4>
<p>æŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥ï¼Œåˆ™ kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œå¹¶ä¸”å®¹å™¨å°†æ ¹æ®é‡å¯ç­–ç•¥æ¥åˆ¤æ–­æ˜¯å¦é‡æ–°æ‹‰èµ·ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º SUCCESS</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># livenessProbe-exec</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-exec-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-exec-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;touch /tmp/live; sleep 60; rm -rf /tmp/live; sleep 3600&#34;</span><span class="p">]</span><span class="w"> </span><span class="c"># è¿è¡Œè„šæœ¬</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="c"># exec ç±»å‹æ¢é’ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;test&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-e&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;/tmp/live&#34;</span><span class="p">]</span><span class="w"> </span><span class="c"># æ‰§è¡Œè„šæœ¬</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># å¼€å§‹æ¢æµ‹å»¶è¿Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># æ¢æµ‹é—´éš”</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºè¯¥ Pod åï¼Œåœ¨å‰ 60 ç§’å†…æ­£å¸¸è¿è¡Œï¼Œä¹‹åå‘ç° Pod è¢«æ€æ­»å¹¶é‡æ–°åˆ›å»ºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># livenessProbe-httpget</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-httpget-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-httpget-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£å’Œ path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">index.html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># å¼€å§‹æ¢æµ‹å»¶è¿Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># æ¢æµ‹é—´éš”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># è¶…æ—¶æ—¶é—´</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># livenessProbe-tcp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-tcp-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">liveness-tcp-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tcp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tcpSocket</span><span class="p">:</span><span class="w"> </span><span class="c"># æ¢é’ˆç±»å‹ï¼Œè¯·æ±‚ç«¯å£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># å¼€å§‹æ¢æµ‹å»¶è¿Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># è¶…æ—¶æ—¶é—´</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯åŠ¨é€€å‡ºåŠ¨ä½œhook">å¯åŠ¨ã€é€€å‡ºåŠ¨ä½œã€Œhookã€</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lifecycle-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lifecycle-demo-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w"> </span><span class="c"># ç”Ÿå‘½å‘¨æœŸ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">postStart</span><span class="p">:</span><span class="w"> </span><span class="c"># å¯åŠ¨å‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;echo postStart &gt; /usr/share/message&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">preStart</span><span class="p">:</span><span class="w"> </span><span class="c"># å…³é—­å‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;echo preStart &gt; /usr/share/message&#34;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿›å…¥å®¹å™¨åï¼Œå°±å¯ä»¥çœ‹åˆ°<code>/usr/share/message</code>å­˜åœ¨ï¼Œå¹¶ä¸”å†…å®¹æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>postStart</code>ã€‚æˆ‘ä»¬è¿›å»å®¹å™¨æ­»å¾ªç¯æ‰“å°æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> cat /usr/share/message<span class="p">;</span> <span class="k">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¤–éƒ¨å…³é—­å®¹å™¨åï¼Œå‘ç°æ‰“å°å˜æˆäº†<code>preStart</code></p>
<h2 id="6æ§åˆ¶å™¨è¯¦è§£">6ã€æ§åˆ¶å™¨è¯¦è§£</h2>
<h3 id="rc-æ§åˆ¶å™¨">RC æ§åˆ¶å™¨</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># file: rc.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ReplicationController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># å‰¯æœ¬æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c"># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¯»æ‰¾ app=nginx çš„ Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c"># åˆ›å»º Pod æ¨¡æ¿</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åˆ›å»ºä¸Šè¿°æ–‡ä»¶åï¼Œæˆ‘ä»¬æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create -f rc.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬æŸ¥çœ‹å¯¹åº” Podï¼š</p>
<p></p>
<p>è¿™ä¹Ÿå°±æ˜¯ RC æ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ é™¤å…¶ä¸­ä¸€ä¸ª Pod ä¼šå‘ç°åˆè¢«é‡æ–°åˆ›å»º</p>
<p></p>
<h3 id="rs-æ§åˆ¶å™¨">RS æ§åˆ¶å™¨</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ReplicaSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># å‰¯æœ¬æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c"># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¯»æ‰¾ app=nginx çš„ Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># matchExpressions: å¯é€‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c"># åˆ›å»º Pod æ¨¡æ¿</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>RS æ§åˆ¶å™¨ç›¸æ¯” RC æ§åˆ¶å™¨ï¼Œåªæ˜¯å¤šäº†ä¸€ç§æ ‡ç­¾é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl explain rs.spec.selector
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°é™¤äº†å’Œ RC æ§åˆ¶å™¨åŠŸèƒ½ä¸€è‡´çš„<code>matchLabels</code>ï¼Œè¿˜å¤šäº†ä¸€ç§<code>matchExpressions</code>å¯é€‰æ‹©ã€‚</p>
<p><code>matchExpressions</code>ç›®å‰èƒ½æ”¯æŒçš„æ“ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li>Inï¼šlabel çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li>
<li>NotInï¼šlabel çš„å€¼ä¸åœ¨æŸä¸€ä¸ªåˆ—è¡¨ä¸­</li>
<li>Existsï¼šæŸä¸ª label å­˜åœ¨</li>
<li>DoesNotExistï¼šæŸä¸ª label ä¸å­˜åœ¨</li>
</ul>
<h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># selector exists demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ReplicaSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rs-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w"> </span><span class="c"># è¿™é‡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">Exists</span><span class="w"> </span><span class="c"># label ä¸­ key ä¸º app å­˜åœ¨å³å¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># selector In demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ReplicaSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rs-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w"> </span><span class="c"># è¿™é‡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w"> </span><span class="c"># label ä¸­ key å¯¹åº”çš„ value åœ¨æšä¸¾çš„ values ä¸­å³å¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="deployment-æ§åˆ¶å™¨">Deployment æ§åˆ¶å™¨</h3>
<blockquote>
<p>å‘½ä»¤çš„å®šä¹‰æ–¹å¼</p>
<ul>
<li>å‘½ä»¤å¼å®šä¹‰ kubectl create -f xxxxx</li>
<li>å£°æ˜å¼å®šä¹‰ kubectl apply -f xxxxx</li>
</ul>
<p>åŒºåˆ«ï¼šå£°æ˜å¼å‘½ä»¤å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­å½“å‰æ“ä½œæ˜¯ä¿®æ”¹è¿˜æ˜¯åˆ›å»º</p>
<p>æ¨èç›´æ¥ä½¿ç”¨ applyï¼Œåœ¨é‡åˆ°å‘½ä»¤å¼èµ„æºæ—¶ä¼šè‡ªåŠ¨é™çº§æˆå‘½ä»¤å¼</p>
</blockquote>
<p>Deployment ä¸º Pod å’Œ ReplicaSet æä¾›æ¥ä¸€ä¸ªå£°æ˜å¼å®šä¹‰æ–¹æ³•ï¼Œç”¨æ¥ä»£æ›¿ä¹‹å‰çš„ ReplicationController æ¥æ–¹ä¾¿ç®¡ç†åº”ç”¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®šä¹‰ Deployment æ¥åˆ›å»º Pod å’Œ ReplicaSet</li>
<li>æ»šåŠ¨å‡çº§å’Œå›æ»šåº”ç”¨</li>
<li>æ‰©å®¹å’Œç¼©å®¹</li>
<li>æš‚åœå’Œç»§ç»­ Deployment</li>
</ul>
<h4 id="1éƒ¨ç½²ä¸€ä¸ªç®€å•çš„-nginx-åº”ç”¨">1ã€éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ Nginx åº”ç”¨</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f https://kubernetes.io/docs/user-guide/nginx-deployment.yaml --record
</span></span><span class="line"><span class="cl"><span class="c1"># --record å¯ä»¥è®°å½•å½“å‰å‘½ä»¤åˆ° deployment åˆ°å†å²è®°å½•ä¸­</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2æ‰©å®¹">2ã€æ‰©å®¹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹å‰¯æœ¬æ•°é‡ä¸º 10ï¼Œä¸ä¼šå½±å“ deployment å·²ç»åˆ›å»ºçš„ rs</span>
</span></span><span class="line"><span class="cl">kubectl scale deployment nginx-deployment --replicas <span class="m">10</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¦‚æœé›†ç¾¤æ”¯æŒ horizontal pod autoscaling çš„è¯ï¼Œè¿˜å¯ä»¥ä¸º Deployment è®¾ç½®è‡ªåŠ¨æ‰©å±•</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl autoscale deployment nginx-deployment --min<span class="o">=</span><span class="m">10</span> --max<span class="o">=</span><span class="m">15</span> --cpu-percent<span class="o">=</span><span class="m">80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3æ›´æ–°é•œåƒ">3ã€æ›´æ–°é•œåƒ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">set</span> image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4å›æ»š">4ã€å›æ»š</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl rollout undo deployment/nginx-deployment
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡å¦‚å½“å‰æœ‰4ä¸ªç‰ˆæœ¬ v1ã€v2ã€v3ã€v4ï¼Œç›®å‰çš„ç‰ˆæœ¬ä¸º v4ï¼Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤å›æ»šä¹‹åå›æ»šåˆ° v3 ç‰ˆæœ¬ï¼Œå†æ¬¡ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œæ­¤æ—¶å›é‡æ–°å›æ»šåˆ° v4 ç‰ˆæœ¬ï¼Œå› ä¸ºå½“å‰çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸º v4ï¼Œå¦‚æœæƒ³æŒ‡å®šç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å†å²ç‰ˆæœ¬è®°å½•ï¼Œå¦‚æœä½¿ç”¨äº† --replicas ä¼šæ˜¾ç¤ºå½“æ—¶çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">kubectl rollout <span class="nb">history</span> deployment/nginx-deployment
</span></span><span class="line"><span class="cl"><span class="c1"># å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">kubectl rollout undo deployment/nginx-deployment --to-revision<span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æš‚åœ deployment çš„æ›´æ–°</span>
</span></span><span class="line"><span class="cl">kubectl rollout pause deployment/nginx-deployment
</span></span><span class="line"><span class="cl"><span class="c1"># å¯ä»¥ä½¿ç”¨ kubectl rollout status æŸ¥çœ‹å›æ»šæ˜¯å¦å®Œæˆï¼ŒåŒæ—¶å‘½ä»¤è¿”å› code ä¸º 0ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬æ¥åˆ¤æ–­</span>
</span></span><span class="line"><span class="cl">kubectl rollout status depoyment/nginx-deployment
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é™åˆ¶ç‰ˆæœ¬æ•°é‡</strong></p>
<p>å¯ä»¥è®¾ç½®<code>.spec.revisionHistoryLimit</code>æ¥è®¾ç½®ä¿ç•™çš„ç‰ˆæœ¬æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡ä¹Ÿå°±æ˜¯ deployment ç®¡ç†çš„å†å² rs æ•°é‡</p>
<p><strong>å¤šä¸ª rollout å¹¶è¡Œ</strong></p>
<p>å‡è®¾å½“å‰æœ‰ 10 ä¸ª Pod æ­£åœ¨ä» v1 ç‰ˆæœ¬å‡çº§è‡³ v2 ç‰ˆæœ¬ï¼Œæ­¤æ—¶ v1 : 5ã€v2 : 5ã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬å†å‡çº§è‡³ v3 ç‰ˆæœ¬ï¼Œæ­¤æ—¶å‡çº§çš„ 5 ä¸ª v2 ç‰ˆæœ¬çš„ Pod ä¼šç›´æ¥è¢«æ€æ­»ï¼Œç„¶åç›´æ¥åˆ›å»º v3 ç‰ˆæœ¬çš„ Podã€‚</p>
<p><strong>å¸¸ç”¨å›æ»šç­–ç•¥</strong></p>
<p>ä¸€èˆ¬åœ¨ä¼ä¸šä¸­ä¸ä¼šä½¿ç”¨ revision è¿™ç§å›æ»šæ–¹å¼ï¼Œè€Œæ˜¯ä¼šå¤åˆ¶æœ€è¿‘ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åç§°åç›´æ¥è¿›è¡Œ apply æ“ä½œï¼Œæ¯”å¦‚<code>nginx-deployment-2022-06-06 12:00:00.yaml</code>ã€‚è¿™æ ·çš„è¯å‡ºç°é—®é¢˜å¯ä»¥ç›´æ¥ apply è‡³ä¸Šä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<h4 id="5æ›´æ–°ç­–ç•¥">5ã€æ›´æ–°ç­–ç•¥</h4>
<p>Deployment å¯ä»¥ä¿è¯åœ¨å‡çº§æ—¶åªæœ‰ä¸€å®šæ•°é‡çš„ Pod æ˜¯ down çš„ã€‚é»˜è®¤å®ƒä¼šç¡®ä¿è‡³å°‘æœ‰æ¯”æœŸæœ›çš„å‰¯æœ¬æ•°é‡å°‘ä¸€ä¸ªä¸º up çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šä¸€ä¸ªä¸å¯ç”¨</p>
<p>åŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›ä¸€å®šæ•°é‡çš„ Podï¼Œé»˜è®¤ä¼šæ¯”æœŸæœ›çš„å‰¯æœ¬æ•°é‡å¤šä¸€ä¸ªæ˜¯ up çŠ¶æ€</p>
<p>æœªæ¥çš„ kuberentes ç‰ˆæœ¬ä¸­ï¼Œå°†ä» 1-1 å˜æˆ 25%-25%</p>
<p>å½“ç„¶ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ›´æ–°ç­–ç•¥</p>
<blockquote>
<p>kubectl explain deploy.spec.strategy.type</p>
<ul>
<li>Recreateï¼šé‡æ–°åˆ›å»º</li>
<li>rollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰
<ul>
<li>maxSurgeï¼šæŒ‡å®šè¶…å‡ºå‰¯æœ¬æ•°æœ‰å‡ ä¸ªï¼Œä¸¤ç§æ–¹å¼ï¼š1ã€æŒ‡å®šæ•°é‡ 2ã€ç™¾åˆ†æ¯”</li>
<li>maxUnavailableï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡æœ€å¤šæœ‰å‡ ä¸ªä¸å¯ç”¨</li>
</ul>
</li>
</ul>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢å½“å‰æ›´æ–°ç­–ç•¥</span>
</span></span><span class="line"><span class="cl">kubectl describe deployments <span class="o">{</span>æ§åˆ¶å™¨åç§°<span class="o">}</span> <span class="c1"># æ‰¾åˆ° RollingUpdateStrategy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹å½“å‰æ›´æ–°ç­–ç•¥</span>
</span></span><span class="line"><span class="cl">kubectl edit deployment <span class="o">{</span>æ§åˆ¶å™¨åç§°<span class="o">}</span> <span class="c1"># æ‰¾åˆ° rollingUpdate</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–è€…ä½¿ç”¨ patch æ‰“è¡¥ä¸</span>
</span></span><span class="line"><span class="cl">kubectl patch deployment nginx-deployment -p <span class="s1">&#39;{&#34;spec&#34;: {&#34;strategy&#34;: {&#34;rollingUpdate&#34;: {&#34;maxSurge&#34;:1, &#34;maxUnavailable&#34;: 0}}}}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6é‡‘ä¸é›€éƒ¨ç½²">6ã€é‡‘ä¸é›€éƒ¨ç½²</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># éœ€è¦è®¾ç½®å½“å‰æ›´æ–°ç­–ç•¥ä¸º maxSurge:1 maxUnavailable:0</span>
</span></span><span class="line"><span class="cl">kubectl patch deployment nginx-deployment -p <span class="s1">&#39;{&#34;spec&#34;: {&#34;strategy&#34;: {&#34;rollingUpdate&#34;: {&#34;maxSurge&#34;:1, &#34;maxUnavailable&#34;: 0}}}}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¼€å§‹æ›´æ–°åç›´æ¥æš‚åœï¼Œæ­¤æ—¶åªä¼šæ–°å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ Podï¼Œæ—§ç‰ˆæœ¬çš„ Pod ä¸ä¼šè¿›è¡Œåˆ é™¤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ­¤æ—¶ svc ç½‘ç»œä¼šå°†æµé‡è´Ÿè½½å‡è¡¡è‡³å½“å‰å…¨éƒ¨ Podï¼Œå°±å¯ä»¥æµ‹è¯•æ–°ç‰ˆæœ¬äº†</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">set</span> image deployment nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="o">&amp;&amp;</span> kubectl rollout pause deployment nginx-deployment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­‰å¾…æµ‹è¯•ç»“æŸåï¼Œç»§ç»­æ›´æ–°</span>
</span></span><span class="line"><span class="cl">kubectl rollout resume deployment nginx-deployment
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="daemonset-1">DaemonSet</h3>
<p>DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰ Node å‡å¦‚é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Podã€‚å½“æœ‰ Node ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Pod</p>
<p>ä½¿ç”¨ DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š</p>
<ul>
<li>è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œ<code>glusterd</code>ã€<code>ceph</code></li>
<li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›† daemonï¼Œä¾‹å¦‚<code>fluentd</code>ã€<code>logstash</code></li>
<li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œç›‘æ§ darmonï¼Œä¾‹å¦‚<code>Promentheus Node Exproter</code>ã€<code>collectd</code>ã€<code>Datadogä»£ç†</code>ã€<code>New Relic ä»£ç†</code>æˆ–è€…<code>Ganglia gmond</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daemonset-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daemonset</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daemonset-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daemonset-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daemonset-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="job">Job</h3>
<p>Job è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ª Pod æˆåŠŸç»“æŸ</p>
<p>ç‰¹æ®Šè¯´æ˜</p>
<ul>
<li><code>.spec.template</code>æ ¼å¼åŒ Pod</li>
<li>RestartPolicy ä»…æ”¯æŒ Never æˆ–è€… OnFailure</li>
<li>å½“ä¸ª Pod æ—¶ï¼Œé»˜è®¤ Pod è¿è¡ŒæˆåŠŸå Job å³ç»“æŸ</li>
<li><code>.spec.completions</code>æ ‡å¿— Job ç»“æŸéœ€è¦æˆåŠŸè¿è¡Œçš„ Pod ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 1</li>
<li><code>.spec.parallelism</code>æ ‡å¿—å¹¶è¡Œè¿è¡Œçš„ Pod ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 1</li>
<li><code>spec.activeDeadlineSecods</code>æ ‡å¿—å¤±è´¥ Pod çš„é‡è¯•æœ€å¤§æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¸ä¼šç»§ç»­é‡è¯•</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">batch/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;this is a job container&#39;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cronjob">CronJob</h3>
<p>CronJob åŸºäºæ—¶é—´ç®¡ç†çš„ Jobï¼Œå³ï¼š</p>
<ul>
<li>åœ¨ç»™å®šçš„æ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡</li>
<li>å‘¨æœŸæ€§çš„åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ</li>
</ul>
<p>ä½¿ç”¨æ¡ä»¶ï¼šå½“å‰ä½¿ç”¨ k8s é›†ç¾¤ï¼Œç‰ˆæœ¬ &gt;= 1.8</p>
<p>å…¸å‹ç”¨æ³•ï¼š</p>
<ul>
<li>åœ¨ç»™å®šçš„æ—¶é—´ç‚¹è°ƒåº¦ Job è¿è¡Œ</li>
<li>åˆ›å»ºå‘¨æœŸæ€§è¿è¡Œçš„ Jobï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å¤‡ä»½ã€å‘é€é‚®ä»¶</li>
</ul>
<p>Spec</p>
<ul>
<li>
<p><code>.spec.schedule</code>ï¼šè°ƒåº¦ï¼Œå¿…é¡»å­—æ®µï¼ŒæŒ‡å®šä»»åŠ¡è¿è¡Œå‘¨æœŸï¼Œæ ¼å¼åŒ Cron</p>
</li>
<li>
<p><code>.spec.jobTemplate</code>ï¼šJob æ¨¡æ¿ï¼Œå¿…é¡»å­—æ®µï¼ŒæŒ‡å®šéœ€è¦è¿è¡Œçš„ä»»åŠ¡ï¼Œæ ¼å¼åŒ Job</p>
</li>
<li>
<p><code>.spec.startingDeadlineSeconds</code>ï¼šå¯åŠ¨ Job çš„æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé€‰å¡«ï¼Œè¶…å‡ºè¯¥æ—¶é—´æœªå¯åŠ¨è®¤å®šä¸ºå¤±è´¥ï¼Œé»˜è®¤æ²¡æœ‰æœŸé™</p>
</li>
<li>
<p><code>.spce.concurrencyPolicy</code>ï¼šå¹¶å‘ç­–ç•¥ï¼Œé€‰å¡«ï¼ŒæŒ‡å®š Job çš„å¹¶å‘æ‰§è¡Œï¼Œåªå…è®¸ä»¥ä¸‹ç­–ç•¥ï¼š</p>
<ul>
<li>Allow ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å¹¶å‘è¿è¡Œ</li>
<li>Forbidï¼š ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è·³è¿‡</li>
<li>Replaceï¼šå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ Jobï¼Œç”¨ä¸€ä¸ªæ–°çš„æ›¿æ¢</li>
</ul>
<p>ä»¥ä¸Šç­–ç•¥åªèƒ½åº”ç”¨äºåŒä¸€ä¸ª CronJob åˆ›å»ºçš„ Jobï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª CronJobï¼Œå®ƒä»¬ä¹‹é—´æ€»æ˜¯äº’ä¸å¹²æ¶‰çš„</p>
</li>
</ul>
<h2 id="7service">7ã€Service</h2>
<blockquote>
<p>Kubernetes Service å®šä¹‰äº†è¿™æ ·ä¸€ç§æŠ½è±¡ï¼š</p>
<p>ä¸€ä¸ª Pod çš„é€»è¾‘åˆ†ç»„ï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„ç­–ç•¥ï¼Œé€šå¸¸ç§°ä¸º å¾®æœåŠ¡</p>
<p>è¿™ä¸€ç»„ Pod èƒ½å¤Ÿè¢« Service è®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡ Label Selector</p>
</blockquote>
<h3 id="æ ¸å¿ƒè¿­ä»£">æ ¸å¿ƒè¿­ä»£</h3>
<p>åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ª Node è¿è¡Œä¸€ä¸ª <code>kube-proxy</code>è¿›ç¨‹ã€‚<code>kube-proxy</code> è´Ÿè´£ä¸º <code>Service</code>å®ç°ä¸€ç§ VIPï¼ˆè™šæ‹ŸIPï¼‰çš„å½¢å¼ï¼Œè€Œä¸æ˜¯<code>ExternalName</code>çš„å½¢å¼ã€‚åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨ userspaceã€‚åœ¨ Kubernetes v1.1 ç‰ˆæœ¬ï¼Œå¢åŠ äº† iptables ä»£ç†ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ä» Kubernetes v1.2 èµ·ï¼Œé»˜è®¤å°±æ˜¯ iptables ä»£ç†ã€‚åœ¨ Kubernetes v1.8.0-beta.0 ä¸­ï¼Œæ·»åŠ äº† ipvs ä»£ç†ã€‚åœ¨ Kubernetes v1.14 ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨ ipvs ä»£ç†ã€‚</p>
<p>åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼ŒService æ˜¯ 4å±‚ï¼ˆTCP/UDP over IPï¼‰æ¦‚å¿µã€‚åœ¨ Kubernetes v1.1 ç‰ˆæœ¬ï¼Œæ–°å¢äº† Ingress APIï¼ˆbeta ç‰ˆï¼‰ï¼Œç”¨æ¥è¡¨ç¤º 7å±‚ï¼ˆHTTPï¼‰æœåŠ¡ã€‚</p>
<h4 id="1userspace-ä»£ç†æ¨¡å¼">1ã€userspace ä»£ç†æ¨¡å¼</h4>
<p></p>
<h4 id="2iptables-ä»£ç†æ¨¡å¼">2ã€iptables ä»£ç†æ¨¡å¼</h4>
<p></p>
<h4 id="3ipvs-ä»£ç†æ¨¡å¼">3ã€ipvs ä»£ç†æ¨¡å¼</h4>
<p>æ³¨æ„ï¼šipvs æ¨¡å¼å‡å®šè¿è¡Œ kube-proxy ä¹‹å‰åœ¨èŠ‚ç‚¹ä¸Šéƒ½å·²ç»å®‰è£…äº† IPVS å†…æ ¸æ¨¡å—ã€‚å½“ kube-proxyä»¥ ipvs ä»£ç†æ¨¡å¼å¯åŠ¨æ—¶ï¼Œkube-proxy å°†éªŒè¯èŠ‚ç‚¹æ˜¯å¦å®‰è£… IPVS æ¨¡å—ï¼Œå¦‚æœæœªå®‰è£…ï¼Œåˆ™å›é€€åˆ° iptables ä»£ç†æ¨¡å¼</p>
<p></p>
<h3 id="é™åˆ¶">é™åˆ¶</h3>
<p>Service èƒ½å¤Ÿæä¾›è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
<ul>
<li>åªæä¾› 4 å±‚è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œæ²¡æœ‰ 7 å±‚çš„åŠŸèƒ½ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ›´å¤šçš„åŒ¹é…è§„åˆ™æ¥è½¬å‘è¯·æ±‚ï¼Œè¿™ç‚¹ 4 å±‚è´Ÿè½½å‡è¡¡æ˜¯ä¸æ”¯æŒçš„</li>
</ul>
<h3 id="ç±»å‹">ç±»å‹</h3>
<ul>
<li>ClusterIPï¼šé»˜è®¤ç±»å‹ï¼Œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä»… Cluster å†…éƒ¨å¯ä»¥è®¿é—®çš„è™šæ‹Ÿ IP</li>
<li>NodePortï¼šåœ¨ Cluster Ip åŸºç¡€ä¸Šä¸º Service åœ¨æ¯å°æœºå™¨ä¸Šç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ <nodeIP>:<nodePort> æ¥è®¿é—®æœåŠ¡</li>
<li>LoadBalancerï¼šåœ¨ NodePort çš„åŸºç¡€ä¸Šï¼Œç»“æŸ cloud provider åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ° <nodeIP>:<nodePort></li>
<li>ExternalNameï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨æ¥ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç›´æ¥ä½¿ç”¨ã€‚æ²¡æœ‰ä»»ä½•ç±»å‹ä»£ç†è¢«åˆ›å»ºï¼Œè¿™è‡ªç”± Kubernetes 1.7 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ kube-dns æ‰æ”¯æŒ</li>
</ul>
<h4 id="1clusterip">1ã€ClusterIP</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">relese</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Headless Service</strong></p>
<p>æœ‰æ—¶ä¸éœ€è¦æˆ–ä¸æƒ³è¦è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠå•ç‹¬çš„ Service IPã€‚ é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š Cluster IPï¼ˆ<code>spec.clusterIP</code>ï¼‰çš„å€¼ä¸º <code>&quot;None&quot;</code> æ¥åˆ›å»º <code>Headless</code> Serviceã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ— å¤´ Service ä¸å…¶ä»–æœåŠ¡å‘ç°æœºåˆ¶è¿›è¡Œæ¥å£ï¼Œè€Œä¸å¿…ä¸ Kubernetes çš„å®ç°æ†ç»‘åœ¨ä¸€èµ·ã€‚</p>
<p>å¯¹äºæ— å¤´ <code>Services</code> å¹¶ä¸ä¼šåˆ†é… Cluster IPï¼Œkube-proxy ä¸ä¼šå¤„ç†å®ƒä»¬ï¼Œ è€Œä¸”å¹³å°ä¹Ÿä¸ä¼šä¸ºå®ƒä»¬è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±ã€‚ DNS å¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®ï¼Œä¾èµ–äº Service æ˜¯å¦å®šä¹‰äº†é€‰æ‹©ç®—ç¬¦ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-headless</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w">  </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;None&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2nodeport">2ã€NodePort</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-nodeport</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">relese</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">30000</span><span class="w"> </span><span class="c"># å¯æŒ‡å®š</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3loadbalancer">3ã€LoadBalancer</h4>
<p>loadBalacer å’Œ nodePort å…¶å®æ˜¯åŒä¸€ç§æ–¹å¼ï¼ŒåŒºåˆ«åœ¨äº loadBalancer æ¯” nodePort å¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯å¯ä»¥è°ƒç”¨ cloud provider å»åˆ›å»º LB æ¥å‘èŠ‚ç‚¹å¯¼æµ</p>
<p></p>
<h4 id="4externalname">4ã€ExternalName</h4>
<p>å¯ä»¥å°†æœåŠ¡æ˜ å°„åˆ° ExternalName å­—æ®µçš„å†…å®¹ï¼ˆä¾‹å¦‚ï¼šmyapp.otherNSï¼‰ã€‚ExternalName Service æ˜¯ Service çš„ç‰¹ä¾‹ï¼Œå®ƒæ²¡æœ‰ selectorï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰ä»»ä½•çš„ç«¯å£å’Œ Endpointã€‚ç›¸åçš„ã€å¯¹äºè¿è¡Œåœ¨é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡è¿”å›å¤–éƒ¨æœåŠ¡çš„åˆ«åè¿™ç§æ–¹å¼æ¥æä¾›æœåŠ¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ExternalName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">externalName</span><span class="p">:</span><span class="w"> </span><span class="l">myapp.otherNS</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æŸ¥è¯¢ä¸»æœº<code>my-service.default.svc.cluster.local</code>ï¼ˆSVC NAME.NAMESPACE.svc.cluster.localï¼‰æ—¶ï¼Œé›†ç¾¤çš„ coreDNS æœåŠ¡å°†è¿”å›ä¸€ä¸ªå€¼ <code>my.database.example.com</code> çš„ CANEM è®°å½•ã€‚è®¿é—®è¿™ä¸ªæœåŠ¡çš„å·¥ä½œæ–¹å¼å’Œå…¶ä»–çš„ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„äº‹é‡å®šå‘å‘ç”Ÿåœ¨ DNS å±‚ï¼Œè€Œä¸”ä¸ä¼šè¿›è¡Œä»£ç†å’Œè½¬å‘</p>
<h2 id="8ingress">8ã€Ingress</h2>
<p>Ingress çš„åŠŸèƒ½ä¸ service å¤§è‡´ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ ingerss æä¾›äº†7å±‚çš„ä»£ç†ï¼Œè€Œ service åªæä¾›äº† 4 å±‚ä»£ç†ï¼Œå¦‚æœå¸Œæœ›å®ç° https çš„è®¿é—®åˆ™å¯ä»¥ä½¿ç”¨ Ingress</p>
<h3 id="å®ç°åŸç†">å®ç°åŸç†</h3>
<p></p>
<p>åœ¨ k8s ç¯å¢ƒä¸‹åˆ›å»ºä¸€ä¸ª nginx podï¼Œåœ¨å†…ç¼–å†™é…ç½®æ–‡ä»¶å»åå‘ä»£ç† svcï¼ŒåŒæ—¶æä¾› https æœåŠ¡ã€‚å…¶ä¸­çš„ nginx åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶çš„çŠ¶æ€ä¸‹å¯èƒ½ä¼šé€ æˆæœåŠ¡çš„ä¸ç¨³å®šï¼Œæ‰€ä»¥ ingress çš„ nginx ç‰ˆæœ¬æ˜¯ä¸åŒçš„ï¼Œå…·ä½“é€»è¾‘è§ä¸‹å›¾ï¼š</p>
<p></p>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹</h3>
<h4 id="httpä»£ç†">httpä»£ç†</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">test.localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">app-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç° Ingress ä¾èµ–ä¸ svcï¼Œé¿å…ä¾èµ–åŠ¨æ€çš„æœåŠ¡å‰¯æœ¬æ•°é‡é¢‘ç¹é‡å¯ Ingress</p>
<h4 id="httpsä»£ç†">httpsä»£ç†</h4>
<p>åˆ›å»º https è¯ä¹¦ï¼Œä»¥åŠåˆ›å»º secret å¯¹è±¡è¿›è¡Œå­˜å‚¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºè¯ä¹¦</span>
</span></span><span class="line"><span class="cl">openssl req -x509 -sha256 -nodes -days <span class="m">365</span> -newkey rsa:2048 -keyout tls.key -out tls.crt -subj <span class="s2">&#34;/CN=nginxsvc /O=nginxsvc&#34;</span>
</span></span><span class="line"><span class="cl">kubectl create secret tls tls-secret --key tls.key --cert tls.crt
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">test.localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">tls-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">test.localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">app-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="basicauth">BasicAuth</h4>
<p>åˆ›å»ºå¯†é’¥å¯¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum -y install httpd-tools
</span></span><span class="line"><span class="cl">htpasswd -c auth foo
</span></span><span class="line"><span class="cl">kubectl create secret generic basic-auth --form-file<span class="o">=</span>auth
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-with-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">anntations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-type</span><span class="p">:</span><span class="w"> </span><span class="l">basic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-secret</span><span class="p">:</span><span class="w"> </span><span class="l">basic-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-realm</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Authentication Required - foo&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">test.localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">app-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="nginx-è¿›è¡Œé‡å†™">Nginx è¿›è¡Œé‡å†™</h4>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th>å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>nginx.ingress.kubernetes.io/rewrite-target</td>
<td>å¿…é¡»é‡å®šå‘æµé‡çš„ç›®æ ‡ URL</td>
<td>å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io/ssl-redirect</td>
<td>æŒ‡ç¤ºä½ç½®éƒ¨åˆ†æ˜¯å¦ä»…å¯è®¿é—®SSLï¼ˆå½“ Ingress åŒ…å«è¯ä¹¦æ—¶é»˜è®¤ä¸º trueï¼‰</td>
<td>å¸ƒå°”</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io/force-ssl-redirect</td>
<td>å³ä½¿ Ingress æœªå¯ç”¨ TLSï¼Œä¹Ÿå¼ºåˆ¶é‡å®šå‘åˆ° HTTPS</td>
<td>å¸ƒå°”</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io/app-root</td>
<td>å®šä¹‰ Controller å¿…é¡»é‡å®šå‘åˆ°åº”ç”¨ç¨‹åºæ ¹ï¼Œå¦‚æœå®ƒåœ¨ &lsquo;/&rsquo; ä¸Šä¸‹æ–‡ä¸­</td>
<td>å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io/use-regex</td>
<td>æŒ‡ç¤º Ingress ä¸Šå®šä¹‰å½“è·¯å¾„æ˜¯å¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</td>
<td>å¸ƒå°”</td>
</tr>
</tbody>
</table>
<h2 id="9å­˜å‚¨">9ã€å­˜å‚¨</h2>
<blockquote>
<p>K8S é›†ç¾¤ä¸­å­˜å‚¨å¸¸ç”¨çš„æœ‰ä»¥ä¸‹ 4 ç§</p>
<ol>
<li>ConfigMap: ä¸€èˆ¬ç”¨äºå­˜å‚¨é…ç½®ä¿¡æ¯</li>
<li>Secret: å­˜å‚¨ä¸€äº›å®‰å…¨ç±»å‹çš„å†…å®¹ï¼Œä¾‹å¦‚å­˜å‚¨å¯†é’¥</li>
<li>Volume: å·ï¼Œå¯ä»¥ä¿éšœ Pod çº§åˆ«çš„æ–‡ä»¶å­˜å‚¨</li>
<li>Persistent Volume: æŒä¹…å·</li>
</ol>
</blockquote>
<h3 id="configmap">ConfigMap</h3>
<h4 id="æè¿°">æè¿°</h4>
<p>ConfigMap åŠŸèƒ½åœ¨ Kubernetes 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºä¼šä»é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ConfigMap å¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ–è€… JSON äºŒè¿›åˆ¶ç­‰å¯¹è±¡</p>
<h4 id="åˆ›å»º">åˆ›å»º</h4>
<p><strong>ä½¿ç”¨ç›®å½•åˆ›å»º</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ls /root/game
</span></span><span class="line"><span class="cl"><span class="c1"># game.file</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ui.file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat /root/game/game.file
</span></span><span class="line"><span class="cl"><span class="c1"># version=1.17</span>
</span></span><span class="line"><span class="cl"><span class="c1"># name=dave</span>
</span></span><span class="line"><span class="cl"><span class="c1"># age=18</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat /root/game/ui.file
</span></span><span class="line"><span class="cl"><span class="c1"># level=2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># color=yellow</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl create configmap game-config --from-file<span class="o">=</span>/root/game
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>-from-file</code>æŒ‡å®šåœ¨ç›®å½•ä¸‹å½“æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ ConfigMap é‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åç§°å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹</p>
<p><strong>ä½¿ç”¨æ–‡ä»¶åˆ›å»º</strong></p>
<p>åªè¦æŒ‡å®šä¸ºä¸€ä¸ªæ–‡ä»¶å°±å¯ä»¥ä»å•æ–‡ä»¶ä¸­åˆ›å»º ConfigMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create configmap game-config-2 --from-file<span class="o">=</span>/root/game/game.file
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>--form-file</code>è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€å¯ä»¥ä½¿ç”¨ä¸¤æ¬¡åˆ†åˆ«æŒ‡å®šä¸‰ä¸ªå®ä¾‹ä¸­çš„é‚£ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ•ˆæœå’ŒæŒ‡å®šæ•´ä¸ªç›®å½•æ˜¯ä¸€æ ·çš„</p>
<p><strong>ä½¿ç”¨å­—é¢å€¼åˆ›å»º</strong></p>
<p>ä½¿ç”¨æ–‡å­—åˆ›å»ºï¼Œåˆ©ç”¨<code>-from-literal</code>å‚æ•°ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¯¥å‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œæ ¼å¼å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create configmap literal-config --from-literal<span class="o">=</span><span class="nv">name</span><span class="o">=</span>dave --from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span>pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get configmap literal-config -o yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>
<h5 id="ä½¿ç”¨-configmap-æ¥ä»£æ›¿ç¯å¢ƒå˜é‡">ä½¿ç”¨ ConfigMap æ¥ä»£æ›¿ç¯å¢ƒå˜é‡</h5>
<p>åˆ›å»ºä¸¤ä¸ª ConfigMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dave</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">pass</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">env-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="l">INFO</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ Pod ä¸­ä½¿ç”¨ ConfigMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-env-test-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;env&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># å•ä¸ªæŒ‡å®š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">USERNAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">PASSWORD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueForm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">password</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">envFrom</span><span class="p">:</span><span class="w"> </span><span class="c"># æ‰¹é‡æ³¨å…¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">configMapRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">env-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ä½¿ç”¨-configmap-è®¾ç½®å‘½ä»¤è¡Œå‚æ•°">ä½¿ç”¨ ConfigMap è®¾ç½®å‘½ä»¤è¡Œå‚æ•°</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-env-test-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;echo $(USERNAME) $(PASSWORD)&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># å•ä¸ªæŒ‡å®š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">USERNAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">PASSWORD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueForm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">password</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é€šè¿‡æ•°æ®å·æ’ä»¶ä½¿ç”¨-configmap">é€šè¿‡æ•°æ®å·æ’ä»¶ä½¿ç”¨ ConfigMap</h5>
<p>åœ¨æ•°æ®å·é‡Œé¢ä½¿ç”¨è¿™ä¸ª ConfigMapï¼Œæœ‰ä¸åŒçš„é€‰é¡¹ã€æœ€åŸºæœ¬çš„å°±æ˜¯å°†æ–‡ä»¶å¡«å…¥æ•°æ®å·ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé”®å°±æ˜¯æ–‡ä»¶åç§°ï¼Œå€¼å°±æ˜¯æ–‡ä»¶å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-volume-test-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">literal-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="çƒ­æ›´æ–°">çƒ­æ›´æ–°</h5>
<p>åœ¨é€šè¿‡æ•°æ®å·æ’ä»¶çš„å½¢å¼ä½¿ç”¨ ConfigMap æ—¶ï¼Œå¯ä»¥è¾¾åˆ°<strong>çƒ­æ›´æ–°</strong>çš„ç›®çš„ï¼Œä¿®æ”¹ ConfigMap ä¹‹åï¼Œåœ¨ Pod ä¸­çš„å¯¹åº”æ–‡ä»¶å†…å®¹ä¹Ÿå°†ä¿®æ”¹æˆå¯¹åº”ä¿®æ”¹åçš„å†…å®¹</p>
<p>åˆ›å»ºåˆå§‹ ConfigMap &amp; Pod</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># åˆå§‹å†…å®¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-cofnig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="l">INFO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hot-update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">my-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-config</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> pod-xxx cat /etc/config/log_level
</span></span><span class="line"><span class="cl"><span class="c1"># INFO</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ ConfigMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit cm log-config
</span></span><span class="line"><span class="cl"><span class="c1"># log_level=ERROR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ¬¡æŸ¥çœ‹å†…å®¹ï¼Œéœ€è¦ä¸€å®šæ—¶é—´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> pod-xxx cat /etc/config/log_level
</span></span><span class="line"><span class="cl"><span class="c1"># ERROR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>**æ³¨æ„ï¼š**å¦‚æœ configMap ä»¥ ENV çš„æ–¹å¼æŒ‚è½½ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå®ç°çƒ­æ›´æ–°</p>
<h5 id="æ»šåŠ¨æ›´æ–°pod">æ»šåŠ¨æ›´æ–°Pod</h5>
<p>åœ¨æ›´æ–° ConfigMap ä¹‹åå¹¶ä¸ä¼šè§¦å‘ Pod çš„æ»šåŠ¨æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ Pod annotations çš„æ–¹å¼æ¥å¼ºåˆ¶å‡ºå‘æ»šåŠ¨æ›´æ–°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl patch deploy my-nginx --patch <span class="s1">&#39;{&#34;spec&#34;: {&#34;template&#34;: {&#34;metadata&#34;: {&#34;anntations&#34;: {&#34;version/config&#34;: &#34;20190411&#34;}}}}}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬åœ¨<code>.spec.template.metadata.annotations</code>ä¸­æ·»åŠ <code>version/config</code>ï¼Œæ¯æ¬¡é€šè¿‡ä¿®æ”¹<code>version/config</code>æ¥è§¦å‘æ»šåŠ¨æ›´æ–°</p>
<h3 id="secret">Secret</h3>
<p>è§£å†³äº†å¯†ç ã€tokenã€å¯†é’¥ç­‰æ•æ„Ÿæ•°æ®ç­‰é…ç½®é—®é¢˜ï¼Œè€Œä¸éœ€è¦æŠŠè¿™äº›æ•æ„Ÿæ•°æ®æš´éœ²åˆ°é•œåƒæˆ–è€… Pod Spec ä¸­ã€‚Secret å¯ä»¥ä»¥ Volume æˆ–è€…ç¯å¢ƒå˜é‡æ–¹å¼ä½¿ç”¨</p>
<p>Secretæœ‰ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li><strong>Service Account</strong>ï¼šç”¨æ¥è®¿é—® Kubernetes APIï¼Œç”± Kubernetes è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ° Pod çš„ <code>/run/secrets/kubernetes.io/serviceaccount</code>ç›®å½•ä¸­</li>
<li><strong>Opaque</strong>ï¼šbase64 ç¼–ç æ ¼å¼çš„ Secretï¼Œç”¨æ¥å­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰</li>
<li><strong>kubernetes.io/dockerconfigjson</strong>ï¼šç”¨æ¥å­˜æ”¾ç§æœ‰ docker ä»“åº“ç­‰è®¤è¯ä¿¡æ¯</li>
</ul>
<h4 id="service-account">Service Account</h4>
<p>ç”¨æ¥è®¿é—® Kubernetes APIï¼Œç”± Kubernetes è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ° Pod çš„ <code>/run/secrets/kubernetes.io/serviceaccount</code>ç›®å½•ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> pod-xxx -- ls /run/secrets/kubernetes.io/serviceaccount
</span></span><span class="line"><span class="cl"><span class="c1"># ca.crt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># namespace</span>
</span></span><span class="line"><span class="cl"><span class="c1"># token</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="opaque-secret">Opaque Secret</h4>
<p>Opaque ç±»å‹çš„æ•°æ®æ˜¯ä¸€ä¸ª map ç±»å‹ï¼Œè¦æ±‚ value æ˜¯ base64 ç¼–ç æ ¼å¼</p>
<h5 id="åˆ›å»º-1">åˆ›å»º</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">echo</span> -n <span class="s2">&#34;admin&#34;</span> <span class="p">|</span> base64
</span></span><span class="line"><span class="cl"><span class="nv">YWRtaW4</span><span class="o">=</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> -n <span class="s2">&#34;123456&#34;</span> <span class="p">|</span> base64
</span></span><span class="line"><span class="cl">MTIzNDU2
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>secrets.yaml</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mysecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Opaque</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">YWRtaW4=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">MTIzNDU2</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>secret åœ¨æŒ‚è½½åä¼šè‡ªåŠ¨è§£å¯†</p>
</blockquote>
<h5 id="ä½¿ç”¨-1">ä½¿ç”¨</h5>
<p><strong>1ã€å°† Secret æŒ‚è½½åˆ° Volume ä¸­</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volumes12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">mysecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volumes12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/data&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2ã€å°† Secret å¯¼å‡ºåˆ°ç¯å¢ƒå˜é‡ä¸­</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pod-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">pod-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pod-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">TEST_USER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mysecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">username</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">TEST_PASSWORD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mysecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">password</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="kubernetesiodockerconfigjson">kubernetes.io/dockerconfigjson</h4>
<p>ä½¿ç”¨ kubectl åˆ›å»º docker ä»“åº“è®¤è¯çš„ secret</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl create secret docker-registry myregistrykey <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--docker-server<span class="o">=</span>DOCKER_REGISTRY_SERVER <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--docker-username<span class="o">=</span>DOCKER_USER <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--docker-password<span class="o">=</span>DOCKER_PASSWOED <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--docker-email<span class="o">=</span>DOCKER_EMAIL
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">secret <span class="s2">&#34;myregistrykey&#34;</span> createdã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åˆ›å»º Pod çš„æ—¶å€™ï¼Œé€šè¿‡ <code>imagePullSecrets</code>æ¥å¼•ç”¨åˆšåˆ›å»ºçš„<code>myregistrykey</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hub.xxx.com/xxx/xxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myregistrykey</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="volumeå·">Volumeã€Œå·ã€</h3>
<p>å®¹å™¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ç­‰ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œè¿™å°±ä½¿å¾—åœ¨å®¹å™¨ä¸­è¿è¡Œé‡è¦åº”ç”¨æ—¶ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œå½“å®¹å™¨å´©æºƒæ—¶ï¼Œkubelet ä¼šé‡å¯å®ƒï¼Œä½†æ˜¯å®¹å™¨ä¸­çš„æ–‡ä»¶å°†ä¸¢å¤±ï¼Œå®¹å™¨å°†ä»¥å¹²å‡€çš„çŠ¶æ€ï¼ˆé•œåƒæœ€åˆçš„çŠ¶æ€ï¼‰é‡æ–°å¯åŠ¨ã€‚å…¶æ¬¡ï¼Œåœ¨<code>Pod</code>ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªå®¹å™¨æ—¶ï¼Œè¿™äº›å®¹å™¨ä¹‹é—´é€šå¸¸éœ€è¦å…±äº«æ–‡ä»¶ã€‚Kubernetes ä¸­çš„ <code>Volume</code> æŠ½è±¡å°±å¾ˆå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚</p>
<p>Kubernetes ä¸­çš„å·æœ‰æ˜ç¡®çš„å¯¿å‘½ï¼ˆä¸å°è£…å®ƒçš„ Pod ç›¸åŒï¼‰ã€‚æ‰€ä»¥ï¼Œå·çš„ç”Ÿå‘½æ¯” Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é•¿ï¼Œå½“è¿™ä¸ªå®¹å™¨é‡å¯æ—¶æ•°æ®ä»ç„¶å¾—ä»¥ä¿å­˜ã€‚å½“ç„¶ï¼Œå½“ Pod ä¸å†å­˜åœ¨æ—¶ï¼Œå·ä¹Ÿå°†ä¸å¤å­˜åœ¨ã€‚ä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯ï¼ŒKubernetes æ”¯æŒå¤šç§ç±»å‹çš„å·ï¼ŒPod å¯ä»¥åŒæ—¶ä½¿ç”¨ä»»æ„æ•°é‡çš„å·</p>
<p><strong>ç±»å‹</strong></p>
<p>kubernetes æ”¯æŒä»¥ä¸‹ç±»å‹çš„å·ï¼š</p>
<ul>
<li><code>csi</code> é€šç”¨å­˜å‚¨æ¥å£</li>
<li><code>hostPath</code> ä¸»æœºè·¯å¾„ï¼ˆä¸èƒ½é™åˆ¶ä½¿ç”¨é‡ï¼‰</li>
<li><code>emptyDir</code> ç©ºç›®å½•</li>
<li><code>awsElasticBlockStore</code> <code>azureDisk</code> <code>azureFile</code> <code>cephfs</code>  <code>downwardAPI</code></li>
<li><code>fc</code> <code>flocker</code> <code>gcePersistentDisk</code> <code>gitRepo</code> <code>glusterfs</code> <code>hostPath</code> <code>iscsi</code> <code>local</code> <code>nfs</code></li>
<li><code>persistentVolumeClaim</code> <code>projected</code> <code>portworxVolume</code> <code>quobyte</code> <code>rbd</code> <code>scaleIO</code> <code>secret</code></li>
<li><code>storageos</code> <code>vsphereVolume</code></li>
</ul>
<h5 id="emptydir">emptyDir</h5>
<p>å½“ Pod è¢«åˆ†é…ç»™èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆåˆ›å»º <code>emptyDir</code> å·ï¼Œå¹¶ä¸”åªè¦è¯¥ Pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè¯¥å·å°±ä¼šå­˜åœ¨ã€‚æ­£å¦‚å·åå­—æ‰€è¿°ï¼Œå®ƒæœ€åˆæ—¶ç©ºçš„ã€‚Pod ä¸­çš„å®¹å™¨å¯ä»¥è¯»å–å–å†™å…¥ <code>emptyDir</code> å·ä¸­çš„ç›¸åŒæ–‡ä»¶ï¼Œå°½ç®¡è¯¥å·å¯ä»¥æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­çš„ç›¸åŒæˆ–ä¸åŒè·¯å¾„ä¸Šã€‚å½“å‡ºäºä»»ä½•åŸå› ä»èŠ‚ç‚¹ä¸­åˆ é™¤ Pod æ—¶ï¼Œ<code>empryDir</code> ä¸­çš„æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤</p>
<p>âš ï¸<strong>æ³¨æ„ï¼š</strong> å®¹å™¨å´©æºƒä¸ä¼šä»èŠ‚ç‚¹ä¸­ç§»é™¤ Podï¼Œå› æ­¤ <code>emptyDir</code> å·ä¸­çš„æ•°æ®åœ¨å®¹å™¨å´©æºƒæ—¶æ˜¯å®‰å…¨çš„</p>
<p>ç”¨æ³•ï¼š</p>
<ul>
<li>æš‚å­˜ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºåŸºäºç£ç›˜çš„åˆå¹¶æ’åºã€ç”¨ä½œé•¿æ—¶é—´è®¡ç®—å´©æºƒæ¢å¤æ—¶çš„æ£€æŸ¥ç‚¹</li>
<li>Web æœåŠ¡å™¨å®¹å™¨æä¾›æ•°æ®æ—¶ï¼Œä¿å­˜å†…å®¹ç®¡ç†å™¨æå–çš„æ–‡ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">batch/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">jobs-empty</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spce</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initContainers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox:1.34.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sh&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;-c&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">              for i in 1 2 3;
</span></span></span><span class="line"><span class="cl"><span class="sd">              do
</span></span></span><span class="line"><span class="cl"><span class="sd">                echo &#34;job-1 `date`&#34;;
</span></span></span><span class="line"><span class="cl"><span class="sd">                sleep 1s;
</span></span></span><span class="line"><span class="cl"><span class="sd">              done;
</span></span></span><span class="line"><span class="cl"><span class="sd">              echo job-1 GG &gt; /src/input/code</span><span class="w">              
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w"> </span><span class="c"># æŒ‚è½½ä¸€ä¸ªå·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/src/input/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job-2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox:1.34.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sh&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;-c&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">              for i in 1 2 3;
</span></span></span><span class="line"><span class="cl"><span class="sd">              do
</span></span></span><span class="line"><span class="cl"><span class="sd">                echo &#34;job-2 `date`&#34;;
</span></span></span><span class="line"><span class="cl"><span class="sd">                sleep 1s;
</span></span></span><span class="line"><span class="cl"><span class="sd">              done;
</span></span></span><span class="line"><span class="cl"><span class="sd">              cat /src/input/code &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="sd">              echo job-2 GG &gt; /sec/input/output/file</span><span class="w">              
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w"> </span><span class="c"># æŒ‚è½½ä¸¤ä¸ªå·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/src/input/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/src/input/output/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">job-3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox:1.34.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sh&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;-c&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">              echo &#34;job-1 and job-2 completed&#34;;
</span></span></span><span class="line"><span class="cl"><span class="sd">              sleep 3s;
</span></span></span><span class="line"><span class="cl"><span class="sd">              cat /src/output/file</span><span class="w">              
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/src/output/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="hostpath">hostPath</h5>
<p><code>hostPath</code> å·å°†ä¸»æœºèŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°é›†ç¾¤ä¸­</p>
<p>ç”¨é€”å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¿è¡Œéœ€è¦è®¿é—® Docker å†…éƒ¨çš„å®¹å™¨ï¼›ä½¿ç”¨ <code>/var/lib/docker</code> çš„ <code>hostPath</code></li>
<li>åœ¨å®¹å™¨ä¸­è¿è¡Œ cAdvisor; ä½¿ç”¨ <code>/dev/cgroups</code> çš„ <code>hostPath</code></li>
<li>å…è®¸ Pod æŒ‡å®šç»™å®šçš„ hostPath æ˜¯å¦åº”è¯¥åœ¨ Pod è¿è¡Œä¹‹å‰å­˜åœ¨ï¼Œæ˜¯å¦åº”è¯¥åˆ›å»ºï¼Œä»¥åŠå®ƒåº”è¯¥ä»¥ä»€ä¹ˆå½¢å¼å­˜åœ¨</li>
</ul>
<p>é™¤äº†æ‰€éœ€çš„ <code>path</code> å±æ€§ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥ä¸º hostPath å·æŒ‡å®š type</p>
<table>
<thead>
<tr>
<th>å€¼</th>
<th>è¡Œä¸º</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>ç©ºå­—ç¬¦ä¸²ï¼ˆé»˜è®¤ï¼‰ç”¨äºå‘åå…¼å®¹ï¼Œè¿™æ„å‘³ç€åœ¨æŒ‚è½½ hostPath å·ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ£€æŸ¥</td>
</tr>
<tr>
<td><code>DirectoryOrCreate</code></td>
<td>å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„æ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ ¹æ®éœ€è¦åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œæƒé™è®¾ç½®ä¸º 0755ï¼Œä¸ kubelet å…·æœ‰ç›¸åŒçš„ç»„å–æ‰€æœ‰æƒ</td>
</tr>
<tr>
<td><code>Directory</code></td>
<td>ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨ç›®å½•</td>
</tr>
<tr>
<td><code>FileOrCreate</code></td>
<td>å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„æ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ ¹æ®éœ€è¦åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0655ï¼Œä¸ kubelet å…·æœ‰ç›¸åŒçš„ç»„å–æ‰€æœ‰æƒ</td>
</tr>
<tr>
<td><code>File</code></td>
<td>ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨æ–‡ä»¶</td>
</tr>
<tr>
<td><code>Socket</code></td>
<td>ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨ UNIX å¥—æ¥å­—</td>
</tr>
<tr>
<td><code>CharDevice</code></td>
<td>ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å­—ç¬¦è®¾å¤‡</td>
</tr>
<tr>
<td><code>BlockDevice</code></td>
<td>ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å—è®¾å¤‡</td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨è¿™ç§å·ç±»å‹æ—¶è¯·æ³¨æ„ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>ç”±äºæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶éƒ½ä¸åŒï¼Œå…·æœ‰ç›¸åŒé…ç½®ï¼ˆä¾‹å¦‚ä» PodTemplate åˆ›å»ºçš„ï¼‰çš„ Pod åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„è¡Œä¸ºä¼šæœ‰æ‰€ä¸åŒ</li>
<li>å½“ Kubernetes æŒ‰ç…§è®¡åˆ’æ·»åŠ èµ„æºæ„ŸçŸ¥è°ƒåº¦æ—¶ï¼Œå°†æ— æ³•è€ƒè™‘ <code>hostPath</code> ä½¿ç”¨çš„èµ„æº</li>
<li>åœ¨åº•å±‚ä¸»æœºä¸Šåˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•åªèƒ½ç”± root å†™å…¥ï¼Œæ‚¨éœ€è¦åœ¨ç‰¹æƒå®¹å™¨ä¸­ä»¥ root èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œæˆ–ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶æƒé™ä»¥ä¾¿å†™å…¥ hostPath å·</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-pd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/test-pd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Dirctory</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="persistent-volumeæŒä¹…å·">Persistent Volumeã€ŒæŒä¹…å·ã€</h3>
<h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4>
<p><strong>PersistentVolumeï¼ˆPVï¼‰</strong></p>
<p>æ˜¯ç”±ç®¡ç†å‘˜è®¾ç½®çš„å­˜å‚¨ï¼Œå®ƒæ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„èµ„æºä¸€æ ·ï¼ŒPV ä¹Ÿæ˜¯é›†ç¾¤ä¸­çš„èµ„æºã€‚PV æ˜¯ Volume ä¹‹ç±»çš„å·æ’ä»¶ï¼Œä½†å…·æœ‰ç‹¬ç«‹äºä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚æ­¤ API å¯¹è±¡åŒ…å«å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œå³ NFSã€ISCSI æˆ–ç‰¹å®šäºäº‘ä¾›åº”å•†çš„å­˜å‚¨ç³»ç»Ÿ</p>
<p><strong>PersistentVolumeClaimï¼ˆPVCï¼‰</strong></p>
<p>æ˜¯ç”¨æˆ·å­˜å‚¨çš„è¯·æ±‚ï¼Œå®ƒä¸ Pod ç›¸ä¼¼ã€‚Pod æ¶ˆè€—èŠ‚ç‚¹èµ„æºï¼ŒPVC æ¶ˆè€— PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šçº§åˆ«çš„èµ„æºï¼ˆCPU å’Œ å†…å­˜ï¼‰ã€‚å£°æ˜å¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼šå¯ä»¥ä»¥è¯»/å†™ä¸€æ¬¡æˆ–åªè¯»å¤šæ¬¡æ¨¡å¼æŒ‚è½½ï¼‰</p>
<p><strong>é™æ€PV</strong></p>
<p>é›†ç¾¤ç®¡ç†å‘˜åˆ›å»ºä¸€äº› PVã€‚å®ƒä»¬å¸¦æœ‰å¯ä¾›é›†ç¾¤ç”¨æˆ·ä½¿ç”¨çš„å®é™…å­˜å‚¨çš„ç»†èŠ‚ã€‚å®ƒä»¬å­˜åœ¨äº Kuberneters API ä¸­ï¼Œå¯ç”¨äºæ¶ˆè´¹ã€‚</p>
<p><strong>åŠ¨æ€PV</strong></p>
<p>å½“ç®¡ç†å‘˜åˆ›å»ºçš„é™æ€ PV éƒ½ä¸åŒ¹é…ç”¨æˆ·çš„ <code>PVC</code> æ—¶ï¼Œé›†ç¾¤å¯èƒ½ä¼šå°è¯•åŠ¨æ€çš„ä¸º PVC åˆ›å»ºå·ã€‚æ­¤é…ç½®åŸºäº <code>StorageClasses</code>ï¼š PVC å¿…é¡»è¯·æ±‚ ã€Œå­˜å‚¨ç±»ã€ï¼Œå¹¶ä¸”ç®¡ç†å‘˜å¿…é¡»åˆ›å»ºå¹¶é…ç½®è¯¥ç±»æ‰èƒ½è¿›è¡ŒåŠ¨æ€åˆ›å»ºã€‚å£°æ˜è¯¥ç±»ä¸º <code>&quot;&quot;</code> å¯ä»¥æœ‰æ•ˆçš„ç¦ç”¨å…¶åŠ¨æ€é…ç½®</p>
<p>è¦å¯ç”¨åŸºäºå­˜å‚¨çº§åˆ«çš„åŠ¨æ€å­˜å‚¨é…ç½®ï¼Œé›†ç¾¤ç®¡ç†å‘˜éœ€è¦å¯ç”¨ API server ä¸Šçš„ <code>DefaultStorageClass</code>ã€Œå‡†å…¥æ§åˆ¶å™¨ã€ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ç¡®ä¿ <code>DefaultStorageClass</code> ä½äº API server ç»„ä»¶çš„ <code>--admission-control</code> æ ‡å¿—ï¼Œä½¿ç”¨é€—å·åˆ†éš”çš„æœ‰åºå€¼åˆ—è¡¨ä¸­ï¼Œå¯ä»¥å®Œæˆæ­¤æ“ä½œ</p>
<h4 id="ç»‘å®š">ç»‘å®š</h4>
<p>master ä¸­çš„æ§åˆ¶ç¯è·¯ç›‘å¬æ–°çš„ PVCï¼Œå¯»æ‰¾åŒ¹é…çš„ PVï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚å¦‚æœä¸ºæ–°çš„ PVC åŠ¨æ€æ‰é… PVï¼Œåˆ™è¯¥ç¯è·¯å°†å§‹ç»ˆå°† PV ç»‘å®šåˆ° PVCï¼Œå¦åˆ™ç”¨æˆ·æ€»ä¼šå¾—åˆ°ä»–ä»¬æ‰€è¯·æ±‚çš„å­˜å‚¨ï¼Œä½†æ˜¯å®¹é‡å¯èƒ½è¶…å‡ºè¦æ±‚çš„æ•°é‡ã€‚ä¸€æ—¦ PV å’Œ PVC ç»‘å®šåï¼Œ<code>PersistentVolumeClaim</code> ç»‘å®šæ˜¯æ’ä»–æ€§çš„ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦‚ä½•ç»‘å®šçš„ã€‚PVC è·Ÿ PV ç»‘å®šæ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„</p>
<h4 id="ä¿æŠ¤">ä¿æŠ¤</h4>
<p>PVC ä¿æŠ¤çš„ç›®çš„æ˜¯ç¡®ä¿ç”± Pod æ­£åœ¨ä½¿ç”¨çš„ PVC ä¸ä¼šä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œå› ä¸ºå¦‚æœè¢«ç§»é™¤çš„è¯å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</p>
<p>âš ï¸**æ³¨æ„ï¼š**å½“ Pod çŠ¶æ€ä¸º <code>Pending</code> å¹¶ä¸” Pod å·²ç»åˆ†é…ç»™èŠ‚ç‚¹æˆ– Pod ä¸º <code>Running</code> çŠ¶æ€æ—¶ï¼ŒPVCå¤„äºæ´»è·ƒçŠ¶æ€</p>
<p>å½“å¯ç”¨ PVC ä¿æŠ¤ alpha åŠŸèƒ½æ—¶ï¼Œå¦‚æœç”¨æˆ·åˆ é™¤äº†ä¸€ä¸ª Pod æ­£åœ¨ä½¿ç”¨çš„ PVCï¼Œåˆ™è¯¥ PVC ä¸ä¼šè¢«ç«‹å³åˆ é™¤ã€‚PVC çš„åˆ é™¤å°†è¢«æ¨è¿Ÿï¼Œç›´åˆ° PVC ä¸å†è¢«ä»»ä½• Pod ä½¿ç”¨</p>
<h4 id="åˆ†ç±»">åˆ†ç±»</h4>
<p><code>PersistentVolume</code> ç±»å‹ä»¥æ’ä»¶å½¢å¼å‡ºç°ã€‚Kubernetes ç›®å‰æ”¯æŒä»¥ä¸‹æ’ä»¶ç±»å‹ï¼š</p>
<ul>
<li><code>HostPath</code></li>
<li><code>GCEPersistentDisk</code> <code>AWSElasticBlockStore</code> <code>AzureFile</code> <code>AzureDisk</code> <code>FC(Fibre Channel)</code></li>
<li><code>FlexVolume</code> <code>Flocker</code> <code>NFS</code> <code>iSCSI</code> <code>RBD</code> <code>CephFS</code> <code>Cinder(OpenStack block storage)</code></li>
<li><code>Glusterfs</code> <code>VsphereVolume</code> <code>Quobyte Volumes</code> <code>Vmware Photon</code> <code>Portworx Voumes</code></li>
<li><code>ScaleIO Volumes</code> <code>StorageOS</code></li>
</ul>
<p><strong>æŒä¹…å·ç¤ºä¾‹ä»£ç </strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pv0001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w"> </span><span class="c"># å®¹é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">5Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l">Filesystem</span><span class="w"> </span><span class="c"># å·æ¨¡å¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="c"># è®¿é—®ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Recycle</span><span class="w"> </span><span class="c"># å›æ”¶ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">slow</span><span class="w"> </span><span class="c"># å­˜å‚¨ç±»åç§° é»˜è®¤ä¸º StorageClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mountOptions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">hard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">nfsvers=4.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">172.17.0.2</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è®¿é—®æ¨¡å¼">è®¿é—®æ¨¡å¼</h4>
<p>PV å¯ä»¥ä»¥èµ„æºæä¾›è€…æ”¯æŒçš„ä»»ä½•å½¢å¼æŒ‚è½½åˆ°ä¸»æœºä¸Šã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œä¾›åº”å•†å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œæ¯ä¸ª PV çš„è®¿é—®æ¨¡å¼éƒ½å°†è¢«è®¾ç½®ä¸ºè¯¥å·æ”¯æŒçš„ç‰¹å®šæ¨¡å¼ã€‚ä¾‹å¦‚ï¼ŒNFS å¯ä»¥æ”¯æŒå¤šä¸ªè¯»/å†™å®¢æˆ·ç«¯ï¼Œä½†ç‰¹å®šçš„ NFS PV å¯èƒ½ä»¥åªè¯»æ–¹å¼å¯¼å‡ºåˆ°æœåŠ¡å™¨ä¸Šã€‚æ¯ä¸ª PV éƒ½æœ‰ä¸€å¥—è‡ªå·±çš„ç”¨æ¥æè¿°ç‰¹å®šåŠŸèƒ½çš„è®¿é—®æ¨¡å¼</p>
<ul>
<li><strong>ReadWriteOnce</strong> è¯¥å·å¯ä»¥è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½</li>
<li><strong>ReadOnlyMany</strong> è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ¨¡å¼æŒ‚è½½</li>
<li><strong>ReadWriteMany</strong> è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½</li>
</ul>
<p><strong>åœ¨å‘½ä»¤è¡Œä¸­ï¼Œè®¿é—®æ¨¡å¼ç¼©å†™ä¸ºï¼š</strong></p>
<ul>
<li><strong>RWO</strong> - ReadWriteOnce</li>
<li><strong>ROX</strong> - ReadOnlyMany</li>
<li><strong>ReadWriteMany</strong> - RWX</li>
</ul>
<p>âš ï¸**æ³¨æ„ï¼š**ä¸€ä¸ªå·ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ç§è®¿é—®æ¨¡å¼æŒ‚è½½ï¼Œå³ä½¿å®ƒæ”¯æŒå¾ˆå¤šè®¿é—®æ¨¡å¼ã€‚ä¾‹å¦‚ï¼ŒGCRPersistentDisk å¯ä»¥ç”±å•ä¸ªèŠ‚ç‚¹ä½œä¸º ReadWriteOnce æ¨¡å¼æŒ‚è½½ï¼Œæˆ–ç”±å¤šä¸ªèŠ‚ç‚¹ä»¥ ReadOnlyMany æ¨¡å¼æŒ‚è½½ï¼Œä½†ä¸èƒ½åŒæ—¶æŒ‚è½½</p>
<h4 id="å›æ”¶ç­–ç•¥">å›æ”¶ç­–ç•¥</h4>
<ul>
<li>Retainï¼ˆä¿ç•™ï¼‰ï¼šæ‰‹åŠ¨å›æ”¶</li>
<li>Recycleï¼ˆå›æ”¶ï¼‰ï¼šåŸºæœ¬æ“¦é™¤ï¼ˆ<code>rm -rf /thevolume/*</code>ï¼‰</li>
<li>Deleteï¼ˆåˆ é™¤ï¼‰ï¼šå…³è”çš„å­˜å‚¨èµ„äº§ï¼ˆä¾‹å¦‚ AWS EBS&hellip;ï¼‰å°†è¢«åˆ é™¤</li>
</ul>
<p>å½“å‰ï¼Œåªæœ‰ HostPath æ”¯æŒå›æ”¶ç­–ç•¥ï¼ŒAWS EBSã€GCE PDã€Azure Disk å’Œ Cinder å·æ”¯æŒåˆ é™¤ç­–ç•¥</p>
<h4 id="çŠ¶æ€">çŠ¶æ€</h4>
<p>å·å¯ä»¥å¤„äºä¸€ä¸‹çš„æŸç§çŠ¶æ€ï¼š</p>
<ul>
<li>Availableï¼ˆå¯ç”¨ï¼‰ï¼šä¸€å—ç©ºé—²èµ„æºè¿˜æ²¡æœ‰è¢«ä»»ä½•å£°æ˜ç»‘å®š</li>
<li>Boundï¼ˆå·²ç»‘å®šï¼‰ï¼šå·å·²ç»è¢«å£°æ˜ç»‘å®š</li>
<li>Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼šå£°æ˜è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜</li>
<li>Failedï¼ˆå¤±è´¥ï¼‰ï¼šè¯¥å·çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
<p>å‘½ä»¤è¡Œä¼šæ˜¾ç¤ºç»‘å®šåˆ° PV çš„ PVC çš„åç§°</p>
]]></description>
</item><item>
  <title>MySQLåŠ¨æ€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ã€Œè½¬ã€</title>
  <link>https://ronin-zc.com/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/</link>
  <pubDate>Tue, 17 May 2022 11:00:00 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%BD%AC%E8%BD%BD/</guid>
  <description><![CDATA[<h2 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h2>
<p>æœ€è¿‘åœ¨è€ƒè™‘PAASç§»åŠ¨å¹³å°çš„â€åŠ¨æ€å­—æ®µå­˜å‚¨â€é—®é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯å‰æ®µæŸé¡µé¢ä¸­çš„è¡¨å•åŠ¨æ€å¢åŠ ä¸€ä¸ªç¼–è¾‘æ¡†ï¼Œä»¥æŸä¸€ä¸ªæ–°å­—æ®µçš„å½¢å¼æäº¤åˆ°åç«¯ï¼Œåç«¯æ¥å£èƒ½å¤Ÿåœ¨ä¸å¢åŠ æ–°çš„è¡¨å­—æ®µä¸”åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ä»£ç çš„æ–¹å¼å­˜å‚¨èµ·æ¥ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå…³ç³»å‹æ•°æ®åº“MySQLçš„æ•°æ®è¡¨åœ¨ä¿®æ”¹è¡¨å­—æ®µæ—¶ï¼Œä»£ä»·æ¯”è¾ƒå¤§ï¼Œç”šè‡³å‡ºç°é”è¡¨å¯¼è‡´æœåŠ¡å¥”æºƒã€‚æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»ç„¶åŸºäºMySQLï¼Œå¯¹æ¯”äº†ä¸¤ç§å¯è¡Œçš„æ–¹æ³•ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<h2 id="äºŒåŠ¨æ€ç»“æ„">äºŒã€åŠ¨æ€ç»“æ„</h2>
<p>å…³ç³»æ•°æ®åº“éå¸¸é€‚åˆå…·æœ‰å¤§é‡å…³ç³»çš„ç»“æ„åŒ–æ•°æ®ï¼Œå®ƒæ‰€å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯é¢„å…ˆèƒ½å¤Ÿå®šä¹‰å‡ºæ¸…æ™°çš„ç»“æ„ï¼Œå¹¶ä¸”çŸ­æœŸæˆ–æ›´é•¿çš„æ—¶é—´å†…ç»“æ„ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä½†æ˜¯ä¸šåŠ¡æ€»æ˜¯ä¸æ–­åœ¨å˜åŒ–çš„ï¼Œä¸šåŠ¡åœ¨æ‰©å±•ï¼Œå­˜å‚¨çš„ä¿¡æ¯å¿…ç„¶æ›´å¤šæ›´å¹¿ï¼Œè¡¨ç»“æ„å‘ç”Ÿå˜åŒ–å‡ ä¹æ˜¯ä¸å¯é¿å…ã€‚</p>
<p>ä¸ºäº†è§£å†³â€åŠ¨æ€ç»“æ„â€çš„é—®é¢˜ä¹Ÿæœ‰ä¸å°‘è½»æ˜“èƒ½å¤Ÿæƒ³åˆ°çš„æ–¹æ³•ï¼š</p>
<ol>
<li><strong>åˆ—æ¨¡å‹</strong>ï¼šå°±æ˜¯å¸¸è¯´çš„â€å®½è¡¨â€ï¼Œä¸ºäº†åº”å¯¹è¡¨ç»“æ„çš„æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¾è®¡è¡¨ç»“æ„çš„æ—¶å€™ï¼Œé¢„ç•™å¤šä¸€äº›ç©ºç™½å­—æ®µï¼Œç®€å•å¥½ç†è§£ï¼Œä½†æ˜¯å®¹æ˜“é€ æˆæ•°æ®çš„â€ç¨€ç–æ€§â€ï¼ŒåŒæ—¶é•¿è¿œçœ‹æ¥å®½è¡¨å¤ªå®½å­˜å‚¨æ€§èƒ½å¾ˆå·®ï¼Œå¤ªçª„ä¼šæ»¡è¶³ä¸äº†ä¸šåŠ¡å˜åŒ–ã€‚</li>
<li><strong>è¡Œæ¨¡å‹</strong>ï¼šå°±æ˜¯ä»¥key-valueç»“æ„ä½œä¸ºä¸€è¡Œå­˜å‚¨åˆ°è¡¨ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªå­—æ®µå°±æ–°å¢ä¸€è¡Œæ•°æ®ï¼Œå…¼é¡¾çµæ´»æ€§ï¼Œé—®é¢˜åœ¨äºvalueå®šä¹‰ç±»å‹åªèƒ½æ˜¯varcharï¼Œå¤§å°ä¹Ÿéœ€è¦åšé™åˆ¶ã€‚</li>
<li><strong>NoSQL</strong>ï¼šåˆ©ç”¨NoSQLåŸºäºdocumentç±»å‹çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å­˜å‚¨åŠ¨æ€ç»“æ„å¹¶ä¸”æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†é—®é¢˜åœ¨äºä¸šåŠ¡æ”¹é€ æˆæœ¬å¤§ï¼ŒåŒæ—¶éœ€è¦ACIDäº‹åŠ¡çš„åœºæ™¯æ”¯æŒåº¦ä¸å¤Ÿã€‚</li>
</ol>
<p>è¿˜æœ‰ä¸€ç§æ¨¡å‹ï¼Œç›®å‰åœ¨è¯¸å¦‚åŒ»ç–—æ•°æ®åº“ã€çŠ¯ç½ªæ•°æ®åº“å’Œå¤§å‹ç”µå•†ç±»æ•°æ®ç­‰æœ‰ç€å¹¿æ³›åº”ç”¨çš„æˆç†Ÿæ¨¡å‹ï¼š<strong>EAVæ¨¡å‹</strong>ï¼Œä¹Ÿå³æ˜¯ä»¥â€å®ä½“-å±æ€§-å€¼â€æ¥ç»„ç»‡æ•°æ®ã€‚</p>
<h3 id="eavæ¨¡å‹">EAVæ¨¡å‹</h3>
<p>åœ¨å¼€æºå’Œphpç¤¾åŒºï¼Œæœ€è‘—åçš„EAVå®ç°æ˜¯Magentoï¼Œä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°ã€‚EAVæ¨¡å‹ï¼Œå°±æ˜¯æŠŠå®ä½“-å±æ€§-å€¼ï¼ˆEntity-Attribute-Valueï¼‰åˆ†å¼€è¡¨è¿›è¡Œå­˜å‚¨ã€‚å®ä½“è¡¨å­˜å‚¨å¯¹è±¡çš„IDå’Œä¸»è¦å±æ€§ï¼Œå±æ€§è¡¨å­˜å‚¨éœ€è¦æ‰©å±•çš„å±æ€§ï¼Œå€¼è¡¨ç”±ä¸åŒç±»å‹çš„è¡¨ç»„æˆä¸€ä¸ªé›†åˆï¼Œä¸€ä¸ªå€¼éœ€è¦ç”±å®ä½“ID+å±æ€§IDæ¥ç¡®å®šã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾æŸä¸€ä¸ªå®ä½“å…·å¤‡å“ªäº›å±æ€§ï¼Œå¯ä»¥å¢åŠ å®ä½“ç±»å‹ï¼ˆtype_idï¼‰ï¼ŒåŸºäºå®ä½“çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾eav_attributeæ¥æ‰¾åˆ°è¦è®¾ç½®äº§å“çš„é‚£ä¸€å±æ€§ã€‚å½“éœ€è¦æ“ä½œæŸä¸€ä¸ªå®ä½“çš„å±æ€§æ—¶ï¼Œå°±å¯ä»¥å…ˆæŠŠå®ä½“æ‹¥æœ‰çš„å±æ€§å…ˆæŸ¥å‡ºæ¥ï¼Œå†å¯¹å±æ€§è¿›è¡Œæ“ä½œï¼Œè®¾ç½®å±æ€§å€¼æ—¶ï¼Œå…ˆåˆ¤æ–­å±æ€§çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå†æ‰¾åˆ°å¯¹åº”ç±»å‹çš„å€¼è¡¨ï¼Œç„¶åæ›´æ–°æ”¹å±æ€§çš„å€¼ã€‚</p>
<p>è™½ç„¶EAVæ¨¡å‹èƒ½å¤Ÿè§£å†³ä»¥ä¸Šä¸‰ç§æ¨¡å‹çš„ç¼ºç‚¹ï¼Œæœ‰ç€çµæ´»æ€§å¼ºï¼Œå®Œç¾è§£å†³<strong>æ•°æ®ç¨€ç–æ€§</strong>ï¼Œä½†æ˜¯å®ƒä¹Ÿå› ä¸ºå¤ªè¿‡äºå¤æ‚ï¼Œæœ‰ç€æ˜æ˜¾çš„å­¦ä¹ æ›²çº¿ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¹Ÿç›¸å¯¹ä½ä¸‹ï¼Œå¿…é¡»ä¸ºå…¶æå‡æ€§èƒ½åšå¤§é‡çš„è¾…åŠ©å·¥ä½œã€‚</p>
<p>æˆ‘çš„ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ç§åŠ¨æ€ç»“æ„çš„æ•°æ®çš„æ¨¡å‹æ€§èƒ½å¯ä¸æ–‡æ¡£æ•°æ®åº“ç›¸åª²ç¾ï¼Œç»“æ„æ›´ç®€å•æ¯”EAVæ›´å…·å¯è¯»æ€§ã€‚é‚£å°±æ˜¯MySQL5.7ä»¥åæ”¯æŒçš„<strong>JSONç±»å‹</strong>ï¼Œä¹Ÿå°±è¡¨å­—æ®µç±»å‹ä¸ºJSONï¼Œç”¨äºå­˜å‚¨åŠ¨æ€æ‰©å±•å­—æ®µã€‚</p>
<h3 id="jsonæ¨¡å‹">JSONæ¨¡å‹</h3>
<p>JSONæ¨¡å‹ï¼Œæ¯”è¾ƒMySQL5.7ä»¥å‰ä½¿ç”¨textç±»å‹æ¥å­˜æ–‡æœ¬JSONçš„æ–¹å¼ï¼ŒJSONæ¨¡å‹å…¼é¡¾äº†æ€§èƒ½åŠæ˜“ç”¨æ€§ï¼Œåœ¨æ“ä½œå’Œæ€§èƒ½ä¸Šéƒ½å¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚JSONç±»å‹æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œè¦æ¯”å­—ç¬¦ä¸²æ›´åŠ é«˜æ•ˆï¼Œå†ä¹Ÿä¸ç”¨jsonåºåˆ—åŒ–è¿‘æ–‡æœ¬å­—æ®µï¼ŒæŸ¥è¯¢ä¹‹åè¿˜è¦è§£æï¼ŒåŒæ—¶è¿˜è¦å…¼é¡¾jsonçš„åˆæ³•æ€§ã€‚</p>
<p>åœ¨MySQL 5.7.8ä¸­ï¼ŒMySQLæ”¯æŒç”±RFC 7159å®šä¹‰çš„æœ¬åœ°JSONæ•°æ®ç±»å‹ï¼Œå®ƒæ”¯æŒå¯¹JSON(JavaScriptå¯¹è±¡æ ‡è®°)æ–‡æ¡£ä¸­çš„æ•°æ®è¿›è¡Œæœ‰æ•ˆè®¿é—®. æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š</p>
<ul>
<li>MySQLä¼šå¯¹DML JSONæ•°æ®è‡ªåŠ¨éªŒè¯ã€‚æ— æ•ˆçš„DML JSONæ•°æ®æ“ä½œä¼šäº§ç”Ÿé”™è¯¯.</li>
<li>ä¼˜åŒ–çš„å­˜å‚¨æ ¼å¼ã€‚å­˜å‚¨åœ¨JSONåˆ—ä¸­çš„JSONæ–‡æ¡£è½¬æ¢ä¸ºä¸€ç§å†…éƒ¨æ ¼å¼ï¼Œå…è®¸å¯¹Jsonå…ƒç´ è¿›è¡Œå¿«é€Ÿè¯»å–è®¿é—®.</li>
<li>MySQL Jsonç±»å‹æ”¯æŒå»ºç«‹ç´¢å¼•å¢åŠ æŸ¥è¯¢æ€§èƒ½æå‡.</li>
</ul>
<p>å¦å¤–æœ‰è¿˜æœ‰ä¸€ç§æˆ‘è®¤ä¸ºæ”¶ç›Šæ¯”è¾ƒå¤§çš„æ˜¯ï¼š<strong>è™šæ‹Ÿåˆ— Virtual Column</strong></p>
<p>åœ¨MySQL 5.7ä¸­ï¼Œæ”¯æŒä¸¤ç§Generated Columnï¼Œå³Virtual Generated Columnå’ŒStored Generated Columnï¼Œå‰è€…åªå°†Generated Columnä¿å­˜åœ¨æ•°æ®å­—å…¸ä¸­ï¼ˆè¡¨çš„å…ƒæ•°æ®ï¼‰ï¼Œå¹¶ä¸ä¼šå°†è¿™ä¸€åˆ—æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼›åè€…ä¼šå°†Generated ColumnæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯»å–çš„æ—¶å€™è®¡ç®—æ‰€å¾—ã€‚å¾ˆæ˜æ˜¾ï¼Œåè€…å­˜æ”¾äº†å¯ä»¥é€šè¿‡å·²æœ‰æ•°æ®è®¡ç®—è€Œå¾—çš„æ•°æ®ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´ï¼Œä¸Virtual Columnç›¸æ¯”å¹¶æ²¡æœ‰ä¼˜åŠ¿ï¼Œå› æ­¤ï¼ŒMySQL 5.7ä¸­ï¼Œä¸æŒ‡å®šGenerated Columnçš„ç±»å‹ï¼Œé»˜è®¤æ˜¯Virtual Columnã€‚</p>
<p>æœ‰äº†è™šæ‹Ÿåˆ—ï¼Œåœ¨selectå­å¥å’Œwhereå­å¥ä¸­ï¼ŒæŸ¥è¯¢è™šæ‹Ÿåˆ—ä¸æ™®é€šçš„åˆ—æ²¡æœ‰ä¸åŒï¼ŒæŸ¥è¯¢ç”¨æ³•ä¸Šå¯ä»¥åŸºæœ¬ä¸éœ€è¦å˜åŒ–ã€‚åŒæ—¶ç”±äºè™šæ‹Ÿåˆ—çš„ç‰¹æ€§ï¼Œåªæ˜¯ä¸jsonä¸­çš„å±æ€§keyçš„ä¸€ç§æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥è™šæ‹Ÿåˆ—çš„å¢åˆ æ€§èƒ½æ˜¯éå¸¸å¥½çš„ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨å»ºç«‹äº†è™šæ‹Ÿåˆ—ä¹‹åï¼Œå¯ä»¥ç»§ç»­å¯¹è™šæ‹Ÿåˆ—å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæœ‰äº†ç´¢å¼•ï¼Œæ€§èƒ½å‡ ä¹è·Ÿæ™®é€šæ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>ä¸‹é¢çš„ç¬¬äº”èŠ‚çš„<strong>æ¨¡å‹æ“ä½œå¯¹æ¯”</strong>ä¸­ä¼šç»™å‡ºä¸€äº›JSONæ“ä½œçš„å®ä¾‹ï¼Œæ›´å¤šå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://dev.mysql.com/doc/refman/5.7/en/json.html</p>
<p>ä¸‹é¢ç»™å‡ºåˆ—æ¨¡å‹ã€è¡Œæ¨¡å‹ã€EAVæ¨¡å‹å’ŒJSONæ¨¡å‹çš„ä¼˜ç¼ºç‚¹åŠè¡¨ç»“æ„å¯¹æ¯”ï¼š</p>
<p></p>
<p><strong>ç”±äºåˆ—æ¨¡å‹ã€è¡Œæ¨¡å‹å’ŒNoSQLéƒ½æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£å’Œå¸¸è§ï¼Œæ‰€ä»¥ä¸‹æ–‡é‡ç‚¹åªå¯¹EAVæ¨¡å‹å’ŒJSONæ¨¡å‹è¿›è¡Œåˆ†æå’Œå¯¹æ¯”</strong></p>
<h2 id="ä¸‰æ€§èƒ½æµ‹è¯•ç»“æœå¯¹æ¯”">ä¸‰ã€æ€§èƒ½æµ‹è¯•ç»“æœå¯¹æ¯”</h2>
<p>ä¸‹é¢æ˜¯ä¸¤ç§æ¨¡å‹å‚ä¸æ€§èƒ½æµ‹è¯•çš„SQLï¼ŒåŒ…æ‹¬æŸ¥è¯¢ï¼Œæ›´æ–°å’Œæ’å…¥æ•°æ®ï¼Œå¯ä»¥å¯¹æ¯”è§‚å¯Ÿä¸€ä¸‹ä¸åŒæ¨¡å‹SQLçš„å¤æ‚åº¦ï¼š</p>
<p></p>
<p>ä¸‹é¢ä¸ºSQLåœ¨ä¸åŒé‡çº§çš„æ•°æ®é‡æ—¶ï¼Œä»æŸ¥è¯¢ã€æ›´æ–°ã€æ’å…¥ã€å»ºç«‹å­—æ®µå’Œç´¢å¼•ç­‰æ“ä½œç»´åº¦ï¼Œå¯¹æ¯”äº†EAVæ¨¡å‹ã€MySQL5.7çš„JSONæ¨¡å‹ å’Œ MySQL8.0çš„JSONæ¨¡å‹ çš„æ€§èƒ½ï¼Œå¦å¤–å¯¹æ¯”äº†ç£ç›˜ç©ºé—´å ç”¨å’Œæ•°æ®å¯¼å…¥æ€§èƒ½</p>
<p></p>
<p>å›¾è¡¨å±•ç¤ºï¼Œæ–¹ä¾¿æŸ¥çœ‹è¶‹åŠ¿</p>
<p></p>
<p></p>
<p>ç»“è®ºï¼š</p>
<ol>
<li>ä¸¤ç§æ¨¡å‹ä»æ“ä½œçš„å¤æ‚åº¦æ¯”è¾ƒï¼ŒEAVæ¨¡å‹è¦å¤æ‚å¾—å¤šï¼ŒæŸ¥è¯¢ä¸å®œè”æŸ¥è¿™ä¹ˆå¤šçš„è¡¨ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½å¿…é¡»åˆ†æ­¥éª¤ï¼ŒæŸ¥è¯¢æœ‰å“ªäº›å±æ€§å¹¶æ‹¿åˆ°å±æ€§IDï¼ˆå½“ç„¶å¯ä»¥åˆ©ç”¨ç¼“å­˜æ¥ä¼˜åŒ–ï¼‰ï¼ŒJSONæ¨¡å‹åªè¦æœ‰è™šæ‹Ÿåˆ—ï¼ŒæŸ¥è¯¢æ—¶ä¸æ™®é€šçš„æ–¹å¼æ²¡æœ‰å´åˆ«ï¼Œæ’å…¥æˆ–æ›´æ–°æ—¶éœ€è¦åˆ©ç”¨å‡½æ•°ï¼›</li>
<li>ä»æŸ¥è¯¢æ€§èƒ½æ¥çœ‹ï¼ŒJSONæ¨¡å‹æ˜æ˜¾ä¼˜äºEAVæ¨¡å‹ã€‚ä¸è¿‡è™½ç„¶è¿™æ ·ï¼ŒEAVåªè¦åšå¥½é€‚å½“çš„ç¼“å­˜ä¼˜åŒ–ï¼Œå…¶å®æ˜¯å¯ä»¥æ»¡è¶³ä¸€å®šçš„åœºæ™¯å¹¶è¢«æ¥å—ï¼›</li>
<li>æ— è®ºåœ¨é‚£ä¸ªæ•°é‡çº§ä¸‹ï¼ŒJSONæ¨¡å‹æ“ä½œè™šæ‹Ÿåˆ—æ—¶çš„æ¶ˆè€—éƒ½æ˜¯æå¿«ï¼Œè€Œå¯¹äºç»™è™šæ‹Ÿåˆ—æ·»åŠ ç´¢å¼•ï¼Œæ€§èƒ½ä¼šéšç€æ•°æ®é‡çº§çš„å¢å¤§è€Œå¢åŠ ï¼Œæ¯•ç«Ÿéœ€è¦å»ºç«‹ç´¢å¼•æ ‘ï¼Œä¹Ÿæ˜¯æ­£å¸¸æ“ä½œäº†ï¼Œä¸æ™®é€šåˆ—çš„ç´¢å¼•å·®ä¸å¤šï¼›</li>
<li>MySQL8.0å¯¹JSONç±»å‹ä¹Ÿåšäº†å¢å¼ºï¼Œå¯¹æ¯”MySQL5.7ï¼Œåœ¨æ·»åŠ /åˆ é™¤ç´¢å¼•çš„æ€§èƒ½ä¸Šï¼Œæ€§èƒ½æå‡äº†æ¥è¿‘ä¸€å€ï¼Œè™šæ‹Ÿåˆ—çš„æ“ä½œæ€§èƒ½åœ¨ä¸åŒæ•°æ®é‡çº§ä¸‹ï¼Œæ›´åŠ ç¨³å®šï¼›</li>
</ol>
<p>ç”±äºæµ‹è¯•ç”¨ä¾‹è¿˜æ˜¯æ¯”è¾ƒç²—ç•¥ï¼Œæ‰€ä»¥ä¸ä¸€å®š100%ç²¾å‡†ï¼Œå‘ç°å“ªé‡Œæœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p>
<p><strong>å¯¹EAVæ¨¡å‹å’ŒJSONæ¨¡å‹çš„è¡¨ç»“æ„å’Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œæ„Ÿå…´è¶£çš„ï¼Œè¯·çœ‹ç¬¬äº”èŠ‚â€åŠ¨æ€å­˜å‚¨æ¨¡å‹å®é™…æ¡ˆä¾‹â€</strong></p>
<h2 id="å››æ€»ç»“">å››ã€æ€»ç»“</h2>
<p>æœ¬ç¯‡ä¸ºä½ ä»‹ç»äº†åŠ¨æ€ç»“æ„çš„åœºæ™¯ï¼Œå¹¶ä¸”åˆ—ä¸¾äº†å‡ ä¸ªå¯è¡Œçš„å­˜å‚¨æ¨¡å‹ï¼šåˆ—æ¨¡å‹ï¼ˆå®½è¡¨ï¼‰ï¼Œè¡Œæ¨¡å‹ï¼ŒEAVæ¨¡å‹å’ŒJSONæ¨¡å‹ï¼Œå¹¶ä¸”åˆ†æäº†å„ç§æ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹æ¥å¯¹æ¯”åˆ†æäº†EAVæ¨¡å‹å’ŒJSONæ¨¡å‹ï¼Œäº†è§£äº†è¿™ä¸¤ç§æ¨¡å‹çš„å®é™…æ“ä½œçš„SQLè¯­å¥ï¼Œå±•ç¤ºäº†ä¸åŒçš„æ•°æ®é‡çº§ä¸‹çš„æŸ¥è¯¢ã€æ’å…¥å’Œæ›´æ–°æ€§èƒ½ã€‚</p>
<p>ç»è¿‡ä¸€ç•ªå¯¹æ¯”ï¼Œç›¸ä¿¡ä½ å·²ç»é¢å¯¹â€åŠ¨æ€ç»“æ„â€çš„åœºæ™¯æ—¶å€™ï¼Œå·²ç»æœ‰æ®å¯ä¾äº†ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<p>è‚æ–‡ç« ä¸æ˜“ï¼Œç‚¹ä¸ªèµå†èµ°ã€‚æ„Ÿè°¢ï¼ï¼</p>
<h2 id="äº”é™„åŠ åŠ¨æ€å­˜å‚¨æ¨¡å‹å®é™…æ¡ˆä¾‹">äº”ã€é™„åŠ ï¼šåŠ¨æ€å­˜å‚¨æ¨¡å‹å®é™…æ¡ˆä¾‹</h2>
<h3 id="1-eavæ¨¡å‹entity-attribute-value-model">1. EAVæ¨¡å‹ï¼ˆEntity-Attribute-Value Modelï¼‰</h3>
<p></p>
<h4 id="è¡¨ç»“æ„">è¡¨ç»“æ„</h4>
<p>å±æ€§è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">eav_attribute</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w">   </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_type_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ç±»å‹ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_code</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§Code&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§åç§°&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_type</span><span class="o">`</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;decimal&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ç±»å‹&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_ENTITY_TYPE_ID</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_type_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_TYPE</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">attribute_type</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;eavå±æ€§è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·å®ä½“è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_entity</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">type_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ç±»å‹ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">username</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·å&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·å®ä½“è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æ•´å‹å€¼è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_int</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="w">    </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="w">        </span><span class="nb">int</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;æ•´å‹å€¼&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_VALUE</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;useræ•´å‹å€¼è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·å­—ç¬¦ä¸²å€¼è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_varchar</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="w">    </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="w">        </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å­—ç¬¦å€¼&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_VALUE</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;userå­—ç¬¦å€¼è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æ–‡æœ¬å€¼è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_text</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="w">    </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="w">        </span><span class="nb">text</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;æ–‡æœ¬å€¼&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;useræ–‡æœ¬å€¼è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æµ®ç‚¹å‹å€¼è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_decimal</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="w">    </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="w">        </span><span class="nb">decimal</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;æµ®ç‚¹å€¼&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_VALUE</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;useræµ®ç‚¹å€¼è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æ—¥æœŸå‹å€¼è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_datetime</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="w">    </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å®ä½“ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å±æ€§ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="w">        </span><span class="n">datetime</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;æ—¥æœŸå€¼&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">entity_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">attribute_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_VALUE</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;useræ—¥æœŸå€¼è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ’å…¥å±æ€§æ•°æ®">æ’å…¥å±æ€§æ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">eav_attribute</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">entity_type_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_code</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_name</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_type</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å§“å&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¹´é¾„&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;int&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gender&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ€§åˆ«&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç”µè¯&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç§»åŠ¨ç”µè¯&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;address&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å®¶åº­ä½å€&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;èº«é«˜(cm)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;decimal&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weight&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä½“é‡(kg)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;decimal&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç®€ä»‹&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;birthday&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å‡ºç”Ÿå¹´æœˆ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;datetime&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-jsonæ¨¡å‹">2. JSONæ¨¡å‹</h3>
<h4 id="è¡¨ç»“æ„-1">è¡¨ç»“æ„</h4>
<p></p>
<p>ç”¨æˆ·è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;è´¦å·&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·ä¸»è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æºæ•°æ®è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_metadata</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·å…ƒæ•°æ®&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">field_code</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å­—æ®µcode&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">field_name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å­—æ®µå&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">field_type</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å­—æ®µç±»å‹&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_FIELD</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">field_name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">field_type</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·å…ƒæ•°æ®è¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·æ‰©å±•å­—æ®µè¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">user_extra_field</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;å­—æ®µid&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">user_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·ID&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">properties</span><span class="o">`</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;æ‰©å±•å­—æ®µ&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_USER_ID</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">comment</span><span class="w"> </span><span class="s1">&#39;ç”¨æˆ·æ‰©å±•å­—æ®µè¡¨&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å…ƒæ•°æ®">å…ƒæ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">`</span><span class="n">user_metadata</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">field_code</span><span class="p">,</span><span class="w"> </span><span class="n">field_name</span><span class="p">,</span><span class="w"> </span><span class="n">field_type</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å§“å&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¹´é¾„&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;int&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gender&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ€§åˆ«&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç”µè¯&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç§»åŠ¨ç”µè¯&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;address&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å®¶åº­ä½å€&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;èº«é«˜(cm)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;decimal&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weight&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä½“é‡(kg)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;decimal&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç®€ä»‹&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;birthday&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å‡ºç”Ÿå¹´æœˆ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;datetime&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šç”±äºjsonç±»å‹é‡Œçš„æ•°æ®ç±»å‹ä¹Ÿæ˜¯åªæœ‰å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ï¼ˆJSON å¯¹è±¡ï¼‰ã€æ•°ç»„ã€å¸ƒå°”å’ŒNullï¼Œæ‰€ä»¥ä½¿ç”¨å…ƒæ•°æ®è¡¨æŠŠå±æ€§çš„å…·ä½“ç±»å‹å­˜å‚¨èµ·æ¥ï¼Œå¯ä»¥åœ¨å¿…è¦æ—¶å¯ä»¥åœ¨ä»£ç å±‚åšç±»å‹è½¬æ¢é€»è¾‘ã€‚</p>
<h2 id="æ¨¡å‹æ“ä½œå¯¹æ¯”">æ¨¡å‹æ“ä½œå¯¹æ¯”</h2>
<h3 id="1-å­—æ®µæ“ä½œ">1. å­—æ®µæ“ä½œ</h3>
<h4 id="å¢åŠ ä¸€ä¸ªeduå­¦å†å­—æ®µ">å¢åŠ ä¸€ä¸ªâ€eduâ€å­¦å†å­—æ®µ</h4>
<p><strong>EAVæ¨¡å‹</strong></p>
<p>åªéœ€è¦åœ¨å±æ€§è¡¨eav_attributeä¸­å¢åŠ ä¸€è¡Œå³å¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="p">(</span><span class="n">entity_type_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_code</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_name</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_type</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;edu&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å­¦å†&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;varchar&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>JSON</strong></p>
<p>éœ€è¦åœ¨å…ƒæ•°æ®è¡¨user_metadataå¢åŠ ä¸€è¡Œï¼Œå¹¶ä¸”å¢åŠ <strong>è™šæ‹Ÿåˆ—</strong>eduä»¥åŠå…¶ç´¢å¼•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="o">`</span><span class="n">edu</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">json_extract</span><span class="p">(</span><span class="o">`</span><span class="n">properties</span><span class="o">`</span><span class="p">,</span><span class="s1">&#39;$.edu&#39;</span><span class="p">))</span><span class="w"> </span><span class="n">VIRTUAL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">`</span><span class="n">IDX_EDU</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">edu</span><span class="o">`</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ é™¤mobileå­—æ®µ">åˆ é™¤mobileå­—æ®µ</h4>
<p><strong>EAVæ¨¡å‹</strong></p>
<p>éœ€è¦ä¸‰æ­¥ï¼š</p>
<ol>
<li>æŸ¥è¯¢mobileå±æ€§</li>
<li>åˆ é™¤å±æ€§è®°å½•</li>
<li>åˆ é™¤å±æ€§å€¼</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: æŸ¥è¯¢å±æ€§ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: åˆ é™¤å­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step3: åˆ é™¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>JSONæ¨¡å‹</strong></p>
<p>åˆ©ç”¨json_remove()æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤jsonå­—æ®µå¯¹åº”çš„å±æ€§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: åˆ é™¤å­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_metadata</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">field_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mobile&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: åˆ é™¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">update</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_remove</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.mobile&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step3: åˆ é™¤è™šæ‹Ÿåˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="o">`</span><span class="n">mobile</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œç¬¬2ã€3æ­¥å¯ä»¥æ ¹æ®ä¸šåŠ¡è‡ªèº«è€ƒè™‘æ˜¯å¦æœ‰å¿…è¦ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œé‚£äº›ç¡®å®šä¸å†ä½¿ç”¨çš„å±æ€§å­—æ®µå¯ä»¥è€ƒè™‘åˆ é™¤ï¼Œç¼©å°jsonä½“ç§¯ã€‚</p>
<h3 id="2-æŸ¥è¯¢æ“ä½œ">2. æŸ¥è¯¢æ“ä½œ</h3>
<h4 id="æŸ¥è¯¢èº«é«˜é«˜äº170cmå¹´æ»¡18å²çš„ç”·æ€§ç”¨æˆ·">æŸ¥è¯¢èº«é«˜é«˜äº170cmï¼Œå¹´æ»¡18å²çš„ç”·æ€§ç”¨æˆ·</h4>
<p><strong>EAVæ¨¡å‹</strong></p>
<p>éœ€è¦åˆ†ä¸‰æ­¥è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯ä¸€æ­¥çš„ç»“æœä¼ é€’éœ€è¦ä»£ç é€»è¾‘å±‚å®ç°ï¼Œæ­¤å¤„ç›´æ¥è´´å‡ºæ‰€æœ‰çš„æŸ¥è¯¢SQL</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: æ ¹æ®æ¡ä»¶è¿‡æ»¤å‡ºç”¨æˆ·ID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">entity_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">user_int</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">entity_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">user_decimal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">entity_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">170</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step3: æ ¹æ®ç”¨æˆ·IDä¸å±æ€§ï¼ŒæŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„å®ä½“ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">attribute_code</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_int</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_datetime</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_decimal</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šæŸ¥å‡ºæ¥çš„ç»“æœï¼Œè¿˜éœ€è¦è¿›è¡Œkey-valueçš„è½¬æ¢</p>
<p><strong>JSONæ¨¡å‹</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">json_unquote</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">json_unquote</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.gender&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.height&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">json_unquote</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.birthday&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">birthday</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.age&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.height&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">170</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;$.gender&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å»ºç«‹äº†è™šæ‹Ÿåˆ—çš„å‰æä¸‹ï¼ŒæŸ¥è¯¢ä¸ä¼ ç»Ÿçš„æ–¹å¼æ²¡æœ‰åŒºåˆ«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">f</span><span class="p">.</span><span class="n">gender</span><span class="p">,</span><span class="n">f</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">birthday</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">170</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…æŸ¥è¯¢ç”¨æˆ·idä¸º3çš„ç”¨æˆ·ä¿¡æ¯">æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…ï¼šæŸ¥è¯¢ç”¨æˆ·IDä¸º3çš„ç”¨æˆ·ä¿¡æ¯</h4>
<p><strong>EAVæ¨¡å‹</strong> éœ€è¦åˆ†ä¸¤æ­¥ï¼š1. æŸ¥è¯¢æ‰€æœ‰çš„å±æ€§ï¼Œ2.æ ¹æ®å±æ€§IDå’Œç”¨æˆ·IDï¼ŒæŸ¥è¯¢å±æ€§å€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: æ ¹æ®å±æ€§åŠidï¼ŒæŸ¥è¯¢idä¸º3çš„ç”¨æˆ·ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">attribute_code</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_int</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_decimal</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_text</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">value</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_datetime</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>JSONæ¨¡å‹</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">properties</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-æ’å…¥æ•°æ®">3. æ’å…¥æ•°æ®</h3>
<h4 id="æ–°å¢ä¸€æ¡æ•°æ®">æ–°å¢ä¸€æ¡æ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">profile</span><span class="p">,</span><span class="w"> </span><span class="n">birthday</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;jayzone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¼ ä¸‰&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;13722211133&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æˆ‘å¾ˆå¥½ï¼Œä½ å‘¢ï¼Ÿ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1994-01-11&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>EAVæ¨¡å‹</strong> åˆ†ä¸¤æ­¥æ“ä½œ: 1.æŸ¥è¯¢æ‰€æœ‰å±æ€§ï¼Œ2.æ ¹æ®å±æ€§IDå’Œå€¼ï¼Œæ’å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: æŸ¥è¯¢æ‰€æœ‰å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: æŠŠå€¼æ’å…¥åˆ°å¯¹åº”çš„è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_entity</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">type_id</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;jayzone&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_int</span><span class="w"> </span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¼ ä¸‰&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;13722211133&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_text</span><span class="w"> </span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æˆ‘å¾ˆå¥½ï¼Œä½ å‘¢ï¼Ÿ&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_datetime</span><span class="w"> </span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute_id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1994-01-11 00:00:00&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>JSONæ¨¡å‹</strong> éœ€è¦ä½¿ç”¨**json_object()**æ–¹æ³•æ„å»ºjsonå¯¹è±¡ï¼Œåœ¨å­˜å…¥JSONå­—æ®µä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;jayzone&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">json_object</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¼ ä¸‰&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gender&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ç”·&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;13722211133&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;address&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºè¥¿ä¹¡è¡—é“åæ³°å¤§å¦101&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æˆ‘å¾ˆå¥½,ä½ å‘¢ï¼Ÿ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;birthday&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1994-01-11&#39;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-æ›´æ–°æ•°æ®">4. æ›´æ–°æ•°æ®</h3>
<h4 id="æ–°å¢ä¸€ä¸ªå­—æ®µ-å¹¶ä¸”æ›´æ–°ç”¨æˆ·id3çš„ç”¨æˆ·å­¦å†ä¸ºæœ¬ç§‘">æ–°å¢ä¸€ä¸ªå­—æ®µ, å¹¶ä¸”æ›´æ–°ç”¨æˆ·ID=3çš„ç”¨æˆ·å­¦å†ä¸ºæœ¬ç§‘</h4>
<p><strong>EAVæ¨¡å‹</strong> éœ€è¦åœ¨eav_attributeè¡¨ä¸­å¢åŠ ä¸€è¡Œè®°å½•ï¼Œç„¶åæ›´æ–°å¯¹åº”çš„å€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- step1: æŸ¥è¯¢å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eav_attribute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- step2: æ›´æ–°å¯¹åº”å±æ€§çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">update</span><span class="w"> </span><span class="n">user_varchar</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;æœ¬ç§‘&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">entity_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attribute_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>JSONæ¨¡å‹</strong> åˆ©ç”¨json_insert/json_setæ–¹æ³•æ›´æ–°å¯¹åº”å­—æ®µçš„å€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">update</span><span class="w"> </span><span class="n">user_extra_field</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_set</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;15016716555&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
  <title>K8Sv1.24.0 containerd å®‰è£…æ•™ç¨‹</title>
  <link>https://ronin-zc.com/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</link>
  <pubDate>Sat, 14 May 2022 16:45:00 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/k8sv1.24.0-containerd%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</guid>
  <description><![CDATA[<h3 id="1å¸è½½æ—§ç‰ˆæœ¬">1ã€å¸è½½æ—§ç‰ˆæœ¬</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt remove docker docker-engine docker.io containerd runc
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2å®‰è£…ç›¸å…³ä¾èµ–åŒ…">2ã€å®‰è£…ç›¸å…³ä¾èµ–åŒ…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3æ·»åŠ è¯ä¹¦é•œåƒ">3ã€æ·»åŠ è¯ä¹¦&amp;é•œåƒ</h3>
<ul>
<li>
<p>å®˜æ–¹é•œåƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å®˜æ–¹é•œåƒ</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Ubuntu 22.04 è¯·ä½¿ç”¨</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo gpg --dearmor -o /usr/share/keyrings/aliyun-docker-archive-keyring.gpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo add-apt-repository <span class="s2">&#34;deb [arch=arm64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>é˜¿é‡Œäº‘é•œåƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Ubuntu 22.04 è¯·ä½¿ç”¨</span>
</span></span><span class="line"><span class="cl">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg ï½œ sudo gpg --dearmor -o /usr/share/keyrings/aliyun-docker-archive-keyring.gpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo add-apt-repository <span class="s2">&#34;deb [arch=arm64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<blockquote>
<p>å¦‚æœå¡ä½ä¸åŠ¨çš„è¯ï¼Œå¯ä»¥å…ˆ wget ä¸‹è½½æ–‡ä»¶ï¼Œç›´æ¥å¯¼å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg
</span></span><span class="line"><span class="cl">sudo apt-key add ./gpg
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="4å®‰è£…">4ã€å®‰è£…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y containerd
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5ç”Ÿæˆé…ç½®æ–‡ä»¶">5ã€ç”Ÿæˆé…ç½®æ–‡ä»¶</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /etc/containerd <span class="o">&amp;&amp;</span> containerd config default <span class="p">|</span> sudo tee /etc/containerd/config.toml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è€ç‰ˆæœ¬éœ€è¦æ‰‹åŠ¨æ·»åŠ  `SystemdCgroup = true`</span>
</span></span><span class="line"><span class="cl">sudo sed -i <span class="s1">&#39;s/SystemdCgroup = false/SystemdCgroup = true/&#39;</span> /etc/containerd/config.toml <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">grep <span class="s1">&#39;SystemdCgroup&#39;</span> -B <span class="m">11</span> /etc/containerd/config.toml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6é…ç½®é•œåƒåŠ é€Ÿå®˜æ–¹é“¾æ¥httpscrconsolealiyuncomcn-shenzheninstancesmirrors">6ã€é…ç½®é•œåƒåŠ é€Ÿ<a
  href="https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors"
  
  
    
    
    target="_blank"
  
  
    rel="external nofollow noopener noreferrer"
  
  
  
>å®˜æ–¹é“¾æ¥</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿå™¨åœ°å€</span>
</span></span><span class="line"><span class="cl">sudo sed -i <span class="s1">&#39;s#endpoint = &#34;&#34;#endpoint = &#34;https://xxxxxx.mirror.aliyuncs.com&#34;#g&#39;</span> /etc/containerd/config.toml <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">grep <span class="s1">&#39;endpoin&#39;</span> -B <span class="m">5</span> /etc/containerd/config.toml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s#sandbox_image = &#34;k8s.gcr.io/pause#sandbox_image = &#34;registry.aliyuncs.com/google_containers/pause#g&#39;</span> /etc/containerd/config.toml <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">grep <span class="s1">&#39;sandbox_image&#39;</span> /etc/containerd/config.toml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7é‡è½½æœåŠ¡å™¨é…ç½®">7ã€é‡è½½æœåŠ¡å™¨é…ç½®</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl daemon-reload <span class="o">&amp;&amp;</span> systemctl restart containerd.service
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="8æ£€æŸ¥è¿è¡Œæƒ…å†µ">8ã€æ£€æŸ¥è¿è¡Œæƒ…å†µ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl status containerd
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
  <title>Ubuntu ARM Docker å®‰è£…</title>
  <link>https://ronin-zc.com/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/</link>
  <pubDate>Fri, 13 May 2022 14:13:00 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/ubuntu-arm-docker-%E5%AE%89%E8%A3%85/</guid>
  <description><![CDATA[<h3 id="1å¸è½½å¯èƒ½å­˜åœ¨çš„æ—§ç‰ˆæœ¬">1ã€å¸è½½å¯èƒ½å­˜åœ¨çš„æ—§ç‰ˆæœ¬</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt remove docker docker-engine docker-ce docker.io
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2å®‰è£…ä¾èµ–ä½¿-apt-å¯é€šè¿‡-https-ä¸‹è½½åŒ…">2ã€å®‰è£…ä¾èµ–ä½¿ apt å¯é€šè¿‡ HTTPS ä¸‹è½½åŒ…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> apt install -y apt-transport-https ca-certificates curl software-properties-common
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3æ·»åŠ -docker-å¯†é’¥">3ã€æ·»åŠ  docker å¯†é’¥</h3>
<h4 id="31é˜¿é‡Œäº‘-docker-æº">3.1ã€é˜¿é‡Œäº‘ docker æº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32å®˜æ–¹-docker-æº">3.2ã€å®˜æ–¹ docker æº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4æ·»åŠ å¯¹åº”çš„-docker-æºéœ€è¦å’Œç¬¬ä¸‰éƒ¨ä¸€è‡´">4ã€æ·»åŠ å¯¹åº”çš„ docker æºã€Œéœ€è¦å’Œç¬¬ä¸‰éƒ¨ä¸€è‡´ã€</h3>
<h4 id="41é˜¿é‡Œäº‘-å®˜æ–¹æ–‡æ¡£httpsdeveloperaliyuncommirrordocker-ce">4.1ã€é˜¿é‡Œäº‘ <a
  href="https://developer.aliyun.com/mirror/docker-ce"
  
  
    
    
    target="_blank"
  
  
    rel="external nofollow noopener noreferrer"
  
  
  
>ã€Œå®˜æ–¹æ–‡æ¡£ã€</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo add-apt-repository <span class="s2">&#34;deb [arch=arm64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="42å®˜æ–¹æº">4.2ã€å®˜æ–¹æº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo add-apt-repository <span class="s2">&#34;deb [arch=arm64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>$(lsb_release -cs)</code>æ˜¯è·å–å½“å‰ Ubuntu ä»£å·</p>
<p>å¦‚æœæ²¡æœ‰ç§‘å­¦ä¸Šç½‘æ‰‹æ®µï¼Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘æº</p>
</blockquote>
<h3 id="5å®‰è£…-docker">5ã€å®‰è£… docker</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> apt install -y docker-ce
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6é…ç½®é•œåƒä»“åº“">6ã€é…ç½®é•œåƒä»“åº“</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir /etc/docker
</span></span><span class="line"><span class="cl">cat &gt; /etc/docker/daemon.json <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">	&#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span class="line"><span class="cl"><span class="s">	&#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">	&#34;log-opts&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">		&#34;max-size&#34;: &#34;100m&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">	},
</span></span></span><span class="line"><span class="cl"><span class="s">	&#34;registry-mirrors&#34;: [&#34;https://xxx.mirror.aliyuncs.com&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å®Œæˆåé‡å¯</span>
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7éªŒè¯å®‰è£…">7ã€éªŒè¯å®‰è£…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemstl status docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£å¸¸è¿è¡Œåˆ™ä¼šæ˜¾ç¤º</p>
<p></p>
]]></description>
</item><item>
  <title>è§£å†³Hugoå­—æ•°ç»Ÿè®¡ä¸æ­£ç¡®</title>
  <link>https://ronin-zc.com/%E8%A7%A3%E5%86%B3hugo%E5%AD%97%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%B8%8D%E6%AD%A3%E7%A1%AE/</link>
  <pubDate>Wed, 11 May 2022 17:26:29 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/%E8%A7%A3%E5%86%B3hugo%E5%AD%97%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%B8%8D%E6%AD%A3%E7%A1%AE/</guid>
  <description><![CDATA[<p>åœ¨ Hugo çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">hasCJKLanguage</span> <span class="o">=</span> <span class="nb">true</span> <span class="c1"># å­—æ•°ç»Ÿè®¡æ·»åŠ ä¸­æ–‡æ”¯æŒ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡æ–°ç¼–è¯‘å³å¯</p>
]]></description>
</item><item>
  <title>å¦‚ä½•åœ¨Hugoå’ŒTyporaä¸­æ˜¾ç¤ºå›¾ç‰‡</title>
  <link>https://ronin-zc.com/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/</link>
  <pubDate>Wed, 11 May 2022 14:02:19 &#43;0800</pubDate>
  <author>RoninZc</author>
  <guid>https://ronin-zc.com/%E5%A6%82%E4%BD%95%E5%9C%A8hugo%E5%92%8Ctypora%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87/</guid>
  <description><![CDATA[<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p>Typora å¯ä»¥æ–¹ä¾¿çš„å°†æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°ï¼Œä½†æ˜¯ä¸åˆç†çš„è®¾ç½®å°†æ— æ³•é€‚åº”å„ç§é™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼ˆæ¯”å¦‚ï¼šhugoï¼‰çš„å›¾ç‰‡å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥è¦å¯¹ Typora è¿›è¡Œè®¾ç½®ã€‚</p>
<h3 id="ç›®æ ‡">ç›®æ ‡</h3>
<p>hugo çš„é»˜è®¤å›¾ç‰‡è·¯å¾„ä¸º <code>${site}/static/images</code>ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½® Typora çš„å›¾ç‰‡é»˜è®¤å¤åˆ¶åˆ°æ•´ä¸ªç›®å½•ã€‚å¹¶ä¸”è¾¾åˆ°åœ¨ç½‘ç«™å’Œ Typora ä¸­åŒæ—¶å¯æŸ¥çœ‹ã€‚</p>
<h3 id="è§£å†³">è§£å†³</h3>
<p>å¯¹äº Typora å›¾ç‰‡çš„é»˜è®¤å¤åˆ¶è·¯å¾„å¯ä»¥ç›´æ¥è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p></p>
<p>ä¹Ÿå¯ä»¥å†åŠ ä¸Š <code>static/images/${filename}/</code>ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†å›¾ç‰‡ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·é…ç½®å®Œä¼šå‘ç°ï¼ŒHugo è¯»å–å›¾ç‰‡çš„æ¡ä»¶æ»¡è¶³äº†ï¼ŒTypora é¢„è§ˆæ²¡æ³•æ»¡è¶³ï¼Œåœ¨è®¾ç½®é‡Œæˆ‘ä»¬ä¹Ÿæ‰¾åˆ°è°ƒæ•´çš„ä½ç½®ã€‚</p>
<p>å…¶å® Typora æœ‰ä¸€ä¸ªéšè—çš„é…ç½®ï¼Œ<code>æ ¼å¼( Format ) -&gt; å›¾åƒ( Image ) -&gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½•( Use Image Root Path )</code>ï¼Œå…·ä½“å¯ä»¥ä¾æ®ä¸‹å›¾ã€‚</p>
<p></p>
<p>é…ç½®æ˜¯åœ¨å½“ä¸ª <code>md</code> æ–‡ä»¶ä¸­ç”Ÿæ•ˆçš„ï¼Œåœ¨è®¾ç½®ååœ¨æ–‡ä»¶çš„å¼€å¤´ä¼šæ·»åŠ ä¸Š<code>typora-root-url: ../../../static/</code>ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„åŸç†äº†ã€‚</p>
]]></description>
</item></channel>
</rss>
